if (self.CavalryLogger) { CavalryLogger.start_js(["DXwXJ"]); }

__d('CSSAnimations',['cx','CSS'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i="_3yk",j=750,k={bounce:function l(m){c('CSS').addClass(m,i);setTimeout(c('CSS').removeClass.bind(null,m,i),j);},getBounceTimeout:function l(){return j;}};f.exports=k;}),null);
__d('Selectable',['cx','Arbiter','ArbiterMixin','CSS','DataStore','DOM','DOMQuery','Event','Style','TextSelection','Vector','getOverlayZIndex','shield','mixin'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();var k=new (c('Arbiter'))(),l=c('DOM').create('div',{className:"_102"}),m,n,o,p,q,r;function s(event){if(event.isRightClick()||event.isMiddleClick())return;var ca=event.getTarget();while(ca){var da=ca.getAttribute&&ca.getAttribute("data-selectable");switch(da){case "click":r=true;q=false;break;case "lasso":r=false;q=true;break;case "both":r=true;q=true;break;case "none":return;default:ca=ca.parentNode;continue;}break;}if(!ca)return;if(q){c('TextSelection').clearSelection();event.prevent();}var ea=c('Event').getPosition(event);m=ea.x;n=ea.y;o=event.getTarget();p=false;if(!event.ctrlKey&&!event.shiftKey&&!event.altKey&&!event.metaKey){k.inform("deselect");}else event.prevent();}function t(event){if(typeof m==="undefined")return;if(!q)return;p=true;if(!l.parentNode){var ca=c('getOverlayZIndex')(o,document.body);c('Style').set(l,'z-index',ca);c('DOM').appendContent(document.body,l);}var da=c('Event').getPosition(event),ea=z(m,n,da.x,da.y);k.inform("lasso",ea);}function u(event){if(typeof m==="undefined")return;var ca=event.getTarget();if(p){var da=c('Event').getPosition(event),ea=z(m,n,da.x,da.y);k.inform("lasso",ea);}else if(o===ca&&r){var fa,ga=event.getTarget();while(ga){fa=c('DataStore').get(ga,"selectable-data");if(fa)break;ga=ga.parentNode;}if(fa&&fa.instance)fa.instance._clickHandler({elem:ga,meta:event.ctrlKey||event.altKey||event.metaKey,shift:event.shiftKey});}c('DOM').remove(l);k.inform("select");o=null;m=undefined;p=false;}k.subscribe("lasso",function(ca,da){c('Style').set(l,"left",da.minX+"px");c('Style').set(l,"top",da.minY+"px");c('Style').set(l,"width",da.maxX-da.minX+"px");c('Style').set(l,"height",da.maxY-da.minY+"px");});var v=0,w;function x(){if(v++!==0)return;w={down:c('Event').listen(document.documentElement,"mousedown",s),move:c('Event').listen(document.documentElement,"mousemove",t),up:c('Event').listen(document.documentElement,"mouseup",u)};}function y(){if(--v!==0)return;w.down.remove();w.move.remove();w.up.remove();}function z(ca,da,ea,fa){var ga;if(ca>ea){ga=ca;ca=ea;ea=ga;}if(da>fa){ga=da;da=fa;fa=ga;}return {minX:ca,minY:da,maxX:ea,maxY:fa};}function aa(ca,da){if(ca.minX===ca.maxX&&ca.minY===ca.maxY)return false;if(da.minX===da.maxX&&da.minY===da.maxY)return false;return ca.maxX>=da.minX&&ca.maxY>=da.minY&&da.maxX>=ca.minX&&da.maxY>=ca.minY;}i=babelHelpers.inherits(ba,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function ba(ca,da,ea,fa){'use strict';j.constructor.call(this);this._root=ca;this._selector=da;this._selected=ea;fa=fa||{};this._sticky=fa.sticky!==false;this._elements=[];this._attachListeners();this.rematch();}ba.prototype._lassoHandler=function(ca,da){'use strict';var ea=this._elements,fa=ea.length;while(fa-->0){var ga=ea[fa],ha=c('DataStore').get(ga,"selectable-data");if(!ha)continue;if(ha.lassoed^aa(ha.bounds,da)){ha.lassoed=!ha.lassoed;c('CSS').toggleClass(ea[fa],this._selected);this._lassoAffected=true;}}};ba.prototype._selectHandler=function(ca){'use strict';if(this._lassoAffected){this._elements.forEach(function(da){var ea=c('DataStore').get(da,"selectable-data");if(!ea)return;ea.lassoed=false;});this._changed=true;this._lassoAffected=false;this._primary=null;}if(this._changed){this._changed=false;this._selection();}};ba.prototype._deselectHandler=function(ca){'use strict';if(!this._sticky)if(this.deselect())this._changed=true;};ba.prototype._clickHandler=function(ca){'use strict';var da=this._selected;if(ca.meta||ca.shift&&!this._primary){c('CSS').toggleClass(ca.elem,da);this._primary=ca.elem;this._secondary=null;}else if(ca.shift&&this._primary){if(this._secondary)this.range(this._primary,this._secondary).forEach(function(ea){c('CSS').removeClass(ea,da);});this.range(this._primary,ca.elem).forEach(function(ea){c('CSS').addClass(ea,da);});this._secondary=ca.elem;}else if(this._sticky){c('CSS').toggleClass(ca.elem,da);if(c('CSS').hasClass(ca.elem,da)){this._primary=ca.elem;}else this._primary=null;this._secondary=null;}else{this._elements.forEach(function(ea){c('CSS').removeClass(ea,da);});c('CSS').addClass(ca.elem,da);this._primary=ca.elem;this._secondary=null;}this._changed=true;};ba.prototype._selection=function(){'use strict';var ca=this._selected,da=this._elements,ea=[];for(var fa=0;fa<da.length;fa++)if(c('CSS').hasClass(da[fa],ca))ea.push(da[fa]);this.inform("selection",ea);};ba.prototype.selectAll=function(){'use strict';var ca=this._selected,da=this._elements;for(var ea=0;ea<da.length;ea++)c('CSS').addClass(da[ea],ca);this.inform("selection",da);};ba.prototype.setSticky=function(ca){'use strict';this._sticky=ca;};ba.prototype.deselect=function(){'use strict';var ca=false;this._elements.forEach(function(da){if(ca||c('CSS').hasClass(da,this._selected)){c('CSS').removeClass(da,this._selected);ca=true;}}.bind(this));this._primary=null;return ca;};ba.prototype.range=function(ca,da){'use strict';if(ca===da)return [ca];var ea,fa,ga=this._elements;for(var ha=0;ha<ga.length;ha++)if(ca===ga[ha]){ea=ha;if(typeof fa!=="undefined")break;}else if(da===ga[ha]){fa=ha;if(typeof ea!=="undefined")break;}if(ha===ga.length)return [];if(ea>fa){return ga.slice(fa,ea+1);}else return ga.slice(ea,fa+1);};ba.prototype._attachListeners=function(){'use strict';x();var ca=c('Event').listen(document.body,'mousedown',function(){this.reparent();ca.remove();}.bind(this),c('Event').Priority.URGENT);this._subscriptions=[k.subscribe("lasso",this._lassoHandler.bind(this)),k.subscribe("select",this._selectHandler.bind(this)),k.subscribe("deselect",this._deselectHandler.bind(this))];this._listeners=[c('Event').listen(window,"resize",c('shield')(this.recalculate,this)),ca];};ba.prototype._detachListeners=function(){'use strict';while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();while(this._listeners.length)this._listeners.pop().remove();this._subscriptions=null;this._listeners=null;if(this._scrollListener){this._scrollListener.remove();this._scrollListener=null;}y();};ba.prototype.rematch=function(){'use strict';var ca=c('DOMQuery').scry(this._root,this._selector),da=this._elements;for(var ea=0;ea<da.length;ea++){for(var fa=0;fa<ca.length;fa++)if(da[ea]===ca[fa])break;if(fa===ca.length)c('DataStore').remove(da[ea],"selectable-data");}this._elements=ca;this.recalculate(true);};ba.prototype.recalculate=function(ca){'use strict';var da=this._elements;for(var ea=0;ea<da.length;ea++)if(!ca||!c('DataStore').get(da[ea],"selectable-data")){var fa={instance:this},ga=c('Vector').getElementPosition(da[ea]),ha=c('Vector').getElementDimensions(da[ea]).add(ga);fa.bounds=z(ga.x,ga.y,ha.x,ha.y);c('DataStore').set(da[ea],"selectable-data",fa);}};ba.prototype.reparent=function(){'use strict';if(this._scrollListener)this._scrollListener.remove();var ca=c('Style').getScrollParent(this._root);if(ca&&ca!==window){this._scrollListener=c('Event').listen(ca,'scroll',function(){this.recalculate();}.bind(this));}else this._scrollListener=null;this.recalculate();};ba.prototype.destroy=function(){'use strict';this._detachListeners();var ca=this._elements;for(var da=0;da<ca.length;da++)c('DataStore').remove(ca[da],"selectable-data");this._elements=null;};f.exports=ba;}),null);
__d('SubscribableSet',['ArbiterMixin','isScalar','mixin'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);this._map={};this._items=[];if(k)k.forEach(this.add.bind(this));}j.prototype.contains=function(k){'use strict';return k in this._map;};j.prototype.add=function(k){'use strict';if(!this.contains(k)){this._items.push(k);this._map[k]=k;this.inform('add',{item:k});this.inform('change');}};j.prototype.addAll=function(k){'use strict';k.forEach(this.add.bind(this));};j.prototype.remove=function(k){'use strict';if(this.contains(k)){delete this._map[k];this._items.splice(this._items.indexOf(k),1);this.inform('remove',{item:k});this.inform('change');}};j.prototype.clear=function(){'use strict';this.getItems().forEach(this.remove.bind(this));};j.prototype.getLength=function(){'use strict';return this._items.length;};j.prototype.getItems=function(){'use strict';return this._items.slice(0);};f.exports=j;}),null);
__d('BadgedButton',['cx','Button.react','React','joinClasses'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';var l=this.props.count>1?this.props.pluralLabel:this.props.singularLabel,m=null;if(this.props.count>0)m=c('React').createElement('div',{className:"_4_-d"+(this.props.bounce?' '+"_3yk":'')},this.props.count);return (c('React').createElement('div',babelHelpers['extends']({},this.props,{className:c('joinClasses')(this.props.className,"_4_-e")}),c('React').createElement(c('Button.react'),{label:l,use:'confirm',size:'large',className:"_4_-f"}),m));};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('ProfilePicRequestCreator',['URI','XProfilePicSaver','tidyEvent'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){'use strict';this.saver=new (c('XProfilePicSaver'))(String(i),String(j));c('tidyEvent')([this.saver.subscribe('success',this.$ProfilePicRequestCreator1.bind(this)),this.saver.subscribe('error',this.$ProfilePicRequestCreator2.bind(this))]);this.setSuccessURI(new (c('URI'))('/profile.php').setQueryData({id:j}));this.setErrorURI(new (c('URI'))('/photo.php').setQueryData({pid:i,profile_id:j}));}h.prototype.setSuccessURI=function(i){'use strict';this.$ProfilePicRequestCreator3=i;return this;};h.prototype.setErrorURI=function(i){'use strict';this.$ProfilePicRequestCreator4=i;return this;};h.prototype.setProfilePhotoSource=function(i){'use strict';i&&this.saver.setProfilePhotoSource(i);return this;};h.prototype.setProfilePhotoMethod=function(i){'use strict';i&&this.saver.setProfilePhotoMethod(i);return this;};h.prototype.setFlowType=function(i){'use strict';this.saver.setFlowType(i);return this;};h.prototype.savePic=function(){'use strict';this.saver.saveAsProfilePic();};h.prototype.saveCrop=function(i,j){'use strict';this.saver.saveCroppedProfilePic({x:i.x/j.x,y:i.y/j.y,width:i.width/j.x,height:i.height/j.y});};h.prototype.$ProfilePicRequestCreator1=function(){'use strict';this.$ProfilePicRequestCreator3.go(true);};h.prototype.$ProfilePicRequestCreator2=function(){'use strict';this.$ProfilePicRequestCreator4.go(true);};f.exports=h;}),null);
__d('SpotlightViewerBottomBar',['cx','LeftRight.react','React','joinClasses'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';var l=Array.isArray(this.props.children)?this.props.children:[this.props.children],m="_4_8n _51an";if(this.props.className)m=c('joinClasses')(m,this.props.className);if(l.length===1)return (c('React').createElement('div',{className:m},l[0]));m=c('joinClasses')(m,"_50-m");return (c('React').createElement(c('LeftRight.react'),{className:m},l[0],l[1]));};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('SpotlightViewerBottomBarGroup',['cx','React'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';var l=this.props.itemmargin||'right',m=(l=='left'?"marginLeft":'')+(l=='right'?' '+"marginRight":'')+(' '+"_4_8i");return (c('React').createElement('div',{className:m},this.props.children));};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('SpotlightViewerCheck',['cx','Link.react','React'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;function k(){var l,m;'use strict';for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return l=(m=j.constructor).call.apply(m,[this].concat(o)),this.state={selected:this.props.selected},l;}k.prototype.render=function(){'use strict';var l=(this.props.selected?"_4_d3":'')+(' '+"_4_d2")+(' '+"_51an")+(' '+"_4bi")+(this.props.bounce?' '+"_3yk":'');return c('React').createElement(c('Link.react'),{className:l,onClick:this.props.onClick});};f.exports=k;}),null);
__d('SpotlightViewerCroppingBar',['cx','fbt','React','SpotlightViewerBottomBar','SpotlightViewerBottomBarGroup','SpotlightViewerBottomBarLink'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();j=babelHelpers.inherits(l,c('React').Component);k=j&&j.prototype;function l(){var m,n;'use strict';for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return m=(n=k.constructor).call.apply(n,[this].concat(p)),this.$SpotlightViewerCroppingBar1=function(){if(this.props.saving)return (c('React').createElement('span',{className:"_4_8j"},i._("\u6b63\u5728\u5132\u5b58\u4f60\u7684\u65b0\u5927\u982d\u8cbc\u7167")));return [c('React').createElement(c('SpotlightViewerBottomBarLink'),{onClick:this.props.onDone},i._("\u5b8c\u6210\u526a\u88c1")),c('React').createElement(c('SpotlightViewerBottomBarLink'),{onClick:this.props.onCancel},i._("\u53d6\u6d88"))];}.bind(this),m;}l.prototype.render=function(){'use strict';return (c('React').createElement(c('SpotlightViewerBottomBar'),null,c('React').createElement(c('SpotlightViewerBottomBarGroup'),null,this.$SpotlightViewerCroppingBar1())));};f.exports=l;}),null);
__d('SpotlightViewerOptionsMenu',['fbt','ContextualLayerAutoFlip','React','ReactMenu','PopoverMenu.react','SpotlightViewerBottomBarLink'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('ReactMenu').Item;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;'use strict';for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return m=(n=j.constructor).call.apply(n,[this].concat(p)),this.$SpotlightViewerOptionsMenu1=function(r,s){this.props.callback&&this.props.callback(s.item.getValue());}.bind(this),m;}l.prototype.render=function(){'use strict';var m=c('React').createElement(c('ReactMenu'),{onItemClick:this.$SpotlightViewerOptionsMenu1},this.props.items.map(function(n){return (c('React').createElement(k,{value:n.value,title:n.label,href:n.href||'#'},n.label));}));return (c('React').createElement(c('PopoverMenu.react'),{menu:m,layerBehaviors:[c('ContextualLayerAutoFlip')],onShow:this.props.onShow,onHide:this.props.onHide},c('React').createElement(c('SpotlightViewerBottomBarLink'),null,h._("\u9078\u9805"))));};f.exports=l;}),null);
__d('SpotlightViewerUpdateUrlOnNav',['PageTransitions','PhotoUtils','URI','VaultBoxURI','goURI'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this._viewer=i;this._registered=false;this._shouldUpdateURL=false;this._suppressNextEvent=false;}h.prototype.enable=function(){'use strict';this._registered=false;this._subscriptions=[this._viewer.subscribe('open',this._onOpen.bind(this)),this._viewer.subscribe('close',this._onClose.bind(this)),this._viewer.subscribe('photo_change',this._onPhotoChange.bind(this))];this._enabled=true;};h.prototype.disable=function(){'use strict';for(var i=0;i<this._subscriptions.length;i++)this._subscriptions[i].unsubscribe();this._subscriptions=[];this._enabled=false;};h.prototype._registerTransition=function(){'use strict';if(this._registered)return;c('PageTransitions').registerHandler(this._handleTransition.bind(this));this._registered=true;};h.prototype._handleTransition=function(i){'use strict';if(!this._enabled)return false;if(this._shouldUpdateURL){this._shouldUpdateURL=false;c('PageTransitions').transitionComplete();return true;}this._suppressNextEvent=true;if(this._viewer.openURL(i)){c('PageTransitions').transitionComplete();return true;}if(this._viewer.isOpen()&&c('VaultBoxURI').isVaultArchiveURI(i)){this._suppressNextEvent=true;this._viewer.close();c('PageTransitions').transitionComplete();return true;}this._suppressNextEvent=false;return false;};h.prototype._onOpen=function(){'use strict';this._registerTransition();this._openURI=c('URI').getMostRecentURI().getUnqualifiedURI();};h.prototype._onClose=function(){'use strict';if(this._suppressNextEvent){this._suppressNextEvent=false;return;}var i=this._viewer.removePermalinkQueryData(this._openURI);this._updateURL(i);};h.prototype._onPhotoChange=function(i,j){'use strict';if(this._suppressNextEvent){this._suppressNextEvent=false;return;}this._updateURL(c('PhotoUtils').getPermalinkFromData(j));};h.prototype._updateURL=function(i){'use strict';this._shouldUpdateURL=true;c('goURI')(i);};f.exports=h;}),null);
__d("VaultImageCache",[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=[],i={},j={addImageProvider:function k(l){h.push(l);},invokeCallbackWithURL:function k(l,m){if(i[l]){m(i[l]);return;}for(var n=0;n<h.length;n++){var o=h[n](l,function(p){i[l]=p;m(p);});if(o)return;}}};f.exports=j;}),null);
__d('VaultSelectableGrid',['fbt','ArbiterMixin','AsyncRequest','CSS','CSSAnimations','DOM','DOMQuery','Event','Form','Parent','PhotosUploadWaterfall','Selectable','SubscribableSet','VaultImageCache','shield'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(event){var m=event.getTarget();if(m.classList.contains("fbVaultSelectableGridImageCheckContainer"))m=m.firstChild;if(!c('DOM').isNodeOfType(m,'input')||m.type!='checkbox')return;var n=m.value;if(!n)return;if(!this.selectionSet.contains(n)){this.selectionSet.clear();this.selectionSet.add(n);}else this.selectionSet.remove(n);}function j(m,n){this.bulkChange(function(){var o=new (c('SubscribableSet'))();n.forEach(function(q){var r=c('DOMQuery').find(q,'input[type="checkbox"]');o.add(r.value);});var p=this.selectionSet.getLength();c('DOMQuery').scry(this.grid,'.fbVaultSelectableGridItem input[type="checkbox"]').forEach(function(q){if(!o.contains(q.value))this.selectionSet.remove(q.value);}.bind(this));this.selectionSet.addAll(o.getItems());if(this.waterfallID)c('PhotosUploadWaterfall').sendSignal({qn:this.waterfallID,step:c('PhotosUploadWaterfall').VAULT_IMAGES_SELECTED,count:this.selectionSet.getLength()-p,uploader:this.origin,source:c('PhotosUploadWaterfall').GRID});});}function k(m,n){c('DOMQuery').scry(m,'input[type="checkbox"]').forEach(n);}function l(m,n,o,p,q){this.grid=m;this.form=c('Parent').byTag(this.grid,'form');this.waterfallID=p;this.origin=q;this.setSelectionSet(new (c('SubscribableSet'))(n));this.multiselect=o;if(this.multiselect){this._initMultiselect();}else this._initNonMultiselect();c('Event').listen(this.form,'submit',function(){this.submitForm();return false;}.bind(this));var r=function(s,t){var u=c('DOMQuery').scry(this.grid,'input[value="'+s+'"]');if(u){var v=c('Parent').byClass(u[0],"fbVaultSelectableGridItem");if(v){var w=c('DOM').scry(v,".fbVaultSelectableGridImage img");if(w.length>0){t(w[0].src);return true;}}}return false;}.bind(this);c('VaultImageCache').addImageProvider(r);c('Event').listen(this.grid,'click',function(event){var s=c('Parent').byClass(event.getTarget(),'fbVaultSelectableGridImageCheckContainer');if(s)c('CSSAnimations').bounce(s);});}Object.assign(l,{getSerializedFormData:function m(n,o,p,q){var r=c('Form').serialize(o),s=c('DOM').scry(o,'input[type="checkbox"]')[0].name;r[s]=n.getItems();r.source=q||c('PhotosUploadWaterfall').GRID;r.qn=p;r.application=c('PhotosUploadWaterfall').APP_ARCHIVE;return r;}});Object.assign(l.prototype,c('ArbiterMixin'),{selectAll:function m(){this.selectable&&this.selectable.selectAll();},_initMultiselect:function m(){this.selectable=new (c('Selectable'))(this.grid,'.fbVaultSelectableGridItem','fbVaultSelectableGridSelected',{lassoable:true,sticky:true});this.selectable.subscribe('selection',function(n,o){setTimeout(c('shield')(j,this,n,o),0);}.bind(this));},_initNonMultiselect:function m(){c('Event').listen(this.grid,'click',i.bind(this));},setSelectionSet:function m(n){if(n==this.selectionSet)return;this.selectionSet=n;this.selectionSet.subscribe('change',this.updateGridState.bind(this));this.updateGridState();},getRoot:function m(){return this.grid;},getSelectedCount:function m(){return this.selectionSet.getLength();},switchTab:function m(n){c('CSS').conditionClass(this.grid,'onlySelected',n==='selected');c('CSS').conditionClass(this.grid,'onlyVault',n==='vault');c('CSS').conditionClass(this.grid,'onlyRecent',n==='recent');c('CSS').conditionClass(this.grid,'showingUpload',n==='upload');},getSelectedImageIDs:function m(){return this.selectionSet.getItems();},getSelectionSet:function m(){return this.selectionSet;},itemsAddedOrRemoved:function m(){this.selectable&&this.selectable.rematch();},bulkChange:function m(n){if(this.disableUpdates){n.call(this);}else{this.disableUpdates=true;n.call(this);this.disableUpdates=false;}this.updateGridState();},updateGridState:function m(){if(this._disableUpdates)return;k(this.form,function(n){var o=n.value,p=this.selectionSet.contains(o);n.checked=p;var q=c('Parent').byClass(n,'fbVaultSelectableGridItem');if(q){c('CSS').conditionClass(q,'fbVaultSelectableGridSelected',p);var r=c('DOM').scry(q,'.fbVaultSelectableGridImageCheckTooltip');if(r.length>0){var s=r[0];if(n.checked){s.setAttribute('aria-label',h._("\u53d6\u6d88\u9078\u53d6"));}else s.setAttribute('aria-label',h._("\u9078\u64c7"));}}}.bind(this));c('CSS').conditionClass(this.grid,'fbVaultSelectableGridHasSelected',this.getSelectedCount()>0);this.inform('change');},submitForm:function m(n,o){var p=l.getSerializedFormData(this.selectionSet,this.form,this.waterfallID,o),q=n?c('Parent').byClass(n,'stat_elem'):this.form;new (c('AsyncRequest'))(this.form.action).setData(p).setStatusElement(q).setHandler(function(r){c('Event').fire(this.form,'success',{response:r});this.inform('submitted');}.bind(this)).send();},setWaterfallID:function m(n){this.waterfallID=n;}});f.exports=l;}),null);
__d('VaultPageGrid',['Event','Arbiter','AsyncDialog','AsyncRequest','CSS','DOM','DOMQuery','KeyedCallbackManager','Parent','PhotosUploadWaterfall','SubscribableSet','VaultSelectableGrid','Vector','ViewportBounds','VaultBoxURI','Style','URI','$','arrayContains'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='VaultPageGrid/registerSelectableGrid-',i='VaultPageGrid/appendNewImages-',j=new (c('KeyedCallbackManager'))();function k(l,m,n,o,p,q){var r=this._selectionSet=new (c('SubscribableSet'))();n.setSelectionSet(this._selectionSet);this._waterfallID=q;this._form=o;var s={};s[l]=this;j.addResourcesAndExecute(s);var t=p.imageCount,u=c('Vector').getElementPosition(m).y-c('ViewportBounds').getTop();c('Event').listen(window,'scroll',function(){var y=c('Vector').getScrollPosition().y,z=c('Vector').getElementDimensions(o).y+u;c('CSS').conditionClass(m,'fbVaultPageFixedHeaderSticky',y>u&&y<z);});r.subscribe('change',function(){n.setHasImagesSelected(r.getLength()>0);});var v=function y(){c('DOMQuery').scry(o,'.fbVaultSelectableGridSelected').forEach(function(z){c('CSS').removeClass(z,'fbVaultSelectableGridSelected');});c('DOMQuery').scry(o,'input[type="checkbox"]').forEach(function(z){z.name=='vault_image_ids[]'&&(z.checked=false);});r.clear();};n.subscribe('cancel',function(){c('PhotosUploadWaterfall').sendSignal({qn:q,step:c('PhotosUploadWaterfall').SELECT_CANCELED,uploader:c('PhotosUploadWaterfall').APP_ARCHIVE});v();});n.subscribe('delete',function(){new (c('AsyncRequest'))('/ajax/vault/delete.php').setData(c('VaultSelectableGrid').getSerializedFormData(r,o,q)).setStatusElement(o).send();});c('Arbiter').subscribe(h+l,function(y,z){this.registerSelectableGrid(z);}.bind(this));c('Arbiter').subscribe(i+l,function(y,z){this.appendNewImages(z.timestamp,z.newGrid);}.bind(this));c('Arbiter').subscribe(k.REMOVE_IMAGES_EVENT,function(y,z){c('DOM').scry(o,'.fbVaultSelectableGridItem').forEach(function(ba){var ca=c('DOM').find(ba,'input[type="checkbox"]').value;if(c('arrayContains')(z,ca)){var da=c('DOM').find(ba,'.fbVaultSelectableGridImage'),ea=c('Style').get(da,'width'),fa=c('Style').get(da,'height');c('Style').set(ba,'width',ea);c('Style').set(ba,'height',fa);c('Style').set(ba,'line-height',fa);c('DOM').setContent(ba,p.deletedIcon.cloneNode(true));c('CSS').addClass(ba,'fbVaultSelectableGridDeletedImage');c('CSS').removeClass(ba,'fbVaultSelectableGridItem');}});r.clear();var aa=c('DOM').scry(document.body,'.fbVaultPageGridImageCount')[0];if(aa){t-=z.length;c('DOM').setContent(aa,t);}this._selectableGrids.forEach(function(ba){ba.itemsAddedOrRemoved();});}.bind(this));c('Arbiter').subscribe('VaultSharerDialog/imagesShared',v);var w=c('DOM').create('div',{className:'fbVaultPageSelectableBg'});w.setAttribute('data-selectable','lasso');c('DOM').prependContent(c('$')('contentCol'),w);var x=c('Arbiter').subscribe('page_transition',function(){if(!c('VaultBoxURI').isVaultArchiveURI(c('URI').getNextURI())){c('DOM').remove(w);x.unsubscribe();w=null;}});}Object.assign(k.prototype,{_selectableGrids:[],appendNewImages:function l(m,n){var o=c('$')('month_grid_'+m+'_'),p=c('DOM').scry(o,'.fbVaultSelectableGrid')[0];while(n.firstChild)p.appendChild(n.firstChild);c('DOM').remove(n);this._selectableGrids.forEach(function(q){q.itemsAddedOrRemoved();});},registerSelectableGrid:function l(m){m.getSelectedImageIDs().forEach(this._selectionSet.add.bind(this._selectionSet));m.setSelectionSet(this._selectionSet);this._selectableGrids.push(m);m.setWaterfallID(this._waterfallID);},getSelectionSet:function l(){return this._selectionSet;},createPost:function l(m){var n=new (c('AsyncRequest'))(this._form.action).setData(c('VaultSelectableGrid').getSerializedFormData(this._selectionSet,this._form,this._waterfallID)).setStatusElement(c('Parent').byClass(m,'stat_elem')).setRelativeTo(m).setHandler(function(o){c('Event').fire(this._form,'success',{response:o});}.bind(this));c('AsyncDialog').send(n);}});Object.assign(k,{REMOVE_IMAGES_EVENT:'VaultPageGrid/removeImagesEvent',appendNewImages:function l(m,n,o){c('Arbiter').inform(i+m,{timestamp:n,newGrid:o},c('Arbiter').BEHAVIOR_PERSISTENT);},insertNewPagelet:function l(m,n,o){c('DOM').find(document.body,'.fbVaultPageMainPagelet').appendChild(o);c('Arbiter').inform(h+m,n,c('Arbiter').BEHAVIOR_PERSISTENT);},getInstanceWithCallback:function l(m,n){j.executeOrEnqueue(m,n);},getInstance:function l(m){return j.getResource(m);}});f.exports=k;}),null);
__d('SpotlightVaultViewer',['cx','fbt','Arbiter','ArbiterMixin','AsyncDialog','AsyncRequest','BadgedButton','CSSAnimations','LoadingIndicator.react','Parent','Photocrop2','PhotosConst','PhotoStore','PhotosUploadWaterfall','PhotoUtils','ProfilePicRequestCreator','ProfilePictureFlowLogging','React','ReactDOM','SpotlightViewer','SpotlightViewerAutoResize','SpotlightViewerBehaviorsMixin','SpotlightViewerBottomBar','SpotlightViewerBottomBarGroup','SpotlightViewerBottomBarLink','SpotlightViewerCheck','SpotlightViewerClose','SpotlightViewerCoreMixin','SpotlightViewerCroppingBar','SpotlightViewerDimensionMixin','SpotlightViewerOptionsMenu','SpotlightViewerPagers','SpotlightViewerPageWithKeys','SpotlightViewerUpdateUrlOnNav','SpotlightViewport','SubscriptionsHandler','URI','VaultBoxURI','VaultPageGrid','Vector'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'SpotlightVaultViewer',mixins:[c('ArbiterMixin'),c('SpotlightViewerBehaviorsMixin'),c('SpotlightViewerCoreMixin'),c('SpotlightViewerDimensionMixin')],behaviors:[c('SpotlightViewerUpdateUrlOnNav'),c('SpotlightViewerPageWithKeys'),c('SpotlightViewerAutoResize')],getViewerID:function k(){return 'vaultbox';},optionsMenuValues:{DOWNLOAD:0,CROP:1,ROTATE_LEFT:2,ROTATE_RIGHT:3,MAKE_COVER_PHOTO:4},getInitialState:function k(){this._grid=c('VaultPageGrid').getInstance(this.props.gridid);this._subscriptions=new (c('SubscriptionsHandler'))();return {photoData:this._getInitialPhotoData(),open:true,selectionSet:this._grid.getSelectionSet(),croppingMode:false,savingMode:false,menuOpen:false,bounce:false};},_getInitialPhotoData:function k(){var l=c('PhotoStore').getIndexForID(this.props.setid,this.props.photoid),m=c('PhotoStore').getByIndexImmediate(this.props.setid,l);return m?m:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function k(){if(!this.props.normaldimensions||!this.props.thumbsrc)return null;var l=c('Vector').deserialize(this.props.normaldimensions),m={id:this.props.photoid,image1:{width:l.x,height:l.y,uri:this.props.thumbsrc}};if(this.props.hiresdimensions){var n=c('Vector').deserialize(this.props.hiresdimensions);m.image2={width:n.x,height:n.y,uri:this.props.thumbsrc};}return m;},_enableSubscriptions:function k(){this._subscriptions.addSubscriptions(c('Arbiter').subscribe('VaultSharerDialog/imagesShared',this.close),c('Arbiter').subscribe('SpotlightVaultViewer/imageDeleted',this._onDelete),this.viewState.subscribe('photo_fetch',this.setState.bind(this,{photoData:null},null)));},removePermalinkQueryData:function k(l){if(c('VaultBoxURI').isVaultBoxURI(l))return new (c('URI'))(l).removeQueryData('view_image');return l;},_onShareClick:function k(event){if(this.state.selectionSet.getLength()===0){this.state.selectionSet.add(this._getCurrentFBID());this.setState({selectionSet:this.state.selectionSet});}this._grid.createPost(event.target);},_onSelect:function k(){var l=this._getCurrentFBID();if(!this.state.selectionSet.contains(l)){this.state.selectionSet.add(l);}else this.state.selectionSet.remove(l);this.setState({selectionSet:this.state.selectionSet,bounce:true});setTimeout(this.setState.bind(this,{bounce:false}),c('CSSAnimations').getBounceTimeout());},_onClickOptions:function k(l){if(l==this.optionsMenuValues.CROP){this._enableCropping();}else if(l==this.optionsMenuValues.ROTATE_LEFT){this._rotate('left');}else if(l==this.optionsMenuValues.ROTATE_RIGHT){this._rotate('right');}else if(l==this.optionsMenuValues.MAKE_COVER_PHOTO)this.close();},_rotate:function k(l){var m=this._getCurrentFBID(),n={fbid:m,cs_ver:c('PhotosConst').VIEWER_VAULTBOX};n[l]=1;var o=this.viewState.getPosition();new (c('AsyncRequest'))('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(n).setFinallyHandler(this.rotationComplete.bind(this,o)).setErrorHandler(this.rotationComplete.bind(this,o)).setMethod('POST').setReadOnly(false).send();this.viewState.inform('photo_fetch');},rotationComplete:function k(l){if(l==this.viewState.getPosition())c('PhotoStore').getByIndex(this.props.setid,l,this._updatePhoto);},_enableCropping:function k(){c('ProfilePictureFlowLogging').setAction(c('ProfilePictureFlowLogging').action.MAKE_PROFILE).setFlowType(c('ProfilePictureFlowLogging').flow.VAULT).log(c('ProfilePictureFlowLogging').step.CROP);var l=this.getDimensions().getOriginalDimensionsFromPhoto(this.state.photoData);this._photocrop=new (c('Photocrop2'))(c('ReactDOM').findDOMNode(this.refs.image),{},l);this.setState({croppingMode:true});},_disableCropping:function k(){c('ProfilePictureFlowLogging').setFlowType(c('ProfilePictureFlowLogging').flow.VAULT).log(c('ProfilePictureFlowLogging').step.CANCEL);this._photocrop&&this._photocrop.done(false);this.setState({croppingMode:false});},componentDidMount:function k(){if(this.props.enablecropping)this._enableCropping();},_crop:function k(){var l=this._getCurrentFBID(),m=this.state.photoData.owner.id,n=this._photocrop.done(),o=this.getDimensions().getOriginalDimensionsFromPhoto(this.state.photoData);new (c('ProfilePicRequestCreator'))(l,m).setErrorURI(c('URI').getRequestURI()).setFlowType(c('ProfilePictureFlowLogging').flow.VAULT).saveCrop(n,o);this.setState({croppingMode:false,savingMode:true});},_isCroppingEnabled:function k(){return this.state.croppingMode||this.state.savingMode;},_delete:function k(event){var l=new (c('AsyncRequest'))('/ajax/vault/delete.php').setData({vault_image_ids:[this._getCurrentFBID()],source:c('PhotosUploadWaterfall').SPOTLIGHT_VAULT_VIEWER}).setStatusElement(c('Parent').byClass(event.target,'stat_elem')).setRelativeTo(event.target);c('AsyncDialog').send(l);},_onDelete:function k(){this.close();c('PhotoStore').clearSetCache(this.props.setid);},openURL:function k(l){var m=l.getQueryData('view_image').view_image;if(!m)return false;this.viewState.page(this.viewState.getRelativeMovement(m));return true;},_getBottomBar:function k(){if(!this.state.photoData)return null;if(this._isCroppingEnabled())return (c('React').createElement(c('SpotlightViewerCroppingBar'),{onDone:this._crop,onCancel:this._disableCropping,saving:this.state.savingMode}));return (c('React').createElement(c('SpotlightViewerBottomBar'),{className:'stat_elem'},c('React').createElement(c('SpotlightViewerBottomBarGroup'),null,c('React').createElement(c('SpotlightViewerBottomBarLink'),{onClick:this._delete},i._("\u522a\u9664")),this._getOptionsMenu(),c('React').createElement('div',{className:"_4_8j"},c('React').createElement(c('LoadingIndicator.react'),{size:c('LoadingIndicator.react').SIZES.small,color:c('LoadingIndicator.react').COLORS.blue,showonasync:true,className:"_535k"}))),c('React').createElement(c('SpotlightViewerBottomBarGroup'),{itemmargin:'left'},c('React').createElement(c('BadgedButton'),{onClick:this._onShareClick,className:"_4_8j",count:this.state.selectionSet.getLength(),singularLabel:i._("\u5206\u4eab\u76f8\u7247"),pluralLabel:i._("\u5206\u4eab\u76f8\u7247"),bounce:this.state.bounce}))));},_getCheck:function k(){if(!this.state.photoData||this._isCroppingEnabled())return null;var l=this.state.selectionSet.contains(this._getCurrentFBID());return (c('React').createElement(c('SpotlightViewerCheck'),{bounce:this.state.bounce,selected:l,onClick:this._onSelect}));},_getPagers:function k(){if(this._isCroppingEnabled())return null;return c('React').createElement(c('SpotlightViewerPagers'),null);},_getOptionsMenu:function k(){if(!this.state.photoData)return null;var l=[],m=c('PhotoUtils').getDownloadURLFromData(this.state.photoData);if(m)l.push({label:i._("\u4e0b\u8f09"),value:this.optionsMenuValues.DOWNLOAD,href:c('PhotoUtils').getDownloadURLFromData(this.state.photoData)});if(this.state.photoData.owner)l.push({label:i._("\u8a2d\u5b9a\u70ba\u5927\u982d\u8cbc\u7167"),value:this.optionsMenuValues.CROP});if(c('PhotoUtils').canViewerMakeCoverPhoto(this.state.photoData))l.push({label:i._("\u4f5c\u70ba\u5c01\u9762\u76f8\u7247"),value:this.optionsMenuValues.MAKE_COVER_PHOTO,href:c('PhotoUtils').getCoverPhotoURLFromData(this.state.photoData)});l.push({label:i._("\u5411\u5de6\u65cb\u8f49"),value:this.optionsMenuValues.ROTATE_LEFT});l.push({label:i._("\u5411\u53f3\u65cb\u8f49"),value:this.optionsMenuValues.ROTATE_RIGHT});return (c('React').createElement(c('SpotlightViewerOptionsMenu'),{items:l,callback:this._onClickOptions,onShow:this.setState.bind(this,{menuOpen:true},null),onHide:this.setState.bind(this,{menuOpen:false},null)}));},render:function k(){var l=this.getMedia(),m=this.getStageDimensions();return (c('React').createElement(c('SpotlightViewer'),{open:this.state.open,onHide:this.close},c('React').createElement(c('SpotlightViewport'),{active:this.state.menuOpen,onClick:this._onClickViewport,stageDimensions:m,media:l,showLoadingIndicator:!this.state.photoData},c('React').createElement(c('SpotlightViewerClose'),{onClick:this.close,position:'left'}),this._getCheck(),this._getBottomBar(),this._getPagers())));}});f.exports=j;}),null);
__d('VaultBoxInit',['AsyncRequest','DOM','PhotoStore','React','SpotlightVaultViewer','SpotlightViewerInit','VaultPageGrid'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={setID:'vault:images_by_date_taken',bootstrapWithElem:function i(j){c('SpotlightViewerInit').render(c('React').createElement(c('SpotlightVaultViewer'),{open:true,gridid:j.getAttribute('data-grid-id'),setid:h.setID,photoid:j.getAttribute('data-fbid'),thumbsrc:c('DOM').find(j,'img').src,hiresdimensions:j.getAttribute('data-hi-res-dimensions'),normaldimensions:j.getAttribute('data-normal-dimensions')}));if(!c('PhotoStore').hasBeenCreated(h.setID))new (c('AsyncRequest'))('/ajax/photos/vaultbox/init_react.php').setRelativeTo(j).setData({photoID:j.getAttribute('data-fbid')}).send();},bootstrapFromPermalink:function i(j,k,l,m){c('VaultPageGrid').getInstanceWithCallback(l,function(){c('SpotlightViewerInit').render(c('React').createElement(c('SpotlightVaultViewer'),{open:true,setid:h.setID,initialpayload:j,photoid:k,gridid:l,enablecropping:m.enableCropping}));});}};f.exports=h;}),null);
if (self.CavalryLogger) { CavalryLogger.start_js(["YbWSd"]); }

__d("CampfireLoggerEvents",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONSUME_READER_DRAFT:"consume_reader_draft",CONSUME_READER_PUBLISHED_NOTE:"consume_reader_published_note",CONSUME_READER_EXIT_DRAFT:"consume_reader_exit_draft",CONSUME_READER_EXIT_PUBLISHED:"consume_reader_exit_published",CONSUME_PERMALINK_DRAFT:"consume_permalink_draft",CONSUME_PERMALINK_PUBLISHED_NOTE:"consume_permalink_published_note",CONSUME_PERMALINK_EXIT_DRAFT:"consume_permalink_exit_draft",CONSUME_PERMALINK_EXIT_PUBLISHED:"consume_permalink_exit_published",CONSUME_AS_INSTANT_ARTICLE:"consume_as_instant_article",COMPOSE_CREATE_DRAFT:"compose_create_draft",COMPOSE_EDIT_DRAFT:"compose_edit_draft",COMPOSE_DELETE_DRAFT:"compose_delete_draft",COMPOSE_PUBLISH_DRAFT:"compose_publish_draft",COMPOSE_EDIT_PUBLISHED_NOTE:"compose_edit_published_note",COMPOSE_UPDATE_PUBLISHED_NOTE:"compose_update_published_note",COMPOSE_DELETE_PUBLISHED_NOTE:"compose_delete_published_note",COMPOSE_EXIT_COMPOSER:"compose_exit_composer"};}),null);
__d("CampfireLoggerNoteTypes",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CAMPFIRE:"campfire",MOBILE_CAMPFIRE:"mobile_campfire",OLD:"old"};}),null);
__d('CampfireTimeSpentMonitor',['BanzaiLogger','CampfireLoggerEvents','CampfireLoggerNoteTypes','Run'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){this.$CampfireTimeSpentMonitor1=i;this.$CampfireTimeSpentMonitor2=j;c('Run').onBeforeUnload(this.$CampfireTimeSpentMonitor4.bind(this));this.$CampfireTimeSpentMonitor3=Date.now();}h.prototype.$CampfireTimeSpentMonitor4=function(){var i=Date.now(),j=Math.round((i-this.$CampfireTimeSpentMonitor3)/1000);c('BanzaiLogger').log('CampfireNotesLoggerConfig',{event:c('CampfireLoggerEvents').CONSUME_PERMALINK_EXIT_PUBLISHED,event_time:i,note_id:Number(this.$CampfireTimeSpentMonitor1),note_type:c('CampfireLoggerNoteTypes').CAMPFIRE,author_id:Number(this.$CampfireTimeSpentMonitor2.ownerID),is_author_verified:this.$CampfireTimeSpentMonitor2.isAuthorVerified,is_author_page:this.$CampfireTimeSpentMonitor2.isAuthorPage,time_spent_reading_sec:j});};f.exports=h;}),null);
__d('SpotlightViewerClose',['cx','fbt','React','TooltipLink.react','joinClasses'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;m.prototype.render=function(){'use strict';var n=this.props.position=='left'?"_5wx3":"_5wx4",o=c('React').createElement('span',null,i._("\u6309 Esc \u9375\u95dc\u9589"));return (c('React').createElement(c('TooltipLink.react'),{className:c('joinClasses')("_4-o9 _50-m _51an",n),onClick:this.props.onClick,tooltip:o}));};function m(){'use strict';j.apply(this,arguments);}m.propTypes={position:l.oneOf(['left','right'])};m.defaultProps={position:'right'};f.exports=m;}),null);
__d('PhotoViewState',['ArbiterMixin','PhotoStore','PhotoUtils','SpotlightViewerLoggingEvents','mixin'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k,l,m){'use strict';i.constructor.call(this);var n=m||{};this._viewer=k;this._setID=l;this._position=n.position||0;this._preventPreload=n.preventPreload;this._reverse=n.reverse;this._updateCallback=n.updateCallback;this._preloaded={};}j.prototype._fetchCallback=function(k){'use strict';if(!this._viewer.isOpen())return;this._preload(k);this._log(c('SpotlightViewerLoggingEvents').DATA_FETCH_COMPLETE);};j.prototype._preload=function(k){'use strict';c('PhotoUtils').preload(this._viewer,k,function(l){this._preloaded[c('PhotoUtils').getFBIDFromData(l)]=true;}.bind(this));};j.prototype._preloadPhotosInRange=function(k,l){'use strict';var m=[];for(var n=k;n<=l;++n){var o=c('PhotoStore').getByIndexImmediate(this._setID,n);if(o&&!this._isPreloaded(o))m.push(o);}this._preload(m);};j.prototype._isPreloaded=function(k){'use strict';return this._preloaded[c('PhotoUtils').getFBIDFromData(k)];};j.prototype.getPosition=function(){'use strict';return this._position;};j.prototype.isValidMovement=function(k){'use strict';if(!c('PhotoStore').hasBeenCreated(this._setID))return false;if(c('PhotoStore').hasLooped(this._setID))return true;var l=this._position+k,m=c('PhotoStore').getAvailableRange(this._setID),n=m.offset+m.length-1;return l>=m.offset-1&&l<=n+1;};j.prototype.getRelativeMovement=function(k){'use strict';return c('PhotoStore').getIndexForID(this._setID,k)-this._position;};j.prototype.moveCursor=function(k){'use strict';if(!this.isValidMovement(k))return false;this._position+=k;return true;};j.prototype._page=function(k){'use strict';if(!this.moveCursor(k))return;this._log(c('SpotlightViewerLoggingEvents').PAGE_BEGIN);var l=c('PhotoStore').getByIndexImmediate(this._setID,this._position);if(!l){this.inform('photo_fetch');this._log(c('SpotlightViewerLoggingEvents').PHOTO_FETCH);}else if(!this._isPreloaded(l))this._preload([l]);c('PhotoStore').getByIndex(this._setID,this._position,this._updateCallback);this._loadMoreIfNecessary(k>0,j.BUFFER_SIZE);this._log(c('SpotlightViewerLoggingEvents').PAGE_COMPLETE);};j.prototype.loadMoreForwardIfNecessary=function(k){'use strict';if(this._preventPreload)return;var l=c('PhotoStore').getAvailableRange(this._setID),m=l.offset+l.length-1,n=this._position+k;if(n>m&&!c('PhotoStore').hasLooped(this._setID)){var o=c('PhotoStore').getCursorByIndexImmediate(this._setID,m);c('PhotoStore').fetchForward(this._setID,o,k,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(this._position+1,n);};j.prototype.loadMoreBackwardIfNecessary=function(k){'use strict';if(this._preventPreload)return;var l=c('PhotoStore').getAvailableRange(this._setID),m=this._position-k;if(m<l.offset&&!c('PhotoStore').hasLooped(this._setID)){var n=c('PhotoStore').getCursorByIndexImmediate(this._setID,l.offset);c('PhotoStore').fetchBackward(this._setID,n,k,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(m,this._position-1);};j.prototype._loadMoreIfNecessary=function(k,l){'use strict';if(k){this.loadMoreForwardIfNecessary(l);}else this.loadMoreBackwardIfNecessary(l);};j.prototype.displayFirst=function(){'use strict';if(!this._viewer.isOpen())return;c('PhotoStore').setPreFetchCallback(this._setID,function(){this._log(c('SpotlightViewerLoggingEvents').DATA_FETCH_BEGIN);}.bind(this));var k=function(l){if(!this._isPreloaded(l))this._preload([l]);this._updateCallback&&this._updateCallback(l);}.bind(this);c('PhotoStore').getByIndex(this._setID,this._position,k);if(this._reverse){this.loadMoreBackwardIfNecessary(j.BUFFER_SIZE);}else this.loadMoreForwardIfNecessary(j.BUFFER_SIZE);};j.prototype.backward=function(){'use strict';this._page(this._reverse?1:-1);};j.prototype.forward=function(){'use strict';this._page(this._reverse?-1:1);};j.prototype._log=function(k){'use strict';this._viewer.log(k);};Object.assign(j,{BUFFER_SIZE:4});f.exports=j;}),null);
__d('SpotlightViewerCoreMixin',['PhotoLogger','PhotoStore','PhotoUtils','PhotoViewState','React','SpotlightViewerImage','SpotlightViewerLoggingEvents'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_displayFirstPhoto:function i(){c('PhotoStore').executePostCreate(this.props.setid,this.viewState.displayFirst.bind(this.viewState));},_getInitialPosition:function i(){var j;if(!this.props.clearcache)j=c('PhotoStore').getIndexForID(this.props.setid,this.props.photoid);if(j===undefined){c('PhotoStore').clearSetCache(this.props.setid);j=0;}return j;},__displayPhoto:function i(){var j=this._getInitialPosition();this.viewState=new (c('PhotoViewState'))(this,this.props.setid,{position:j,preventPreload:this.__shouldPreventPhotoPreload,reverse:this.props.reverse,updateCallback:this._updatePhoto});this.inform('open');this._displayFirstPhoto();},componentWillMount:function i(){this._logger=new (c('PhotoLogger'))(this.getViewerID());this.log(c('SpotlightViewerLoggingEvents').OPEN_BEGIN);this.__displayPhoto();},componentDidMount:function i(){this._enableSubscriptions&&this._enableSubscriptions();this.log(c('SpotlightViewerLoggingEvents').OPEN_COMPLETE);},isOpen:function i(){return this.state.open;},close:function i(){if(!this.isOpen())return;this.log(c('SpotlightViewerLoggingEvents').CLOSE_BEGIN);this.setState({open:false},function(){this.inform('close');this.log(c('SpotlightViewerLoggingEvents').CLOSE_COMPLETE);});},componentWillUnmount:function i(){this.viewState=null;},_onClickViewport:function i(j){j?this.viewState.forward():this.viewState.backward();},_getMedia:function i(j,k){return (c('React').createElement(c('SpotlightViewerImage'),{ref:'image',src:j.uri,dimensions:k.imageDimensions}));},_getCurrentFBID:function i(){return c('PhotoUtils').getFBIDFromData(this.state.photoData);},_updatePhoto:function i(j){this.log(c('SpotlightViewerLoggingEvents').PHOTO_CHANGE_BEGIN);this.setState({photoData:j},function(){this.inform('photo_change',this.state.photoData);this.log(c('SpotlightViewerLoggingEvents').PHOTO_CHANGE_COMPLETE);});},getLogger:function i(){return this._logger;},log:function i(j){this._logger&&this._logger.logEvent(j);}};f.exports=h;}),null);
__d('SpotlightViewerPageWithKeys',['KeyEventController','SubscriptionsHandler'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this.$SpotlightViewerPageWithKeys1=i;}h.prototype.enable=function(){'use strict';this.$SpotlightViewerPageWithKeys2=new (c('SubscriptionsHandler'))();this.$SpotlightViewerPageWithKeys2.addSubscriptions(c('KeyEventController').registerKey('LEFT',function(){this.$SpotlightViewerPageWithKeys1.viewState.backward();return false;}.bind(this)),c('KeyEventController').registerKey('RIGHT',function(){this.$SpotlightViewerPageWithKeys1.viewState.forward();return false;}.bind(this)));};h.prototype.disable=function(){'use strict';this.$SpotlightViewerPageWithKeys2.release();delete this.$SpotlightViewerPageWithKeys2;};f.exports=h;}),null);
__d('SpotlightViewerPagers',['cx','LeftRight.react','Link.react','React'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';return (c('React').createElement(c('LeftRight.react'),null,c('React').createElement(c('Link.react'),{className:"_4-oa _4-ob _50-m"}),c('React').createElement(c('Link.react'),{className:"_4-oa _4-oc _50-m"})));};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('SpotlightSnowflakePhotoViewer',['ArbiterMixin','React','SpotlightViewer','SpotlightViewerAutoResize','SpotlightViewerBehaviorsMixin','SpotlightViewerClose','SpotlightViewerCoreMixin','SpotlightViewerDimensionMixin','SpotlightViewerPagers','SpotlightViewerPageWithKeys','SpotlightViewerThumbnailMixin','SpotlightViewport','SubscriptionsHandler'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('React').createClass({displayName:'SpotlightSnowflakePhotoViewer',mixins:[c('ArbiterMixin'),c('SpotlightViewerBehaviorsMixin'),c('SpotlightViewerCoreMixin'),c('SpotlightViewerThumbnailMixin'),c('SpotlightViewerDimensionMixin')],behaviors:[c('SpotlightViewerPageWithKeys'),c('SpotlightViewerAutoResize')],getViewerID:function i(){return 'photoviewer';},componentWillUnmount:function i(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;},getInitialState:function i(){this._subscriptions=new (c('SubscriptionsHandler'))();return {photoData:this._getInitialPhotoData(),open:true};},_enableSubscriptions:function i(){this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe('photo_fetch',this.setState.bind(this,{photoData:null},null)));},render:function i(){var j=this.getMedia(),k=this.getStageDimensions(),l=this.props.useloadingindicator&&!this.state.photoData;return (c('React').createElement(c('SpotlightViewer'),{open:this.state.open,onHide:this.close},c('React').createElement(c('SpotlightViewport'),{media:j,showLoadingIndicator:l,stageDimensions:k,onClick:this._onClickViewport},c('React').createElement(c('SpotlightViewerClose'),{onClick:this.close}),this.props.disablepaging?null:c('React').createElement(c('SpotlightViewerPagers'),null))));}});f.exports=h;}),null);
__d('CampfireImageViewer',['DOM','Event','React','ReactDOM','SpotlightSnowflakePhotoViewer','ge'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={registerPopup:function i(j,k){c('Event').listen(j,'click',function(l){h.bootstrap({src:k.src,fbid:k.id,dimensions:[k.width,k.height].join(','),disablePaging:true});});},bootstrap:function i(j){var k=c('React').createElement(c('SpotlightSnowflakePhotoViewer'),{dimensions:[j.dimensions],open:true,disablepaging:true,photoid:j.fbid,reverse:false,rootClassName:j.rootClassName,thumbsrc:j.src});h.render(k);},render:function i(j){var k=c('ge')('campfire_viewer');if(!k){k=c('DOM').create('div',{id:'messages_viewer'});document.body.appendChild(k);}j=c('ReactDOM').render(j,k);j.subscribeOnce('close',function(){c('ReactDOM').unmountComponentAtNode(k);});}};f.exports=h;}),null);
if (self.CavalryLogger) { CavalryLogger.start_js(["19APk"]); }

__d("AdPageMessageTypeEnum",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AD_ADMIN_TEXT:"ad_admin_text",AD_TEXT:"ad_text",AD_BUBBLE:"ad_bubble",NON_AD:"non_ad"};}),null);
__d("GenderConst",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};}),null);
__d("MessageShareType",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={IMAGE:"image",PLATFORM_SHARE_CTA:"platform_share_CTA"};}),null);
__d("MNAdsLoggerEventEnum",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LINK_CLICK:"messenger_ads_link_click",LINK_CLICK_CTA:"messenger_ads_link_click_cta",MESSAGE_SEEN_THREAD:"messenger_ads_message_seen_thread",MESSAGE_SEEN_INBOX:"messenger_ads_message_seen_inbox",MESSAGE_SEEN_REQUEST:"messenger_ads_message_seen_request"};}),null);
__d("MNCommerceBlockTypeJSInstance",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ALL:"all",PROMOTION:"promotion",NONE:"none"};}),null);
__d('GroupChatMessageBlockAlert',['fbt','DialogX','GenderConst','MercuryParticipants','React','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react','XUIDialogTitle.react'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={show:function j(k,l,m){var n=new (c('DialogX'))({width:445},c('React').createElement('div',null,c('React').createElement(c('XUIDialogTitle.react'),null,h._("See Conversations?")),c('React').createElement(c('XUIDialogBody.react'),null,this.dialogBodyText(k)),c('React').createElement(c('XUIDialogFooter.react'),null,c('React').createElement(c('XUIDialogButton.react'),{action:'cancel',label:this.leaveGroupButton(),onClick:function o(){return m();}}),c('React').createElement(c('XUIDialogButton.react'),{use:'confirm',action:'cancel',label:this.openChatButton(),onClick:function o(){return l();}}))));n.show();},openChatButton:function j(){return h._("\u67e5\u770b\u5c0d\u8a71");},leaveGroupButton:function j(){return h._("\u9000\u51fa\u7fa4\u7d44");},dialogBodyText:function j(k){if(k.length!==1){return h._("\u9019\u500b\u5c0d\u8a71\u4e2d\u6709\u4eba\u5df2\u7d93\u906d\u4f60\u5c01\u9396\uff0c\u7576\u4f60\u67e5\u770b\u9019\u500b\u7fa4\u7d44\u5c0d\u8a71\u6642\uff0c\u5c31\u6703\u85c9\u7531\u5c0d\u8a71\u6536\u5230\u5f7c\u6b64\u7684\u8a0a\u606f\u3002");}else{var l='';c('MercuryParticipants').get(k.pop(),function(m){switch(m.gender){case c('GenderConst').FEMALE_SINGULAR:l=h._("{name}\u5728\u9019\u500b\u7fa4\u804a\u4e2d\uff0c\u4f46\u662f\u4f60\u5df2\u7d93\u5c07\u5979\u5c01\u9396\u3002\u5982\u679c\u4f60\u67e5\u770b\u9019\u500b\u5c0d\u8a71\uff0c\u5c31\u6703\u770b\u5230\u5979\u50b3\u7d66\u7fa4\u7d44\u7684\u8a0a\u606f\uff0c\u800c\u5979\u4e5f\u6703\u770b\u5230\u4f60\u50b3\u7d66\u7fa4\u7d44\u7684\u8a0a\u606f\u3002",[h.param('name',m.short_name)]);break;case c('GenderConst').MALE_SINGULAR:l=h._("{name}\u5728\u9019\u500b\u7fa4\u804a\u4e2d\uff0c\u4f46\u662f\u4f60\u5df2\u7d93\u5c07\u4ed6\u5c01\u9396\u3002\u5982\u679c\u4f60\u67e5\u770b\u9019\u500b\u5c0d\u8a71\uff0c\u5c31\u6703\u770b\u5230\u4ed6\u50b3\u7d66\u7fa4\u7d44\u7684\u8a0a\u606f\uff0c\u800c\u4ed6\u4e5f\u6703\u770b\u5230\u4f60\u50b3\u7d66\u7fa4\u7d44\u7684\u8a0a\u606f\u3002",[h.param('name',m.short_name)]);break;default:l=h._("{name}\u5728\u9019\u500b\u7fa4\u804a\u4e2d\uff0c\u4f46\u662f\u4f60\u5df2\u7d93\u5c07\u6b64\u7528\u6236\u5c01\u9396\u3002\u5982\u679c\u4f60\u67e5\u770b\u9019\u500b\u5c0d\u8a71\uff0c\u5c31\u6703\u770b\u5230\u6b64\u7528\u6236\u50b3\u7d66\u7fa4\u7d44\u7684\u8a0a\u606f\uff0c\u800c\u5c0d\u65b9\u4e5f\u6703\u770b\u5230\u4f60\u50b3\u7d66\u7fa4\u7d44\u7684\u8a0a\u606f\u3002",[h.param('name',m.short_name)]);}});return l;}}};f.exports=i;}),null);
__d('MercuryAudioPlayer',['Arbiter','DOM','Event','Flash'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=200;function i(){var r=c('DOM').create('audio'),s=false;try{if(!!r.canPlayType)if(r.canPlayType('video/mp4;').replace(/^no$/,''))s=true;}finally{return s;}}function j(){return c('Flash').isAvailable();}var k=function r(){this.interval=null;this.arbiterInstance=null;this.audio=c('DOM').create('audio');c('Event').listen(this.audio,'playing',function(){this.informAttachment('playing',this.audio.currentTime);this.interval=setInterval(function(){this.informAttachment('playing',this.audio.currentTime);}.bind(this),h);}.bind(this));c('Event').listen(this.audio,'ended',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};Object.assign(k.prototype,{setAudio:function r(s,t){this.audio.setAttribute('src',s);this.arbiterInstance=t;},informAttachment:function r(s,t){if(this.arbiterInstance)this.arbiterInstance.inform(s,t);},play:function r(){this.audio.play();this.informAttachment('played');},resume:function r(){this.audio.play();this.informAttachment('played');},pause:function r(){this.audio.pause();clearInterval(this.interval);this.informAttachment('paused');},getType:function r(){return 'html5';}});var l=function r(){this.src=null;this.arbiterInstance=null;var s=c('DOM').create('div');document.body.appendChild(s);this.swf=c('Flash').embed('/swf/cigars/SoundStreamPlayer.swf',s,null,{});this.interval=null;c('Arbiter').subscribe('soundstream/finished',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};Object.assign(l.prototype,{setAudio:function r(s,t){this.src=s;this.arbiterInstance=t;},informAttachment:function r(s,t){if(this.arbiterInstance)this.arbiterInstance.inform(s,t);},play:function r(){this.swf.playSound(this.src);this.interval=setInterval(function(){var s=this.swf.getCurrentTime();this.informAttachment('playing',s);}.bind(this),h);this.informAttachment('played');},resume:function r(){this.swf.resume();this.informAttachment('played');},pause:function r(){clearInterval(this.interval);this.swf.pause();this.informAttachment('paused');},getType:function r(){return 'flash';}});function m(){if(i()){return new k();}else if(j())return new l();return false;}var n=null,o=null,p=0;function q(r,s){this.src=r;this.arbiterInstance=s;this.audio_id=++p;n!==null||(n=m());if(!n)return false;}Object.assign(q.prototype,{getType:function r(){if(!n){return false;}else return n.getType();},play:function r(s){if(s&&o==this.audio_id){n.resume();}else{this.pause();o=this.audio_id;n.setAudio(this.src,this.arbiterInstance);n.play();}},pause:function r(){n.pause();}});f.exports=q;}),null);
__d('MercuryAttachmentAudioClip.react',['cssVar','cx','fbt','Arbiter','ArbiterMixin','MercuryAudioPlayer','CurrentUser','JSLogger','LeftRight.react','MercuryConfig','MercuryShareAttachmentRenderLocations','React','SubscriptionsHandler','WorkModeConfig','joinClasses','messengerCustomColorUtils','shield'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l='MercuryAttachmentAudioClip/play',m='progress-bar',n=c('JSLogger').create('mercury_audio_clip'),o=c('React').createClass({displayName:'AudioClip',mixins:[c('ArbiterMixin')],propTypes:{customColor:k.string,duration:k.number,isChat:k.bool,isFromViewer:k.bool,location:k.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()),rootClassName:k.string,showHelp:k.bool,src:k.string.isRequired,width:k.number},getInitialState:function p(){this.logged=false;return {time:0,playing:false,started:false,duration:this.props.duration,audioPlayer:new (c('MercuryAudioPlayer'))(this.props.src,this)};},componentDidMount:function p(){this._subscriptionsHandler=new (c('SubscriptionsHandler'))();this._subscriptionsHandler.addSubscriptions(this.subscribe('playing',this.updateTime),this.subscribe('played',c('shield')(this.setState,this,{playing:true,started:true})),this.subscribe('paused',c('shield')(this.setState,this,{playing:false})),this.subscribe('finished',c('shield')(this.setState,this,{playing:false,started:false,time:this.props.duration})),c('Arbiter').subscribe(l,function(q,r){if(this.props.src!=r)this.setState({time:0});}.bind(this)));},componentWillUnmount:function p(){this._subscriptionsHandler&&this._subscriptionsHandler.release();},updateTime:function p(q,r){this.setState({time:r});},play:function p(){if(this.state.playing){this.state.audioPlayer.pause();}else{this.state.audioPlayer.play(this.state.started);c('Arbiter').inform(l,this.props.src);if(!this.logged){this.logged=true;n.log('play',{uid:c('CurrentUser').getID(),duration:this.props.duration});}}},_formatSeconds:function p(q){if(q){q=Math.round(q);var r=q%60;if(r<10)r='0'+r;var s=Math.floor(q/60);return s+':'+r;}else return null;},_renderPlayer:function p(q,r,s){var t=this.props.isFromViewer,u=this.props.isChat,v=c('MercuryConfig').ChatMessengerStyles,w=c('WorkModeConfig').is_work_user,x=u&&v&&t&&s!==m,y=w?"#373e4d":"#4080ff",z=s||y,aa={width:q};if(x)c('messengerCustomColorUtils').customBubbleStyle(z,aa);return (c('React').createElement('a',{className:"_1miz"+(' '+"_2e-1")+(' '+"_3_om")+(t&&u?' '+"_3e5f":''),href:'#',style:aa,onClick:this.play},c('React').createElement('span',{className:"_1mi- _2e-2"},c('React').createElement('i',{className:"_1mi_ _2e-3"})),c('React').createElement('span',{className:"_1mj0 _2e-4 _3oh-"},r),c('React').createElement('div',{className:"_1mj1 _2e-5"})));},render:function p(){var q=this.state.time,r=this.state.playing,s=this._formatSeconds(this.state.duration),t=this.props.location===c('MercuryShareAttachmentRenderLocations').MESSENGER,u=this.props.width||170;if(t){var v=this.props.duration;if(v>10){u=240;}else if(v>5){u=200;}else if(v>2){u=160;}else u=120;}var w=null,x=Math.ceil(q*(u+2)/this.state.duration);if(t)x=Math.ceil(q*(u+24)/this.state.duration);if(this.state.audioPlayer&&this.state.audioPlayer.getType()){var y=this._renderPlayer(u,s,this.props.customColor),z=this._renderPlayer(u,s,m),aa="_1mj2"+(' '+"_2e-6")+(r&&q!==0?' '+"_1mj3":'')+(r&&q===0?' '+"_4g4x":'');w=c('React').createElement('div',{className:aa},y,c('React').createElement('div',{className:"_1mj4 _2e-7",style:{width:x}},z));}else w=c('React').createElement('div',{className:"_1mj2"},c('React').createElement('div',{className:"_1miz"},c('React').createElement(c('LeftRight.react'),null,c('React').createElement('a',{className:"_1mj5",href:this.props.src},c('React').createElement('span',{className:"_3qi6"},c('React').createElement('i',{className:"_1mj6"})),c('React').createElement('span',{className:"_1mj7"},j._("\u8a9e\u97f3\u8a0a\u606f")),c('React').createElement('span',{className:"_1mj8"},s)),c('React').createElement('a',{href:this.props.src,className:"_1mj9"},c('React').createElement('i',{className:"_1mja"})))));return (c('React').createElement('div',{className:c('joinClasses')("_1mjb"+(t?' '+"_454y":''),this.props.rootClassName)},w));}});f.exports=o;}),null);
__d("MercuryAttachmentConstants",[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={SIDE_LENGTH:9};f.exports=h;}),null);
__d('MercuryAttachmentError.react',['fbt','XUINotice.react','XUIText.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){return (c('React').createElement(c('XUINotice.react'),{use:'warn'},c('React').createElement(c('XUIText.react'),{size:'small'},h._("This attachment could not be loaded."))));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('MercuryAttachmentFile.react',['ix','cx','fbt','Image.react','LeftRight.react','Link.react','MercuryAttachment','React','joinClasses'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').PureComponent);l=k&&k.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return o=(p=l.constructor).call.apply(p,[this].concat(r)),this.$MercuryAttachmentFile1=function(){if(this.props.open_url)return (c('React').createElement('div',{className:"_59gs"},c('React').createElement(c('Link.react'),{target:'_blank',href:this.props.open_url},j._("\u958b\u555f")),' ','·',' ',c('React').createElement(c('Link.react'),{href:this.props.url},j._("\u4e0b\u8f09"))));return c('React').createElement('div',null);}.bind(this),o;}n.prototype.render=function(){var o=c('joinClasses')(c('MercuryAttachment').getAttachIconClass(this.props.type),"_59go _59gq");if(this.props.url)return (c('React').createElement(c('LeftRight.react'),{className:o},c('React').createElement(c('Link.react'),{href:this.props.url},c('React').createElement(c('LeftRight.react'),null,c('React').createElement(c('Image.react'),{src:h('/images/messaging/docs/generic.png')}),c('React').createElement('span',{className:"_59gp"},this.props.name))),this.$MercuryAttachmentFile1()));return (c('React').createElement(c('LeftRight.react'),{className:o},c('React').createElement(c('Image.react'),{src:h('/images/messaging/docs/generic.png')}),c('React').createElement('span',{className:"_59gp"},this.props.name)));};n.propTypes={name:m.string.isRequired,open_url:m.string,rel:m.string,type:m.string.isRequired,url:m.string};f.exports=n;}),null);
__d('MercuryAttachmentMalicious.react',['fbt','XUINotice.react','XUIText.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){return (c('React').createElement(c('XUINotice.react'),{use:'warn'},c('React').createElement(c('XUIText.react'),{size:'small'},h._("\u6b64\u9644\u4ef6\u5df2\u6a19\u793a\u70ba\u60e1\u610f\u9644\u4ef6\u3002"))));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('ChatImageArrowDirection',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({BOTH:null,LEFT:null,RIGHT:null});f.exports=h;}),null);
__d('ChatImageWithArrow.react',['cx','ChatImageArrowDirection','Link.react','MercuryAttachmentConstants','React','XUISpinner.react','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=30,m=15;i=babelHelpers.inherits(n,c('React').Component);j=i&&i.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return o=(p=j.constructor).call.apply(p,[this].concat(r)),this.$ChatImageWithArrow3=function(){return Math.max(this.props.width,m);}.bind(this),this.$ChatImageWithArrow6=function(){return Math.max(this.props.height,l);}.bind(this),this.$ChatImageWithArrow5=function(t){if(this.props.onClick)return (c('React').createElement(c('Link.react'),{onClick:this.props.onClick},t));return t;}.bind(this),this.$ChatImageWithArrow7=function(t,u,v,w){if(u===c('ChatImageArrowDirection').LEFT){return 'translate('+v+'px, '+w+'px)'+'rotate(45deg)';}else return 'translate('+(t-v)+'px, '+w+'px)'+'rotate(45deg)';},this.$ChatImageWithArrow8=function(t,u,v,w){if(u===c('ChatImageArrowDirection').LEFT){return 'rotate(-45deg)'+'translate(-'+(this.$ChatImageWithArrow1+v)+'px,'+'-'+w+'px)';}else return 'rotate(-45deg)'+'translate(-'+(t-v)+'px, -'+w+'px)';}.bind(this),this.$ChatImageWithArrow4=function(){var t={width:this.props.sideLength,height:this.props.sideLength};if(this.props.source)t.backgroundImage='url('+this.props.source+')';var u={width:this.props.sideLength,height:this.props.sideLength};if(this.props.source)u.opacity=0;var v={width:this.$ChatImageWithArrow3(),height:this.$ChatImageWithArrow6()};if(this.props.source){v.backgroundImage='url('+this.props.source+')';v.backgroundSize='cover';}return (c('React').createElement('div',{className:"_4yp6"},c('React').createElement('div',{className:"_4ypb _3_om",style:v},c('React').createElement(c('XUISpinner.react'),{size:'small'}))));}.bind(this),o;}n.prototype.render=function(){this.$ChatImageWithArrow1=Math.floor(this.props.sideLength/Math.sqrt(2));this.$ChatImageWithArrow2=Math.ceil(this.$ChatImageWithArrow3()+this.$ChatImageWithArrow1);if(this.props.isLoading)return this.$ChatImageWithArrow4();var o=c('joinClasses')("_4yp6"+(this.props.round?' '+"_3lk2":''),this.props.rootClassName);return this.$ChatImageWithArrow5(c('React').createElement('div',{className:o},c('React').createElement('div',{className:"_52kr"+(this.props.round?' '+"_3_om":''),style:{width:this.$ChatImageWithArrow3(),height:this.$ChatImageWithArrow6()}},c('React').createElement('div',{className:"_4yp9",style:{backgroundImage:'url('+this.props.source+')',width:this.$ChatImageWithArrow3(),height:this.$ChatImageWithArrow6()}}))));};n.propTypes={arrowDirection:k.oneOf(Object.keys(c('ChatImageArrowDirection'))),onClick:k.func,height:k.number.isRequired,isLoading:k.bool,round:k.bool,rootClassName:k.string,sideLength:k.number,source:k.string,width:k.number.isRequired};n.defaultProps={sideLength:c('MercuryAttachmentConstants').SIDE_LENGTH,isLoading:false,round:false};f.exports=n;}),null);
__d('MessengerSharedPhotosContainerRoute',['RelayRoute','RelayQL'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='MessengerSharedPhotosContainerRoute';j.paramDefinitions={threadFBID:{type:'String',required:true},newViewGK:{type:'Boolean',required:false}};j.queries={sharedPhotos:function k(l,m){var n=m.newViewGK;return function(o){return {calls:[{kind:'Call',metadata:{type:'ID!'},name:'id',value:{kind:'CallVariable',callVariableName:'threadFBID'}}],children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},c('RelayQL').__frag(o)]),fieldName:'message_thread',kind:'Query',metadata:{identifyingArgName:'id',identifyingArgType:'ID!'},name:'MessengerSharedPhotosContainerRoute',type:'MessageThread'};}(l.getFragment('sharedPhotos',{newViewGK:n}));}};f.exports=j;}),null);
__d('MessengerPhotoViewCloseLink.react',['cx','fbt','React','TooltipLink.react'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=function l(m){var n=c('React').createElement('span',null,i._("\u6309 Esc \u9375\u95dc\u9589"));return (c('React').createElement(c('TooltipLink.react'),{className:"_51ok _50-m _51an",onClick:m.onClick,tooltip:n},c('React').createElement('div',{className:"_387s"})));};k.propTypes={onClick:j.func};f.exports=k;}),null);
__d('MessengerSharedPhotosAlbumViewPhoto.react',['React'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return l=(m=i.constructor).call.apply(m,[this].concat(o)),this.$MessengerSharedPhotosAlbumViewPhoto1=function(){this.props.onClick(this.props.photoID);}.bind(this),l;}k.prototype.render=function(){return (c('React').createElement('a',{className:this.props.className,href:'#',onClick:this.$MessengerSharedPhotosAlbumViewPhoto1,style:{backgroundImage:'url('+this.props.uri+')'}}));};k.propTypes={className:j.string.isRequired,fbid:j.string.isRequired,onClick:j.func.isRequired,photoID:j.string,uri:j.string.isRequired};f.exports=k;}),null);
__d('MessengerSharedPhotosAlbumViewVScroll.react',['cx','Animation','MessengerSpinner.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=200,m=48,n=6,o=20;i=babelHelpers.inherits(p,c('React').Component);j=i&&i.prototype;function p(){var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return q=(r=j.constructor).call.apply(r,[this].concat(t)),this.state={hasScrolledDown:false},this.$MessengerSharedPhotosAlbumViewVScroll1=function(){var v=this.props.sharedPhotos.edges.length,w=this.props.totalCount;if(v<m){var x=Math.min(w-v,m-v);this.props.fetchMore(x);}}.bind(this),this.$MessengerSharedPhotosAlbumViewVScroll3=function(v){var w=this.props.children.find(function(x){return x.props.photoID===v;});if(!w)return 0;return this.props.children.indexOf(w);}.bind(this),this.$MessengerSharedPhotosAlbumViewVScroll4=function(v,w){var x=Math.floor(v/n);return w/n*x;},this.$MessengerSharedPhotosAlbumViewVScroll5=function(v){if(this.refs&&this.refs.childContainer)new (c('Animation'))(this.refs.childContainer).to('scrollTop',v).duration(l).go();}.bind(this),this.$MessengerSharedPhotosAlbumViewVScroll2=function(){var v=this.props.sharedPhotos.edges.length,w=this.props.totalCount;if(this.props.allPhotosDisplayed&&this.$MessengerSharedPhotosAlbumViewVScroll6())if(v<w){var x=Math.min(w-v,m);if(!this.props.isLoadingImages)this.props.fetchMore(x);}}.bind(this),this.$MessengerSharedPhotosAlbumViewVScroll6=function(){var v=this.refs.childContainer;return v.scrollTop+v.clientHeight>=v.scrollHeight-o;}.bind(this),q;}p.prototype.componentDidMount=function(){this.$MessengerSharedPhotosAlbumViewVScroll1();this.refs.childContainer.addEventListener('scroll',function(event){this.$MessengerSharedPhotosAlbumViewVScroll2();}.bind(this));};p.prototype.componentWillUnmount=function(){this.refs.childContainer.removeEventListener('scroll',function(event){this.$MessengerSharedPhotosAlbumViewVScroll2();}.bind(this));};p.prototype.render=function(){var q=this.props.isLoadingImages?c('React').createElement('div',{className:"_3xo7"},c('React').createElement(c('MessengerSpinner.react'),null)):null;if(!this.state.hasScrolledDown&&!this.props.isLoadingImages&&this.refs.scrollable){this.setState({hasScrolledDown:true});if(this.props.totalCount>m){var r=this.refs.scrollable,s=this.$MessengerSharedPhotosAlbumViewVScroll3(this.props.viewedPhoto),t=this.$MessengerSharedPhotosAlbumViewVScroll4(s,r.clientWidth);this.$MessengerSharedPhotosAlbumViewVScroll5(t);}}return c('React').createElement('div',{className:"_3xo8",ref:'childContainer',onscroll:this.$MessengerSharedPhotosAlbumViewVScroll2,style:{height:this.props.height}},c('React').createElement('div',{className:"_3xoa",ref:'scrollable'},this.props.children,q));};p.propTypes={allPhotosDisplayed:k.bool.isRequired,children:k.array.isRequired,fetchMore:k.func.isRequired,height:k.number.isRequired,isLoadingImages:k.bool.isRequired,onClick:k.func.isRequired,onClose:k.func.isRequired,sharedPhotos:k.object.isRequired,totalCount:k.number.isRequired,viewedPhoto:k.string.isRequired};f.exports=p;}),null);
__d('MessengerSharedPhotosAlbumView.react',['cx','fbt','MessengerSharedPhotosAlbumViewPhoto.react','MessengerSharedPhotosAlbumViewVScroll.react','MessengerPhotoViewCloseLink.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return n=(o=k.constructor).call.apply(o,[this].concat(q)),this.$MessengerSharedPhotosAlbumView4=function(){this.props.onClick(this.props.viewedPhoto);}.bind(this),this.$MessengerSharedPhotosAlbumView1=function(){return (c('React').createElement('div',{className:"_3bm0 _5l-3",ref:'header'},c('React').createElement('div',{className:"_3bm2",onClick:this.$MessengerSharedPhotosAlbumView4},c('React').createElement('div',{className:"_3bm3"}),i._("\u8fd4\u56de\u76f8\u7247")),c('React').createElement('div',{className:"_3bm4"},i._("\u5206\u4eab\u7684\u76f8\u7247")),c('React').createElement(c('MessengerPhotoViewCloseLink.react'),{onClick:this.props.onCloseSharedPhotos})));}.bind(this),n;}m.prototype.render=function(){return c('React').createElement('div',{className:"_3bl- _5l-3",ref:'window'},this.$MessengerSharedPhotosAlbumView1(),c('React').createElement(c('MessengerSharedPhotosAlbumViewVScroll.react'),{allPhotosDisplayed:this.props.allPhotosDisplayed,children:this.$MessengerSharedPhotosAlbumView2(),fetchMore:this.props.fetchMore,height:this.$MessengerSharedPhotosAlbumView3(),isLoadingImages:this.props.isLoadingImages,onClick:this.props.onClick,onClose:this.props.onCloseSharedPhotos,sharedPhotos:this.props.sharedPhotos,totalCount:this.props.totalCount,viewedPhoto:this.props.viewedPhoto}));};m.prototype.$MessengerSharedPhotosAlbumView3=function(){if(this.refs.window&&this.refs.header)return this.refs.window.clientHeight-this.refs.header.clientHeight;return 0;};m.prototype.$MessengerSharedPhotosAlbumView2=function(){var n="_3bly",o=this.props.sharedPhotos.edges,p=o.map(function(q){var r=q.node;return (c('React').createElement(c('MessengerSharedPhotosAlbumViewPhoto.react'),{className:n,count:this.props.sharedPhotos.edges,onClick:this.props.onClick,fbid:r.legacy_attachment_id,key:r.legacy_attachment_id,photoID:r.id,uri:r.image.uri}));}.bind(this));return p;};m.propTypes={allPhotosDisplayed:l.bool.isRequired,isLoadingImages:l.bool.isRequired,fetchMore:l.func.isRequired,onClick:l.func.isRequired,onCloseSharedPhotos:l.func.isRequired,sharedPhotos:l.object.isRequired,totalCount:l.number.isRequired,viewedPhoto:l.string.isRequired};f.exports=m;}),null);
__d('MessengerSharedPhoto.react',['MercuryConfig','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').PureComponent);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return l=(m=i.constructor).call.apply(m,[this].concat(o)),this.$MessengerSharedPhoto1=function(q){q.preventDefault();this.props.onClick(c('MercuryConfig').SharedPhotoNewView?this.props.photoID:this.props.fbid);}.bind(this),l;}k.prototype.render=function(){return c('React').createElement('a',{className:this.props.className,href:this.props.uri,onClick:this.$MessengerSharedPhoto1,style:{backgroundImage:'url('+this.props.uri+')'}});};k.propTypes={className:j.string.isRequired,fbid:j.string.isRequired,onClick:j.func.isRequired,photoID:j.string,uri:j.string.isRequired};f.exports=k;}),null);
__d('ChatPhotoViewFooterHScroll.react',['cx','Animation','MessengerSharedPhoto.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=200,m=74,n=140;i=babelHelpers.inherits(o,c('React').Component);j=i&&i.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return p=(q=j.constructor).call.apply(q,[this].concat(s)),this.$ChatPhotoViewFooterHScroll1=null,this.state={currentPhoto:'',prevScrollLeft:0,scrollLeft:0},this.$ChatPhotoViewFooterHScroll2=function(u){var v=this.props.sharedPhotos.edges.find(function(w){return w.node.id===u;});if(!v)return -1;return this.props.sharedPhotos.edges.indexOf(v);}.bind(this),p;}o.prototype.componentDidMount=function(){this.$ChatPhotoViewFooterHScroll1=new (c('Animation'))(this.refs.childContainer).to('scrollLeft',0).duration(l).go();};o.prototype.componentWillReceiveProps=function(p){if(p.photoID!=this.state.currentPhoto)this.setState({currentPhoto:p.photoID,prevScrollLeft:this.state.scrollLeft,scrollLeft:this.$ChatPhotoViewFooterHScroll2(p.photoID)*m});};o.prototype.shouldComponentUpdate=function(p,q){return p.photoID!=this.state.currentPhoto;};o.prototype.componentDidUpdate=function(){if(this.$ChatPhotoViewFooterHScroll1)this.$ChatPhotoViewFooterHScroll1.from('scrollLeft',this.state.prevScrollLeft).to('scrollLeft',this.state.scrollLeft).duration(l).go();};o.prototype.componentWillUnmount=function(){this.$ChatPhotoViewFooterHScroll1&&this.$ChatPhotoViewFooterHScroll1.stop();};o.prototype.render=function(){var p=this.props.sharedPhotos.edges,q={paddingRight:(this.props.width-2*n-m)/2},r={paddingRight:0,paddingLeft:0},s=p.map(function(u){return c('React').createElement('div',{className:"_1oyb",style:p.indexOf(u)===this.props.totalCount-1?q:r,key:u.node.legacy_attachment_id},c('React').createElement(c('MessengerSharedPhoto.react'),{className:"_1oyc"+(this.state.currentPhoto!==u.node.id?' '+"_1oyd":''),fbid:u.node.legacy_attachment_id,onClick:this.props.onScroll,photoID:u.node.id,uri:u.node.image.uri}));}.bind(this)),t={paddingLeft:(this.props.width-2*n-m)/2};return c('React').createElement('div',{className:"_1oye"},c('React').createElement('div',{className:"_1oyf",ref:'childContainer'},c('React').createElement('div',{className:"_1oyh",ref:'scrollable',style:t},s),c('React').createElement('div',{className:"_1oyi"},c('React').createElement('div',{className:"_1oyj"})),c('React').createElement('div',{className:"_1oyk"},c('React').createElement('div',{className:this.state.scrollLeft>0?"_1oyl":''}))));};o.propTypes={fetchMore:k.func,isLoadingImages:k.bool,onScroll:k.func,photoID:k.string,sharedPhotos:k.object,totalCount:k.number,width:k.number};f.exports=o;}),null);
__d('SpotlightViewerBottomBarLink',['cx','Link.react','React'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';var l=this.props.className||"_4_8j _4_8k";return (c('React').createElement(c('Link.react'),babelHelpers['extends']({},this.props,{className:l}),this.props.children));};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('ChatPhotoViewHeader.react',['cx','fbt','React','SpotlightViewerBottomBarLink'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').PureComponent);k=j&&j.prototype;m.prototype.render=function(){return (c('React').createElement('div',{className:"_51an _50-m _3h_t _5l-3",role:'banner'},this.$ChatPhotoViewHeader1()));};m.prototype.$ChatPhotoViewHeader1=function(){var n;if(!this.props.disableForward)n=c('React').createElement(c('SpotlightViewerBottomBarLink'),{className:"_3h_u",onClick:this.props.showForwardDialog,ref:'forwardButton'},c('React').createElement('div',{className:"_3h_v _3h_w"}),i._("\u8f49\u5bc4"));return (c('React').createElement('div',{key:'buttonsContainer',ref:'buttons'},c('React').createElement(c('SpotlightViewerBottomBarLink'),{className:"_3h_u",onClick:this.props.showForwardDialog,ref:'downloadButton'},c('React').createElement('div',{className:"_3h_x _3h_w"}),i._("\u4e0b\u8f09")),n,c('React').createElement('div',{className:"_3h_u",onClick:this.props.openInfo,ref:'moreInfo'},c('React').createElement('div',{className:"_3h_y _3h_w"}),i._("\u76f8\u95dc\u8cc7\u8a0a"))));};function m(){j.apply(this,arguments);}m.propTypes={disableForward:l.bool,onClose:l.func,openInfo:l.func,photoID:l.string,showForwardDialog:l.func,url:l.object,viewer:l.string};f.exports=m;}),null);
__d('MercuryThreadMetadataRawRenderer',['cx','fbt','Event','CSS','DOM','MercuryActionStatus','MercuryErrorInfo','MercuryStatusTemplates','TooltipData'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={renderParticipantListWithNoThreadName:function k(l,m,n,o,p,q){var r={callback:true,check_length:true,show_unread_count:true};q=q||{};var s={};for(var t in q)if(r[t]){s[t]=q[t];delete q[t];}var u=n.map(function(z){return o[z];}),v=this.renderRawParticipantList(l,u,n.length,q);v=this.renderRawTitleWithUnreadCount(v,s.show_unread_count?m.unread_count:0);var w=q.abbr_mode,x={};for(var y in q)x[y]=q[y];x.abbr_mode=true;p.forEach(function(z){var aa=p.length>1?this._cloneIfDOMElement(v):v;c('DOM').setContent(z,aa);if(s.check_length&&!w&&z.scrollWidth>z.clientWidth){var ba=this.renderRawParticipantList(l,u,n.length,x),ca=this.renderRawTitleWithUnreadCount(ba,s.show_unread_count?m.unread_count:0);c('DOM').setContent(z,ca);}}.bind(this));s.callback&&s.callback(v);},renderRawParticipantList:function k(l,m,n,o){var p={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};o=o||{};var q=null;if(o.names_renderer){q=o.names_renderer(m);}else q=m.map(function(s){return s.name;});var r=null;if(q.length===0){if(!l){r=i._("\u65b0\u8a0a\u606f\uff01");}else r=i._("\u6c92\u6709\u53c3\u8207\u8005");}else if(q.length==1){r=q[0];}else if(q.length==2){if(o.last_separator_uses_and){r=i._("{participant1}\u8207{participant2}",[i.param('participant1',q[0]),i.param('participant2',q[1])]);}else r=i._("{participant1}\u3001{participant2}",[i.param('participant1',q[0]),i.param('participant2',q[1])]);}else if(o.last_separator_uses_and){if(o.abbr_mode){r=i._("{participant1}\u548c{others_link}",[i.param('participant1',q[0]),i.param('others_link',this.renderRawParticipantCount({render_subset:true,count:n-1}))]);}else if(q.length==3){r=i._("{participant1}\u3001{participant2}\u548c{participant3}",[i.param('participant1',q[0]),i.param('participant2',q[1]),i.param('participant3',q[2])]);}else r=i._("{participant1}\u3001{participant2}\u548c{others_link}",[i.param('participant1',q[0]),i.param('participant2',q[1]),i.param('others_link',this.renderRawParticipantCount({render_subset:true,count:n-2}))]);}else if(q.length==3){r=i._("{participant1}\u3001{participant2}\u3001{participant3}",[i.param('participant1',q[0]),i.param('participant2',q[1]),i.param('participant3',q[2])]);}else r=i._("{participant1}\u3001{participant2}\u3001{participant3}\u3001{others_link}",[i.param('participant1',q[0]),i.param('participant2',q[1]),i.param('participant3',q[2]),i.param('others_link',this.renderRawParticipantCount({render_subset:true,count:n-3}))]);if(Array.isArray(r))r=c('DOM').create('span',{},r);return r;},renderRawTitleWithUnreadCount:function k(l,m){var n=l;if(m&&m>1)n=c('DOM').create('span',{},i._("{conversation_title}\uff08{unread_count}\uff09",[i.param('conversation_title',l),i.param('unread_count',m)]));return n;},renderRawParticipantCount:function k(l){var m=l.render_subset,n;if(!m){n=l.count>1?i._({"*":"{num}\u4eba"},[i.param('num',l.count,[0])]):i._("1 \u4eba");}else n=l.count>1?i._({"*":"\u5176\u4ed6{others_count}\u500b\u4eba"},[i.param('others_count',l.count,[0])]):i._("\u53e6\u5916 1 \u4eba");return n;},renderShortNames:function k(l){if(l.length==1)return [l[0].name];return l.map(function(m){return m.short_name;});},renderStatusIndicator:function k(l,m,n){var o;if(l==c('MercuryActionStatus').RESENDING){o=this.renderResendIndicator();}else if(l!==undefined&&l!=c('MercuryActionStatus').UNSENT&&l!=c('MercuryActionStatus').UNCONFIRMED&&l!=c('MercuryActionStatus').SUCCESS)o=this.renderErrorIndicator(m,n);return o;},renderResendIndicator:function k(){return c('MercuryStatusTemplates')[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function k(l,m){if(!l)return null;var n=c('MercuryStatusTemplates')[':fb:mercury:error-indicator'].render(),o=l.is_transient,p=c('MercuryErrorInfo').getMessage(l);if(o)if(c('MercuryErrorInfo').isConnectionError(l)){p=i._("{message}\u8acb\u6aa2\u67e5\u4f60\u7684\u7db2\u8def\u9023\u7dda\uff0c\u7136\u5f8c\u9ede\u64ca\u518d\u8a66\u4e00\u6b21\u3002",[i.param('message',p)]);}else p=i._("{message}\u9ede\u9078\u4ee5\u518d\u6b21\u50b3\u9001\u3002",[i.param('message',p)]);c('TooltipData').set(n,p,'above','center');if(m&&o){c('Event').listen(n,'click',m);n.setAttribute('tabindex','0');c('CSS').addClass(n,"_55q-");}return n;},_cloneIfDOMElement:function k(l){if(l&&l.cloneNode){return l.cloneNode();}else return l;}};f.exports=j;}),null);
__d('MessagingRecipientTypeaheadItem.react',['cx','BackgroundImage.react','ChatTypeaheadConstants','ImageBlock.react','LeftRight.react','React','SplitImage.react','MercuryThreadMetadataRawRenderer','TypeaheadViewItem','joinClasses'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MessagingRecipientTypeaheadItem',propTypes:babelHelpers['extends']({},c('TypeaheadViewItem').propTypes,{imageSize:i.number.isRequired}),mixins:[c('TypeaheadViewItem').Mixin],isThreadRecipient:function k(){return this.props.entry.getType()===c('ChatTypeaheadConstants').THREAD_TYPE;},_getImage:function k(){var l=this.props.entry;if(l.getType()===c('ChatTypeaheadConstants').THREAD_TYPE&&!l.getPhoto()){var m=l.getAuxiliaryData();return (c('React').createElement(c('SplitImage.react'),{size:this.props.imageSize,srcs:m.participantsToRender.map(function(n){return n.image_src;})}));}if(l.getPhoto())return (c('React').createElement(c('BackgroundImage.react'),{width:this.props.imageSize,height:this.props.imageSize,backgroundSize:'cover',src:l.getPhoto()}));return c('React').createElement('span',null);},_getThreadParticipantList:function k(){if(!this.isThreadRecipient())return null;var l=this.props.entry;return c('MercuryThreadMetadataRawRenderer').renderRawParticipantList(l.getUniqueID(),l.getAuxiliaryData().participantsToRender,l.getAuxiliaryData().thread.participants.length-1,{names_renderer:c('MercuryThreadMetadataRawRenderer').renderShortNames});},_getTitle:function k(){var l=this.props.entry;if(this.isThreadRecipient()&&!l.getTitle())return this._getThreadParticipantList();return l.getTitle();},_getSubtitle:function k(){var l=this.props.entry;if(this.isThreadRecipient()&&!l.getTitle())return this._getThreadParticipantList();return l.getSubtitle()?l.getSubtitle().split(' \u00b7 ')[0]:null;},render:function k(){var l=this._getSubtitle(),m=c('joinClasses')("_599m"+(' '+"_55xn")+(!l?' '+"_5mne":'')+(this.props.highlighted?' '+"_599n":''),this.props.className);return (c('React').createElement('li',{'aria-selected':this.props.selected,className:m,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight,role:this.props.role},c('React').createElement(c('ImageBlock.react'),{spacing:'medium'},this._getImage(),c('React').createElement(c('LeftRight.react'),null,c('React').createElement('div',null,c('React').createElement('div',{className:"_55xt _599p"},this._getTitle()),c('React').createElement('div',{className:"_55z3 _599q"},l)),this.props.children))));}});f.exports=j;}),null);
__d('MessagingRecipientSelectedList.react',['cx','fbt','xuiglyph','Image.react','LeftRight.react','Map','MessagingRecipientTypeaheadItem.react','React'],(function a(b,c,d,e,f,g,h,i,j){var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;function n(){var o,p;'use strict';for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return o=(p=l.constructor).call.apply(p,[this].concat(r)),this.$MessagingRecipientSelectedList1=function(t){var u=j({name:'cross',shade:'dark',size:'small'});return (c('React').createElement(c('MessagingRecipientTypeaheadItem.react'),{key:t.getUniqueID(),entry:t,imageSize:24,onSelect:this.props.onSelect},c('React').createElement(c('Image.react'),{className:"_1jm4",src:u})));}.bind(this),o;}n.prototype.render=function(){'use strict';var o=i._("\u50b3\u9001\u81f3\uff1a"),p=[];this.props.entries.forEach(function(q){return p.push(this.$MessagingRecipientSelectedList1(q));}.bind(this));return (c('React').createElement('div',{className:"_1jm5"},c('React').createElement(c('LeftRight.react'),{className:"_1jm6 _2ph-"},c('React').createElement('span',null,o),c('React').createElement('span',null,this.props.entries.size)),c('React').createElement('ul',null,p)));};n.propTypes={entries:m.instanceOf(c('Map')),onSelect:m.func.isRequired};f.exports=n;}),null);
__d('MessagingRecipientTypeaheadView.react',['cx','fbt','CenteredContainer.react','Link.react','Map','MessagingRecipientTypeaheadItem.react','React','TypeaheadViewPropTypes','XUISpinner.react'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes,m=32;j=babelHelpers.inherits(n,c('React').Component);k=j&&j.prototype;function n(){var o,p;'use strict';for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return o=(p=k.constructor).call.apply(p,[this].concat(r)),this.$MessagingRecipientTypeaheadView1=function(t){var u=t===this.props.highlightedEntry,v=this.props.selectedEntries.has(t.getUniqueID());return (c('React').createElement(c('MessagingRecipientTypeaheadItem.react'),{key:t.getUniqueID(),entry:t,highlighted:u,imageSize:m,selected:v,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight},c('React').createElement(c('Link.react'),{'aria-checked':v,className:"_2i83"+(v?' '+"_2i85":'')+(!v?' '+"_2i86":''),href:'#',role:'checkbox',tabIndex:'0'})));}.bind(this),o;}n.prototype.render=function(){'use strict';if(this.props.entries.length===0&&!this.props.loading)return (c('React').createElement(c('CenteredContainer.react'),{className:"_2pi1"},i._("\u67e5\u7121\u7d50\u679c")));return (c('React').createElement('ul',{id:this.props.ariaOwneeID,className:"_51do",role:this.props.role},this.props.entries.map(this.$MessagingRecipientTypeaheadView1),c('React').createElement('div',{className:"_51dq"},this.props.loading?c('React').createElement(c('XUISpinner.react'),null):null)));};n.propTypes=babelHelpers['extends']({},c('TypeaheadViewPropTypes'),{selectedEntries:l.instanceOf(c('Map')),loading:l.bool});n.defaultProps={role:'listbox'};f.exports=n;}),null);
__d("XMessagingForwardAttachmentController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/attachments\/forward\/",{});}),null);
__d("XMessengerPlatformShareCTAController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messages\/platform\/share\/",{});}),null);
__d('MessagingForwardAttachmentDialog.react',['ix','cx','fbt','AsyncRequest','ChatSearchSource','Image.react','LayerFadeOnHide','Layout.react','Map','MessageShareType','MessagingRecipientSelectedList.react','MessagingRecipientTypeaheadView.react','React','SearchableTextInput.react','ScrollableArea.react','XMessagingForwardAttachmentController','XMessengerPlatformShareCTAController','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogCancelButton.react','XUIDialogFooter.react','XUIDialogTitle.react','XUISpinner.react','fbglyph','requireWeak'],(function a(b,c,d,e,f,g,h,i,j){var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('Layout.react').Column,n=c('Layout.react').FillColumn,o=c('React').PropTypes;k=babelHelpers.inherits(p,c('React').Component);l=k&&k.prototype;function p(){var q,r;'use strict';for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return q=(r=l.constructor).call.apply(r,[this].concat(t)),this.state={bootstrappedEntries:[],entries:[],loading:true,selectedEntries:new (c('Map'))(),sendError:null,sending:false,startingThreadingID:Date.now(),query:''},this.$MessagingForwardAttachmentDialog2=function(v){var w=v.getUniqueID(),x=new (c('Map'))(this.state.selectedEntries);if(x.has(w)){x['delete'](w);}else x.set(w,v);this.setState({selectedEntries:x});}.bind(this),this.$MessagingForwardAttachmentDialog3=function(v){var w=v.target.value;this.setState({loading:true,query:w});}.bind(this),this.$MessagingForwardAttachmentDialog4=function(v){this.setState({entries:v});}.bind(this),this.$MessagingForwardAttachmentDialog5=function(v){v===this.state.query&&this.setState({loading:false});}.bind(this),this.$MessagingForwardAttachmentDialog6=function(){var v={},w=this.state.startingThreadingID;this.state.selectedEntries.forEach(function(y){v[w++]=y.getUniqueID();});if(this.props.shareType===c('MessageShareType').PLATFORM_SHARE_CTA){var x=c('XMessengerPlatformShareCTAController').getURIBuilder().getURI();new (c('AsyncRequest'))(x).setMethod('POST').setHandler(this.$MessagingForwardAttachmentDialog7).setData({cta_id:this.props.attachmentID,recipient_map:v}).send();}else{x=c('XMessagingForwardAttachmentController').getURIBuilder().getURI();new (c('AsyncRequest'))(x).setMethod('POST').setHandler(this.$MessagingForwardAttachmentDialog7).setData({attachment_id:this.props.attachmentID,recipient_map:v}).send();}this.setState({sending:true,sendError:null});}.bind(this),this.$MessagingForwardAttachmentDialog7=function(v){if(v.payload.success){this.setState({bootstrappedEntries:[],selectedEntries:new (c('Map'))(),sending:false,startingThreadID:Date.now(),query:''},this.props.onClose);return;}this.setState({sending:false,sendError:v.payload.error});}.bind(this),this.$MessagingForwardAttachmentDialog8=function(v){if(!v)this.props.onClose();}.bind(this),q;}p.prototype.componentWillMount=function(){'use strict';this.$MessagingForwardAttachmentDialog1=new (c('ChatSearchSource'))({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});};p.prototype.componentDidMount=function(){'use strict';c('requireWeak')('OrderedFriendsList',function(q){return q.getSearchableEntries(20,function(r){this.setState({bootstrappedEntries:r,loading:false});}.bind(this));}.bind(this));};p.prototype.render=function(){'use strict';var q=j._("\u50b3\u9001"),r=null;if(this.state.sending){r=c('React').createElement('div',null,c('React').createElement(c('XUISpinner.react'),null),c('React').createElement('span',{className:"_5s0d _3-99"},j._("\u50b3\u9001\u4e2d")));}else if(this.state.sendError){var s=h("\/images\/assets_DO_NOT_HARDCODE\/fb_glyphs\/caution-solid_16_bluegray-40.png");r=c('React').createElement('div',{className:"_5s0d"},c('React').createElement(c('Image.react'),{src:s}),c('React').createElement('span',{className:"_3-99"},this.state.sendError));}var t=j._("\u641c\u5c0b\u7528\u6236\u548c\u7fa4\u7d44");return (c('React').createElement(c('XUIDialog.react'),{shown:this.props.shown,behaviors:{LayerFadeOnHide:c('LayerFadeOnHide')},onToggle:this.$MessagingForwardAttachmentDialog8,width:560},c('React').createElement(c('XUIDialogTitle.react'),null,this.props.title),c('React').createElement(c('XUIDialogBody.react'),{useCustomPadding:true},c('React').createElement(c('Layout.react'),null,c('React').createElement(m,{className:"_5s0e"},c('React').createElement('div',{className:"_2ph_"},c('React').createElement(c('SearchableTextInput.react'),{className:"_5s0f autofocus",onChange:this.$MessagingForwardAttachmentDialog3,onEntriesFound:this.$MessagingForwardAttachmentDialog4,placeholder:t,queryString:this.state.query,searchSource:this.$MessagingForwardAttachmentDialog1,searchSourceOptions:{onQueryFinished:this.$MessagingForwardAttachmentDialog5}})),c('React').createElement(c('ScrollableArea.react'),{className:"_5s0g",height:400,width:360},c('React').createElement(c('MessagingRecipientTypeaheadView.react'),{entries:this.state.query?this.state.entries:this.state.bootstrappedEntries,loading:this.state.loading,selectedEntries:this.state.selectedEntries,onSelect:this.$MessagingForwardAttachmentDialog2}))),c('React').createElement(n,{className:"_5s0h"},c('React').createElement(c('ScrollableArea.react'),{height:457,shadow:false},c('React').createElement(c('MessagingRecipientSelectedList.react'),{entries:this.state.selectedEntries,onSelect:this.$MessagingForwardAttachmentDialog2}))))),c('React').createElement(c('XUIDialogFooter.react'),{leftContent:r},c('React').createElement(c('XUIDialogCancelButton.react'),{onClick:this.props.onClose}),c('React').createElement(c('XUIDialogButton.react'),{use:'confirm',disabled:!this.state.selectedEntries.size||this.state.sending,label:q,onClick:this.$MessagingForwardAttachmentDialog6}))));};p.propTypes={attachmentID:o.string.isRequired,onClose:o.func,shown:o.bool.isRequired,title:o.string.isRequired,shareType:o.string};p.defaultProps={shareType:c('MessageShareType').IMAGE};f.exports=p;}),null);
__d("XForwardingNUXSeenController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/chat\/forwarding_nux_seen\/",{});}),null);
__d('MessagingForwardingButtonNUX.react',['AsyncRequest','ChatConfig','React','XForwardingNUXSeenController','XUIAmbientNUX.react'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;function k(){var l,m;'use strict';for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return l=(m=i.constructor).call.apply(m,[this].concat(o)),this.state={showNUX:!c('ChatConfig').get('seen_forwarding_nux')},this.$MessagingForwardingButtonNUX1=function(){if(!this.state.showNUX)return;c('ChatConfig').set('seen_forwarding_nux',true);new (c('AsyncRequest'))(c('XForwardingNUXSeenController').getURIBuilder().getURI()).send();this.setState({showNUX:false});}.bind(this),this.close=function(){this.$MessagingForwardingButtonNUX1();}.bind(this),l;}k.prototype.render=function(){'use strict';return c('React').createElement(c('XUIAmbientNUX.react'),{contextRef:this.props.contextRef,onCloseButtonClick:this.$MessagingForwardingButtonNUX1,position:'left',width:'auto',shown:this.state.showNUX},this.props.children);};k.propTypes={contextRef:j.func.isRequired};f.exports=k;}),null);
__d('MessengerTabIndices',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={NEW_MESSAGE_TOKENIZER:9998,COMPOSER_INPUT:9999};f.exports=h;}),null);
__d('MessengerScrollableArea.react',['cx','React','ReactDOM','ScrollableArea.react','Style','UserAgent','clearImmediate','joinClasses','setImmediate','throttle'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=20;i=babelHelpers.inherits(m,c('React').Component);j=i&&i.prototype;function m(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return o=(p=j.constructor).call.apply(p,[this].concat(r)),n.call(this),o;}m.prototype.componentDidMount=function(){this.$MessengerScrollableArea2=c('setImmediate')(this.$MessengerScrollableArea4);this.$MessengerScrollableArea1=true;this.$MessengerScrollableArea3=c('throttle')(this.$MessengerScrollableArea5,50);};m.prototype.componentWillUnmount=function(){c('clearImmediate')(this.$MessengerScrollableArea2);this.$MessengerScrollableArea1=false;};m.prototype.render=function(){return (c('React').createElement(c('ScrollableArea.react'),{className:c('joinClasses')("_5f0v",this.props.className),height:this.props.height,onScroll:this.props.needsFastScrollHandler?this.$MessengerScrollableArea5:this.$MessengerScrollableArea3,ref:'scrollable',shadow:false,tabIndex:this.props.tabIndex,width:this.props.width},this.props.children));};m.propTypes={needsFastScrollHandler:k.bool,onScroll:k.func,width:k.number};var n=function o(){this.$MessengerScrollableArea1=false;this.$MessengerScrollableArea2=null;this.$MessengerScrollableArea5=function(){if(this.$MessengerScrollableArea1){var p;this.props.onScroll&&(p=this.props).onScroll.apply(p,arguments);}}.bind(this);this.$MessengerScrollableArea4=function(){if(!c('UserAgent').isBrowser('IE'))return;var p=this.refs.scrollable.refs.wrap,q=this.refs.scrollable.refs.body;if(!q||!p)return;q=c('ReactDOM').findDOMNode(q);p=c('ReactDOM').findDOMNode(p);var r=p.offsetWidth-p.clientWidth;if(r>0)c('Style').set(q,'margin-right',-r+'px');}.bind(this);this.getArea=function(){return this.refs.scrollable.getArea();}.bind(this);this.scrollToBottom=function(){var p=this.getArea();if(p)this.scrollToPosition(p.getScrollHeight());}.bind(this);this.scrollToTop=function(p){var q=this.getArea();if(q)q.scrollToTop(!!p);}.bind(this);this.scrollToPosition=function(p){var q=this.getArea();if(!q)return;q.setScrollTop(p,false);}.bind(this);this.isScrolledToBottom=function(){return this.isScrolledToBottomWithHeight(0);}.bind(this);this.isScrolledToBottomWithHeight=function(p){var q=this.getArea();if(!q)return false;return q.getScrollTop()+q.getClientHeight()+p>=q.getScrollHeight()-l;}.bind(this);this.isScrolledToTop=function(){var p=this.getArea();if(!p)return true;return p.getScrollTop()<=l;}.bind(this);this.getScrollTop=function(){var p=this.getArea();if(!p)return 0;return p.getScrollTop();}.bind(this);};f.exports=m;}),null);
__d('MessengerContactAdapters',['immutable','ImmutableObject','MercuryTypeaheadConstants'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={fromSearchableEntry:function i(j){var k=j.getType(),l={alias:null,isMessengerUser:null,participants:null,photo:j.getPhoto(),subtitle:j.getSubtitle(),thread:null,title:j.getTitle(),type:k,uid:j.getUniqueID()},m=j.getAuxiliaryData();if(m)if(k===c('MercuryTypeaheadConstants').THREAD_TYPE){l.thread=new (c('ImmutableObject'))(m.thread);l.participants=c('immutable').Map().withMutations(function(n){m.participantsToRender.forEach(function(o){n.set(o.id,o);});});}else{l.isMessengerUser=m.isMessengerUser;l.alias=m.alias;}return new (c('ImmutableObject'))(l);},fromMercuryParticipant:function i(j){return new (c('ImmutableObject'))({alias:j.alias,uid:j.id,photo:j.image_src,title:j.name,subtitle:'',type:j.type,isMessengerUser:j.is_messenger_user,href:j.href,timezone:j.timezone});}};f.exports=h;}),null);
__d('MessengerContactActions',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=c('keyMirror')({ADD_OWNER:null,MESSAGE:null,PROFILE:null,REMOVE:null,REMOVE_OWNER:null,SELECT:null});}),null);
__d('MercuryThreadTimestamp.react',['React','formatDate','joinClasses'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').PureComponent);i=h&&h.prototype;k.prototype.render=function(){var l=this.props.time;if(!l)return c('React').createElement('abbr',null);return (c('React').createElement('abbr',{className:c('joinClasses')(this.props.className,'timestamp'),title:this.props.title||new Date(l).toLocaleDateString(),'data-utime':l/1000},this.props.text||c('formatDate')(new Date(l),'g:ia')));};function k(){h.apply(this,arguments);}k.propTypes={time:j.number,title:j.string,text:j.string};f.exports=k;}),null);
__d('MessengerLocalTime.react',['cx','fbt','MercuryThreadTimestamp.react','React','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes,m=22,n=6;j=babelHelpers.inherits(o,c('React').PureComponent);k=j&&j.prototype;o.prototype.render=function(){var p=this.props.participantTimeZone;if(!p)return null;var q=p-new Date().getTimezoneOffset()*-60;if(!q)return null;var r=new Date(Date.now()+q*1000),s=r.getHours()<n||r.getHours()>m,t=c('joinClasses')("_10rk",this.props.className);return (c('React').createElement('span',{className:t},c('React').createElement('span',{className:s?"_2f3x":''},c('React').createElement(c('MercuryThreadTimestamp.react'),{time:r.getTime()}),' ',i._("\u7576\u5730\u6642\u9593"))));};function o(){j.apply(this,arguments);}o.propTypes={className:l.string,participantTimeZone:l.number};f.exports=o;}),null);
__d('MercuryParticipantsImage.react',['MercuryParticipants','React','SplitImage.react','areEqual'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'MercuryParticipantsImage',_bigImageToken:null,propTypes:{participants:h.array.isRequired,size:h.number},getInitialState:function j(){return {participantImages:[]};},componentDidMount:function j(){this._getParticipantImages(this.props);},componentWillReceiveProps:function j(k){this._getParticipantImages(k);},componentWillUnmount:function j(){this._bigImageToken&&this._bigImageToken.remove();},shouldComponentUpdate:function j(k,l){return (k.size!==this.props.size||!l||!c('areEqual')(l.participantImages,this.state.participantImages));},render:function j(){if(this.state.participantImages.length>0)return (c('React').createElement(c('SplitImage.react'),{border:true,className:this.props.className,srcs:this.state.participantImages,size:this.props.size}));return null;},_getParticipantImages:function j(k){this._bigImageToken&&this._bigImageToken.remove();this._bigImageToken=c('MercuryParticipants').getOrderedBigImageMulti(k.participants,function(l){this.isMounted()&&this.setState({participantImages:l});}.bind(this));}});f.exports=i;}),null);
__d('MercuryThreadImage.react',['ImmutableObject','MercuryIDs','MercuryParticipantsImage.react','MercuryParticipantsConstants','Pixelz.react','React','areEqual'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;k.prototype.shouldComponentUpdate=function(l,m){return (l.thread.image_src!==this.props.thread.image_src||!c('areEqual')(l.thread.participants,this.props.thread.participants)||l.size!==this.props.size||l.viewer!==this.props.viewer||l.useBackground!==this.props.useBackground);};k.prototype.render=function(){var l=this.props.size||c('MercuryParticipantsConstants').BIG_IMAGE_SIZE,m=this.props.thread.image_src;if(m){if(this.props.useBackground)return (c('React').createElement('div',{style:{height:l,backgroundImage:'url('+m+')',backgroundPosition:'50% 50%',backgroundRepeat:'no-repeat',backgroundSize:'cover',width:l}}));return (c('React').createElement(c('Pixelz.react'),{alt:'',height:l,resizeMode:'cover',src:m,width:l}));}var n=c('MercuryIDs').getParticipantIDFromUserID(this.props.viewer),o=this.props.thread.participants.filter(function(q){return q!==n;}),p=[];if(!o.length){p=[n];}else if(o.length==1){p=o;}else p=o.slice(0,3);return (c('React').createElement(c('MercuryParticipantsImage.react'),{className:this.props.className,participants:p,size:l}));};function k(){h.apply(this,arguments);}k.propTypes={thread:j.instanceOf(c('ImmutableObject')).isRequired,viewer:j.string.isRequired,size:j.number,useBackground:j.bool};f.exports=k;}),null);
__d('MessengerThreadImage.react',['immutable','ImmutableObject','MercuryIDs','MercuryThreadImage.react','MessengerProfileImageWrapper.react','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').PureComponent);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return l=(m=i.constructor).call.apply(m,[this].concat(o)),this.$MessengerThreadImage1=function(){if(!c('MercuryIDs').isCanonical(this.props.thread.thread_id)||this.props.participants.size===0)return null;var q=this.props.thread.other_user_fbid,r=c('MercuryIDs').getParticipantIDFromUserID(q),s=this.props.participants.get(r);return s&&s.is_messenger_user;}.bind(this),l;}k.prototype.render=function(){return c('React').createElement(c('MessengerProfileImageWrapper.react'),{className:this.props.className,isMessengerUser:this.$MessengerThreadImage1(),size:this.props.size,showBadge:this.props.showBadge&&c('MercuryIDs').isCanonical(this.props.thread.thread_id)},c('React').createElement(c('MercuryThreadImage.react'),{size:this.props.size,thread:this.props.thread,viewer:this.props.viewer,useBackground:true}));};k.propTypes={participants:j.instanceOf(c('immutable').Map).isRequired,showBadge:j.bool,size:j.number,thread:j.instanceOf(c('ImmutableObject')).isRequired,viewer:j.string.isRequired};k.defaultProps={showBadge:true};f.exports=k;}),null);
__d('MessengerContactListRow.react',['cx','fbt','ix','Image.react','ImageBlock.react','ImmutableObject','Link.react','MercuryConfig','MercuryTypeaheadConstants','MessengerAdminGroupUtils','MessengerContactActions','MessengerContactImage.react','MessengerLocalTime.react','MessengerTextWithEntities.react','MessengerThreadImage.react','React','ReactDOM','TextWithEntities.react','joinClasses'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes,n=j('/images/mercury/clients/messenger/core/Checkmark.png'),o=32;k=babelHelpers.inherits(p,c('React').PureComponent);l=k&&k.prototype;function p(){var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return q=(r=l.constructor).call.apply(r,[this].concat(t)),this.state={isActionsOpen:false},this.$MessengerContactListRow2=function(v){if(this.props.actionsClass)return;v.stopPropagation();v.preventDefault();}.bind(this),this.$MessengerContactListRow1=function(v){v.stopPropagation();this.$MessengerContactListRow6(c('MessengerContactActions').SELECT,v);}.bind(this),this.$MessengerContactListRow3=function(){if(this.props.contact.photo){return (c('React').createElement(c('MessengerContactImage.react'),{className:"_5l39 _5rmm",isMessengerUser:this.props.contact.isMessengerUser,size:o,src:this.props.contact.photo}));}else if(this.props.contact.type===c('MercuryTypeaheadConstants').THREAD_TYPE)return (c('React').createElement(c('MessengerThreadImage.react'),{className:"_5l39",participants:this.props.contact.participants,size:o,thread:this.props.thread||this.props.contact.thread,viewer:this.props.viewer}));return c('React').createElement('div',{className:"_5l39"});}.bind(this),this.$MessengerContactListRow4=function(){if(this.props.contact.subtitle){var v=c('TextWithEntities.react');if(c('MercuryConfig').MessengerNewEmojiGK)v=c('MessengerTextWithEntities.react');return (c('React').createElement('div',null,c('React').createElement('div',{className:"_3q34"},c('React').createElement(v,{renderEmoji:true,renderEmoticons:true,text:this.props.contact.title})),c('React').createElement('div',{className:"_3q35"},this.props.contact.subtitle)));}else return (c('React').createElement('div',{className:"_364g"},this.props.contact.title,c('React').createElement(c('MessengerLocalTime.react'),{className:"_5ywd",participantTimeZone:this.props.contact.timezone})));}.bind(this),this.$MessengerContactListRow5=function(){if(this.props.isOriginal)return (c('React').createElement('span',{className:"_5rh4"},i._("\u5df2\u65b0\u589e")));if(this.props.isInvited)return (c('React').createElement('span',{className:"_5rh4"},i._("\u5df2\u9080\u8acb")));if(this.props.isSelected)return (c('React').createElement(c('Image.react'),{className:"_1kqm",src:n}));if(this.props.presenceStatus)return (c('React').createElement('div',{className:"_jg2"}));var v=null,w=c('MessengerAdminGroupUtils').isAdmin(this.props.adminIds,this.props.contact.uid),x=this.props.thread;if(x&&c('MessengerAdminGroupUtils').isOwner(w,x))v=c('React').createElement('span',{className:"_5qsj"},i._("\u64c1\u6709\u8005"));if(this.props.actionsClass){var y=this.props.actionsClass;return (c('React').createElement('div',null,v,c('React').createElement(y,{className:"_rwo",adminIds:this.props.adminIds,contact:this.props.contact,extrasEnabled:this.props.extraActionsEnabled,isOpen:this.state.isActionsOpen,onAction:this.$MessengerContactListRow6,onToggle:this.$MessengerContactListRow7,viewer:this.props.viewer})));}return v;}.bind(this),this.$MessengerContactListRow6=function(v,event){this.props.onAction&&this.props.onAction(v,event);}.bind(this),this.$MessengerContactListRow7=function(v){this.setState({isActionsOpen:v});}.bind(this),q;}p.prototype.componentDidMount=function(){if(this.props.isHighlighted&&this.props.onScrollIntoView){var q=c('ReactDOM').findDOMNode(this);this.props.onScrollIntoView&&this.props.onScrollIntoView(q);this.props.onRenderHighlight&&this.props.onRenderHighlight(q);}};p.prototype.componentDidUpdate=function(q){if(this.props.isHighlighted&&!q.isHighlighted){var r=c('ReactDOM').findDOMNode(this);this.props.onScrollIntoView&&this.props.onScrollIntoView(r);this.props.onRenderHighlight&&this.props.onRenderHighlight(r);}};p.prototype.render=function(){var q=this.props.disableRole?{}:{'aria-selected':this.props.isHighlighted,role:'option'};return c('React').createElement('li',babelHelpers['extends']({},q,{className:c('joinClasses')(this.props.className,"_5l37"+(this.props.isHighlighted?' '+"_1k1p":'')+(this.state.isActionsOpen?' '+"_rwn":''))}),c('React').createElement(c('Link.react'),{className:"_5f0v",onClick:this.$MessengerContactListRow1,onMouseDown:this.$MessengerContactListRow2,onMouseEnter:this.props.onMouseEnter,tabIndex:this.props.actionsClass?0:-1},c('React').createElement(c('ImageBlock.react'),{contentClassName:"_5l38",spacing:'medium'},this.$MessengerContactListRow3(),this.$MessengerContactListRow4(),this.$MessengerContactListRow5())));};p.propTypes={actionsClass:m.func,adminIds:m.arrayOf(m.string),className:m.string,contact:m.instanceOf(c('ImmutableObject')).isRequired,disableRole:m.bool,extraActionsEnabled:m.bool.isRequired,isHighlighted:m.bool,isInvited:m.bool,isOriginal:m.bool,isSelected:m.bool,onAction:m.func,onMouseEnter:m.func,onScrollIntoView:m.func,presenceStatus:m.bool,thread:m.instanceOf(c('ImmutableObject')),viewer:m.string.isRequired};f.exports=p;}),null);
__d('MessengerContactListRowContainer.react',['AvailableListConstants','immutable','ImmutableObject','MercuryIDs','MercuryParticipantTypes','MessengerContactActions','MessengerContactListRow.react','PresenceStatus','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').PureComponent);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return l=(m=i.constructor).call.apply(m,[this].concat(o)),this.state={contact:this.props.contactAdapter(this.props.rawContact)},this.$MessengerContactListRowContainer2=function(){if(!this.props.hasHoverState)return;this.props.onHighlight&&this.props.onHighlight(this.props.rawContact);}.bind(this),this.$MessengerContactListRowContainer1=function(q,event){switch(q){case c('MessengerContactActions').SELECT:this.props.onSelect(this.props.rawContact,event);break;default:this.props.onAction&&this.props.onAction(q,this.props.rawContact);break;}}.bind(this),this.$MessengerContactListRowContainer3=function(){var q=this.state.contact;if(!this.props.showPresence||q.type!==c('MercuryParticipantTypes').FRIEND&&q.type!==c('MercuryParticipantTypes').USER)return false;var r=c('MercuryIDs').getUserIDFromParticipantID(q.uid);return c('PresenceStatus').get(r)==c('AvailableListConstants').ACTIVE;}.bind(this),l;}k.prototype.componentWillReceiveProps=function(l){if(l.rawContact!==this.props.rawContact)this.setState({contact:l.contactAdapter(l.rawContact)});};k.prototype.render=function(){return c('React').createElement(c('MessengerContactListRow.react'),{actionsClass:this.props.actionsClass,adminIds:this.props.adminIds,className:this.props.rowClassName,contact:this.state.contact,disableRole:this.props.disableRole,extraActionsEnabled:this.props.extraActionsEnabled,isHighlighted:this.props.isHighlighted,isInvited:this.props.invitedEntryIDs&&this.props.invitedEntryIDs.contains(this.state.contact.uid),isOriginal:this.props.originalEntryIDs&&this.props.originalEntryIDs.contains(this.state.contact.uid),isSelected:this.props.selectedEntryIDs&&this.props.selectedEntryIDs.contains(this.state.contact.uid),onAction:this.$MessengerContactListRowContainer1,onMouseEnter:this.$MessengerContactListRowContainer2,onRenderHighlight:this.props.onRenderHighlight,onScrollIntoView:this.props.onScrollIntoView,presenceStatus:this.$MessengerContactListRowContainer3(),thread:this.props.thread||this.state.contact.thread,viewer:this.props.viewer});};k.propTypes={actionsClass:j.func,adminIds:j.arrayOf(j.string),contactAdapter:j.func.isRequired,disableRole:j.bool,extraActionsEnabled:j.bool.isRequired,hasHoverState:j.bool,invitedEntryIDs:j.instanceOf(c('immutable').Set),isHighlighted:j.bool,onAction:j.func,onHighlight:j.func,onScrollIntoView:j.func,onSelect:j.func.isRequired,originalEntryIDs:j.instanceOf(c('immutable').Set),rawContact:j.object.isRequired,rowClassName:j.string,selectedEntryIDs:j.instanceOf(c('immutable').Set),showPresence:j.bool,thread:j.instanceOf(c('ImmutableObject')),viewer:j.string.isRequired};f.exports=k;}),null);
__d('MessengerContactList.react',['cx','fbt','MessengerContactListRowContainer.react','ImageBlock.react','immutable','ImmutableObject','MessengerSpinner.react','React','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').PureComponent);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return n=(o=k.constructor).call.apply(o,[this].concat(q)),this.$MessengerContactList1=function(s,t){return (c('React').createElement('div',{key:t,className:"_29hk"},this.$MessengerContactList4(t),c('React').createElement('ul',{id:this.props.ariaOwneeID,role:this.props.disableRole?undefined:'listbox',className:"_29hl"},s.map(function(u,v){var w=v===0?c('joinClasses')(this.props.rowClassName,"_3h3c"):this.props.rowClassName;return (c('React').createElement(c('MessengerContactListRowContainer.react'),{actionsClass:this.props.actionsClass,adminIds:this.props.adminIds,contactAdapter:this.props.contactAdapter,disableRole:this.props.disableRole,extraActionsEnabled:!!this.props.extraActionsEnabled,hasHoverState:this.props.hasHoverState,invitedEntryIDs:this.props.invitedEntryIDs,isHighlighted:this.props.highlightedEntry&&this.props.highlightedEntry.getUniqueID()===u.getUniqueID(),key:u.id||u.getUniqueID(),onAction:this.props.onAction,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight,onScrollIntoView:this.props.onScrollIntoView,onSelect:this.props.onSelect,originalEntryIDs:this.props.originalEntryIDs,rawContact:u,rowClassName:w,selectedEntryIDs:this.props.selectedEntryIDs,showPresence:this.props.showPresence,thread:this.props.thread,viewer:this.props.viewer}));}.bind(this)))));}.bind(this),this.$MessengerContactList4=function(s){if(!s)return null;return (c('React').createElement('div',{className:"_225b"},s));},this.$MessengerContactList2=function(){if(!this.props.isLoading)return null;return (c('React').createElement(c('ImageBlock.react'),{className:"_225c",spacing:'medium'},c('React').createElement(c('MessengerSpinner.react'),{className:"_2i59",color:'grey'}),c('React').createElement('div',{className:"_4g0h"},i._("\u641c\u5c0b\u4e2d\u22ef\u22ef"))));}.bind(this),this.$MessengerContactList3=function(){if(this.props.isLoading||this.props.listSections.size>0||!this.props.queryString||this.props.queryString.length===0)return null;return (c('React').createElement('div',{className:"_3xcx"},i._("\u67e5\u7121\u7d50\u679c")));}.bind(this),n;}m.prototype.render=function(){return c('React').createElement('div',{className:this.props.className},this.props.listSections.map(this.$MessengerContactList1).toArray(),this.$MessengerContactList2(),this.$MessengerContactList3());};m.propTypes={actionsClass:l.func,adminIds:l.arrayOf(l.string),ariaOwneeID:l.string,contactAdapter:l.func.isRequired,disableRole:l.bool,extraActionsEnabled:l.bool,hasHoverState:l.bool,highlightedEntry:l.object,invitedEntryIDs:l.instanceOf(c('immutable').Set),isLoading:l.bool,listSections:l.instanceOf(c('immutable').OrderedMap).isRequired,onAction:l.func,onHighlight:l.func,onRenderHighlight:l.func,onScrollIntoView:l.func,onSelect:l.func.isRequired,originalEntryIDs:l.instanceOf(c('immutable').Set),queryString:l.string,rowClassName:l.string,selectedEntryIDs:l.instanceOf(c('immutable').Set),showPresence:l.bool,thread:l.instanceOf(c('ImmutableObject')),viewer:l.string.isRequired};f.exports=m;}),null);
__d('MessengerTypeaheadView.react',['cx','immutable','MessengerContactAdapters','MessengerContactList.react','MessengerTypeaheadUtils','React','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').PureComponent);j=i&&i.prototype;l.prototype.render=function(){return (c('React').createElement(c('MessengerContactList.react'),{ariaOwneeID:this.props.ariaOwneeID,className:c('joinClasses')(this.props.className,"_5t4c"),contactAdapter:c('MessengerContactAdapters').fromSearchableEntry,hasHoverState:this.props.hasHoverState,highlightedEntry:this.props.highlightedEntry,isLoading:this.props.isLoading,listSections:c('MessengerTypeaheadUtils').buildListSections(this.props.entries,this.props.queryString),onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight,onScrollIntoView:this.props.onScrollIntoView,onSelect:this.props.onSelect,originalEntryIDs:this.props.originalEntryIDs,invitedEntryIDs:this.props.invitedEntryIDs,queryString:this.props.queryString,selectedEntryIDs:this.props.selectedEntryIDs,showPresence:false,viewer:this.props.viewer}));};function l(){i.apply(this,arguments);}l.propTypes={ariaOwneeID:k.string,entries:k.array.isRequired,hasHoverState:k.bool,highlightedEntry:k.object,isLoading:k.bool,onHighlight:k.func,onRenderHighlight:k.func,onScrollIntoView:k.func,onSelect:k.func,originalEntryIDs:k.instanceOf(c('immutable').Set),invitedEntryIDs:k.instanceOf(c('immutable').Set),queryString:k.string,selectedEntryIDs:k.instanceOf(c('immutable').Set),viewer:k.string.isRequired};f.exports=l;}),null);
__d('MessengerScrollableTypeaheadView.react',['MessengerScrollableArea.react','MessengerTypeaheadUtils','MessengerTypeaheadView.react','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').PureComponent);i=h&&h.prototype;function j(){var k,l;for(var m=arguments.length,n=Array(m),o=0;o<m;o++)n[o]=arguments[o];return k=(l=i.constructor).call.apply(l,[this].concat(n)),this.$MessengerScrollableTypeaheadView1=function(p){c('MessengerTypeaheadUtils').scrollEntryIntoView(p,this.refs.scrollable);}.bind(this),k;}j.prototype.render=function(){var k=this.props,l=k.className,m=k.width,n=babelHelpers.objectWithoutProperties(k,['className','width']);return c('React').createElement(c('MessengerScrollableArea.react'),{className:l,ref:'scrollable',width:m},c('React').createElement(c('MessengerTypeaheadView.react'),babelHelpers['extends']({},n,{onScrollIntoView:this.$MessengerScrollableTypeaheadView1})));};f.exports=j;}),null);
__d('MessengerTokenizerToken.react',['cx','Keys','React','SearchableEntry','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=100;i=babelHelpers.inherits(m,c('React').Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return n=(o=j.constructor).call.apply(o,[this].concat(q)),this.$MessengerTokenizerToken1=function(event){event.stopPropagation();},this.$MessengerTokenizerToken2=function(event){if(event.keyCode===c('Keys').BACKSPACE){event.preventDefault();this.props.onRemove&&this.props.onRemove(this.props.entry);}}.bind(this),n;}m.prototype.render=function(){return c('React').createElement('span',{className:c('joinClasses')(this.props.className,"_14-8"),label:null,onClick:this.$MessengerTokenizerToken1,onKeyDown:this.$MessengerTokenizerToken2,tabIndex:this.props.index+l},c('React').createElement('span',{'aria-label':this.props.label,title:this.props.label,className:"_14-9"},this.props.label));};m.propTypes={className:k.string,entry:k.instanceOf(c('SearchableEntry')),index:k.number,label:k.string.isRequired,onRemove:k.func};f.exports=m;}),null);
__d('MessengerTokenizer.react',['cx','invariant','AbstractTokenizer.react','immutable','React','SearchableEntry','MessengerScrollableTypeaheadView.react','MessengerTokenizerToken.react','MessengerTypeaheadUtils','TypeaheadNavigation','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes,m=30;j=babelHelpers.inherits(n,c('React').PureComponent);k=j&&j.prototype;function n(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return p=(q=k.constructor).call.apply(q,[this].concat(s)),o.call(this),p;}n.prototype.componentDidMount=function(){if(this.props.autoFocus)this.focusInput();};n.prototype.render=function(){return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,"_14-7")},c('React').createElement(c('AbstractTokenizer.react'),{autoHighlight:this.props.hasHoverState,context:this.props.context,entries:this.props.entries.toArray(),excludeTokenEntries:!!this.state.queryString,extraTypeaheadProps:{spellCheck:false},hideViewWithEntries:this.props.hideViewWithEntries,onAddEntryAttempt:this.$MessengerTokenizer3,onEntriesFound:this.props.onEntriesFound,onQueryStringChange:this.$MessengerTokenizer4,onRemoveEntryAttempt:this.props.onRemoveEntryAttempt,onReorderEntryAttempt:this.props.onReorderEntryAttempt,navigation:{moveUp:this.$MessengerTokenizer1,moveDown:this.$MessengerTokenizer2},placeholder:this.props.placeholder,presenter:{ViewRenderer:c('MessengerScrollableTypeaheadView.react'),TokenRenderer:c('MessengerTokenizerToken.react'),alwaysVisibleOnFocus:(this.state.isLoading||this.state.isLoaded)&&!!this.state.queryString,useLayer:this.props.useLayer,extraRendererProps:babelHelpers['extends']({hasHoverState:this.props.hasHoverState,isLoading:this.state.isLoading,originalEntryIDs:this.props.originalEntryIDs,selectedEntryIDs:c('immutable').Seq(this.props.entries).map(function(p){return p.getUniqueID();}).toSet(),viewer:this.props.viewer},this.props.extraRendererProps),maxEntries:m,sortEntries:this.$MessengerTokenizer5},queryString:this.state.queryString,ref:'tokenizer',searchSource:this.props.searchSource,searchSourceOptions:{onQueryFinished:this.$MessengerTokenizer6,onQueryStarted:this.$MessengerTokenizer7,showDefaultEntries:this.props.showDefaultEntries},showEntriesOnFocus:true,tabIndex:this.props.tabIndex&&this.props.tabIndex.toString()})));};n.propTypes={autoFocus:l.bool,className:l.string,context:l.object,entries:l.instanceOf(c('immutable').List).isRequired,excludeGroups:l.bool,extraRendererProps:l.object,hasHoverState:l.bool,hideViewWithEntries:l.bool,onAddEntryAttempt:l.func.isRequired,onEntriesFound:l.func,onRemoveEntryAttempt:l.func.isRequired,onReorderEntryAttempt:l.func,originalEntryIDs:l.instanceOf(c('immutable').Set),placeholder:l.string,searchSource:l.object.isRequired,tabIndex:l.number,useLayer:l.bool,viewer:l.string.isRequired};n.defaultProps={excludeGroups:false,hideViewWithEntries:true};var o=function p(){this.state={isLoading:false,isLoaded:false,queryString:''};this.$MessengerTokenizer1=function(q){for(var r=arguments.length,s=Array(r>1?r-1:0),t=1;t<r;t++)s[t-1]=arguments[t];c('TypeaheadNavigation').moveUp.apply(c('TypeaheadNavigation'),[c('MessengerTypeaheadUtils').orderEntries(q,this.state.queryString)].concat(s));}.bind(this);this.$MessengerTokenizer2=function(q){for(var r=arguments.length,s=Array(r>1?r-1:0),t=1;t<r;t++)s[t-1]=arguments[t];c('TypeaheadNavigation').moveDown.apply(c('TypeaheadNavigation'),[c('MessengerTypeaheadUtils').orderEntries(q,this.state.queryString)].concat(s));}.bind(this);this.$MessengerTokenizer3=function(q){this.setState({isLoaded:false,queryString:''});var r=q.getUniqueID();if(this.props.entries.some(function(s){return (s.getUniqueID()===r);})){this.props.onRemoveEntryAttempt(q);return;}if(this.props.originalEntryIDs&&this.props.originalEntryIDs.contains(r))return;this.props.onAddEntryAttempt(q);}.bind(this);this.$MessengerTokenizer5=function(q){if(this.props.entries.size||this.props.excludeGroups)return c('MessengerTypeaheadUtils').sortEntriesWithoutGroupsOrViewer(q,this.props.viewer);return c('MessengerTypeaheadUtils').sortEntries(q,this.state.queryString);}.bind(this);this.focusInput=function(){setTimeout(function(){this.refs.tokenizer&&this.refs.tokenizer.focusInput();}.bind(this));}.bind(this);this.$MessengerTokenizer7=function(q){if(q===this.state.queryString)this.setState({isLoading:true});}.bind(this);this.$MessengerTokenizer6=function(q){if(q===this.state.queryString)this.setState({isLoaded:true,isLoading:false});}.bind(this);this.$MessengerTokenizer4=function(event){!(event.target instanceof HTMLInputElement)?i(0):void 0;this.setState({isLoaded:false,queryString:event.target.value});}.bind(this);};f.exports=n;}),null);
__d('MessengerComposeViewHeader.react',['cx','fbt','immutable','MessengerSearchSource','MessengerTokenizer.react','MessengerTypeaheadComponents','MessengerTabIndices','React','clearImmediate','joinClasses','setImmediate'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes,m=320,n=c('MessengerTypeaheadComponents').TokenizerComponent||c('MessengerTokenizer.react');j=babelHelpers.inherits(o,c('React').PureComponent);k=j&&j.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return p=(q=k.constructor).call.apply(q,[this].concat(s)),this.state={tokenizerContext:null},this.$MessengerComposeViewHeader1=null,this.$MessengerComposeViewHeader2=function(){this.$MessengerComposeViewHeader1=c('setImmediate')(function(){this.refs.tokenizer&&this.refs.tokenizer.focusInput();}.bind(this));}.bind(this),p;}o.prototype.componentDidMount=function(){this.$MessengerComposeViewHeader2();this.setState({tokenizerContext:this.refs.tokenizerContext});};o.prototype.componentDidUpdate=function(p){if(this.props.recipients!==p.recipients)this.props.onResize();};o.prototype.componentWillUnmount=function(){this.$MessengerComposeViewHeader1&&c('clearImmediate')(this.$MessengerComposeViewHeader1);};o.prototype.render=function(){var p={};if(c('MessengerTypeaheadComponents').GraphQLTypeahead){p={enableMessageSearch:false,excludeGroups:false,excludePages:false,hasHoverState:true,originalEntryIDs:c('immutable').Set(),scrollableViewClassName:"_2y8_",shouldQueryVCEndpoint:false,width:m};}else p={extraRendererProps:{className:"_2y8_",width:m},hasHoverState:true,searchSource:c('MessengerSearchSource').getForFBID(this.props.viewer)};return c('React').createElement('div',{className:c('joinClasses')("_2y8y _5l-3",this.props.className),onClick:this.$MessengerComposeViewHeader2},c('React').createElement('div',{className:"_2y8z"},i._("\u6536\u4ef6\u8005\uff1a")),c('React').createElement('div',null,c('React').createElement(n,babelHelpers['extends']({className:"_2y8-",context:this.state.tokenizerContext,entries:this.props.recipients,forceHideClearButton:this.props.forceHideClearButton,onAddEntryAttempt:this.props.onAddRecipient,onClear:this.props.onClear,onRemoveEntryAttempt:this.props.onRemoveRecipient,placeholder:i._("\u8f38\u5165\u7528\u6236\u6216\u7fa4\u7d44\u7684\u540d\u7a31\u3002"),ref:'tokenizer',tabIndex:c('MessengerTabIndices').NEW_MESSAGE_TOKENIZER,useLayer:true,viewer:this.props.viewer},p)),c('React').createElement('div',{ref:'tokenizerContext'})));};o.propTypes={forceHideClearButton:l.bool.isRequired,onAddRecipient:l.func.isRequired,onClear:l.func,onRemoveRecipient:l.func.isRequired,onResize:l.func.isRequired,recipients:l.instanceOf(c('immutable').List).isRequired,viewer:l.string.isRequired};f.exports=o;}),null);
__d('MessengerDialogCancelButton.react',['fbt','MessengerDialogButton.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').PureComponent);j=i&&i.prototype;k.prototype.render=function(){return (c('React').createElement(c('MessengerDialogButton.react'),babelHelpers['extends']({action:'cancel',label:h._("\u53d6\u6d88"),type:'secondary'},this.props)));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('MessengerForwardAttachmentDialog.react',['ix','cx','fbt','AsyncRequest','CurrentUser','Image.react','immutable','LayerFadeOnHide','MessageShareType','MessengerComposeViewHeader.react','MessengerDialog.react','MessengerDialogBody.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerSpinner.react','React','XMessagingForwardAttachmentController','XMessengerPlatformShareCTAController','emptyFunction','fbglyph'],(function a(b,c,d,e,f,g,h,i,j){var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;function n(){var o,p;'use strict';for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return o=(p=l.constructor).call.apply(p,[this].concat(r)),this.state={recipients:c('immutable').List(),sendError:null,sending:false,startingThreadingID:Date.now()},this.$MessengerForwardAttachmentDialog3=function(t){this.setState({recipients:this.state.recipients.push(t)});}.bind(this),this.$MessengerForwardAttachmentDialog4=function(t){var u=this.state.recipients;this.setState({recipients:u['delete'](u.indexOf(t))});}.bind(this),this.$MessengerForwardAttachmentDialog2=function(){this.setState({recipients:c('immutable').List()});}.bind(this),this.$MessengerForwardAttachmentDialog5=function(){var t={},u=this.state.startingThreadingID;this.state.recipients.forEach(function(w){t[u++]=w.getUniqueID();});if(this.props.shareType===c('MessageShareType').PLATFORM_SHARE_CTA){var v=c('XMessengerPlatformShareCTAController').getURIBuilder().getURI();new (c('AsyncRequest'))(v).setMethod('POST').setHandler(this.$MessengerForwardAttachmentDialog6).setData({cta_id:this.props.attachmentID,recipient_map:t}).send();}else{v=c('XMessagingForwardAttachmentController').getURIBuilder().getURI();new (c('AsyncRequest'))(v).setMethod('POST').setHandler(this.$MessengerForwardAttachmentDialog6).setData({attachment_id:this.props.attachmentID,recipient_map:t}).send();}this.setState({sending:true,sendError:null});}.bind(this),this.$MessengerForwardAttachmentDialog6=function(t){if(t.payload.success){this.props.onClose&&this.props.onClose();this.setState({recipients:c('immutable').List(),sending:false,startingThreadingID:Date.now()});return;}this.setState({sending:false,sendError:t.payload.error});}.bind(this),this.$MessengerForwardAttachmentDialog1=function(t){if(!t)this.props.onClose&&this.props.onClose();}.bind(this),o;}n.prototype.getDefaultProps=function(){'use strict';return {shareType:c('MessageShareType').IMAGE};};n.prototype.render=function(){'use strict';var o=j._("\u50b3\u9001"),p;if(this.state.sending){p=c('React').createElement('div',null,c('React').createElement(c('MessengerSpinner.react'),null),c('React').createElement('span',{className:"_1e1n _3-99"},j._("\u50b3\u9001\u4e2d")));}else if(this.state.sendError){var q=h("\/images\/assets_DO_NOT_HARDCODE\/fb_glyphs\/caution-solid_16_bluegray-40.png");p=c('React').createElement('div',{className:"_1e1n"},c('React').createElement(c('Image.react'),{src:q}),c('React').createElement('span',{className:"_3-99"},this.state.sendError));}return c('React').createElement(c('MessengerDialog.react'),{shown:this.props.shown,behaviors:{LayerFadeOnHide:c('LayerFadeOnHide')},onToggle:this.$MessengerForwardAttachmentDialog1,width:560},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),null,this.props.title)),c('React').createElement(c('MessengerDialogBody.react'),null,c('React').createElement(c('MessengerComposeViewHeader.react'),{className:"_1e1o",forceHideClearButton:false,onClear:this.$MessengerForwardAttachmentDialog2,onAddRecipient:this.$MessengerForwardAttachmentDialog3,onRemoveRecipient:this.$MessengerForwardAttachmentDialog4,onResize:c('emptyFunction'),recipients:this.state.recipients,viewer:c('CurrentUser').getID()})),c('React').createElement(c('MessengerDialogFooter.react'),{leftContent:p},c('React').createElement(c('MessengerDialogCancelButton.react'),{onClick:this.props.onClose}),c('React').createElement(c('MessengerDialogButton.react'),{action:'confirm',disabled:!this.state.recipients.size||this.state.sending,label:o,onClick:this.$MessengerForwardAttachmentDialog5,type:'primary'})));};n.propTypes={attachmentID:m.string.isRequired,onClose:m.func,shown:m.bool.isRequired,title:m.string.isRequired,shareType:m.string};f.exports=n;}),null);
__d('XUIDialogHeader.react',['cx','fbt','React','XUICardHeader.react','XUICloseButton.react'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;m.prototype.render=function(){'use strict';var n=null;if(this.props.showCloseButton)n=c('React').createElement(c('XUICloseButton.react'),{label:this.props.closeButtonText,className:"layerCancel _51-t"});return (c('React').createElement(c('XUICardHeader.react'),babelHelpers['extends']({},this.props,{className:"_4-i0",link:n,type:'primary'}),this.props.children));};function m(){'use strict';j.apply(this,arguments);}m.propTypes={closeButtonText:l.string,showCloseButton:l.bool,activeTabKey:l.string,defaultActiveTabKey:l.string,onTabClick:l.func};m.defaultProps={closeButtonText:i._("\u95dc\u9589"),onTabClick:function n(){return true;},showCloseButton:true};f.exports=m;}),null);
__d('MessengerPhotoInfoDialog.react',['cx','fbt','CurrentEnvironment','MessengerContactImage.react','MessengerDialog.react','MessengerDialogButton.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerActions','MessengerSpinner.react','MercuryIDs','MercuryTimestamp','MercuryParticipants','React','Relay','RelayQL','XUIDialog.react','XUIDialogHeader.react','XUIDialogHeaderTitle.react'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes,m=54;j=babelHelpers.inherits(n,c('React').Component);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return o=(p=k.constructor).call.apply(p,[this].concat(r)),this.$MessengerPhotoInfoDialog6=function(){var t=this.props.fullMedia.exif_data,u='';if(t){if(t.aperture)u=t.aperture+' ';if(t.focal_length){var v=t.focal_length.split('/'),w=parseInt(v[0],10)/(parseInt(v[1],10)||1);u+=w+'mm ';}if(t.iso)u+='ISO '+t.iso;}if(!u.length)return null;return (c('React').createElement('div',{className:"_2zn1"},c('React').createElement('div',{className:"_2zn2"},i._("\u76f8\u6a5f")),c('React').createElement('div',{className:"_2zn4"},c('React').createElement('div',{className:"_2zn5"},t.model||'Camera'),c('React').createElement('div',{className:"_2zn6"},u))));}.bind(this),this.$MessengerPhotoInfoDialog5=function(){var t=this.props.fullMedia,u='';if(t.filesize>1e+06){u=(t.filesize/1e+06).toFixed(2)+'MB';}else if(t.filesize>1000){u=(t.filesize/1000).toFixed(2)+'KB';}else if(t.filesize>0)u=t.filesize+'B';var v=t.__typename==='MessageImage'?(t.original_dimensions.x*t.original_dimensions.y/1e+06).toFixed(2)+'MP':'';return (c('React').createElement('div',{className:"_2zn1"},c('React').createElement('div',{className:"_2zn2"},i._("\u8a73\u7d30\u5167\u5bb9")),c('React').createElement('div',{className:"_2zn4"},c('React').createElement('div',{className:"_2zn5"},t.filename),c('React').createElement('div',{className:"_2zn6"},v+' '+t.original_dimensions.x+' x '+t.original_dimensions.y+' '+u))));}.bind(this),this.$MessengerPhotoInfoDialog4=function(event){event.preventDefault();this.props.showHeader();c('MessengerActions').hideDialog();}.bind(this),this.$MessengerPhotoInfoDialog3=function(t){if(!t){this.props.showHeader();c('MessengerActions').hideDialog();}}.bind(this),this.$MessengerPhotoInfoDialog7=function(t){if(!t){this.props.showHeader();this.props.closeInfo();}}.bind(this),this.showProfilePic=function(){var t=this.props.fullMedia;if(!t){return c('React').createElement(c('MessengerSpinner.react'),null);}else{var u=c('MercuryIDs').getParticipantIDFromUserID(t.creator.id),v=c('MercuryParticipants').getNow(u);if(v&&v.is_messenger_user!=null)return (c('React').createElement(c('MessengerContactImage.react'),{isMessengerUser:v.is_messenger_user,size:m,src:v.big_image_src||v.image_src}));return c('React').createElement(c('MessengerSpinner.react'),null);}}.bind(this),o;}n.prototype.render=function(){return c('CurrentEnvironment').messengerdotcom?this.$MessengerPhotoInfoDialog1():this.$MessengerPhotoInfoDialog2();};n.prototype.$MessengerPhotoInfoDialog1=function(){var o=this.props.fullMedia;return c('React').createElement(c('MessengerDialog.react'),{onToggle:this.$MessengerPhotoInfoDialog3,ref:'dialog',type:'default',width:504},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),null,i._("\u76f8\u95dc\u8cc7\u8a0a")),c('React').createElement(c('MessengerDialogButton.react'),{action:'cancel',label:i._("\u5b8c\u6210"),onClick:this.$MessengerPhotoInfoDialog4,type:'primary'})),c('React').createElement('div',{className:"_2zn1"},c('React').createElement('div',{className:"_2zn2"},i._("\u4e0a\u50b3\u8005\uff1a")),c('React').createElement('div',{className:"_2zn4"},c('React').createElement('div',{className:"_2zn5"},o.creator.name),c('React').createElement('div',{className:"_2zn6"},c('MercuryTimestamp').getPreciseTimestamp(o.creation_time*1000))),c('React').createElement('div',{className:"_2zn7"},this.showProfilePic())),this.$MessengerPhotoInfoDialog5(),this.$MessengerPhotoInfoDialog6());};n.prototype.$MessengerPhotoInfoDialog2=function(){var o=this.props.fullMedia;return c('React').createElement(c('XUIDialog.react'),{onToggle:this.$MessengerPhotoInfoDialog7,shown:this.props.infoOpen,ref:'dialog',type:'serif',width:504},c('React').createElement(c('XUIDialogHeader.react'),null,c('React').createElement(c('XUIDialogHeaderTitle.react'),null,i._("\u76f8\u95dc\u8cc7\u8a0a"))),c('React').createElement('div',{className:"_2zn1"},c('React').createElement('div',{className:"_2zn2"},i._("\u4e0a\u50b3\u8005\uff1a")),c('React').createElement('div',{className:"_2zn4"},c('React').createElement('div',{className:"_2zn5"},o.creator.name),c('React').createElement('div',{className:"_2zn6"},c('MercuryTimestamp').getPreciseTimestamp(o.creation_time*1000))),c('React').createElement('div',{className:"_2zn7"},this.showProfilePic())),this.$MessengerPhotoInfoDialog5(),this.$MessengerPhotoInfoDialog6());};n.propTypes={closeInfo:l.func,photoID:l.string,infoOpen:l.bool,viewer:l.string,showHeader:l.func.isRequired};f.exports=c('Relay').createContainer(n,{fragments:{fullMedia:function o(p){return function(){return {children:[{fieldName:'__typename',kind:'Field',metadata:{isRequisite:true},type:'String'},{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{children:[{fieldName:'creation_time',kind:'Field',metadata:{},type:'Time'},{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'name',kind:'Field',metadata:{},type:'String'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'}],fieldName:'creator',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isAbstract:true},type:'Actor'},{fieldName:'filename',kind:'Field',metadata:{},type:'String'},{children:[{fieldName:'x',kind:'Field',metadata:{},type:'Float'},{fieldName:'y',kind:'Field',metadata:{},type:'Float'}],fieldName:'original_dimensions',kind:'Field',metadata:{canHaveSubselections:true},type:'Vect2'},{fieldName:'filesize',kind:'Field',metadata:{},type:'Int'},{children:[{fieldName:'iso',kind:'Field',metadata:{},type:'Int'},{fieldName:'aperture',kind:'Field',metadata:{},type:'String'},{fieldName:'focal_length',kind:'Field',metadata:{},type:'String'},{fieldName:'model',kind:'Field',metadata:{},type:'String'}],fieldName:'exif_data',kind:'Field',metadata:{canHaveSubselections:true},type:'MessageImageExifData'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'MessageImage',type:'MessageImage'},{children:[{fieldName:'creation_time',kind:'Field',metadata:{},type:'Time'},{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'name',kind:'Field',metadata:{},type:'String'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'}],fieldName:'creator',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isAbstract:true},type:'Actor'},{fieldName:'filename',kind:'Field',metadata:{},type:'String'},{children:[{fieldName:'x',kind:'Field',metadata:{},type:'Float'},{fieldName:'y',kind:'Field',metadata:{},type:'Float'}],fieldName:'original_dimensions',kind:'Field',metadata:{canHaveSubselections:true},type:'Vect2'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'MessageVideo',type:'MessageVideo'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{isAbstract:true},name:'MessengerPhotoInfoDialog_react_FullMediaRelayQL',type:'Node'};}();}}});}),null);
__d('SpotlightMessagesViewerContainerRoute',['RelayRoute','RelayQL'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='SpotlightMessagesViewerContainerRoute';j.paramDefinition={photoID:{type:'String',required:true}};j.queries={fullMedia:function k(l){return function(m){return {calls:[{kind:'Call',metadata:{type:'ID!'},name:'id',value:{kind:'CallVariable',callVariableName:'photoID'}}],children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'},c('RelayQL').__frag(m)]),fieldName:'node',kind:'Query',metadata:{isAbstract:true,identifyingArgName:'id',identifyingArgType:'ID!'},name:'SpotlightMessagesViewerContainerRoute',type:'Node'};}(l.getFragment('fullMedia'));}};f.exports=j;}),null);
__d('MessengerPhotoInfoDialogContainer.react',['MessengerPhotoInfoDialog.react','RelayRootContainer','SpotlightMessagesViewerContainerRoute','React'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'MessengerPhotoInfoDialogContainer',proptypes:{viewer:h.string,photoID:h.string.isRequired,showHeader:h.func.isRequired},render:function j(){var k=new (c('SpotlightMessagesViewerContainerRoute'))({photoID:this.props.photoID});return (c('React').createElement(c('RelayRootContainer'),{Component:c('MessengerPhotoInfoDialog.react'),route:k,renderFetched:function(l){return (c('React').createElement(c('MessengerPhotoInfoDialog.react'),babelHelpers['extends']({},l,{closeInfo:this.props.closeInfo,photoID:this.props.photoID,infoOpen:this.props.infoOpen,showHeader:this.props.showHeader,viewer:this.props.viewer})));}.bind(this)}));}});f.exports=i;}),null);
__d('MessengerPhotoViewBottomBar.react',['cx','React'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=function j(k){return (c('React').createElement('div',{className:"_51an _50-m _16zz"},k.children));};f.exports=i;}),null);
__d('MessengerPhotoViewHScroll.react',['cx','Animation','MessengerSpinner.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=200,m=80;i=babelHelpers.inherits(n,c('React').Component);j=i&&i.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return o=(p=j.constructor).call.apply(p,[this].concat(r)),this.$MessengerPhotoViewHScroll3=function(){if(!this.props.isLoadingImages)return null;return (c('React').createElement('div',{className:"_2n20"},c('React').createElement(c('MessengerSpinner.react'),null)));}.bind(this),this.$MessengerPhotoViewHScroll2=function(){var t=this.props,u=t.children,v=c('React').Children.count(u);return c('React').Children.map(u,function(w,x){var y={paddingLeft:0,paddingRight:0},z=(t.width-m)/2;if(x<v-1)y.paddingRight=0;if(x===0)y.paddingLeft=z;if(x===v-1)y.paddingRight=z;var aa=this.$MessengerPhotoViewHScroll4.bind(null,w);return (c('React').createElement('div',{className:"_4dy9",key:x,onClick:aa,style:y},w));}.bind(this));}.bind(this),this.$MessengerPhotoViewHScroll4=function(t){this.props.onScroll(t.props.photoID);this.props.fetchMore(t.props.photoID);var u=this.$MessengerPhotoViewHScroll1(t.props.photoID);this.$MessengerPhotoViewHScroll5(u);}.bind(this),this.$MessengerPhotoViewHScroll5=function(t){var u=this.$MessengerPhotoViewHScroll6(t);this.setState({scrollLeft:u});}.bind(this),this.$MessengerPhotoViewHScroll6=function(t){var u=this.$MessengerPhotoViewHScroll1(this.props.photoID);if(t===u)return this.state.scrollLeft;var v=t*m;return v;}.bind(this),this.$MessengerPhotoViewHScroll1=function(t){var u=this.props.children.find(function(v){return v.props.photoID===t;});if(!u)return -1;return this.props.children.indexOf(u);}.bind(this),o;}n.prototype.componentWillReceiveProps=function(o){if(o&&o.photoID!==this.props.photoID)this.setState({scrollLeft:this.$MessengerPhotoViewHScroll1(o.photoID)*m});};n.prototype.render=function(){var o=this.props;if(!o.isLoadingImages&&this.refs&&this.refs.childContainer)new (c('Animation'))(this.refs.childContainer).to('scrollLeft',this.state.scrollLeft).duration(l).go();var p={overflow:'hidden',width:o.width};return c('React').createElement('div',{className:"_452h",style:{width:o.width}},c('React').createElement('div',{className:"_452m",ref:'childContainer',style:p},c('React').createElement('div',{className:"_452n"},this.$MessengerPhotoViewHScroll2(),this.$MessengerPhotoViewHScroll3())));};n.propTypes={fetchMore:k.func.isRequired,isLoadingImages:k.bool,onScroll:k.func.isRequired,photoID:k.string.isRequired,width:k.number.isRequired};f.exports=n;}),null);
__d('MessengerPhotoViewBottomScrollable.react',['cx','MessengerPhotoViewHScroll.react','MessengerSharedPhoto.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return m=(n=j.constructor).call.apply(n,[this].concat(p)),this.state={photoID:''},this.$MessengerPhotoViewBottomScrollable1=function(r){if(this.state.photoID!==r.id)this.setState({photoID:r.id});}.bind(this),m;}l.prototype.componentWillReceiveProps=function(m){if(m.photoID!=this.state.photoID)this.setState({photoID:m.photoID});};l.prototype.render=function(){var m=this.props.sharedPhotos.edges,n=m.length,o="_5l-3 _42rk",p=m.slice(0,n).map(function(q){var r=q.node;return c('React').createElement(c('MessengerSharedPhoto.react'),{className:"_42rl"+(this.state.photoID!==r.id?' '+"_q1a":''),fbid:r.legacy_attachment_id,key:r.legacy_attachment_id,onClick:function(){return this.$MessengerPhotoViewBottomScrollable1(r);}.bind(this),photoID:r.id,uri:r.image.uri});}.bind(this));return c('React').createElement('div',{className:o,ref:'scrollable'},c('React').createElement(c('MessengerPhotoViewHScroll.react'),{fetchMore:this.props.fetchMore,isLoadingImages:this.props.isLoadingImages,onScroll:this.props.onScroll,photoID:this.state.photoID,width:this.props.width},p));};l.propTypes={fetchMore:k.func,isLoadingImages:k.bool,onScroll:k.func.isRequired,photoID:k.string,width:k.number};f.exports=l;}),null);
__d('MessengerPhotoViewHeader.react',['cx','fbt','MessengerActions','MessengerPhotoInfoDialogContainer.react','React','SpotlightViewerBottomBarLink','MessengerPhotoViewCloseLink.react'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').PureComponent);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return n=(o=k.constructor).call.apply(o,[this].concat(q)),this.$MessengerPhotoViewHeader3=function(){c('MessengerActions').showDialog(c('MessengerPhotoInfoDialogContainer.react'),{photoID:this.props.photoID,showHeader:this.props.showHeader,viewer:this.props.viewer});}.bind(this),this.$MessengerPhotoViewHeader2=function(){return (c('React').createElement(c('MessengerPhotoViewCloseLink.react'),{onClick:this.props.onClose}));}.bind(this),this.$MessengerPhotoViewHeader1=function(){var s;if(!this.props.disableForward)s=c('React').createElement(c('SpotlightViewerBottomBarLink'),{className:"_3c1o",onClick:this.props.showForwardDialog,ref:'forwardButton'},c('React').createElement('div',{className:"_2msr _3oo2"}),i._("\u8f49\u5bc4"));return (c('React').createElement('div',{key:'buttonsContainer',ref:'buttons'},c('React').createElement(c('SpotlightViewerBottomBarLink'),{ajaxify:this.props.url,className:"_3c1o",rel:'async'},c('React').createElement('div',{className:"_3ooo _2msr"}),i._("\u4e0b\u8f09")),s,c('React').createElement('div',{className:"_3c1o",onClick:this.$MessengerPhotoViewHeader3,ref:'moreInfo'},c('React').createElement('div',{className:"_3c1k _2msr"}),i._("\u76f8\u95dc\u8cc7\u8a0a"))));}.bind(this),n;}m.prototype.render=function(){return c('React').createElement('div',{className:"_51an _50-m _3c1i _5l-3",role:'banner'},this.$MessengerPhotoViewHeader1(),this.$MessengerPhotoViewHeader2());};m.propTypes={disableForward:l.bool,onClose:l.func,photoID:l.string,showForwardDialog:l.func,url:l.object,viewer:l.string};f.exports=m;}),null);
__d("XMessagingVideoAttachmentController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/attachments\/video\/",{video_id:{type:"String",required:true},video_container_id:{type:"String",required:true},width:{type:"Int",required:true},height:{type:"Int",required:true}});}),null);
__d('MessengerVideoPlayer.react',['cx','AsyncRequest','MessengerSpinner.react','React','XMessagingVideoAttachmentController','guid'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MessengerVideoPlayer',_domID:String,propTypes:{videoData:i.object},shouldComponentUpdate:function k(l){return !this.props.videoData||l.videoData.id!==this.props.videoData.id;},componentWillMount:function k(){this._domID=c('guid')();},render:function k(){if(!this.props.videoData)return null;this._loadVideoPlayer();return (c('React').createElement('div',{className:"_4-od _51an",id:this._domID},c('React').createElement(c('MessengerSpinner.react'),{color:'blue',ref:'spinner',size:c('MessengerSpinner.react').Sizes.LARGE})));},_loadVideoPlayer:function k(){var l=this.props.videoData;if(l){var m=c('XMessagingVideoAttachmentController').getURIBuilder().setString('video_id',l.legacy_attachment_id).setString('video_container_id',this._domID).setInt('width',l.original_dimensions.x).setInt('height',l.original_dimensions.y).getURI();new (c('AsyncRequest'))().setMethod('GET').setStatusElement(this.refs.spinner).setURI(m).setReadOnly(true).setHandler(function(n){}).send();}}});f.exports=j;}),null);
__d('SpotlightMessagesViewerPagers.react',['cx','LeftRight.react','Link.react','React'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=function j(k){return (c('React').createElement(c('LeftRight.react'),null,c('React').createElement(c('Link.react'),{className:"_322u _2bbb _50-m"}),c('React').createElement(c('Link.react'),{className:"_322u _2bbc _50-m"})));};f.exports=i;}),null);
__d('SpotlightViewer',['cx','React','Spotlight.react'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';if(!this.props.open)return null;var l="_n3";if(this.props.className)l+=' '+this.props.className;return (c('React').createElement(c('Spotlight.react'),{onBeforeHide:this.props.onBeforeHide,onHide:this.props.onHide,rootClassName:this.props.rootClassName,shown:this.props.open,key:'photoLayer'},c('React').createElement('div',{className:l,onClick:this.props.onClick},this.props.children)));};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('SpotlightViewerAutoResize',['invariant','Event','SubscriptionsHandler'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){'use strict';this.$SpotlightViewerAutoResize1=j;!(typeof this.$SpotlightViewerAutoResize1.onResize==='function')?h(0):void 0;}i.prototype.enable=function(){'use strict';this.$SpotlightViewerAutoResize2=new (c('SubscriptionsHandler'))();this.$SpotlightViewerAutoResize2.addSubscriptions(c('Event').listen(window,'resize',this.$SpotlightViewerAutoResize1.onResize));};i.prototype.disable=function(){'use strict';this.$SpotlightViewerAutoResize2.release();delete this.$SpotlightViewerAutoResize2;};f.exports=i;}),null);
__d('SpotlightViewerBehaviorsMixin',['BehaviorsMixin'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={componentWillMount:function i(){this.behaviors&&this.enableBehaviors(this.behaviors);},componentWillUnmount:function i(){this.destroyBehaviors();}};Object.assign(h,c('BehaviorsMixin'));f.exports=h;}),null);
__d('PhotoUtils',['Event','URI'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={getImagesFromData:function i(j){var k=[];for(var l in j)if(l.indexOf('image')===0)k.push(j[l]);return k;},getFBIDFromData:function i(j){return j&&j.id;},getOriginalImageFromData:function i(j){return j.original||j.download_image;},getDownloadURLFromData:function i(j){var k=this.getOriginalImageFromData(j);if(!k)return null;var l=new (c('URI'))(k.uri);l.addQueryData({dl:1});return l;},getPermalinkFromData:function i(j){return j.permalink;},canViewerMakeCoverPhoto:function i(j){return !!j.can_viewer_make_cover_photo;},getCoverPhotoURLFromData:function i(j){return new (c('URI'))('/profile.php').addQueryData({preview_cover:h.getFBIDFromData(j)});},preload:function i(j,k,l){var m=j.getDimensions();for(var n=0;n<k.length;++n){var o=m.getBestFitImageFromPhoto(k[n],m.getMaxStageDimensions()),p=new Image();l&&c('Event').listen(p,'load',l.bind(null,k[n]));j.getLogger().log(o.uri);p.src=o.uri;}}};f.exports=h;}),null);
__d('PhotoViewerDimensions',['Event','PhotoUtils','Vector'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={verticalPadding:'number',horizontalPadding:'number',normalResDim:'object'};function i(j){'use strict';for(var k in j){if(!h[k])throw new Error("Unsupported extraData value '"+k+"' should not be used");if(typeof j[k]===h[k])this['_'+k]=j[k];}this._listener=c('Event').listen(window,'resize',this._resetMaxStageDimensions.bind(this));}i.prototype.destroy=function(){'use strict';this._listener.remove();};i.prototype.getStageDimensions=function(j){'use strict';var k=this.getMaxStageDimensions(),l=new (c('Vector'))(Math.min(j.x,k.x),Math.min(j.y,k.y)),m=l.x/l.y,n=j.x/j.y;if(m<n){l.y=Math.round(l.x/n);}else l.x=Math.round(l.y*n);return l;};i.prototype.getImageDimensionsForStage=function(j,k){'use strict';var l=j.x,m=j.y,n=k.x,o=k.y;if(l>=n||m>=o){var p=l/m,q=n/o;if(q<p){l=n;m=Math.round(n/p);}else if(q>p){l=Math.round(o*p);m=o;}else{l=n;m=o;}}return new (c('Vector'))(l,m);};i.prototype.getImageDimensionsForMaxStage=function(j,k){'use strict';var l=j.x,m=j.y,n=k.x,o=k.y,p=l/m,q=n/o;if(l>=n||m>=o){if(q<p){l=n;m=Math.round(n/p);}else if(q>p){l=Math.round(o*p);m=o;}else{l=n;m=o;}}else if(p<q){l=Math.round(m*p);}else m=Math.round(l/p);return new (c('Vector'))(l,m);};i.prototype.getMaxStageDimensions=function(){'use strict';if(!this._maxStageDimensions)this._maxStageDimensions=new (c('Vector'))(c('Vector').getViewportDimensions().x-this._horizontalPadding,c('Vector').getViewportDimensions().y-this._verticalPadding);return this._maxStageDimensions;};i.prototype.getMaxStageDimensionsWithoutPadding=function(){'use strict';if(!this._maxStageDimensions)this._maxStageDimensions=new (c('Vector'))(c('Vector').getViewportDimensions().x,c('Vector').getViewportDimensions().y);return this._maxStageDimensions;};i.prototype._resetMaxStageDimensions=function(){'use strict';this._maxStageDimensions=null;};i.prototype.getBestFitImageFromPhoto=function(j,k){'use strict';var l=null,m=c('PhotoUtils').getImagesFromData(j);m=m.sort(function(o,p){return p.width-o.width;});if(window.devicePixelRatio&&window.devicePixelRatio>1)k=new (c('Vector'))(k.x*window.devicePixelRatio,k.y*window.devicePixelRatio);for(var n=0;n<m.length;n++)if(!l||m[n].width>=k.x||m[n].height>=k.y)l=m[n];return l;};i.prototype.getOriginalDimensionsFromPhoto=function(j){'use strict';var k=c('PhotoUtils').getOriginalImageFromData(j);return new (c('Vector'))(k.width,k.height);};i.prototype.getBestFitDimensionsFromPhoto=function(j,k){'use strict';var l=this.getBestFitImageFromPhoto(j,k);return new (c('Vector'))(l.width,l.height);};i.prototype.getVerticalPadding=function(){'use strict';return this._verticalPadding;};i.prototype.getHorizontalPadding=function(){'use strict';return this._horizontalPadding;};Object.assign(i.prototype,{_verticalPadding:40,_horizontalPadding:60,_normalResDim:{x:960,y:960}});f.exports=i;}),null);
__d('SpotlightViewerStageResizer',['Event','MercuryConfig','SubscriptionsHandler','Vector'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=520;function i(j,k){'use strict';this._subscriptionsHandler=new (c('SubscriptionsHandler'))();this._subscriptionsHandler.addSubscriptions(c('Event').listen(window,'resize',this._resetStageDimensions.bind(this)));this._dimensions=j;this._minHeight=k.minHeight||h;this._minWidth=k.minWidth||h;this._resetStageDimensions();}i.prototype.destroy=function(){'use strict';this._dimensions=null;this._subscriptionsHandler.release();};i.prototype._resetStageDimensions=function(){'use strict';this._currentStageDimensions=new (c('Vector'))(this._minWidth,this._minHeight);};i.prototype.getImageAndStageDimensions=function(j){'use strict';var k=this._dimensions.getBestFitDimensionsFromPhoto(j,this._dimensions.getMaxStageDimensions()),l=c('MercuryConfig').SharedPhotoNewView?this._dimensions.getMaxStageDimensionsWithoutPadding(k):this._dimensions.getStageDimensions(k);this._currentStageDimensions=new (c('Vector'))(Math.max(l.x,this._minWidth,this._currentStageDimensions.x),Math.max(l.y,this._minHeight,this._currentStageDimensions.y));var m=c('MercuryConfig').SharedPhotoNewView?this._dimensions.getImageDimensionsForMaxStage(k,this._currentStageDimensions):this._dimensions.getImageDimensionsForStage(k,this._currentStageDimensions);return {stageDimensions:this._currentStageDimensions,imageDimensions:m};};i.prototype.getCurrentStageDimensions=function(){'use strict';return this._currentStageDimensions;};f.exports=i;}),null);
__d('SpotlightViewerDimensionMixin',['MercuryConfig','SpotlightViewerStageResizer','PhotoViewerDimensions'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={getInitialState:function i(){this._dimensions=new (c('PhotoViewerDimensions'))({verticalPadding:this.props.verticalPadding,horizontalPadding:this.props.horizontalPadding});this._resizer=new (c('SpotlightViewerStageResizer'))(this._dimensions,{minHeight:this.props.minHeight,minWidth:this.props.minWidth});return {maxStageDimensions:c('MercuryConfig').SharedPhotoNewView?this._dimensions.getMaxStageDimensionsWithoutPadding():this._dimensions.getMaxStageDimensions()};},componentWillUnmount:function i(){this._resizer&&this._resizer.destroy();this._resizer=null;this._dimensions&&this._dimensions.destroy();this._dimensions=null;},getMedia:function i(){if(this.state.photoData){if(this.state.photoData.__typename&&this.state.photoData.__typename==='MessageVideo')return this._getVideo();var j=this._resizer.getImageAndStageDimensions(this.state.photoData),k=this._dimensions.getBestFitImageFromPhoto(this.state.photoData,this.state.maxStageDimensions);return this._getMedia(k,j);}else return null;},getDimensions:function i(){return this._dimensions;},getStageDimensions:function i(){if(this.state.photoData){return this._resizer.getImageAndStageDimensions(this.state.photoData).stageDimensions;}else return c('MercuryConfig').SharedPhotoNewView?this._dimensions.getMaxStageDimensionsWithoutPadding():this._dimensions.getMaxStageDimensions();},getImageDimensions:function i(){if(!this.state.photoData)return null;return this._resizer.getImageAndStageDimensions(this.state.photoData).imageDimensions;},onResize:function i(){if(c('MercuryConfig').SharedPhotoNewView){var j=this._dimensions.getMaxStageDimensionsWithoutPadding();this.setState({maxStageDimensions:j,width:j.x});}else this.setState({maxStageDimensions:this._dimensions.getMaxStageDimensions()});}};f.exports=h;}),null);
__d('SpotlightViewerImage',['cx','Image.react','React'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';return (c('React').createElement(c('Image.react'),{className:"_4-od",src:this.props.src,style:{width:this.props.dimensions.x,height:this.props.dimensions.y}}));};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('SpotlightViewerThumbnailMixin',['PhotoStore','Vector'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_getInitialPhotoData:function i(){var j=c('PhotoStore').getIndexForID(this.props.setid,this.props.photoid),k=c('PhotoStore').getByIndexImmediate(this.props.setid,j);return k?k:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function i(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var j={id:this.props.photoid};for(var k=0;k<this.props.dimensions.length;++k){var l=c('Vector').deserialize(this.props.dimensions[k]);j['image'+k]={width:l.x,height:l.y,uri:this.props.thumbsrc};}return j;}};f.exports=h;}),null);
__d('SpotlightViewport',['csx','cx','CurrentEnvironment','Locale','Parent','React','ReactDOM','Vector','joinClasses'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SpotlightViewport',propTypes:{stageDimensions:j.object.isRequired,useWidth:j.bool},PAGE_TO_PREV_PERCENTAGE:.2,sections:{NONE:null,FORWARD:1,BACKWARD:2},timer:null,getInitialState:function l(){return {currentActiveSection:this.sections.NONE,active:true};},componentDidMount:function l(){this._onMouseEnter();},componentWillUnmount:function l(){if(this.props.fadeInNOut)clearTimeout(this.timer);},_onMouseMove:function l(event){var m=c('ReactDOM').findDOMNode(this),n=c('Vector').getEventPosition(event.nativeEvent),o=c('Vector').getElementPosition(m),p=this.props.useWidth?this.props.stageDimensions.x:c('Vector').getElementDimensions(m).x;if(this.props.fadeInNOut)if(this._isMouseOverActionBars(n)){clearTimeout(this.timer);}else this._onMouseEnter();var q,r=n.x-o.x,s=r/p;if(c('Locale').isRTL()){q=s>1-this.PAGE_TO_PREV_PERCENTAGE;}else q=s<this.PAGE_TO_PREV_PERCENTAGE;if(q){this.setState({currentActiveSection:this.sections.BACKWARD});}else this.setState({currentActiveSection:this.sections.FORWARD});},_onClick:function l(event){var m=this.state.currentActiveSection==this.sections.FORWARD,n=event.target;if(!c('Parent').bySelector(n,"._51an"))this.props.onClick&&this.props.onClick(m);},_isMouseOverActionBars:function l(m){if(c('CurrentEnvironment').messengerdotcom){return m.y<70||m.y>this.props.stageDimensions.y-70;}else return m.y>this.props.stageDimensions.y-60||m.y<75&&m.x>this.props.stageDimensions.x-75;},_onMouseEnter:function l(){this.setState({active:true});if(this.props.fadeInNOut){clearTimeout(this.timer);this.timer=setTimeout(this._onMouseLeave,1000);}},_onMouseLeave:function l(){this.setState({active:false});},makeActive:function l(){this._onMouseEnter();},render:function l(){var m="_4-of"+(!this.state.active&&!this.props.active?' '+"_50-l":'')+(this.state.currentActiveSection===this.sections.BACKWARD?' '+"_516a":'')+(this.state.currentActiveSection===this.sections.FORWARD?' '+"_516b":'')+(this.props.showLoadingIndicator?' '+"_51jp":'');if(this.props.className)m=c('joinClasses')(m,this.props.className);var n={};if(this.props.stageDimensions){n={height:this.props.stageDimensions.y};if(this.props.useWidth)n.width=this.props.stageDimensions.x;}return (c('React').createElement('div',{className:m,style:n,onClick:this._onClick,onMouseMove:this._onMouseMove,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},this.props.children,c('React').createElement('div',{className:"_4-og"},c('React').createElement('span',{className:"_4-oh"}),this.props.media,c('React').createElement('div',{className:"_4-oi"}))));}});f.exports=k;}),null);
__d("XMessagingPhotoDownloadController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/attachments\/photo\/",{photo_id:{type:"String",required:true}});}),null);
__d('SpotlightMessagesViewer2',['cx','fbt','ActorURI','ArbiterMixin','ChatPhotoViewFooterHScroll.react','ChatPhotoViewHeader.react','CurrentEnvironment','KeyEventController','MessagingForwardAttachmentDialog.react','MessagingForwardingButtonNUX.react','MessengerForwardAttachmentDialog.react','MessengerPhotoInfoDialogContainer.react','MessengerPhotoViewBottomBar.react','MessengerPhotoViewBottomScrollable.react','MessengerPhotoViewCloseLink.react','MessengerPhotoViewHeader.react','MessengerVideoPlayer.react','React','ReactDOM','ReactFragment','Relay','RelayQL','SpotlightViewer','SpotlightViewerAutoResize','SpotlightViewerBehaviorsMixin','SpotlightViewerDimensionMixin','SpotlightViewerImage','SpotlightMessagesViewerPagers.react','SpotlightViewerThumbnailMixin','SpotlightViewport','SubscriptionsHandler','Vector','XMessagingPhotoDownloadController'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=15,k=88,l=c('React').createClass({displayName:'SpotlightMessagesViewer2',_subscriptions:c('SubscriptionsHandler'),mixins:[c('ArbiterMixin'),c('SpotlightViewerBehaviorsMixin'),c('SpotlightViewerDimensionMixin'),c('SpotlightViewerThumbnailMixin')],behaviors:[c('SpotlightViewerAutoResize')],componentWillUnmount:function m(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;},componentWillReceiveProps:function m(n){if(n.photoID!==this.props.photoID)this.setState({open:n.open,photoData:n.fullMedia,photoID:n.photoID});},componentDidMount:function m(){this.setState({photoData:this.props.fullMedia,photoID:this.props.photoID,width:c('ReactDOM').findDOMNode(this.refs.photoviewheader).offsetWidth});},getInitialState:function m(){this._enableKeyEvents();return {isLoadingImage:false,open:true,photoData:null,photoID:'',showForward:false,showInfo:false,width:900};},getIndex:function m(){var n=this.props.sharedPhotos.edges,o=n.find(function(p){var q=p.node;return q.id===this.state.photoID;}.bind(this));if(!o)return -1;return n.indexOf(o);},getLegacyID:function m(){var n=this.props.sharedPhotos.edges,o=n.find(function(p){var q=p.node;return q.id===this.state.photoID;}.bind(this));if(!o)return '';return o.node.legacy_attachment_id;},close:function m(){if(!this._isOpen())return;this.setState({open:false},function(){return this.inform('close');}.bind(this));this.props.onClosePhotoView();},renderLayers:function m(){if(this.props.disableForward)return null;var n=i._("\u4ee5\u55ae\u7368\u8a0a\u606f\u8f49\u5bc4"),o=c('CurrentEnvironment').messengerdotcom?c('MessengerForwardAttachmentDialog.react'):c('MessagingForwardAttachmentDialog.react');return c('ReactFragment').create({forwardDialog:c('React').createElement(o,{attachmentID:String(this.getLegacyID()),onClose:this._hideForwardDialog,shown:this.state.showForward,title:n}),forwardButtonNUX:c('React').createElement(c('MessagingForwardingButtonNUX.react'),{contextRef:function(){return this.refs.forwardButton;}.bind(this),ref:'forwardNUX'},i._("\u4ee5\u500b\u5225\u8a0a\u606f\u7684\u65b9\u5f0f\u767c\u9001\u9019\u5f35\u5716\u50cf\u7d66\u5176\u4ed6\u4eba\u3002"))});},_renderInfo:function m(){return (c('React').createElement(c('MessengerPhotoInfoDialogContainer.react'),{closeInfo:this._hideInfoDialog,infoOpen:this.state.showInfo,photoID:this.props.photoID,showHeader:this._showHeader,viewer:this.props.viewer}));},_renderTopBar:function m(){var n=c('XMessagingPhotoDownloadController').getURIBuilder().setString('photo_id',String(this.getLegacyID())).getURI();if(this.props.actorid)n=c('ActorURI').create(n,this.props.actorid);return (c('React').createElement(c('MessengerPhotoViewHeader.react'),{ref:'photoviewheader',disableForward:this.props.disableForward,onClose:this.props.onCloseSharedPhotos,photoID:this.props.photoID,url:n,showForwardDialog:this._showForwardDialog,showHeader:this._showHeader}));},_renderBottomSection:function m(){var n=this.props.totalCount>=j?c('React').createElement('div',{className:"_2n5a",onClick:this.props.openAlbum},c('React').createElement('div',{className:"_2n5b"})):null;return (c('React').createElement(c('MessengerPhotoViewBottomBar.react'),null,c('React').createElement(c('MessengerPhotoViewBottomScrollable.react'),{fetchMore:this.props.fetchMore,isLoadingImages:this.props.isLoadingImages,onScroll:this._scrollPhotoStrip,photoID:this.state.photoID,sharedPhotos:this.props.sharedPhotos,width:this.state.width}),n));},_renderWebFooter:function m(){return (c('React').createElement(c('ChatPhotoViewFooterHScroll.react'),{fetchMore:this.props.fetchMore,isLoadingImages:this.props.isLoadingImages,onScroll:this._scrollPhotoStrip,photoID:this.state.photoID,sharedPhotos:this.props.sharedPhotos,totalCount:this.props.totalCount,width:this.state.width}));},_enableKeyEvents:function m(){this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('KeyEventController').registerKey('LEFT',function(){this._handleClickViewport(false);return false;}.bind(this)),c('KeyEventController').registerKey('RIGHT',function(){this._handleClickViewport(true);return false;}.bind(this)));},_getVideo:function m(){return c('React').createElement(c('MessengerVideoPlayer.react'),{videoData:this.state.photoData});},_getMedia:function m(n,o){return (c('React').createElement(c('SpotlightViewerImage'),{dimensions:o.imageDimensions,ref:'image',src:n.uri}));},_showForwardDialog:function m(){this.setState({showForward:true});this.refs.forwardNUX.close();},_hideForwardDialog:function m(){this.setState({showForward:false});this._showHeader();},_showInfoDialog:function m(){this.setState({showInfo:true});},_hideInfoDialog:function m(){this.setState({showInfo:false});},_showHeader:function m(){this.refs.viewport.makeActive();},_isOpen:function m(){return this.state.open;},_scrollPhotoStrip:function m(n){this.setState({photoID:n},function(){this.props.loadImage(this.state.photoID);}.bind(this));},_handleClickViewport:function m(n){var o,p=this,q=this.getIndex(),r=n?q+1:q-1;if(r>=this.props.sharedPhotos.edges.length)r=0;if(r>=0)(function(){var s=p.props.sharedPhotos.edges[r].node.id;p.setState({photoID:s},function(){this.props.loadImage(this.state.photoID);if(n)this.props.fetchMore(s);}.bind(p));})();},_renderWebHeader:function m(){var n=c('XMessagingPhotoDownloadController').getURIBuilder().setString('photo_id',String(this.getLegacyID())).getURI();if(this.props.actorid)n=c('ActorURI').create(n,this.props.actorid);return (c('React').createElement(c('ChatPhotoViewHeader.react'),{ref:'photoviewheader',disableForward:this.props.disableForward,onClose:this.props.onCloseSharedPhotos,openInfo:this._showInfoDialog,photoID:this.props.photoID,url:n,showForwardDialog:this._showForwardDialog,showHeader:this._showHeader}));},_renderCloseButton:function m(){return (c('React').createElement(c('MessengerPhotoViewCloseLink.react'),{onClick:this.props.onCloseSharedPhotos}));},render:function m(){var n=this.getMedia(),o=this.getStageDimensions();if(c('CurrentEnvironment').facebookdotcom)o=new (c('Vector'))(o.x,o.y-k);var p=this.state.isLoadingImages||this.props.useloadingindicator&&!this.state.photoData,q=c('CurrentEnvironment').facebookdotcom?c('React').createElement('div',null,this._renderCloseButton(),this._renderWebHeader(),this.props.disablepaging?null:c('React').createElement(c('SpotlightMessagesViewerPagers.react'),null)):c('React').createElement('div',null,this._renderTopBar(),this.props.disablepaging?null:c('React').createElement(c('SpotlightMessagesViewerPagers.react'),null),this._renderBottomSection()),r=this.state.showInfo&&c('CurrentEnvironment').facebookdotcom?this._renderInfo():null,s=c('CurrentEnvironment').facebookdotcom?this._renderWebFooter():null;return (c('React').createElement('span',null,c('React').createElement(c('SpotlightViewer'),{className:"_53vs",onHide:this.close,open:this.state.open,ref:'spotlightViewer',rootClassName:this.props.rootClassName},c('React').createElement(c('SpotlightViewport'),{active:false,fadeInNOut:true,media:n,onClick:this._handleClickViewport,ref:'viewport',showLoadingIndicator:p,stageDimensions:o,useWidth:true},q),s),this.renderLayers(),r));}});f.exports=c('Relay').createContainer(l,{fragments:{fullMedia:function m(n){return function(){return {children:[{fieldName:'__typename',kind:'Field',metadata:{isRequisite:true},type:'String'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'legacy_attachment_id',kind:'Field',metadata:{},type:'ID'},{alias:'image1',calls:[{kind:'Call',metadata:{},name:'width',value:{kind:'CallValue',callValue:960}},{kind:'Call',metadata:{},name:'height',value:{kind:'CallValue',callValue:960}}],children:[{fieldName:'width',kind:'Field',metadata:{},type:'Int'},{fieldName:'height',kind:'Field',metadata:{},type:'Int'},{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{alias:'image2',calls:[{kind:'Call',metadata:{},name:'width',value:{kind:'CallValue',callValue:2048}},{kind:'Call',metadata:{},name:'height',value:{kind:'CallValue',callValue:2048}}],children:[{fieldName:'width',kind:'Field',metadata:{},type:'Int'},{fieldName:'height',kind:'Field',metadata:{},type:'Int'},{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'MessageImage',type:'MessageImage'},{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'legacy_attachment_id',kind:'Field',metadata:{},type:'ID'},{alias:'image1',calls:[{kind:'Call',metadata:{},name:'width',value:{kind:'CallValue',callValue:960}},{kind:'Call',metadata:{},name:'height',value:{kind:'CallValue',callValue:960}}],children:[{fieldName:'width',kind:'Field',metadata:{},type:'Int'},{fieldName:'height',kind:'Field',metadata:{},type:'Int'},{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{alias:'image2',calls:[{kind:'Call',metadata:{},name:'width',value:{kind:'CallValue',callValue:2048}},{kind:'Call',metadata:{},name:'height',value:{kind:'CallValue',callValue:2048}}],children:[{fieldName:'width',kind:'Field',metadata:{},type:'Int'},{fieldName:'height',kind:'Field',metadata:{},type:'Int'},{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{children:[{fieldName:'x',kind:'Field',metadata:{},type:'Float'},{fieldName:'y',kind:'Field',metadata:{},type:'Float'}],fieldName:'original_dimensions',kind:'Field',metadata:{canHaveSubselections:true},type:'Vect2'},{fieldName:'url',kind:'Field',metadata:{},type:'Url'},{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'}],fieldName:'creator',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isAbstract:true},type:'Actor'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'MessageVideo',type:'MessageVideo'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{isAbstract:true},name:'SpotlightMessagesViewer__FullMediaRelayQL',type:'Node'};}();}}});}),null);
__d('MessengerThreadSharedPhotos.react',['cx','MercuryConfig','MessengerSharedPhotosAlbumView.react','React','RelayRootContainer','SpotlightViewer','SpotlightMessagesViewer2','SpotlightMessagesViewerContainerRoute'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return m=(n=j.constructor).call.apply(n,[this].concat(p)),this.state={photoView:this.props.findID,albumView:'',isLoadingImages:false},this.$MessengerThreadSharedPhotos3=function(){this.setState({albumView:this.state.photoView,photoView:''});}.bind(this),this.$MessengerThreadSharedPhotos4=function(){this.setState({albumView:''});}.bind(this),this.$MessengerThreadSharedPhotos5=function(r){this.setState({albumView:'',photoView:r});}.bind(this),this.$MessengerThreadSharedPhotos6=function(){this.setState({photoView:''});}.bind(this),this.$MessengerThreadSharedPhotos7=function(r){this.setState({photoView:r});}.bind(this),m;}l.prototype.componentDidMount=function(){this.props.fetchMorePhotos(this.props.findID);};l.prototype.componentDidUpdate=function(){!this.state.photoView&&!this.state.albumView&&this.props.onCloseSharedPhotos();};l.prototype.render=function(){var m=c('MercuryConfig').SharedPhotoNewView&&this.state.photoView?this.$MessengerThreadSharedPhotos1():null,n=c('MercuryConfig').SharedPhotoNewView&&this.state.albumView?this.$MessengerThreadSharedPhotos2():null;return c('React').createElement('div',null,n,m);};l.prototype.$MessengerThreadSharedPhotos1=function(){var m=this.props.sharedPhotos,n=new (c('SpotlightMessagesViewerContainerRoute'))({photoID:this.state.photoView});return (c('React').createElement(c('RelayRootContainer'),{Component:c('SpotlightMessagesViewer2'),route:n,renderFetched:function(o){return (c('React').createElement(c('SpotlightMessagesViewer2'),babelHelpers['extends']({},o,{disablepaging:m.edges.length===1,fetchMore:this.props.fetchMorePhotos,isLoadingImages:this.props.isLoadingImages,loadImage:this.$MessengerThreadSharedPhotos7,onClosePhotoView:this.$MessengerThreadSharedPhotos6,onCloseSharedPhotos:this.props.onCloseSharedPhotos,open:true,openAlbum:this.$MessengerThreadSharedPhotos3,photoID:this.state.photoView,reverse:false,sharedPhotos:m,snapToPhoto:true,totalCount:this.props.totalCount,thumbsrc:this.props.uri})));}.bind(this)}));};l.prototype.$MessengerThreadSharedPhotos2=function(){return (c('React').createElement(c('SpotlightViewer'),{className:"_3ode",onHide:this.$MessengerThreadSharedPhotos4,open:true,ref:'spotlightViewer'},c('React').createElement(c('MessengerSharedPhotosAlbumView.react'),{allPhotosDisplayed:true,fetchMore:this.props.fetchMoreAlbum,isLoadingImages:this.props.isLoadingImages,onClick:this.$MessengerThreadSharedPhotos5,onCloseSharedPhotos:this.props.onCloseSharedPhotos,sharedPhotos:this.props.sharedPhotos,totalCount:this.props.totalCount,viewedPhoto:this.state.albumView})));};l.propTypes={disablepaging:k.bool,fetchMoreAlbum:k.func,fetchMorePhotos:k.func,findID:k.string,findFBID:k.string,isLoadingImages:k.bool,loadImage:k.func,onCloseSharedPhotos:k.func,openSharedPhotos:k.func,sharedPhotos:k.object,totalCount:k.number,uri:k.string};f.exports=l;}),null);
__d('MessengerThreadSharedPhotosContainer.react',['CurrentEnvironment','MessengerThreadSharedPhotos.react','React','Relay','RelayQL','Vector'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=80,l=60,m=10;h=babelHelpers.inherits(n,c('React').Component);i=h&&h.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return o=(p=i.constructor).call.apply(p,[this].concat(r)),this.state={isLoadingImages:false},this.$MessengerThreadSharedPhotosContainer2=function(t){var u=c('Vector').getViewportDimensions().x,v=this.props.sharedPhotos.message_shared_photo_and_video.edges,w=v.length,x=v.find(function(ba){var ca=ba.node;return ca.id===t;});if(!x)return;var y=v.indexOf(x),z=(w-y)*k;if(z>u/2)return;var aa=Math.ceil((u/2-z)/k);if(!this.state.isLoadingImages)this.$MessengerThreadSharedPhotosContainer4(aa);}.bind(this),this.$MessengerThreadSharedPhotosContainer3=function(t){var u=c('Vector').getViewportDimensions().x,v=this.props.sharedPhotos.message_shared_photo_and_video.edges,w=v.length,x=v.find(function(ba){var ca=ba.node;return ca.id===t;});if(!x)return;var y=v.indexOf(x),z=(w-y)*l;if(z>u)return;var aa=Math.ceil((u-z)/l);if(!this.state.isLoadingImages)this.$MessengerThreadSharedPhotosContainer4(aa);}.bind(this),this.$MessengerThreadSharedPhotosContainer4=function(t){this.setState({isLoadingImages:true},function(){this.props.relay.setVariables({count:this.props.relay.variables.count+t},function(u){if(u.done||u.aborted)this.setState({isLoadingImages:false});}.bind(this));}.bind(this));}.bind(this),o;}n.prototype.componentDidMount=function(){this.$MessengerThreadSharedPhotosContainer1();};n.prototype.componentDidUpdate=function(){this.$MessengerThreadSharedPhotosContainer1();};n.prototype.render=function(){var o=this.props.sharedPhotos.message_shared_photo_and_video.edges,p=o.find(function(r){var s=r.node;return s.legacy_attachment_id==this.props.findID;}.bind(this));if(!p)return null;var q=c('CurrentEnvironment').messengerdotcom?this.$MessengerThreadSharedPhotosContainer2:this.$MessengerThreadSharedPhotosContainer3;return c('React').createElement(c('MessengerThreadSharedPhotos.react'),{disablepaging:this.props.totalCount==1,fullMedia:p.node,fetchMorePhotos:q,fetchMoreAlbum:this.$MessengerThreadSharedPhotosContainer4,findID:p.node.id,findFBID:p.node.legacy_attachment_id,isLoadingImages:this.state.isLoadingImages,loadImage:this.props.loadImage,onCloseSharedPhotos:this.props.onCloseSharedPhotos,openSharedPhotos:this.props.openSharedPhotos,sharedPhotos:this.props.sharedPhotos.message_shared_photo_and_video,totalCount:this.props.totalCount,uri:p.node.image.uri});};n.prototype.$MessengerThreadSharedPhotosContainer1=function(){var o=this.props.sharedPhotos.message_shared_photo_and_video.edges,p=o.find(function(r){var s=r.node;return s.legacy_attachment_id==this.props.findID;}.bind(this)),q=this.props.relay.variables.count;if(q>this.props.totalCount&&!p)this.props.backUpClick(this.props.attachment);if(!p&&!this.state.isLoadingImages&&q<this.props.totalCount)this.$MessengerThreadSharedPhotosContainer4(m);};n.propsTypes={attachment:j.object,backUpClick:j.func.isRequired,findID:j.string,loadImage:j.func.isRequired,onCloseSharedPhotos:j.func.isRequired,openSharedPhotos:j.func.isRequired,relay:j.object,sharedPhotos:j.object,totalCount:j.number};f.exports=c('Relay').createContainer(n,{initialVariables:{count:m},fragments:{sharedPhotos:function o(){return function(){return {children:[{calls:[{kind:'Call',metadata:{},name:'first',value:{kind:'CallVariable',callVariableName:'count'}}],children:[{children:[{children:[{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'},{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'legacy_attachment_id',kind:'Field',metadata:{},type:'ID'},{children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'MessageImage',type:'MessageImage'},{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'legacy_attachment_id',kind:'Field',metadata:{},type:'ID'},{children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'MessageVideo',type:'MessageVideo'},{children:[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{isAbstract:true},name:'IdFragment',type:'Node'}],fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isAbstract:true,isRequisite:true},type:'MessageSharedPhotoAndVideo'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'MessageSharedPhotoAndVideoEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'message_shared_photo_and_video',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true,isFindable:true},type:'MessageSharedPhotoAndVideoConnection'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'MessengerThreadSharedPhotosContainer_react_SharedPhotosRelayQL',type:'MessageThread'};}();}}});}),null);
__d('MercuryAttachmentPhoto.react',['ChatImageArrowDirection','ChatImageWithArrow.react','MessengerThreadSharedPhotosContainer.react','MercuryAttachmentViewer','MercuryConfig','MercuryIDs','MercuryMessageInfo','MessagesViewerSetID','MessengerSharedPhotosContainerRoute','React','RelayRootContainer','URI'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return l=(m=i.constructor).call.apply(m,[this].concat(o)),this.state={newSharedPhotosView:false},this.$MercuryAttachmentPhoto1=function(q){var r=this.props.image,s=true;if(!this.props.hasAttribution&&this.props.count)s=this.props.count===1;var t=this.props.message,u=t.thread_fbid?t.thread_fbid:c('MercuryIDs').getThreadFBIDFromThreadID(t.thread_id),v=new (c('URI'))('/ajax/messaging/attachments/sharedphotos.php').setQueryData({thread_id:u,image_id:r.metadata.fbid}),w=c('MessagesViewerSetID').MESSAGES_VIEW_ALL_IN_THREAD;c('MercuryAttachmentViewer').bootstrapWithConfig({dimensions:r.metadata.dimensions,disablePaging:s,endpoint:v,fbid:r.metadata.fbid,setID:w,src:r.preview_url},null);}.bind(this),this.$MercuryAttachmentPhoto2=function(){var q=this.props.image;if(q&&q.metadata)this.setState({newSharedPhotosView:q.metadata.fbid});}.bind(this),this.$MercuryAttachmentPhoto3=function(){this.setState({newSharedPhotosView:null});}.bind(this),l;}k.prototype.componentDidMount=function(){c('MercuryAttachmentViewer').preload();this.props.onAttachmentLoad&&this.props.onAttachmentLoad(this.props.height);};k.prototype.$MercuryAttachmentPhoto4=function(){var l=this.props.message.thread_fbid,m=new (c('MessengerSharedPhotosContainerRoute'))({threadFBID:l});return (c('React').createElement(c('RelayRootContainer'),{Component:c('MessengerThreadSharedPhotosContainer.react'),route:m,renderFetched:function(n){return (c('React').createElement(c('MessengerThreadSharedPhotosContainer.react'),babelHelpers['extends']({},n,{findID:this.state.newSharedPhotosView,onCloseSharedPhotos:this.$MercuryAttachmentPhoto3,openSharedPhotos:this.$MercuryAttachmentPhoto2,totalCount:this.props.count})));}.bind(this)}));};k.prototype.render=function(){var l=c('MercuryMessageInfo').isInbound(this.props.message),m=c('MercuryConfig').SharedPhotoNewView?this.$MercuryAttachmentPhoto2:this.$MercuryAttachmentPhoto1,n=c('MercuryConfig').SharedPhotoNewView&&this.state.newSharedPhotosView?this.$MercuryAttachmentPhoto4():null;return (c('React').createElement('div',null,n,c('React').createElement(c('ChatImageWithArrow.react'),{arrowDirection:l?c('ChatImageArrowDirection').LEFT:c('ChatImageArrowDirection').RIGHT,source:this.props.image.preview_url,height:this.props.height,width:this.props.width,onClick:m,round:!!this.props.round,isLoading:!!this.props.image.preview_uploading})));};k.propTypes={hasAttribution:j.bool,height:j.number,image:j.object.isRequired,message:j.object.isRequired,onAttachmentLoad:j.func,round:j.bool,width:j.number};f.exports=k;}),null);
__d('MercuryAttachmentPhotoContainer.react',['MercuryAttachmentPhoto.react','MercuryConfig','React','Relay','RelayQL'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=10;h=babelHelpers.inherits(l,c('React').Component);i=h&&h.prototype;l.prototype.render=function(){var m=this.props,n=m.message,o=m.sharedPhotos;if(!n.thread_fbid&&!n.thread_id||!o)return null;var p=c('MercuryConfig').SharedPhotoNewView?o.message_shared_photo_and_video:o.message_images;if((!p.page_info||!p.page_info.has_next_page)&&p.count===0)return (c('React').createElement(c('MercuryAttachmentPhoto.react'),{count:p.count,height:this.props.height,image:this.props.image,message:n,onAttachmentLoad:this.props.onAttachmentLoad,round:this.props.round,width:this.props.width}));return (c('React').createElement(c('MercuryAttachmentPhoto.react'),{count:p.count,height:this.props.height,image:this.props.image,message:n,onAttachmentLoad:this.props.onAttachmentLoad,round:this.props.round,width:this.props.width}));};function l(){h.apply(this,arguments);}l.propTypes={height:j.number,image:j.object.isRequired,message:j.object.isRequired,onAttachmentLoad:j.func,round:j.bool,width:j.number,sharedPhotos:j.object};f.exports=c('Relay').createContainer(l,{initialVariables:{count:k,newViewGK:false},fragments:{sharedPhotos:function m(n){return function(){return {children:[{calls:[{kind:'Call',metadata:{},name:'first',value:{kind:'CallVariable',callVariableName:'count'}}],children:[{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true},type:'PageInfo'},{fieldName:'count',kind:'Field',metadata:{},type:'Int'}],directives:[{kind:'Directive',name:'skip',args:[{name:'if',value:{kind:'CallVariable',callVariableName:'newViewGK'}}]}],fieldName:'message_images',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true,isFindable:true},type:'MessageImagesConnection'},{calls:[{kind:'Call',metadata:{},name:'first',value:{kind:'CallVariable',callVariableName:'count'}}],children:[{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true},type:'PageInfo'},{fieldName:'count',kind:'Field',metadata:{},type:'Int'}],directives:[{kind:'Directive',name:'include',args:[{name:'if',value:{kind:'CallVariable',callVariableName:'newViewGK'}}]}],fieldName:'message_shared_photo_and_video',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true,isFindable:true},type:'MessageSharedPhotoAndVideoConnection'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'MercuryAttachmentPhotoContainer_react_SharedPhotosRelayQL',type:'MessageThread'};}();}}});}),null);
__d('ChatGridImage.react',['cx','Link.react','MercuryConfig','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return m=(n=j.constructor).call.apply(n,[this].concat(p)),this.$ChatGridImage1=function(){c('MercuryConfig').SharedPhotoNewView&&this.props.metadata?this.props.onClick(this.props.metadata.fbid):this.props.onClick();}.bind(this),m;}l.prototype.render=function(){if(this.props.isLoading)return c('React').createElement('div',{className:"_4ypb",style:{width:this.props.size,height:this.props.size}});return c('React').createElement(c('Link.react'),{onClick:this.$ChatGridImage1},c('React').createElement('div',{className:"_332l",style:{backgroundImage:'url('+this.props.source+')',width:this.props.size,height:this.props.size}}));};l.propTypes={isLoading:k.bool,metadata:k.object,onClick:k.func,size:k.number.isRequired,source:k.string};f.exports=l;}),null);
__d('MercuryAttachmentPhotoGrid.react',['cx','ChatGridImage.react','Grid.react','MercuryAttachmentType','MercuryAttachmentViewer','MercuryConfig','MercuryIDs','MessengerSharedPhotosContainerRoute','MessengerThreadSharedPhotosContainer.react','MessagesViewerSetID','React','RelayRootContainer','URI'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('Grid.react').GridItem,l=c('React').PropTypes;i=babelHelpers.inherits(m,c('React').Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return n=(o=j.constructor).call.apply(o,[this].concat(q)),this.state={newSharedPhotosView:null},this.$MercuryAttachmentPhotoGrid1=function(s,t){var u=this.props.count,v=this.props.message,w=v.thread_fbid?v.thread_fbid:c('MercuryIDs').getThreadFBIDFromThreadID(v.thread_id),x=new (c('URI'))('/ajax/messaging/attachments/sharedphotos.php').setQueryData({thread_id:w,image_id:s.metadata&&s.metadata.fbid}),y=c('MessagesViewerSetID').MESSAGES_VIEW_ALL_IN_THREAD;return (function(z){c('MercuryAttachmentViewer').bootstrapWithConfig({dimensions:s.metadata.dimensions,disablePaging:t||u===1,endpoint:x,fbid:s.metadata.fbid,setID:y,src:s.preview_url},null);});}.bind(this),this.$MercuryAttachmentPhotoGrid2=function(s){if(s)this.setState({newSharedPhotosView:s});}.bind(this),this.$MercuryAttachmentPhotoGrid3=function(){this.setState({newSharedPhotosView:null});}.bind(this),n;}m.prototype.componentDidMount=function(){c('MercuryAttachmentViewer').preload();};m.prototype.$MercuryAttachmentPhotoGrid4=function(){var n=this.props.message.thread_fbid,o=new (c('MessengerSharedPhotosContainerRoute'))({threadFBID:n});return (c('React').createElement(c('RelayRootContainer'),{Component:c('MessengerThreadSharedPhotosContainer.react'),route:o,renderFetched:function(p){return (c('React').createElement(c('MessengerThreadSharedPhotosContainer.react'),babelHelpers['extends']({},p,{findID:this.state.newSharedPhotosView,onCloseSharedPhotos:this.$MercuryAttachmentPhotoGrid3,openSharedPhotos:this.$MercuryAttachmentPhotoGrid2,totalCount:this.props.count})));}.bind(this)}));};m.prototype.render=function(){var n=this.props.images,o=n.length,p=o==2||o==4?2:3,q=Math.floor(this.props.size/p),r=[],s=n.some(function(w){return w.attach_type===c('MercuryAttachmentType').ANIMATED_IMAGE;}),t=c('MercuryConfig').SharedPhotoNewView&&this.state.newSharedPhotosView?this.$MercuryAttachmentPhotoGrid4():null;for(var u=0;u<n.length;u++){var v=c('MercuryConfig').SharedPhotoNewView?this.$MercuryAttachmentPhotoGrid2:this.$MercuryAttachmentPhotoGrid1(n[u],s);r.push(c('React').createElement(k,{key:u},c('React').createElement(c('ChatGridImage.react'),{isLoading:!!n[u].preview_uploading,onClick:v,metadata:n[u].metadata,size:q,source:n[u].preview_url})));}return (c('React').createElement('div',null,t,c('React').createElement(c('Grid.react'),{cols:p,className:"_5b2w",spacing:"_5b2x",alignh:'right'},r)));};m.propTypes={images:l.arrayOf(l.object).isRequired,size:l.number.isRequired,message:l.object.isRequired};f.exports=m;}),null);
__d('MercuryAttachmentPhotoGridContainer.react',['MercuryAttachmentPhotoGrid.react','React','Relay','RelayQL'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=10;h=babelHelpers.inherits(l,c('React').Component);i=h&&h.prototype;l.prototype.render=function(){var m=this.props,n=m.message,o=m.sharedPhotos;if(!n.thread_fbid&&!n.thread_id||!o)return null;var p=o.message_images,q=p.count,r=p.page_info;if((!r||!r.has_next_page)&&q===0)return (c('React').createElement(c('MercuryAttachmentPhotoGrid.react'),{images:this.props.images,size:this.props.size,message:n}));return (c('React').createElement(c('MercuryAttachmentPhotoGrid.react'),{images:this.props.images,size:this.props.size,message:n,count:o.message_images.count}));};function l(){h.apply(this,arguments);}l.propTypes={images:j.arrayOf(j.object).isRequired,size:j.number.isRequired,message:j.object.isRequired,sharedPhotos:j.object};f.exports=c('Relay').createContainer(l,{initialVariables:{count:k},fragments:{sharedPhotos:function m(){return function(){return {children:[{calls:[{kind:'Call',metadata:{},name:'first',value:{kind:'CallVariable',callVariableName:'count'}}],children:[{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true},type:'PageInfo'},{fieldName:'count',kind:'Field',metadata:{},type:'Int'}],fieldName:'message_images',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true,isFindable:true},type:'MessageImagesConnection'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'MercuryAttachmentPhotoGridContainer_react_SharedPhotosRelayQL',type:'MessageThread'};}();}}});}),null);
__d('MercuryAttachmentAttribution.react',['cx','Image.react','ImmutableObject','React','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').PureComponent);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return m=(n=j.constructor).call.apply(n,[this].concat(p)),this.$MercuryAttachmentAttribution1=function(){return this.props.attachment&&this.props.attachment.app_attribution;}.bind(this),m;}l.prototype.render=function(){var m=this.$MercuryAttachmentAttribution1();if(!m)return null;return c('React').createElement('div',{className:c('joinClasses')(this.props.className,"_29ew")},c('React').createElement(c('Image.react'),{src:m.icon_url,className:"_29ex"}),c('React').createElement('span',{className:"_29ey"},m.name));};l.propTypes={attachment:k.instanceOf(c('ImmutableObject'))};f.exports=l;}),null);
__d('ChatAttachmentAttribution.react',['cx','ImmutableObject','MercuryAttachmentAttribution.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;l.prototype.render=function(){return (c('React').createElement(c('MercuryAttachmentAttribution.react'),{attachment:this.props.attachment,className:"_1ekr _4i_6"}));};function l(){i.apply(this,arguments);}l.propTypes={attachment:k.instanceOf(c('ImmutableObject'))};f.exports=l;}),null);
__d('ChatSpeakingSticker.react',['React','ReactDOM'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').PureComponent);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return l=(m=i.constructor).call.apply(m,[this].concat(o)),this.$ChatSpeakingSticker1=function(){var q=c('ReactDOM').findDOMNode(this.refs.stickerVideo);q.play();}.bind(this),l;}k.prototype.render=function(){return (c('React').createElement('div',{onClick:this.$ChatSpeakingSticker1},c('React').createElement('video',{height:this.props.videoSize.height,ref:"stickerVideo",width:this.props.videoSize.width},c('React').createElement('source',{src:this.props.videoURI}))));};k.propTypes={videoURI:j.string.isRequired,videoSize:j.shape({height:j.number,width:j.number}).isRequired};f.exports=k;}),null);
__d('MercuryAttachmentVideo.react',['cx','ix','ChatAttachmentAttribution.react','ChatImageArrowDirection','ChatImageWithArrow.react','ChatSpeakingSticker.react','CenteredContainer.react','FBOverlayBase.react','FBOverlayContainer.react','FBOverlayElement.react','Image.react','ImmutableObject','MercuryAttachment','MercuryAttachmentViewer','React','Vector'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(){var n,o;'use strict';for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return n=(o=k.constructor).call.apply(o,[this].concat(q)),this.$MercuryAttachmentVideo1=function(){var s=this.props.duration,t=Math.floor(s/60),u=s%60;if(u<10)return t+':0'+u;return t+':'+u;}.bind(this),this.openViewer=function(){var s=this.props,t=s.pageID,u=s.videoID,v=s.videoSize,w=s.videoURI;v=new (c('Vector'))(v.width,v.height);c('MercuryAttachmentViewer').renderVideo({pageID:t,videoID:u,videoSize:v,videoURI:w});}.bind(this),this.$MercuryAttachmentVideo2=function(){if(this.props.isChat){return (c('React').createElement('div',null,c('React').createElement(c('ChatImageWithArrow.react'),{height:this.props.thumbSize.height,key:'previewImage',round:true,source:this.props.thumbnail,width:this.props.thumbSize.width}),c('React').createElement(c('ChatAttachmentAttribution.react'),{attachment:this.props.attachment,key:'chatAttribution'})));}else return (c('React').createElement(c('Image.react'),{height:this.props.thumbSize.height,width:this.props.thumbSize.width,src:this.props.thumbnail}));}.bind(this),this.$MercuryAttachmentVideo3=function(){if(this.props.isChat)return {};return this.props.thumbSize;}.bind(this),n;}m.prototype.componentDidMount=function(){'use strict';this.props.onAttachmentLoad&&this.props.onAttachmentLoad();c('MercuryAttachmentViewer').preload();};m.prototype.render=function(){'use strict';if(this.props.attachment.metadata&&this.props.attachment.metadata.render_as_sticker&&this.props.isChat)return (c('React').createElement(c('ChatSpeakingSticker.react'),{videoURI:this.props.videoURI,videoSize:this.props.videoSize}));var n=c('MercuryAttachment').hasAttribution(this.props.attachment),o="clearfix"+(' '+"_zow")+(' '+"_59go")+(n?' '+"_4yjw":'')+(this.props.isChat?' '+"_3ds5":''),p=c('React').createElement(c('FBOverlayContainer.react'),{className:o,key:'overlayContainer',onClick:this.openViewer,style:this.$MercuryAttachmentVideo3()},c('React').createElement(c('FBOverlayBase.react'),null,this.$MercuryAttachmentVideo2()),c('React').createElement(c('FBOverlayElement.react'),null,c('React').createElement('div',{className:(!this.props.isChat?"_zox":'')+(n?' '+"_jt3":'')},c('React').createElement('span',{className:"_zoz"},this.$MercuryAttachmentVideo1()))),c('React').createElement(c('FBOverlayElement.react'),null,c('React').createElement(c('CenteredContainer.react'),{className:n?"_jt3":'',vertical:true},c('React').createElement(c('Image.react'),{src:i('/images/chat/chat_play_icon.png')}))));if(this.props.isChat)return p;return (c('React').createElement('div',null,p,c('React').createElement(c('ChatAttachmentAttribution.react'),{attachment:this.props.attachment,key:'inboxAttribution'})));};m.propTypes={attachment:l.instanceOf(c('ImmutableObject')),duration:l.number.isRequired,isChat:l.bool,isInbound:l.bool,name:l.string.isRequired,onAttachmentLoad:l.func,pageID:l.number,thumbSize:l.shape({height:l.number,width:l.number}).isRequired,thumbnail:l.string.isRequired,videoSize:l.shape({height:l.number,width:l.number}).isRequired,videoID:l.string.isRequired,videoURI:l.string.isRequired};f.exports=m;}),null);
__d('PagesMessengerThreadUtils',['invariant','MessagingTag','PageMessageEnumTag'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='CUSTOM_TAG_',j='WITH_FLAG_',k={isFlagThread:function l(m){if(m&&m.page_thread_info&&'flagged' in m.page_thread_info)return m.page_thread_info.flagged;return false;},isPageSpecficEnumFilter:function l(m){if(m===c('PageMessageEnumTag').FLAG||m===c('PageMessageEnumTag').IMPORTANT)return true;return false;},isCustomTagsFilter:function l(m){return m.startsWith(i);},isCustomTagsWithFlagFilter:function l(m){return m.startsWith(i+j);},getCustomTagsFilter:function l(m,n){return i+(n?j:'')+JSON.stringify(m.sort());},parseCustomTagsFilter:function l(m){if(!this.isCustomTagsFilter(m))h(0);var n=this.isCustomTagsWithFlagFilter(m);return JSON.parse(m.substring(i.length+(n?j.length:0)));},getBatchActionMenuParam:function l(m){var n=false,o=false,p=false,q=false,r=false,s=false,t=false,u=false,v=false;if(m.folder===c('MessagingTag').INBOX&&!m.is_archived){n=true;q=true;if(k.isFlagThread(m)){t=true;}else s=true;if(m&&m.unread_count===0){v=true;}else u=true;}else if(m.folder===c('MessagingTag').SPAM){r=true;}else if(m.is_archived){o=true;p=true;}if(m&&m.unread_count===0){v=true;}else u=true;return {showArchive:n,showDelete:o,showUnarchive:p,showSpam:q,showUnspam:r,showFlag:s,showUnflag:t,showMarkRead:u,showMarkUnread:v,showHideContextCard:false,showShowContextCard:false};}};f.exports=k;}),null);
/*
 * @preserve-header
 *
 * Javascript EXIF Reader 0.1.6
 * Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk, http://blog.nihilogic.dk/
 * Licensed under the MPL License [http://www.nihilogic.dk/licenses/mpl-license.txt]
 */__d("exif/exif",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();var h=(function(){var i={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},j={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},k={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},l={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function m(y,event,z){if(y.addEventListener){y.addEventListener(event,z,false);}else if(y.attachEvent)y.attachEvent("on"+event,z);}function n(y){return !!(y.exifdata);}function o(y,z){BinaryAjax(y.src,function(aa){var ba=p(aa.binaryResponse);y.exifdata=ba||{};if(z)z.call(y);});}function p(y){if(y.getByteAt(0)!=255||y.getByteAt(1)!=216)return false;var z=2,aa=y.getLength(),ba;while(z<aa){if(y.getByteAt(z)!=255)return false;ba=y.getByteAt(z+1);if(ba==22400){return s(y,z+4,y.getShortAt(z+2,true)-2);}else if(ba==225){return s(y,z+4,y.getShortAt(z+2,true)-2);}else z+=2+y.getShortAt(z+2,true);}}function q(y,z,aa,ba,ca){var da=y.getShortAt(aa,ca),ea={},fa,ga,ha;for(ha=0;ha<da;ha++){fa=aa+ha*12+2;ga=ba[y.getShortAt(fa,ca)];ea[ga]=r(y,fa,z,aa,ca);}return ea;}function r(y,z,aa,ba,ca){var da=y.getShortAt(z+2,ca),ea=y.getLongAt(z+4,ca),fa=y.getLongAt(z+8,ca)+aa,ga,ha,ia,ja,ka,la;switch(da){case 1:case 7:if(ea==1){return y.getByteAt(z+8,ca);}else{ga=ea>4?fa:(z+8);ha=[];for(ja=0;ja<ea;ja++)ha[ja]=y.getByteAt(ga+ja);return ha;}case 2:ga=ea>4?fa:(z+8);return y.getStringAt(ga,ea-1);case 3:if(ea==1){return y.getShortAt(z+8,ca);}else{ga=ea>2?fa:(z+8);ha=[];for(ja=0;ja<ea;ja++)ha[ja]=y.getShortAt(ga+2*ja,ca);return ha;}case 4:if(ea==1){return y.getLongAt(z+8,ca);}else{ha=[];for(var ja=0;ja<ea;ja++)ha[ja]=y.getLongAt(fa+4*ja,ca);return ha;}case 5:if(ea==1){ka=y.getLongAt(fa,ca);la=y.getLongAt(fa+4,ca);ia=new Number(ka/la);ia.numerator=ka;ia.denominator=la;return ia;}else{ha=[];for(ja=0;ja<ea;ja++){ka=y.getLongAt(fa+8*ja,ca);la=y.getLongAt(fa+4+8*ja,ca);ha[ja]=new Number(ka/la);ha[ja].numerator=ka;ha[ja].denominator=la;}return ha;}case 9:if(ea==1){return y.getSLongAt(z+8,ca);}else{ha=[];for(ja=0;ja<ea;ja++)ha[ja]=y.getSLongAt(fa+4*ja,ca);return ha;}case 10:if(ea==1){return y.getSLongAt(fa,ca)/y.getSLongAt(fa+4,ca);}else{ha=[];for(ja=0;ja<ea;ja++)ha[ja]=y.getSLongAt(fa+8*ja,ca)/y.getSLongAt(fa+4+8*ja,ca);return ha;}}}function s(y,z){if(y.getStringAt(z,4)!="Exif")return false;var aa,ba,ca,da,ea,fa=z+6;if(y.getShortAt(fa)==18761){aa=false;}else if(y.getShortAt(fa)==19789){aa=true;}else return false;if(y.getShortAt(fa+2,aa)!=42)return false;if(y.getLongAt(fa+4,aa)!=8)return false;ba=q(y,fa,fa+8,j,aa);if(ba.ExifIFDPointer){da=q(y,fa,fa+ba.ExifIFDPointer,i,aa);for(ca in da){switch(ca){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":da[ca]=l[ca][da[ca]];break;case "ExifVersion":case "FlashpixVersion":da[ca]=String.fromCharCode(da[ca][0],da[ca][1],da[ca][2],da[ca][3]);break;case "ComponentsConfiguration":da[ca]=l.Components[da[ca][0]]+l.Components[da[ca][1]]+l.Components[da[ca][2]]+l.Components[da[ca][3]];break;}ba[ca]=da[ca];}}if(ba.GPSInfoIFDPointer){ea=q(y,fa,fa+ba.GPSInfoIFDPointer,k,aa);for(ca in ea){switch(ca){case "GPSVersionID":ea[ca]=ea[ca][0]+"."+ea[ca][1]+"."+ea[ca][2]+"."+ea[ca][3];break;}ba[ca]=ea[ca];}}return ba;}function t(y,z){if(!y.complete)return false;if(!n(y)){o(y,z);}else if(z)z.call(y);return true;}function u(y,z){if(!n(y))return;return y.exifdata[z];}function v(y){if(!n(y))return {};var z,aa=y.exifdata,ba={};for(z in aa)if(aa.hasOwnProperty(z))ba[z]=aa[z];return ba;}function w(y){if(!n(y))return "";var z,aa=y.exifdata,ba="";for(z in aa)if(aa.hasOwnProperty(z))if(typeof aa[z]=="object"){if(aa[z] instanceof Number){ba+=z+" : "+aa[z]+" ["+aa[z].numerator+"/"+aa[z].denominator+"]\r\n";}else ba+=z+" : ["+aa[z].length+" values]\r\n";}else ba+=z+" : "+aa[z]+"\r\n";return ba;}function x(y){return p(y);}return {readFromBinaryFile:x,pretty:w,getTag:u,getAllTags:v,getData:t,Tags:i,TiffTags:j,GPSTags:k,StringValues:l};})();f.exports=h;}),null);
__d('ImageExif',['exif/exif'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(k){this.getByteAt=function(l){return k.getUint8(l);};this.getShortAt=function(l,m){return k.getUint16(l,!m);};this.getSShortAt=function(l,m){return k.getInt16(l,!m);};this.getLongAt=function(l,m){return k.getUint32(l,!m);};this.getSLongAt=function(l,m){return k.getInt32(l,!m);};this.getStringAt=function(l,m){var n=Array(m);for(var o=0;o<m;o++)n.push(String.fromCharCode(this.getByteAt(l+o)));return n.join('');};this.getLength=function(){return k.byteLength;};}function i(k){var l=function m(n){return k.charCodeAt(n)&255;};this.getByteAt=l;this.getShortAt=function(m,n){var o=this.getSShortAt(m,n);return o>0?o:o+65536;};this.getSShortAt=function(m,n){var o=l(m),p=l(m+1);return n?(o<<8)+p:(p<<8)+o;};this.getLongAt=function(m,n){var o=this.getSLongAt(m,n);return o>0?o:o+4294967296;};this.getSLongAt=function(m,n){var o=l(m),p=l(m+1),q=l(m+2),r=l(m+3);return n?(((o<<8)+p<<8)+q<<8)+r:(((r<<8)+q<<8)+p<<8)+o;};this.getStringAt=function(m,n){return k.substr(m,n);};this.getLength=function(){return k.length;};}var j={readFromFile:function k(l,m){var n=new FileReader();n.addEventListener('load',function(event){var o=event.target.result,p=o instanceof ArrayBuffer?this.readFromArrayBuffer(o):this.readFromBinaryString(o);m(p);}.bind(this),false);if(window.DataView){n.readAsArrayBuffer(l);}else n.readAsBinaryString(l);},readFromBinaryString:function k(l){return c('exif/exif').readFromBinaryFile(new i(l));},readFromArrayBuffer:function k(l){return c('exif/exif').readFromBinaryFile(new h(new DataView(l)));}};f.exports=j;}),null);
__d('StringEncoding',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(o,p){var q=new Uint8Array(o),r=0,s=[];while(r<q.length){var t=q[r],u=void 0;if(t>>7===0){u=1;}else if(t>>5===6){t&=31;u=2;}else if(t>>4===14){t&=15;u=3;}else if(t>>3===30){t&=7;u=4;}else if(t>>2===62){t&=3;u=5;}else if(t>>1===126){t&=1;u=6;}else throw new Error('Cannot decode as UTF-8 - '+'unrecognised codepoint header');if(r+u>q.length)throw new Error('Cannot decode as UTF-8 - '+'incomplete codepoint');for(var v=1;v<u;v++){var w=q[r+v];if(w>>6!==2)throw new Error('Cannot decode as UTF-8 - '+'unrecognised codepoint subsequent byte');w&=63;t<<=6;t|=w;}if(t>1114111)throw new Error('Cannot decode as UTF-8 - '+"JavaScript doesn't support codepoints over 0x10FFFF");if(!t)switch(p){case 'error':throw new Error('Cannot decode as UTF-8 - '+"contains a null and we're not allowing them");case 'ignore':continue;case 'truncate':return String.fromCodePoint.apply(String,s);case 'include':break;}s.push(t);r+=u;}return String.fromCodePoint.apply(String,s);}function i(o){return (o&255)<<8|o>>8;}function j(o,p){if(o.byteLength%2!==0)throw new Error('Cannot decode as UTF-16 - '+'data length mod 2 != 0');var q=new Uint16Array(o),r=0,s=[],t=false;if(q[0]===65279){++r;}else if(q[0]==65534){++r;t=true;}while(r<q.length){var u=q[r];if(t)u=i(u);var v=u;if(u>55295&&u<57344){if((u&64512)!==55296)throw new Error('Cannot decode as UTF-16 - '+'incorrect signature for high surrogate');if(r+1>=q.length)throw new Error('Cannot decode as UTF-16 - '+'incomplete codepoint');++r;var w=q[r];if(t)w=i(w);if((w&64512)!==56320)throw new Error('Cannot decode as UTF-16 - '+'incorrect signature for low surrogate');v=((u&1023)<<10|w&1023)+65536;}if(!v)switch(p){case 'error':throw new Error('Cannot decode as UTF-16 - '+"contains a null and we're not allowing them");case 'ignore':continue;case 'truncate':return String.fromCodePoint.apply(String,s);case 'include':break;}s.push(v);++r;}return String.fromCodePoint.apply(String,s);}function k(o){return ((o&255)<<24|(o&255<<8)<<8|(o&255<<16)>>8|o>>>24);}function l(o,p){if(o.byteLength%4!==0)throw new Error('Cannot decode as UTF-32 - '+'data length mod 4 != 0');var q=new Uint32Array(o),r=0,s=[],t=false;if(q[0]===65279){++r;}else if(q[0]==4294836224){++r;t=true;}while(r<q.length){var u=q[r];if(t)u=k(u);if(u&2147483648)throw new Error('Cannot decode as UTF-32 - '+'invalid codepoint');if(u>1114111)throw new Error('Cannot decode as UTF-32 - '+"JavaScript doesn't support codepoints over 0x10FFFF");if(!u)switch(p){case 'error':throw new Error('Cannot decode as UTF-32 - '+"contains a null and we're not allowing them");case 'ignore':continue;case 'truncate':return String.fromCodePoint.apply(String,s);case 'include':break;}s.push(u);++r;}return String.fromCodePoint.apply(String,s);}var m={'utf-8':h,'utf-16':j,'utf-32':l};function n(o,p){if(o){this.$Decoder1=o;}else this.$Decoder1=['utf-8','utf-16','utf-32'];if(!p)p='error';this.$Decoder2=p;for(var q=this.$Decoder1,r=Array.isArray(q),s=0,q=r?q:q[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var t;if(r){if(s>=q.length)break;t=q[s++];}else{s=q.next();if(s.done)break;t=s.value;}var u=t;this.$Decoder3(u);}}n.prototype.getPrecedence=function(){return this.$Decoder1;};n.prototype.decode=function(o){var p=[];for(var q=this.$Decoder1,r=Array.isArray(q),s=0,q=r?q:q[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var t;if(r){if(s>=q.length)break;t=q[s++];}else{s=q.next();if(s.done)break;t=s.value;}var u=t,v=this.$Decoder3(u);try{return v(o,this.$Decoder2);}catch(w){p.push(w);}}throw new Error(p.join(', '));};n.prototype.$Decoder3=function(o){var p=m[o];if(!p)throw new Error('Unknown encoding '+o);return p;};f.exports.Decoder=n;}),null);
__d('ImageMetadata',['regeneratorRuntime','Promise','StringEncoding','ImageExif'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(m){this.$ImageMetadata4=m;this.$ImageMetadata5=new Uint8Array(m);this.$ImageMetadata6();}h.prototype.$ImageMetadata6=function(){var m=0;while(m<this.$ImageMetadata5.length){m=this.$ImageMetadata7(m);if(m===-1)return;var n=this.$ImageMetadata5[m+1],o=i[n];if(!o)return;var p=o.length;if(p===undefined)p=this.$ImageMetadata5[m+2]*256+this.$ImageMetadata5[m+3];this.$ImageMetadata8(m,p,o);if(o.name==='SOS')return;m+=2+p;}};h.prototype.$ImageMetadata8=function(m,n,o){switch(o.name){case 'APP1':if(this.$ImageMetadata9(m+4,j)){this.$ImageMetadata10(m+4+j.length,n-2-j.length);}else if(this.$ImageMetadata9(m+4,k)){this.$ImageMetadata11(m+4+k.length,n-2-k.length);}else if(this.$ImageMetadata9(m+4,l))this.$ImageMetadata12(m+4+l.length,n-2-l.length);break;case 'SOF0':case 'SOF1':case 'SOF2':case 'SOF3':case 'SOF5':case 'SOF6':case 'SOF7':case 'JPG':case 'SOF9':case 'SOF10':case 'SOF11':case 'SOF13':case 'SOF14':case 'SOF15':this.$ImageMetadata13(m+4,n-2);break;}};h.prototype.$ImageMetadata13=function(m,n){var o=this.$ImageMetadata5[m+3]*256+this.$ImageMetadata5[m+4],p=this.$ImageMetadata5[m+1]*256+this.$ImageMetadata5[m+2];if(o>0&&p>0)this.$ImageMetadata3={x:o,y:p};};h.prototype.$ImageMetadata10=function(m,n){var o=emptyFunction;try{emptyFunction=function(){};var p=c('ImageExif').readFromArrayBuffer(this.$ImageMetadata4)||{};}finally{emptyFunction=o;}var q={};for(var r in p){var s=p[r];if(typeof s==='string')s=s.trim();q[r.trim()]=s;}this.$ImageMetadata1=q;};h.prototype.$ImageMetadata11=function(m,n){this.$ImageMetadata2={};var o=this.$ImageMetadata2,p=new (c('StringEncoding').Decoder)(null,'truncate');try{var r=p.decode(this.$ImageMetadata4.slice(m,m+n));}catch(q){return;}for(var s=0;s<r.length;++s){var t=r.indexOf('<GPano:',s);if(t==-1)break;var u=r.indexOf('>',t),v=r.substring(t+1,u).trim(),w=r.indexOf('<',u),x=r.substring(u+1,w).trim();o[v]=x;s=w;}for(var y=0;y<r.length;++y){var z=r.indexOf('GPano:',y);if(z==-1)break;var aa=r.indexOf('=',z),ba=r.substring(z,aa).trim(),ca=r.indexOf('"',z);if(ba.indexOf('>')==-1&&ba.indexOf('<')==-1){var da=r.indexOf('"',ca+1),ea=r.substring(ca+1,da).trim();o[ba]=ea;y=da;}}};h.prototype.$ImageMetadata12=function(m){};h.prototype.$ImageMetadata9=function(m,n){return n.split('').every(function(o){return this.$ImageMetadata5[m++]===o.charCodeAt(0);}.bind(this));};h.prototype.$ImageMetadata7=function(m){for(var n=m;n+1<this.$ImageMetadata5.length;++n)if(this.$ImageMetadata5[n]===255&&this.$ImageMetadata5[n+1]!==0&&this.$ImageMetadata5[n+1]!==255)return n;return -1;};h.prototype.hasExif=function(){return Boolean(this.$ImageMetadata1);};h.prototype.hasXMP=function(){return Boolean(this.$ImageMetadata2);};h.prototype.hasSize=function(){return Boolean(this.$ImageMetadata3);};h.prototype.getExif=function(){if(!this.$ImageMetadata1)throw new Error('Image has no Exif data');return this.$ImageMetadata1;};h.prototype.getXMP=function(){if(!this.$ImageMetadata2)throw new Error('Image has no XMP data');return this.$ImageMetadata2;};h.prototype.getSize=function(){if(!this.$ImageMetadata3)throw new Error('Could not find size data?!');return this.$ImageMetadata3;};h.genMetadataFromBlob=function m(n){return c('regeneratorRuntime').async(function o(p){while(1)switch(p.prev=p.next){case 0:p.t0=h;p.next=3;return c('regeneratorRuntime').awrap(h.$ImageMetadata14(n));case 3:p.t1=p.sent;return p.abrupt('return',new p.t0(p.t1));case 5:case 'end':return p.stop();}},null,this);};h.$ImageMetadata14=function(m){return new (c('Promise'))(function(n,o){var p=new b.FileReader();p.onabort=o;p.onerror=o;p.onload=n;p.readAsArrayBuffer(m);});};var i=[];i[216]={name:'SOI',length:0};i[192]={name:'SOF0'};i[193]={name:'SOF1'};i[194]={name:'SOF2'};i[195]={name:'SOF3'};i[197]={name:'SOF5'};i[198]={name:'SOF6'};i[199]={name:'SOF7'};i[200]={name:'JPG'};i[201]={name:'SOF9'};i[202]={name:'SOF10'};i[203]={name:'SOF11'};i[205]={name:'SOF13'};i[206]={name:'SOF14'};i[207]={name:'SOF15'};i[196]={name:'DHT'};i[219]={name:'DQT'};i[221]={name:'DRI',length:2};i[218]={name:'SOS'};i[208]={name:'RST0',length:0};i[209]={name:'RST1',length:0};i[210]={name:'RST2',length:0};i[211]={name:'RST3',length:0};i[212]={name:'RST4',length:0};i[213]={name:'RST5',length:0};i[214]={name:'RST6',length:0};i[215]={name:'RST7',length:0};i[224]={name:'APP0'};i[225]={name:'APP1'};i[226]={name:'APP2'};i[227]={name:'APP3'};i[228]={name:'APP4'};i[229]={name:'APP5'};i[230]={name:'APP6'};i[231]={name:'APP7'};i[232]={name:'APP8'};i[233]={name:'APP9'};i[234]={name:'APP10'};i[235]={name:'APP11'};i[236]={name:'APP12'};i[237]={name:'APP13'};i[238]={name:'APP14'};i[239]={name:'APP15'};i[254]={name:'COM'};i[217]={name:'EOI',length:0};var j='Exif\0\0',k='http://ns.adobe.com/xap/1.0/\0',l='http://ns.adobe.com/xmp/extension/\0';f.exports=h;}),null);
__d('SphericalImage',['Promise','regeneratorRuntime','ImageMetadata'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=100;function i(u){return new (c('Promise'))(function(v,w){var x=new b.FileReader();x.onabort=w;x.onerror=w;x.onload=function(event){return v(event.target.result);};x.readAsArrayBuffer(u);});}function j(u){if(!u.hasXMP())return false;var v=u.getXMP(),w=Boolean(v['GPano:CroppedAreaImageWidthPixels']&&v['GPano:CroppedAreaImageHeightPixels']&&v['GPano:FullPanoWidthPixels']&&v['GPano:FullPanoHeightPixels']);if(w)return true;var x=u.getSize(),y=Math.abs(x.x-x.y*2)<=2;return Boolean(v['GPano:ProjectionType']==='equirectangular'&&y);}var k={'iPhone 4S':{x:19334,y:3264},'iPhone 5':{x:18521,y:3264},'iPhone 5c':{x:18521,y:3264},'iPhone 5s':{x:17279,y:3264},'iPhone 6':{x:17731,y:3264},'iPhone 6 Plus':{x:17731,y:3264},'iPhone 6s':{x:21729,y:4000},'iPhone 6s Plus':{x:21729,y:4000},'iPhone SE':{x:21729,y:4000},'iPad Air':{x:14810,y:2592},'iPad Air 2':{x:18512,y:3264},'iPad Mini 2':{x:14810,y:2592},'iPad Mini 3':{x:14810,y:2592},'iPad Mini 4':{x:18512,y:3264},'iPad Pro':{x:18512,y:3264}},l={'sm-g90':{minHeight:2200,fullWidth:17000},'sm-n91':{minHeight:2200,fullWidth:17000},'sm-g92':{minHeight:2200,fullWidth:15550},'sm-n92':{minHeight:2200,fullWidth:15550},'sm-g93':{minHeight:2800,fullWidth:20200}};function m(u){if(!u.hasExif())return false;return (o(u)||n(u)||p(u));}function n(u){var v=u.getExif(),w=u.getSize();return (v.Make==='RICOH'&&v.Model==='RICOH THETA S'&&w.x===2*w.y);}function o(u){var v=u.getExif();if(v.Make!='Apple')return false;var w=k[v.Model];if(!w)return false;var x=void 0,y=void 0;if(v.ExifImageWidth&&v.ExifImageLength)if(!y||v.ExifImageWidth>y.x)y={x:v.ExifImageWidth,y:v.ExifImageLength};if(v.ImageWidth&&v.ImageLength)if(!y||v.ImageWidth>y.x)y={x:v.ImageWidth,y:v.ImageLength};if(v.OriginalImageWidth&&v.OriginalImageHeight)if(!y||v.OriginalImageWidth>y.x)y={x:v.OriginalImageWidth,y:v.OriginalImageHeight};if(v.PixelXDimension&&v.PixelYDimension)if(!y||v.PixelXDimension>y.x)y={x:v.PixelXDimension,y:v.PixelYDimension};if(u.hasSize()){x=u.getSize();var z=q(x);if(y){var aa=q(y);if(!r(z,aa))return false;}if(z<2)return false;}var ba=y||x;if(!ba)return false;if(!r(ba.y,w.y,.3))return false;return true;}function p(u){var v=u.getExif(),w=u.getSize(),x=w.x,y=w.y;if(String(v.Make).toLowerCase()!='samsung')return false;var z=String(v.Model).toLowerCase().trim(),aa=null;Object.keys(l).forEach(function(da){if(z.startsWith(da))aa=l[da];});if(!aa)return false;if(v.Orientation===6){var ba=x;x=y;y=ba;}if(y<aa.minHeight)return false;var ca=x/aa.fullWidth*360;if(ca<h||x<2*y)return false;return true;}function q(u){return u.x/u.y;}function r(u,v){var w=arguments.length<=2||arguments[2]===undefined?.05:arguments[2];return u>(1-w)*v&&u<(1+w)*v;}function s(u){return (j(u)||m(u));}function t(u){var v,w;return c('regeneratorRuntime').async(function x(y){while(1)switch(y.prev=y.next){case 0:y.next=2;return c('regeneratorRuntime').awrap(i(u));case 2:v=y.sent;w=new (c('ImageMetadata'))(v);return y.abrupt('return',s(w));case 5:case 'end':return y.stop();}},null,this);}f.exports={isSphericalBlob:t,isSphericalMetadata:s};}),null);
__d('XComposerPhotoUploader',['regeneratorRuntime','Promise','AsyncUploadRequest','ReactComposerMediaUtils','FileInputUploader','JSLogger','PhotosMimeType','PhotosUploadID','SphericalPhotoConfig','SphericalImage','curry','emptyFunction','performanceNow'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=b.URL||b.webkitURL||{};function i(j){this.$XComposerPhotoUploader2=j.uploadData||{};this.$XComposerPhotoUploader1=j.uploadEndpoint;this.$XComposerPhotoUploader3=j.retryLimit;this.$XComposerPhotoUploader4=j.concurrentLimit;this.$XComposerPhotoUploader5=j.resizer;this.$XComposerPhotoUploader6=j.onUploadEnqueued||c('emptyFunction');this.$XComposerPhotoUploader7=j.onUploadsEnqueued||c('emptyFunction');this.$XComposerPhotoUploader8=j.onResizeStart||c('emptyFunction');this.$XComposerPhotoUploader11=j.onResizeProgress||c('emptyFunction');this.$XComposerPhotoUploader9=j.onResizeSuccess||c('emptyFunction');this.$XComposerPhotoUploader10=j.onResizeFailure||c('emptyFunction');this.$XComposerPhotoUploader12=j.onUploadIsSpherical||c('emptyFunction');this.$XComposerPhotoUploader13=j.onUploadSent||c('emptyFunction');this.$XComposerPhotoUploader14=j.onUploadStart||c('emptyFunction');this.$XComposerPhotoUploader15=j.onUploadProgress||c('emptyFunction');this.$XComposerPhotoUploader16=j.onUploadSuccess||c('emptyFunction');this.$XComposerPhotoUploader17=j.onUploadFailure||c('emptyFunction');this.$XComposerPhotoUploader18=c('JSLogger').create('composer');}i.prototype.upload=function(j,k){k=k||0;var l=Object.assign({},this.$XComposerPhotoUploader2),m=null;if(!this.$XComposerPhotoUploader19(j)){var n=c('PhotosUploadID').getNewID();j.uploadID=n;l.upload_id=n;this.$XComposerPhotoUploader6({uploadID:n,fileName:j.value.split('/').pop().split('\\').pop(),fileURL:h.createObjectURL?h.createObjectURL(j):null});}else{m=Array.from(j.files);m=m.filter(function(r){return !c('ReactComposerMediaUtils').hasVideos([r.name]);});if(m.length===0)return;var o=m.length+k;m.forEach(function(r){if(!r.uploadID)r.uploadID=c('PhotosUploadID').getNewID();var s=false;if(c('SphericalPhotoConfig').spherical_photo_www_upload)s=null;this.$XComposerPhotoUploader6({uploadID:r.uploadID,fileName:r.name,isSpherical:s,fileURL:h.createObjectURL?h.createObjectURL(r):null});}.bind(this));if(!c('SphericalPhotoConfig').spherical_photo_www_upload||!c('SphericalPhotoConfig').www_spherical_photo_mmp&&o>1)l.allow_spherical_photo=false;}this.$XComposerPhotoUploader7();var p=new (c('FileInputUploader'))(j).setURI(this.$XComposerPhotoUploader1).setData(l).setAllowCrossOrigin(true).setNetworkErrorRetryLimit(this.$XComposerPhotoUploader3).setUploadInParallel(true);if(m&&m.length>0){p.setFiles({farr:m});if(this.$XComposerPhotoUploader5){p.setPreprocessHandler(this.$XComposerPhotoUploader20.bind(this));}else p.setPreprocessHandler(this.$XComposerPhotoUploader21.bind(this));if(this.$XComposerPhotoUploader4)p.setConcurrentLimit(this.$XComposerPhotoUploader4);}p.subscribe('progress',function(r,s){return (this.$XComposerPhotoUploader15(this.$XComposerPhotoUploader22(s,j),s));}.bind(this));p.subscribe('failure',function(r,s){return (this.$XComposerPhotoUploader17(this.$XComposerPhotoUploader22(s,j),s,m));}.bind(this));p.subscribe('start',function(r,s){return (this.$XComposerPhotoUploader14(this.$XComposerPhotoUploader22(s,j),s));}.bind(this));p.subscribe('success',function(r,s){return (this.$XComposerPhotoUploader16(this.$XComposerPhotoUploader22(s,j),s));}.bind(this));try{p.send();this.$XComposerPhotoUploader13(j);}catch(q){this.$XComposerPhotoUploader18.error('error_send_unpublished_files',q);throw q;}};i.prototype.getAsyncUploadRequest=function(j,k){var l=new (c('AsyncUploadRequest'))().setData(Object.assign({},k&&k.data,this.$XComposerPhotoUploader2)).setFiles({farr:j}).setAllowCrossOrigin(true).setURI(this.$XComposerPhotoUploader1);if(this.$XComposerPhotoUploader4)l.setLimit(this.$XComposerPhotoUploader4);if(this.$XComposerPhotoUploader5)l.setPreprocessHandler(this.$XComposerPhotoUploader20.bind(this));l.subscribe('start',function(m,n){return (this.$XComposerPhotoUploader14(n.getFile().uploadID,{upload:n}));}.bind(this));l.subscribe('progress',function(m,n){return (this.$XComposerPhotoUploader15(n.getFile().uploadID,{upload:n,event:n.getProgressEvent()}));}.bind(this));l.subscribe('success',function(m,n){return (this.$XComposerPhotoUploader16(n.getFile().uploadID,{upload:n,response:n.getResponse()}));}.bind(this));l.subscribe('failure',function(m,n){return (this.$XComposerPhotoUploader17(n.getFile().uploadID,{upload:n,response:n.getResponse()},j));}.bind(this));return l;};i.prototype.$XComposerPhotoUploader22=function(j,k){if(j.upload){return j.upload.getFile().uploadID;}else return k.uploadID;};i.prototype.$XComposerPhotoUploader21=function(j,k){(function l(){return c('regeneratorRuntime').async(function m(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return c('regeneratorRuntime').awrap(this.$XComposerPhotoUploader23(j,k));case 2:return n.abrupt('return',n.sent);case 3:case 'end':return n.stop();}},null,this);}).bind(this)().done();};i.prototype.$XComposerPhotoUploader23=function j(k,l){var m,n;return c('regeneratorRuntime').async(function o(p){while(1)switch(p.prev=p.next){case 0:m=k.getFile();p.next=3;return c('regeneratorRuntime').awrap(this.$XComposerPhotoUploader24(m));case 3:n=p.sent;this.$XComposerPhotoUploader12(m,n);l(k);case 6:case 'end':return p.stop();}},null,this);};i.prototype.$XComposerPhotoUploader20=function(j,k){(function l(){return c('regeneratorRuntime').async(function m(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return c('regeneratorRuntime').awrap(this.$XComposerPhotoUploader25(j,k));case 2:return n.abrupt('return',n.sent);case 3:case 'end':return n.stop();}},null,this);}).bind(this)().done();};i.prototype.$XComposerPhotoUploader24=function j(k){return c('regeneratorRuntime').async(function l(m){while(1)switch(m.prev=m.next){case 0:m.next=2;return c('regeneratorRuntime').awrap(c('SphericalImage').isSphericalBlob(k));case 2:return m.abrupt('return',m.sent);case 3:case 'end':return m.stop();}},null,this);};i.prototype.$XComposerPhotoUploader26=function(j){return this.$XComposerPhotoUploader27(this.$XComposerPhotoUploader5.resizeBlob.bind(this.$XComposerPhotoUploader5),j);};i.prototype.$XComposerPhotoUploader28=function(j){return this.$XComposerPhotoUploader27(this.$XComposerPhotoUploader5.resize360Blob.bind(this.$XComposerPhotoUploader5),j);};i.prototype.$XComposerPhotoUploader27=function(j,k){var l=c('curry')(this.$XComposerPhotoUploader11,k.uploadID),m=function(){return this.$XComposerPhotoUploader8(k);}.bind(this);return new (c('Promise'))(function(n,o){m();j(k,function(p,q,r){if(p){o(p);}else if(r){n(null);}else n(q);},l);});};i.prototype.$XComposerPhotoUploader25=function j(k,l){var m,n,o,p,q,r;return c('regeneratorRuntime').async(function s(t){while(1)switch(t.prev=t.next){case 0:m=k.getFile();if(!(!m||!c('PhotosMimeType').isJpeg(m.type))){t.next=5;break;}this.$XComposerPhotoUploader12(m,false);l(k);return t.abrupt('return');case 5:n=c('performanceNow')();t.prev=6;o=false;if(!c('SphericalPhotoConfig').spherical_photo_www_upload){t.next=12;break;}t.next=11;return c('regeneratorRuntime').awrap(this.$XComposerPhotoUploader24(m));case 11:o=t.sent;case 12:if(!o){t.next=19;break;}this.$XComposerPhotoUploader12(m,true);t.next=16;return c('regeneratorRuntime').awrap(this.$XComposerPhotoUploader28(m));case 16:p=t.sent;t.next=23;break;case 19:this.$XComposerPhotoUploader12(m,false);t.next=22;return c('regeneratorRuntime').awrap(this.$XComposerPhotoUploader26(m));case 22:p=t.sent;case 23:if(p){p.uploadID=m.uploadID;p.name=m.name;k.setFile(p);}q=p===null;k.getFile().filename=m.name;this.$XComposerPhotoUploader9(m,p||m,q,c('performanceNow')()-n);t.next=34;break;case 29:t.prev=29;t.t0=t['catch'](6);r=c('performanceNow')()-n;this.$XComposerPhotoUploader10(m,p||m,t.t0,r);case 34:l(k);case 35:case 'end':return t.stop();}},null,this,[[6,29]]);};i.prototype.$XComposerPhotoUploader19=function(j){return !!j.files&&c('AsyncUploadRequest').isSupported();};f.exports=i;}),null);
__d('updatePhotoProgressBar',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,event){if(event.carousel_uploading){if(event.skip_upload){i.setPosition(50);i.setTarget(100,1000);}else{var j=event.loaded/event.total*100;i.setPosition(j);}}else if(event.loaded!=event.total){i.setPosition(50*event.loaded/event.total);}else{i.setPosition(50);i.setTarget(100,2000);}}f.exports=h;}),null);
__d('PhotosMultiUploadInput',['csx','cx','fbt','Animation','Arbiter','AsyncUploadRequest','Bootloader','ComposerWaterfallEvent','ComposerXController','ComposerXDragDropUtils','ComposerXMarauderLogger','ComposerXMediaUploadHandler','CSS','Dialog','DOM','DragDropTarget','Event','JpegResizer','OptimisticVideoPostUtils','Parent','PhotosMimeType','PhotosUploadID','PhotosUploadWaterfallXMixin','ProgressBar','PUWApplications','PUWMethods','PUWSteps','ReactComposerMediaUtils','Tooltip','VideoUploadFile','WaterfallIDGenerator','XComposerPhotoUploader','$','mixin','performanceNow','updatePhotoProgressBar','Fbtrace'],(function a(b,c,d,e,f,g,h,i,j){var k,l;if(c.__markCompiled)c.__markCompiled();var m=1366052;c("Fbtrace");function n(t,u,v,w){'use strict';this._grid=q.getInstance(w.gridID);this._grid.setProgressBarMarkup(t).setVideoIconMarkup(u).setConfig(w);v.getInput().multiple=w.maxselect!=1&&c('AsyncUploadRequest').isSupported();v.subscribe('change',function(x,event){if(event.getTarget().value)this._grid.doFileUpload(v);}.bind(this));if(!this._grid.sessionStarted){this._grid.sessionStarted=true;this._grid.logStep(c('PUWSteps').CLIENT_FLOW_BEGIN,{custom_tags:{high_quality:w.initWithHighQuality}});}this._grid.logStep(c('PUWSteps').CLIENT_SELECT_BEGIN);c('Arbiter').inform('PhotosMultiUploadInput/loaded/'+w.gridID,null,c('Arbiter').BEHAVIOR_PERSISTENT);}n.prototype.getGrid=function(){'use strict';return this._grid;};n.prototype.onQualitySettingChanged=function(t){'use strict';this._grid.setQuality(t);};Object.assign(n,{imageUploadDone:function t(u,v,w,x,y){o[u].imageUploadDone(v,w,x,y);},addCameraImage:function t(u,v,w){o[u].addCameraImage(v,w);},initDragDrop:function t(u,v){c('Arbiter').inform('PhotosMultiUploadInput/initDragDrop/'+u,{dragDropArea:v},c('Arbiter').BEHAVIOR_PERSISTENT);},imageUploadFail:function t(u,v){o[u].removeLoadingIndicator(v.getFile().uploadID);},doFileUpload:function t(u,v){o[u].doFileUpload(v);},onFilesDrop:function t(u,v){o[u].onFilesDrop(v);},onVaultImagesAdded:function t(u,v){o[u].onVaultImagesAdded(v);},getWaterfallID:function t(u){return q.getInstance(u).getWaterfallID();},clearSession:function t(u){o[u].clearSession();},getConfig:function t(u){return o[u].getConfig();}});var o={},p=0;k=babelHelpers.inherits(q,c('mixin')(c('PhotosUploadWaterfallXMixin')));l=k&&k.prototype;function q(t){'use strict';l.constructor.call(this);this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=t;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];this._uploadTimers={};this._videoEncodeTimers={};this._sessionsStarted=false;this._waterfallID=null;this._resizer=null;this._numUploadsSucceeded=0;this._numUploadsFailed=0;this._uploadIDToFileUpload={};this._failedUploadIDs={};this._uploadIDToChildIndex={};this._uploadParams=[];c('Arbiter').subscribe('multi-upload/video-removed/'+this._gridID,function(){c('DOM').remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._fileInputInstances.forEach(function(u){u.clear();});}.bind(this));c('Arbiter').subscribe('multi-upload/image-removed/'+this._gridID,function(){this._logComposerWaterfallEvent(c('ComposerWaterfallEvent').PHOTO_REMOVE);}.bind(this));c('Arbiter').subscribe('PhotosMultiUploadInput/initDragDrop/'+this._gridID,function(u,v){this.initDragDrop(v.dragDropArea);}.bind(this));c('Arbiter').subscribe('AttachmentsPhotoEditor/logPhotoEditorLaunched'+this._gridID,function(u,v){this.logStep(c('PUWSteps').CLIENT_PHOTO_EDIT_BEGIN);}.bind(this));c('Arbiter').subscribe('AttachmentsPhotoEditor/newImage'+this._gridID,this._onEditedImage.bind(this));}q.prototype.getWaterfallID=function(){'use strict';if(!this._waterfallID)this._waterfallID=c('WaterfallIDGenerator').generate();return this._waterfallID;};q.prototype.getWaterfallAppName=function(){'use strict';return c('PUWApplications').WEB_COMPOSER;};q.prototype.getWaterfallSource=function(){'use strict';return this._config.ref;};q.prototype.getLoadingIndicator=function(t){'use strict';var u=this._loadingIndicators[t];return u;};q.prototype.initDragDrop=function(t){'use strict';this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new (c('DragDropTarget'))(t).setOnFilesDropCallback(function(u){this.onFilesDrop(u,c('PUWMethods').DRAGDROP);}.bind(this)).setFileFilter(c('ComposerXDragDropUtils').filterImages).enable();};q.prototype.setConfig=function(t){'use strict';this._config=t;this._isHighQuality=t.hasOwnProperty('initWithHighQuality')?t.initWithHighQuality:true;if(!c('JpegResizer').isSupported()){this.logStep(c('PUWSteps').CLIENT_PROCESS_UNAVAILABLE);}else if(this._config.useResizer){this._resizer=new (c('JpegResizer'))(this._config.maxselect===1?1:c('JpegResizer').DEFAULT_POOL_SIZE);this._resizer.setHighQuality(this._isHighQuality);}if(!this._waterfallID)this._waterfallID=t.waterfallID;this._concurrentLimit=t.concurrentLimit;return this;};q.prototype.setProgressBarMarkup=function(t){'use strict';this._progressBarMarkup=t;return this;};q.prototype.setVideoIconMarkup=function(t){'use strict';this._videoIconMarkup=t;var u=c('DOM').find(t,"._3ev");c('Event').listen(u,'click',this._onVideoRemoved.bind(this));return this;};q.prototype.setQuality=function(t){'use strict';this._isHighQuality=t;this._resizer&&this._resizer.setHighQuality(t);this.logStep(c('PUWSteps').CLIENT_QUALITY_SWITCH,{custom_tags:{high_quality:this._isHighQuality}});};q.prototype.imageUploadDone=function(t,u,v,w){'use strict';this._numUploadsSucceeded++;var x=this.getLoadingIndicator(u);if(!x)return;if(c('DOM').contains(document.body,x.getRoot()))c('DOM').replace(x.getRoot(),t);var y={};y[u]=v;if(this._config.isVideoCarouselPost){this._markUploadAsFinished();var z={};z.image_fbid=v;this._uploadParams[this._uploadIDToChildIndex[u]]=z;if(this._isUploadFinished())this._informUploadFinished();}else{this._informImagesAdded(y,w);this._markUploadAsFinished();}this._loadingIndicators[u]=null;};q.prototype.addCameraImage=function(t,u){'use strict';this.insertIntoGrid(t);this._informImagesAdded({'0':u},{});this.logStep(c('PUWSteps').CLIENT_ATTACH_PHOTO,{method:c('PUWMethods').CAMERA,fbid:u});};q.prototype._informImagesAdded=function(t,u){'use strict';c('Arbiter').inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:t,tagInfo:{exifLocation:u}});c('Arbiter').inform('composer/updateViewerLocationEstimate',u);};q.prototype._informUploadFinished=function(){'use strict';c('Arbiter').inform(['multi-upload/medias-added/'+this._gridID],{params:this._uploadParams});};q.prototype._generateLoadingIndicatorForPhoto=function(t){'use strict';this._generateLoadingIndicator(t.uploadID);this._uploadIDToChildIndex[t.uploadID]=this._uploadParams.length;this._uploadParams[this._uploadParams.length]={};};q.prototype._generateLoadingIndicator=function(t){'use strict';this._numRemainingFiles++;var u=this._progressBarMarkup.cloneNode(true);c('Event').listen(u,'click',this._clickHandler.bind(this,t));this.insertIntoGrid(u);this._loadingIndicators[t]=new (c('ProgressBar'))(u);};q.prototype._generateUploadIDsAndLoadingIndicators=function(t){'use strict';for(var u=0;u<t.length;u++){if(!t[u].uploadID)t[u].uploadID=c('PhotosUploadID').getNewID();this._generateLoadingIndicator(t[u].uploadID);}};q.prototype._clickHandler=function(t,u){'use strict';var v=u.target,w="_639";if(c('Parent').byClass(v,w))if(this._failedUploadIDs[t]){this.removeLoadingIndicator(t);}else this.fileUploadCanceled(t,this._uploadIDToFileUpload[t]);var x="_2zo7";if(c('Parent').byClass(v,x)){c('CSS').hide(c('DOM').find(this.getLoadingIndicator(t).getRoot(),"._2zo5"));this._retryFileUpload(this._uploadIDToFileUpload[t].getFile());this._failedUploadIDs[t]=false;}var y="_2zo8";if(c('Parent').byClass(v,y))this.removeLoadingIndicator(t);};q.prototype.fileUploadFailure=function(t,u,v){'use strict';this._numUploadsFailed++;this._failedUploadIDs[t]=true;var w=Date.now()-this._uploadTimers[t],x=0;if(u.upload)x=u.upload.getRetryCount?u.upload.getRetryCount():0;var y=u.response.getErrorDescription(),z=u.response.getError();if(z===m)y=JSON.stringify(v);this.logStep(c('PUWSteps').CLIENT_TRANSFER_FAIL,{dt:w,error_code:z,error_info:y,bytes:u.upload.getFile().size,auto_retry_count:x,custom_tags:{high_quality:this._isHighQuality,manual_retry:!!u.upload.getFile().manuallyRetried}});if(this._config.useNewErrorUI){var aa=u.response.isTransient()||u.response.getError()==1004||u.response.getError()==1006,ba=aa&&this._uploadIDToFileUpload[t];this._showNewUploadFailedMessage(t,u.upload.getFile().name||u.upload.getFile().filename||'',u.response.getErrorSummary(),u.response.getErrorDescription(),ba,u.upload.getFile());this._markUploadAsFinished();}else{this._showUploadFailedMessage(t);this._fadeOutFileUpload(t);}};q.prototype._fadeOutFileUpload=function(t){'use strict';new (c('Animation'))(this.getLoadingIndicator(t).getRoot()).duration(2000).checkpoint().from('opacity',1).to('opacity',0).duration(1000).ondone(this.removeFileUpload.bind(this,t)).go();};q.prototype._showUploadFailedMessage=function(t){'use strict';c('CSS').hide(c('DOM').find(this.getLoadingIndicator(t).getRoot(),"._5l83"));c('CSS').show(c('DOM').find(this.getLoadingIndicator(t).getRoot(),"._5l82"));};q.prototype._showNewUploadFailedMessage=function(t,u,v,w,x,y){'use strict';var z=this.getLoadingIndicator(t).getRoot();c('CSS').hide(c('DOM').find(z,"._5l83"));c('CSS').show(c('DOM').find(z,"._2zo5"));var aa=c('DOM').find(z,"._2zo6");c('DOM').setContent(aa,u);var ba=c('DOM').find(z,"._2zo5");c('Tooltip').set(ba,v+': '+w);if(x){var ca=c('DOM').find(z,"._2zo7");c('CSS').show(ca);}else{var da=c('DOM').find(z,"._2zo8");c('CSS').show(da);}};q.prototype._finishUploadBatch=function(){'use strict';c('Arbiter').inform('multi-upload/images-upload-completed/'+this._gridID);if(this._numUploadsFailed>0){this.logStep(c('PUWSteps').CLIENT_TRANSFER_BATCH_FAIL,{volume:this._numUploadsFailed,batch_size:this._numUploadsSucceeded+this._numUploadsFailed});}else this.logStep(c('PUWSteps').CLIENT_TRANSFER_BATCH_SUCCESS,{volume:this._numUploadsSucceeded});this._numUploadsSucceeded=0;this._numUploadsFailed=0;};q.prototype.fileUploadCanceled=function(t,u){'use strict';u&&u.abort();var v={latency:Date.now()-this._uploadTimers[t]};if(u&&u.getFile())v.bytes=u.getFile().size;this.logStep(c('PUWSteps').CLIENT_TRANSFER_CANCEL,v);this.removeFileUpload(t);};q.prototype.removeFileUpload=function(t){'use strict';this.removeLoadingIndicator(t);this._markUploadAsFinished();};q.prototype._markUploadAsFinished=function(){'use strict';this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);if(this._numRemainingFiles===0)this._finishUploadBatch();};q.prototype.getVideoOrPhotoUploadCallback=function(t,u){'use strict';var v=this;return function(w){if(w){for(var x=0;x<t.input.files.length;x++){var y=c('ReactComposerMediaUtils').getVideoUploader(v._config.composerID),z=t.input.files[x];if(!z.uploadID)z.uploadID=c('PhotosUploadID').getNewID();var aa=c('VideoUploadFile').fromFile(z);y.subscribe('upload-started',v._onVideoUploadStart.bind(v,z));y.subscribe('upload-progressed',v._onVideoUploadProgress.bind(v,z));y.subscribe('upload-finished',v._onVideoUploadFinished.bind(v,y,z));y.upload(aa);}}else if(u){v._photosSelected(t);}else new (c('Dialog'))().setBody(j._("\u62b1\u6b49\uff0c\u4f60\u53ea\u80fd\u9078\u53d6\u5f71\u7247\u6a94\u6848\u3002")).setTitle(j._("\u4e0d\u88ab\u652f\u63f4\u7684\u6a94\u6848")).setModal(true).setButtons(c('Dialog').OK).show();};};q.prototype.doFileUpload=function(t){'use strict';var u=false,v=false;switch(this._config.supportedFileTypes){case 'photos':v=true;break;case 'videos':u=true;break;case 'both':u=v=true;break;}this._submitListener&&this._submitListener.remove();var w=this.getVideoOrPhotoUploadCallback(t,v);if(u){c('ComposerXMediaUploadHandler').isVideoOrAnimatedGifAsync(t,w);}else w(false);};q.prototype.getConfig=function(){'use strict';return this._config;};q.prototype._resizeUpload=function(t,u){'use strict';var v=t.getFile();if(!v||!c('PhotosMimeType').isJpeg(v.type))return u(t);var w=c('performanceNow')();this.logStep(c('PUWSteps').CLIENT_PROCESS_BEGIN,{bytes:v.size,custom_tags:{high_quality:this._isHighQuality}});this._resizer.resizeBlob(v,function(x,y,z){y=y||v;if(x){this.logStep(c('PUWSteps').CLIENT_PROCESS_FAIL,{dt:c('performanceNow')()-w,bytes:y.size,error_code:x.code,error_info:x.message,custom_tags:{high_quality:this._isHighQuality}});return u(t);}y.uploadID=v.uploadID;y.filename=v.name;t.setFile(y);this.logStep(c('PUWSteps').CLIENT_PROCESS_SUCCESS,{dt:c('performanceNow')()-w,media_data_size:v.size,bytes:y.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:z}});u(t);}.bind(this),this._onResizeProgress.bind(this,v.uploadID));};q.prototype._onResizeStart=function(t){'use strict';this.logStep(c('PUWSteps').CLIENT_PROCESS_BEGIN,{bytes:t.size,custom_tags:{high_quality:this._isHighQuality}});};q.prototype._onResizeFail=function(t,u,v,w){'use strict';this.logStep(c('PUWSteps').CLIENT_PROCESS_FAIL,{dt:w,bytes:u.size,error_code:v.code,error_info:v.message,custom_tags:{high_quality:this._isHighQuality}});};q.prototype._onResizeSuccess=function(t,u,v,w){'use strict';this.logStep(c('PUWSteps').CLIENT_PROCESS_SUCCESS,{dt:w,media_data_size:t.size,bytes:u.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:v}});};q.prototype._isExceedMaxSelect=function(t){'use strict';return this._config.maxselect>1&&t>this._config.maxselect;};q.prototype._showTooManyPhotosDialog=function(t){'use strict';var u=t-this._config.maxselect;new (c('Dialog'))().setTitle(j._("\u592a\u591a\u76f8\u7247")).setBody(u>1?j._({"*":{"*":{"*":"\u4f60\u5df2\u7d93\u9078\u53d6\u4e86{photosattached}\u5f35\u76f8\u7247\uff0c\u4f46\u662f\u4f60\u6700\u591a\u53ea\u80fd\u5728\u8cbc\u6587\u4e2d\u52a0{maxselect}}\u5f35\u76f8\u7247\uff0c\u8acb\u53d6\u6d88\u9078\u53d6\u81f3\u5c11{unselect}\u5f35\u3002"}}},[j.param('maxselect',this._config.maxselect,[0]),j.param('photosattached',t,[0]),j.param('unselect',u,[0])]):j._({"*":{"*":"\u4f60\u5df2\u7d93\u9078\u53d6\u4e86{photosattached}\u5f35\u76f8\u7247\uff0c\u4f46\u662f\u4f60\u6700\u591a\u53ea\u80fd\u5728\u8cbc\u6587\u4e2d\u52a0{maxselect}\u5f35\u76f8\u7247\uff0c\u8acb\u53d6\u6d88\u9078\u53d6\u81f3\u5c11\u4e00\u5f35\u3002"}},[j.param('maxselect',this._config.maxselect,[0]),j.param('photosattached',t,[0])])).setButtons(c('Dialog').OK).setModal(true).show();};q.prototype._photosSelected=function(t){'use strict';var u=t.getInput(),v=r(u);if(this._isExceedMaxSelect(v)){this._showTooManyPhotosDialog(v);return;}this._onBeforeAddUploadedImages();this._upload(t,v);};q.prototype._upload=function(t,u){'use strict';var v=t.getInput(),w=this._config.uploadData;if(this._config.waterfallID)w.qn=this._config.waterfallID;var x=function(){c('Arbiter').inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:u});}.bind(this),y=new (c('XComposerPhotoUploader'))({uploadEndpoint:this._config.photoEndpoint,uploadData:w,retryLimit:this._config.retryLimit,concurrentLimit:this._config.concurrentLimit,resizer:this._resizer,onUploadEnqueued:this._generateLoadingIndicatorForPhoto.bind(this),onUploadsEnqueued:x,onUploadSent:function z(){return t.clear();},onResizeStart:this._onResizeStart.bind(this),onResizeProgress:this._onResizeProgress.bind(this),onResizeSuccess:this._onResizeSuccess.bind(this),onResizeFailure:this._onResizeFail.bind(this),onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFailure:this.fileUploadFailure.bind(this)});y.upload(v);this.logStep(c('PUWSteps').CLIENT_SELECT_SUCCESS,{times_selected:p++,volume:u,method:'file_selector'});};q.prototype._onVideoRemoved=function(){'use strict';this._dragDropTarget&&this._dragDropTarget.enable();c('Arbiter').inform('multi-upload/video-removed/'+this._gridID);};q.prototype.removeLoadingIndicator=function(t){'use strict';var u=this.getLoadingIndicator(t);u&&c('DOM').remove(u.getRoot());delete this._loadingIndicators[t];c('Arbiter').inform('multi-upload/loading-indicator-removed/'+this._gridID);};q.prototype._isUploadFinished=function(){'use strict';return this._numRemainingFiles===0;};q.prototype._informUploadStatus=function(t){'use strict';c('Bootloader').loadModules(["ReactComposerAttachmentActions"],function(u){u.changeUploadStatus(this._config.composerID,t);}.bind(this),'PhotosMultiUploadInput');};q.prototype._onEncodeFinished=function(t){'use strict';this.stopInactivityTimer(t);this._markUploadAsFinished();if(this._isUploadFinished())this._informUploadFinished();};q.prototype._onEncodeProgress=function(t){'use strict';this._videoEncodeTimers[t]=this.startInactivityTimer(t);};q.prototype.startInactivityTimer=function(t){'use strict';this._videoEncodeTimers[t]=setTimeout(c('OptimisticVideoPostUtils').checkVideoStatus.bind(this,t,this._onEncodeFinished.bind(this),this._onEncodeProgress.bind(this),this._onEncodeProgress.bind(this)),100);};q.prototype.stopInactivityTimer=function(t){'use strict';clearTimeout(this._videoEncodeTimers[t]);};q.prototype._onFileUploadStart=function(t,u){'use strict';this._uploadIDToFileUpload[t]=u.upload;var v=c('DOM').find(this.getLoadingIndicator(t).getRoot(),"._639");c('CSS').show(v);this._uploadTimers[t]=Date.now();var w={custom_tags:{high_quality:this._isHighQuality}};if(u.upload&&u.upload.getFile())w.size=u.upload.getFile().size;this.logStep(c('PUWSteps').CLIENT_TRANSFER_BEGIN,w);this._logComposerWaterfallEvent(c('ComposerWaterfallEvent').PHOTO_ADD);};q.prototype._onVideoUploadStart=function(t){'use strict';this._generateLoadingIndicatorForPhoto(t);this._informUploadStatus(true);};q.prototype._onVideoUploadProgress=function(t,u,v){'use strict';var w=this.getLoadingIndicator(t.uploadID);if(!w)return;var x=Math.min(v.start_offset+v.sent_bytes,v.file_size),y=Math.floor(x/v.file_size*100)+'%';this._showProgressBar(w);this._showProgressPosition(w,y);var z={carousel_uploading:true,loaded:x,total:v.file_size,skip_upload:v.skip_upload};c('updatePhotoProgressBar')(w,z);};q.prototype._onVideoUploadFinished=function(t,u,v,w){'use strict';if(this._config.isVideoCarouselPost)t.post({draft:true});var x={};x.video_id=w.video_id;this._uploadParams[this._uploadIDToChildIndex[u.uploadID]]=x;this.startInactivityTimer(w.video_id,u.uploadID);this._numUploadsSucceeded++;var y=this.getLoadingIndicator(u.uploadID);if(!y)return;var z=this.getLoadingIndicator(u.uploadID),aa=j._("encoding...");this._showProgressPosition(z,aa);this._loadingIndicators[u.uploadID]=null;};q.prototype._onUploadProgress=function(t,u){'use strict';var v=this.getLoadingIndicator(t);if(!v||this._failedUploadIDs[t])return;this._showProgressBar(v);c('CSS').removeClass(v.getRoot(),"_5v_0");c('updatePhotoProgressBar')(v,u.event);};q.prototype._onResizeProgress=function(t,event){'use strict';var u=this.getLoadingIndicator(t);if(!u)return;this._showProgressBar(u);c('CSS').addClass(u.getRoot(),"_5v_0");u.setPosition(100*event.written/event.total);};q.prototype._showProgressBar=function(t){'use strict';c('CSS').hide(c('DOM').find(t.getRoot(),"._2om"));c('CSS').show(c('DOM').find(t.getRoot(),"._5e4h"));};q.prototype._showProgressPosition=function(t,u){'use strict';var v=c('DOM').find(t.getRoot(),"._318m");c('DOM').setContent(v,u);c('CSS').show(c('DOM').find(t.getRoot(),"._318n"));};q.prototype._onFileUploadSuccess=function(t,u){'use strict';var v=Date.now()-this._uploadTimers[t],w={dt:v};if(u.upload){w.bytes=u.upload.getFile().size;w.auto_retry_count=u.upload.getRetryCount?u.upload.getRetryCount():0;w.custom_tags={high_quality:this._isHighQuality,manual_retry:!!u.upload.getFile().manuallyRetried};}this.logStep(c('PUWSteps').CLIENT_TRANSFER_SUCCESS,w);this._logComposerWaterfallEvent(c('ComposerWaterfallEvent').PHOTO_ADD_SUCCESS);};q.prototype._logComposerWaterfallEvent=function(event){'use strict';if(!c('Parent').bySelector(c('$')(this._gridID),"._119"))return;c('ComposerXMarauderLogger').logEvent(event,this._getComposerID());};q.prototype._getComposerID=function(){'use strict';return c('ComposerXController').getComposerID(this._gridID);};q.prototype._getAsyncUploadRequest=function(t){'use strict';var u=new (c('XComposerPhotoUploader'))({uploadEndpoint:this._config.photoEndpoint,uploadData:this._config.uploadData,concurrentLimit:this._config.concurrentLimit,onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFail:this.fileUploadFailure.bind(this)});return u.getAsyncUploadRequest(t);};q.prototype._onEditedImage=function(t,u){'use strict';this._onBeforeAddUploadedImages();this.logStep(c('PUWSteps').CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators([u.blob]);var v=this._getGridItemElementByFBID(u.fbid);if(v){var w=this._loadingIndicators[u.blob.uploadID].getRoot();c('DOM').insertBefore(v,w);}c('Arbiter').inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1,method:c('PUWMethods').EDITOR});var x=this._getAsyncUploadRequest([u.blob]);x.setData(Object.assign({},this._config.uploadData,{original_fbid:u.fbid,xy_tags:u.xyTags,stickers:u.stickers,text_overlays:u.textOverlays,has_crop:u.hasCrop,has_filter:u.hasFilter}));x.send();this.logStep(c('PUWSteps').CLIENT_SELECT_SUCCESS,{volume:1,method:c('PUWMethods').EDITOR});this.logStep(c('PUWSteps').CLIENT_PHOTO_EDIT_SUCCESS);};q.prototype._getGridItemElementByFBID=function(t){'use strict';var u=c('DOM').scry(c('$')(this._gridID),".fbVaultGridItem");for(var v=0;v<u.length;v++)if(u[v].dataset.originalfbid==t)return u[v];return null;};q.prototype.onVaultImagesAdded=function(t){'use strict';var u=[];for(var v=0;v<t.length;v++)u.push({imageID:t[v]});this._generateUploadIDsAndLoadingIndicators(u);new (c('AsyncUploadRequest'))('/ajax/composerx/attachment/media/multi_upload_vault_images/').setData(Object.assign({},{vault_images:u,grid_id:this._gridID})).setAllowCrossOrigin(true).send();};q.prototype.onFilesDrop=function(t,u){'use strict';if(this._isExceedMaxSelect(t.length)){this._showTooManyPhotosDialog(t.length);return;}this._onBeforeAddUploadedImages();this.logStep(c('PUWSteps').CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators(t);c('Arbiter').inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:t.length,method:u||c('PUWMethods').DRAGDROP});var v=this._getAsyncUploadRequest(t);if(this._resizer)v.setPreprocessHandler(this._resizeUpload.bind(this));v.send();this.logStep(c('PUWSteps').CLIENT_SELECT_SUCCESS,{volume:t.length,method:u||c('PUWMethods').DRAGDROP});};q.prototype._retryFileUpload=function(t){'use strict';this._numRemainingFiles++;c('Arbiter').inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1});this.logStep(c('PUWSteps').CLIENT_TRANSFER_MANUAL_RETRY);t.manuallyRetried=true;var u=this._getAsyncUploadRequest([t]);u.send();};q.prototype._onBeforeAddUploadedImages=function(){'use strict';if(!this.sessionStarted)this.logStep(c('PUWSteps').CLIENT_FLOW_BEGIN);if(this._config.maxselect==1)c('Arbiter').inform('multi-upload/composer-reset/'+this._gridID);this.sessionStarted=true;};q.prototype.clearSession=function(){'use strict';this.sessionStarted=false;};q.prototype.insertIntoGrid=function(t){'use strict';var u=c('DOM').scry(c('$')(this._gridID),"._577")[0];if(u){c('DOM').insertBefore(u,t);}else c('DOM').prependContent(c('$')(this._gridID),t);};q.prototype._getUploadID=function(t,u){'use strict';if(t.upload){return t.upload.getFile().uploadID;}else return u.uploadID;};q.getInstance=function(t){'use strict';o[t]=o[t]||new q(t);return o[t];};function r(t){if(!s(t))return 1;return t.files.length;}function s(t){return !!t.files&&c('AsyncUploadRequest').isSupported();}f.exports=n;}),null);
__d('MessengerAdsWebTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('messenger_ads_web:MessengerAdsWebLoggerConfig',this.$MessengerAdsWebTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('messenger_ads_web:MessengerAdsWebLoggerConfig',this.$MessengerAdsWebTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$MessengerAdsWebTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$MessengerAdsWebTypedLogger1=babelHelpers['extends']({},this.$MessengerAdsWebTypedLogger1,j);return this;};h.prototype.setEvent=function(j){this.$MessengerAdsWebTypedLogger1.event=j;return this;};h.prototype.setIsSponsored=function(j){this.$MessengerAdsWebTypedLogger1.is_sponsored=j;return this;};h.prototype.setItemID=function(j){this.$MessengerAdsWebTypedLogger1.item_id=j;return this;};h.prototype.setMessageID=function(j){this.$MessengerAdsWebTypedLogger1.message_id=j;return this;};h.prototype.setMessageTimestamp=function(j){this.$MessengerAdsWebTypedLogger1.message_timestamp=j;return this;};h.prototype.setPageID=function(j){this.$MessengerAdsWebTypedLogger1.page_id=j;return this;};h.prototype.setVC=function(j){this.$MessengerAdsWebTypedLogger1.vc=j;return this;};var i={event:true,is_sponsored:true,item_id:true,message_id:true,message_timestamp:true,page_id:true,vc:true};f.exports=h;}),null);
__d('PagesMessagingPerfTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:PagesMessagingPerfLoggerConfig',this.$PagesMessagingPerfTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:PagesMessagingPerfLoggerConfig',this.$PagesMessagingPerfTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$PagesMessagingPerfTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$PagesMessagingPerfTypedLogger1=babelHelpers['extends']({},this.$PagesMessagingPerfTypedLogger1,j);return this;};h.prototype.setEventName=function(j){this.$PagesMessagingPerfTypedLogger1.event_name=j;return this;};h.prototype.setExceptionCode=function(j){this.$PagesMessagingPerfTypedLogger1.exception_code=j;return this;};h.prototype.setExceptionMessage=function(j){this.$PagesMessagingPerfTypedLogger1.exception_message=j;return this;};h.prototype.setPageID=function(j){this.$PagesMessagingPerfTypedLogger1.page_id=j;return this;};h.prototype.setPerfTime=function(j){this.$PagesMessagingPerfTypedLogger1.perf_time=j;return this;};h.prototype.setStack=function(j){this.$PagesMessagingPerfTypedLogger1.stack=j;return this;};h.prototype.setVC=function(j){this.$PagesMessagingPerfTypedLogger1.vc=j;return this;};var i={event_name:true,exception_code:true,exception_message:true,page_id:true,perf_time:true,stack:true,vc:true};f.exports=h;}),null);
__d('StickersTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:StickersLoggerConfig',this.$StickersTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:StickersLoggerConfig',this.$StickersTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$StickersTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$StickersTypedLogger1=babelHelpers['extends']({},this.$StickersTypedLogger1,j);return this;};h.prototype.setEvent=function(j){this.$StickersTypedLogger1.event=j;return this;};h.prototype.setNumsearchresults=function(j){this.$StickersTypedLogger1.numsearchresults=j;return this;};h.prototype.setPackid=function(j){this.$StickersTypedLogger1.packid=j;return this;};h.prototype.setPackids=function(j){this.$StickersTypedLogger1.packids=c('GeneratedLoggerUtils').serializeVector(j);return this;};h.prototype.setSearchtoken=function(j){this.$StickersTypedLogger1.searchtoken=j;return this;};h.prototype.setStickerid=function(j){this.$StickersTypedLogger1.stickerid=j;return this;};h.prototype.setTagid=function(j){this.$StickersTypedLogger1.tagid=j;return this;};h.prototype.setTriggeredword=function(j){this.$StickersTypedLogger1.triggeredword=j;return this;};h.prototype.setTriggerused=function(j){this.$StickersTypedLogger1.triggerused=j;return this;};var i={event:true,numsearchresults:true,packid:true,packids:true,searchtoken:true,stickerid:true,tagid:true,triggeredword:true,triggerused:true};f.exports=h;}),null);
__d('TimelineMapScrollableArea',['Animation','ArbiterMixin','CSS','DOM','Event','Run','Scroll','SimpleDrag','Style','Vector','$','shield'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){i&&this.init(c('$')(i),j);}Object.assign(h.prototype,c('ArbiterMixin'),{init:function i(j,k){k=k||{};this._elem=j;this._wrap=c('DOM').find(j,'div.fbScrollableAreaWrap');this._body=c('DOM').find(this._wrap,'div.fbScrollableAreaBody');this._track=c('DOM').find(j,'div.fbScrollableAreaTrack');this._gripper=c('DOM').find(this._track,'div.fbScrollableAreaGripper');this._options=k;this.adjustGripper();this._listeners=[c('Event').listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(k.fade!==false)this._listeners.push(c('Event').listen(j,'mouseenter',c('shield')(this.adjustGripper,this)),c('Event').listen(j,'mouseenter',c('shield')(this.showScrollbar,this)),c('Event').listen(j,'mousemove',this._handleMousemove.bind(this)),c('Event').listen(j,'mouseout',c('shield')(this.hideScrollbar,this)));if(k.fade!==undefined)this._listeners.push(c('Event').listen(this._track,'click',this.clickToScroll.bind(this)));if(k.verticalscroll)this._listeners.push(c('Event').listen(this._wrap,'mousewheel',this.mouseWheel.bind(this)),c('Event').listen(this._wrap,'DOMMouseScroll',this.mouseWheel.bind(this)));this.initDrag();if(!k.persistent)c('Run').onLeave(this.destroy.bind(this));},getRoot:function i(){return this._elem;},initDrag:function i(){var j=new (c('SimpleDrag'))(this._gripper);j.subscribe('start',function(k,event){if(!(event.which&&event.which===1||event.button&&event.button===1))return;this.inform('dragstart');var l=c('Vector').getEventPosition(event).x,m=this._gripper.offsetLeft,n=j.subscribe('update',function(p,q){var r=c('Vector').getEventPosition(q).x-l,s=this._elem.clientWidth,t=this._body.offsetWidth,u=this._track.offsetWidth,v=s/t*u,w=t-this._wrap.offsetWidth,x=m+r,y=u-v;x=Math.max(Math.min(x,y),0);var z=x/y*w;c('Scroll').setLeft(this._wrap,z);}.bind(this)),o=j.subscribe('end',function(){j.unsubscribe(n);j.unsubscribe(o);this.inform('dragend');}.bind(this));}.bind(this));},adjustGripper:function i(){var j=this._elem.clientWidth,k=this._body.offsetWidth,l=this._track.offsetWidth,m=j/k*l;if(m<l){c('Style').set(this._gripper,'width',m+'px');var n=c('Scroll').getLeft(this._wrap)/k*l;c('Style').set(this._gripper,'left',n+'px');c('CSS').show(this._gripper);}else c('CSS').hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function i(){var j=c('Scroll').getLeft(this._wrap),k=this._wrap.scrollWidth-this._wrap.clientWidth;c('CSS').conditionClass(this._elem,'contentBefore',j>0);c('CSS').conditionClass(this._elem,'contentAfter',j<k);},destroy:function i(){this._listeners.forEach(function(j){j.remove();});this._listeners.length=0;},_handleMousemove:function i(event){var j=c('Vector').getElementPosition(this._track).y,k=c('Vector').getElementDimensions(this._track).y;if(Math.abs(j+k/2-c('Vector').getEventPosition(event).y)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function i(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function i(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=setTimeout(function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=new (c('Animation'))(this._track).from('opacity',1).to('opacity',0).duration(250).ondone(c('CSS').addClass.bind(null,this._track,'invisible_elem')).go();}.bind(this),750);return this;},showScrollbar:function i(j){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this.adjustGripper();c('Style').set(this._track,'opacity',1);c('CSS').removeClass(this._track,'invisible_elem');if(j!==false)this.hideScrollbar();return this;},clickToScroll:function i(event){var j=c('Vector').getEventPosition(event).x,k=this._elem.clientWidth,l=this._body.offsetWidth,m=this._track.offsetWidth,n=k/l*m,o=c('Vector').getElementPosition(this._gripper);if(j>=o.x&&j<=o.x+n)return;var p=j<o.x?-1:1,q=this._wrap.offsetWidth*.8*p;this.scrollBy(q);},scrollBy:function i(j){this.setScroll(c('Scroll').getLeft(this._wrap)+j);},getMaxBodyOffset:function i(){return this._body.offsetWidth-this._wrap.offsetWidth;},setScroll:function i(j){var k=j;k=Math.max(Math.min(k,this.getMaxBodyOffset()),0);c('Scroll').setLeft(this._wrap,k);},scrollIntoView:function i(j){var k=this._wrap.clientWidth,l=j.offsetWidth,m=c('Scroll').getLeft(this._wrap),n=m+k,o=j.offsetLeft,p=o+l;if(o<m||k<l){this.setScroll(o);}else if(p>n)this.setScroll(m+(p-n));},mouseWheel:function i(event){if(this.getMaxBodyOffset()<=0)return;var j=0;if(event.wheelDelta){var k=event.wheelDelta;if(event.wheelDeltaX&&event.wheelDeltaY)k=Math.abs(event.wheelDeltaX)>Math.abs(event.wheelDeltaY)?event.wheelDeltaX:event.wheelDeltaY;j=-k*10/40;}else if(event.detail)j=event.detail*10;this.scrollBy(j);event.prevent();}});f.exports=b.TimelineMapScrollableArea||h;}),null);
__d('MercuryFileUploader',['csx','fbt','ArbiterMixin','CSS','Dialog','DOM','Event','FileForm','FileFormResetOnSubmit','FileInput','FormSubmitOnChange','MercuryAttachment','MercuryAttachmentTemplates','MercuryConstants','PhotosUploadID','SubscriptionsHandler','getObjectValues','mixin','shield'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();j=babelHelpers.inherits(l,c('mixin')(c('ArbiterMixin')));k=j&&j.prototype;function l(n,o,p,q){'use strict';k.constructor.call(this);this.$MercuryFileUploader1=n;this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader7={};this.$MercuryFileUploader8={};this.$MercuryFileUploader9={};this.$MercuryFileUploader10={};this.updateElements(o,p,q);}l.prototype.updateElements=function(n,o,p){'use strict';this.$MercuryFileUploader11&&this.$MercuryFileUploader11.release();this.$MercuryFileUploader11=new (c('SubscriptionsHandler'))();this.$MercuryFileUploader12&&this.$MercuryFileUploader12.destroy();this.$MercuryFileUploader12=new (c('FileForm'))(n,[c('FormSubmitOnChange'),c('FileFormResetOnSubmit')]);this.$MercuryFileUploader12.setAllowCrossOrigin(true);this.$MercuryFileUploader12.setUploadInParallel(true);var q=c('DOM').find(n,"._4q60"),r=c('DOM').find(q,"._4q61");new (c('FileInput'))(q,r,o);this.$MercuryFileUploader11.addSubscriptions(this.$MercuryFileUploader12.subscribe('submit',function(){var s={count:0,file_sizes:[],files:[]};if(o.files){for(var t=0;t<o.files.length;t++)if(o.files[t].size>c('MercuryConstants').AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var u={};for(var v=0;v<o.files.length;v++){var w=this.$MercuryFileUploader13();this.$MercuryFileUploader14(w,o.files[v].name);s.count++;s.file_sizes.push(o.files[v].size);u[w]=o.files[v];s.files.push({upload_id:w,metadata:o.files[v]});}this.$MercuryFileUploader12.setFiles(u);}else{p.value=this.$MercuryFileUploader13();this.$MercuryFileUploader14(p.value,o.value);s.count=1;}this.inform('submit',s);}.bind(this)),this.$MercuryFileUploader12.subscribe('success',this.$MercuryFileUploader15.bind(this)),this.$MercuryFileUploader12.subscribe('failure',this.$MercuryFileUploader16.bind(this)),c('Event').listen(r,'click',c('shield')(this.inform,this,'open')));};l.prototype.showAttachmentSizeErrorDialog=function(){'use strict';this.$MercuryFileUploader12.abort();this.$MercuryFileUploader12.clear();new (c('Dialog'))().setTitle(i._("\u4f60\u9078\u64c7\u7684\u6a94\u6848\u904e\u5927")).setBody(i._("\u4f60\u6240\u9078\u64c7\u7684\u6a94\u6848\u592a\u5927\u3002\u6700\u5927\u4e0a\u9650\u662f 25 MB\u3002")).setButtons(c('Dialog').OK).setSemiModal(true).show();};l.prototype.addDroppedFiles=function(n){'use strict';if(!this.$MercuryFileUploader12||!this.$MercuryFileUploader12.canUseXHR())return;var o={},p={count:0,file_sizes:[],files:[]};for(var q=0;q<n.length;q++){var r=n[q];if(r.size>c('MercuryConstants').AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var s=this.$MercuryFileUploader13();this.$MercuryFileUploader14(s,r.name);o[s]=r;p.file_sizes.push(r.size);p.count++;p.files.push({upload_id:s,metadata:r});}this.$MercuryFileUploader12.setFiles(o);this.$MercuryFileUploader12.forceSendViaXHR();this.inform('submit',p);};l.prototype.isUploading=function(){'use strict';return !!Object.keys(this.$MercuryFileUploader8).length;};l.prototype.addCachedAttachments=function(n){'use strict';n.forEach(function(o){var p=this.$MercuryFileUploader13();this.$MercuryFileUploader14(p,o.filename);this.inform('cached-file-added',{upload_id:p,metadata:o});this.$MercuryFileUploader17(p,o);}.bind(this));};l.prototype.addCachedImageFiles=function(n){'use strict';var o=i._("\u76f8\u7247");n.forEach(function(p){var q=this.$MercuryFileUploader13();this.$MercuryFileUploader14(q,o);this.$MercuryFileUploader17(q,{filename:p,image_id:p,filetype:'image/jpeg'});}.bind(this));};l.prototype.getAttachments=function(){'use strict';return c('getObjectValues')(this.$MercuryFileUploader2);};l.prototype.getImageFiles=function(){'use strict';var n=Object.keys(this.$MercuryFileUploader3).sort(),o=[];n.forEach(function(p){return o.push(this.$MercuryFileUploader3[p]);}.bind(this));return o;};l.prototype.getAnimatedImageFiles=function(){'use strict';return c('getObjectValues')(this.$MercuryFileUploader4);};l.prototype.getVideoFiles=function(){'use strict';return c('getObjectValues')(this.$MercuryFileUploader5);};l.prototype.getAudioFiles=function(){'use strict';return c('getObjectValues')(this.$MercuryFileUploader6);};l.prototype.getFiles=function(){'use strict';return c('getObjectValues')(this.$MercuryFileUploader7);};l.prototype.removeOneAttachment=function(n){'use strict';this.$MercuryFileUploader18(n);};l.prototype.removeAttachments=function(){'use strict';if(this.$MercuryFileUploader1)c('DOM').empty(this.$MercuryFileUploader1);this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader7={};this.$MercuryFileUploader9={};this.$MercuryFileUploader8={};this.$MercuryFileUploader10={};if(this.$MercuryFileUploader1)c('CSS').hide(this.$MercuryFileUploader1);this.inform('dom-updated');};l.prototype.destroy=function(){'use strict';this.$MercuryFileUploader11&&this.$MercuryFileUploader11.release();this.$MercuryFileUploader12&&this.$MercuryFileUploader12.destroy();this.removeAttachments();};l.prototype.$MercuryFileUploader14=function(n,o){'use strict';var p=c('MercuryAttachmentTemplates')[':fb:mercury:upload-file-row'].build(),q={};this.$MercuryFileUploader9[n]=p;this.$MercuryFileUploader8[n]=true;this.$MercuryFileUploader10[n]=Date.now();var r=m(o);c('DOM').appendContent(p.getNode('iconText'),r);q.fileName=r;c('Event').listen(p.getNode('closeFileUpload'),'click',this.$MercuryFileUploader18.bind(this,n));if(this.$MercuryFileUploader1){c('DOM').appendContent(this.$MercuryFileUploader1,p.getRoot());c('CSS').show(this.$MercuryFileUploader1);}this.inform('dom-updated',q);};l.prototype.$MercuryFileUploader18=function(n,event){'use strict';if(this.$MercuryFileUploader8[n]){this.inform('upload-canceled-during-upload');}else if(this.$MercuryFileUploader2[n]||this.$MercuryFileUploader3[n]||this.$MercuryFileUploader4[n]||this.$MercuryFileUploader5[n]||this.$MercuryFileUploader6[n]||this.$MercuryFileUploader7[n])this.inform('upload-canceled-after-uploaded');delete this.$MercuryFileUploader2[n];delete this.$MercuryFileUploader3[n];delete this.$MercuryFileUploader4[n];delete this.$MercuryFileUploader5[n];delete this.$MercuryFileUploader6[n];delete this.$MercuryFileUploader7[n];delete this.$MercuryFileUploader8[n];delete this.$MercuryFileUploader10[n];var o=this.$MercuryFileUploader9[n];delete this.$MercuryFileUploader9[n];if(o){c('DOM').remove(o.getRoot());this.inform('dom-updated');}this.inform('upload-canceled');return false;};l.prototype.$MercuryFileUploader19=function(n,o){'use strict';var p=this.$MercuryFileUploader9[n],q=c('MercuryAttachment').getAttachIconClassByMime(o);c('CSS').addClass(p.getNode('iconText'),q);c('CSS').addClass(p.getRoot(),'done');};l.prototype.$MercuryFileUploader17=function(n,o){'use strict';if(this.$MercuryFileUploader8[n]){delete this.$MercuryFileUploader8[n];if(o.image_id){this.$MercuryFileUploader3[n]=o.image_id;}else if(o.gif_id){this.$MercuryFileUploader4[n]=o.gif_id;}else if(o.video_id){this.$MercuryFileUploader5[n]=o.video_id;}else if(o.audio_id){this.$MercuryFileUploader6[n]=o.audio_id;}else if(o.file_id){this.$MercuryFileUploader7[n]=o.file_id;}else this.$MercuryFileUploader2[n]=o;this.$MercuryFileUploader19(n,o.filetype);this.inform('one-upload-completed',{upload_time_ms:Date.now()-this.$MercuryFileUploader10[n],upload_id:n,metadata:o});}if(!this.isUploading())this.inform('all-uploads-completed',{count:this.getAttachments().length});};l.prototype.$MercuryFileUploader15=function(event,n){'use strict';var o=n.response.getPayload();this.$MercuryFileUploader17(this.$MercuryFileUploader20(n),o.metadata[0]);};l.prototype.$MercuryFileUploader16=function(event,n){'use strict';this.inform('one-upload-failed');this.$MercuryFileUploader18(this.$MercuryFileUploader20(n),event);};l.prototype.$MercuryFileUploader13=function(){'use strict';return 'upload_'+c('PhotosUploadID').getNewID();};l.prototype.$MercuryFileUploader20=function(n){'use strict';var o=n.response.getPayload();if(n.upload){return n.upload.getName();}else return o.uploadID;};function m(n){if(n&&n.startsWith('C:\\fakepath\\'))return n.substring(12);return n;}f.exports=l;}),null);
__d('VaultEditableGrid',['csx','Event','Arbiter','AsyncRequest','CSS','DOM','Scroll','$','ge','removeFromArray'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={};function j(k,l,m,n){i[k.id]=this;this._grid=k;this._gridID=k.id;this._dialogEndpoint=l;this._collapseWhenEmpty=m;this._attachmentCount=n;this._selectedVaultImageIDs=[];c('Arbiter').subscribe('multi-upload/image-removed/'+this._gridID,function(o,p){c('removeFromArray')(this._selectedVaultImageIDs,p);this.updateAttachmentCount(this._attachmentCount-1);}.bind(this));c('Arbiter').subscribe('multi-upload/composer-reset/'+this._gridID,function(o,p){this.removeImages();}.bind(this));c('Arbiter').subscribe(['multi-upload/images-upload-start/'+this._gridID,'multi-upload/video-added/'+this._gridID],function(){this.updateAttachmentCount(this._attachmentCount+1);}.bind(this));c('Arbiter').inform('fbVaultEditableGrid/created/'+k.id,this,c('Arbiter').BEHAVIOR_PERSISTENT);c('Arbiter').subscribe('multi-upload/images-upload-start/'+this._gridID,this._scrollToRight.bind(this));this.updateAttachmentCount(this._attachmentCount);}Object.assign(j,{VAULT_IMAGE:'vault_image',getInstance:function k(l){return i[l];},registerDialogWithGrid:function k(l,m,n){c('Arbiter').subscribe(['multi-upload/images-upload-start/'+l,'multi-upload/video-added/'+l],n.hide.bind(n));c('Arbiter').subscribe('fbVaultEditableGrid/created/'+l,function(o,p){p._registerDialogWithGrid(m,n);});},onImagesSelected:function k(l,m,n){i[l]._onImagesSelected(m,n);}});Object.assign(j.prototype,{getRoot:function k(){var l=c('ge')(this._gridID);if(l){return l;}else return this._grid;},_registerDialogWithGrid:function k(l,m){this._dialog=m;var n=this.getMoreLink();n&&c('Event').listen(n,'click',function(){m.show();return false;});m.subscribe('aftershow',function(){var o=[];c('DOM').scry(c('$')(this._gridID),'input[type="hidden"]').forEach(function(q){if(q.name.match('composer_vault_images')||q.name.match('composer_unpublished_photo'))o.push(q.value);});var p=l.getGrid();p.bulkChange(function(){var q=p.getSelectionSet();q.clear();q.addAll(o);});}.bind(this));},updateAttachmentCount:function k(l){this._attachmentCount=l;if(this._collapseWhenEmpty)c('CSS').conditionShow(this._grid,this._attachmentCount>0);},getID:function k(){return this._gridID;},_onImagesSelected:function k(l,m){var n=c('DOM').find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=m;l.forEach(function(o){c('DOM').insertBefore(n,o);});c('Arbiter').inform('multi-upload/images-added/'+this._gridID,{fbids:m});this._scrollToRight();},removeImages:function k(){c('DOM').scry(this.getRoot(),'.fbVaultGridItem').forEach(function(l){if(!c('CSS').hasClass(l,'fbVaultEditableGridMoreLink'))c('DOM').remove(l);});this._selectedVaultImageIDs=[];c('Arbiter').inform('multi-upload/all-images-removed/'+this._gridID);this.updateAttachmentCount(0);},_scrollToRight:function k(){var l=this.getRoot(),m=c('DOM').find(l,'.fbScrollableAreaWrap');c('Scroll').setLeft(m,Math.max(0,c('DOM').find(l,'.fbScrollableAreaBody').offsetWidth-m.offsetWidth));},showDialog:function k(l,m){if(this._dialog){this._dialog.show();}else c('AsyncRequest').bootstrap(this._dialogEndpoint,l);},getMoreLink:function k(){return c('DOM').scry(this.getRoot(),'.fbVaultEditableGridMoreLink')[0];}});f.exports=j;}),null);
__d('BasePhotoUploader',['Arbiter','ArbiterMixin','CSS','DOM','PhotosMultiUploadInput','VaultEditableGrid','TimelineMapScrollableArea','mixin','getObjectValues'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k,l){'use strict';i.constructor.call(this);new (c('TimelineMapScrollableArea'))(k,{verticalscroll:true});this.$BasePhotoUploader1=k;this.$BasePhotoUploader2=this.$BasePhotoUploader3();this.$BasePhotoUploader4=false;this.$BasePhotoUploader5=null;l.addSubscriptions(c('Arbiter').subscribe('multi-upload/images-added/'+this.$BasePhotoUploader1.id,function(m,n){var o=Object.assign({},n.fbids);Object.assign(this.$BasePhotoUploader2,o);this.$BasePhotoUploader6();this.inform('upload-completed',{fbids:c('getObjectValues')(o)});}.bind(this)),c('Arbiter').subscribe('multi-upload/image-removed/'+this.$BasePhotoUploader1.id,function(m,n){for(var o in this.$BasePhotoUploader2)if(this.$BasePhotoUploader2[o]===n){delete this.$BasePhotoUploader2[o];break;}this.$BasePhotoUploader6();}.bind(this)),c('Arbiter').subscribe('multi-upload/images-upload-start/'+this.$BasePhotoUploader1.id,function(m,n){c('CSS').show(this.$BasePhotoUploader1);this.$BasePhotoUploader4=true;this.inform('dom-updated');this.inform('upload-started',n);}.bind(this)),c('Arbiter').subscribe('multi-upload/composer-reset/'+this.$BasePhotoUploader1.id,this.clear.bind(this)),c('Arbiter').subscribe('multi-upload/all-images-removed/'+this.$BasePhotoUploader1.id,this.$BasePhotoUploader7.bind(this)),c('Arbiter').subscribe('multi-upload/images-upload-completed/'+this.$BasePhotoUploader1.id,function(m){this.$BasePhotoUploader4=false;this.inform('all-uploads-completed');this.$BasePhotoUploader6();}.bind(this)));c('CSS').conditionShow(this.$BasePhotoUploader1,Object.keys(this.$BasePhotoUploader2).length);}j.prototype.getSelectedFBIDs=function(){'use strict';var k=Object.keys(this.$BasePhotoUploader2).sort();return k.map(function(l){return this.$BasePhotoUploader2[l];}.bind(this));};j.prototype.isUploading=function(){'use strict';return this.$BasePhotoUploader4;};j.prototype.clear=function(){'use strict';var k=c('VaultEditableGrid').getInstance(this.$BasePhotoUploader1.id);k&&k.removeImages();};j.prototype.getWaterfallID=function(){'use strict';return c('PhotosMultiUploadInput').getWaterfallID(this.$BasePhotoUploader1.id);};j.prototype.$BasePhotoUploader7=function(){'use strict';this.$BasePhotoUploader2={};this.$BasePhotoUploader4=false;c('CSS').hide(this.$BasePhotoUploader1);this.inform('all-uploads-completed');this.inform('dom-updated');};j.prototype.$BasePhotoUploader3=function(){'use strict';var k={},l=-10000;c('DOM').scry(this.$BasePhotoUploader1,'input[type="hidden"]').forEach(function(m){if(m.name.match('composer_vault_images')){k[l]=m.value;l--;}});return k;};j.prototype.$BasePhotoUploader6=function(){'use strict';c('CSS').conditionShow(this.$BasePhotoUploader1,Object.keys(this.$BasePhotoUploader2).length>0);this.inform('dom-updated');};j.prototype.setCurrentMethod=function(k){'use strict';this.$BasePhotoUploader5=k;};j.prototype.getCurrentMethod=function(){'use strict';return this.$BasePhotoUploader5;};f.exports=j;}),null);
__d('MercuryPhotoUploader',['csx','cx','Arbiter','AsyncRequest','BasePhotoUploader','DOM','Event','FileInput','Focus','Parent','PhotosMultiUploadInput','PUWMethods','VaultEditableGrid'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();j=babelHelpers.inherits(l,c('BasePhotoUploader'));k=j&&j.prototype;function l(m,n,o,p){'use strict';k.constructor.call(this,m,o);this.$MercuryPhotoUploader1=m.id;this.$MercuryPhotoUploader2=false;c('Arbiter').subscribe('PhotosMultiUploadInput/loaded/'+m.id,function(){this.$MercuryPhotoUploader2=true;}.bind(this));c('Arbiter').subscribe('MercuryPhotoUploader/initUploadButton/'+m.id,function(){var q=c('DOM').scry(n,'input[type="file"]')[0];if(!q)q=c('DOM').create('input',{accept:'image/*',type:'file',className:"_n",name:'composer_unpublished_photo[]',multiple:1});var r=c('Parent').bySelector(n,"._9_h"),s=new (c('FileInput'))(r,c('DOM').find(r,"._214"),q);s.subscribe('change',c('PhotosMultiUploadInput').doFileUpload.bind(null,m.id,s));});c('Arbiter').subscribe('MercuryPhotoUploader/registerPhotoMenu/'+m.id,function(q,r){var s=r.menu.getRoot();r.menu.setContext(n);var t=c('DOM').scry(s,"._d2p"),u=t&&t[0];u&&c('Event').listen(u,'click',function(){c('VaultEditableGrid').getInstance(m.id).showDialog(u,c('VaultEditableGrid').VAULT_IMAGE);this.setCurrentMethod(c('PUWMethods').VAULT);this.inform('selection-start',{method:c('PUWMethods').VAULT});}.bind(this));c('Event').listen(n,'click',function(){if(!this.$MercuryPhotoUploader2)return;if(!r.menu.isShown()){var w=c('DOM').scry(r.menu.getContentRoot(),'li');this.inform('menu-show');r.menu.show();if(w)c('Focus').setWithoutOutline(w[0]);}else{this.inform('menu-hide');r.menu.hide();}}.bind(this));c('Event').listen(document.documentElement,'click',function(event){if(!c('DOM').contains(n,event.getTarget())&&!c('DOM').contains(u,event.getTarget())){if(r.menu.isShown())this.inform('menu-hide');r.menu.hide();}}.bind(this));var v=c('DOM').find(s,"._9_h");c('Event').listen(v,'click',function(){this.setCurrentMethod(c('PUWMethods').FILE_SELECTOR);this.inform('selection-start',{method:c('PUWMethods').FILE_SELECTOR});}.bind(this));}.bind(this));p&&c('PhotosMultiUploadInput').initDragDrop(m.id,p);}l.prototype.uploadPastedFile=function(m){'use strict';c('PhotosMultiUploadInput').onFilesDrop(this.$MercuryPhotoUploader1,[m]);};l.prototype.addCachedPhotos=function(m){'use strict';c('AsyncRequest').post('/ajax/vault/selected.php',{max_select:10,grid_id:this.$MercuryPhotoUploader1,source:'messenger',image_ids:m});};Object.assign(l,{initUploadButton:function m(n){c('Arbiter').inform('MercuryPhotoUploader/initUploadButton/'+n,{},c('Arbiter').BEHAVIOR_PERSISTENT);},registerPhotoMenu:function m(n,o){c('Arbiter').inform('MercuryPhotoUploader/registerPhotoMenu/'+n,{menu:o},c('Arbiter').BEHAVIOR_PERSISTENT);}});f.exports=l;}),null);
__d('MercuryShareLinkUploader',['ArbiterMixin','AsyncRequest','CSS','DOM','Event','Form','URLScraper','WebMessengerEvents','mixin','isEmpty'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(){'use strict';i.constructor.call(this);this.__initialize.apply(this,arguments);}j.prototype.__initialize=function(k,l,m,n,o){'use strict';this.$MercuryShareLinkUploader1=k;this.$MercuryShareLinkUploader2=l;this.$MercuryShareLinkUploader3=m;this.$MercuryShareLinkUploader4=o;this.$MercuryShareLinkUploader5=false;this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7=null;c('Event').listen(n,'click',this.close.bind(this));c('Event').listen(o,'keyup',function(){!o.value.length&&this.$MercuryShareLinkUploader8.enable();}.bind(this));this.$MercuryShareLinkUploader8=new (c('URLScraper'))(o);this.$MercuryShareLinkUploader8.subscribe('match',function(p,q){this.loadShare(q&&q.url);}.bind(this));};j.prototype.getAttachData=function(){'use strict';return this.loadAttachData(this.$MercuryShareLinkUploader5,this.$MercuryShareLinkUploader1,this.$MercuryShareLinkUploader4);};j.prototype.getShareDataFromStage=function(k,l){'use strict';var m=c('Form').serialize(l),n=m.attachment&&m.attachment.params;if(!n)return null;if(n instanceof Object){var o=[];o.push(n[0]);o.push(n[1]);n=o;}return {params:n,type:m.attachment.type};};j.prototype.loadAttachData=function(k,l,m,n){'use strict';if(k){var o=c('Form').serialize(l),p=o.attachment&&o.attachment.params,q=o.link_metrics?o.link_metrics.no_image:true;if(!p||c('isEmpty')(p))return null;var r=n?n():m.value;if(r.indexOf(p.url)===-1)return o;if(!p.summary&&!p.favicon&&q&&p.title&&p.url&&p.url.substr(0,p.title.length)===p.title)return null;return o;}return null;};j.prototype.check=function(){'use strict';this.$MercuryShareLinkUploader8.check();};j.prototype.close=function(){'use strict';this.$MercuryShareLinkUploader9();this.$MercuryShareLinkUploader8.disable();this.inform('closed');};j.prototype.clear=function(){'use strict';this.$MercuryShareLinkUploader9();this.$MercuryShareLinkUploader8.enable();};j.prototype.enable=function(){'use strict';this.$MercuryShareLinkUploader8.enable();};j.prototype.disable=function(){'use strict';this.$MercuryShareLinkUploader8.disable();};j.prototype.loadShare=function(k){'use strict';this.$MercuryShareLinkUploader6=k;this.$MercuryShareLinkUploader7&&this.$MercuryShareLinkUploader7.abort();this.$MercuryShareLinkUploader7=new (c('AsyncRequest'))().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:k}).setHandler(this.$MercuryShareLinkUploader10.bind(this).bind(null,k)).setStatusElement(this.$MercuryShareLinkUploader3);this.$MercuryShareLinkUploader7.send();this.inform('link-detected');};j.prototype.$MercuryShareLinkUploader10=function(k,l){'use strict';if(this.$MercuryShareLinkUploader6!==k)return;this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7=null;c('CSS').show(this.$MercuryShareLinkUploader1);c('DOM').empty(this.$MercuryShareLinkUploader2);c('DOM').setContent(this.$MercuryShareLinkUploader2,l.payload);this.$MercuryShareLinkUploader5=true;if(!this.getAttachData()){this.close();return;}c('WebMessengerEvents').detailDOMChanged();};j.prototype.$MercuryShareLinkUploader9=function(){'use strict';c('CSS').hide(this.$MercuryShareLinkUploader1);this.$MercuryShareLinkUploader5=false;this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7&&this.$MercuryShareLinkUploader7.abort();this.$MercuryShareLinkUploader7=null;this.$MercuryShareLinkUploader8.reset();c('WebMessengerEvents').detailDOMChanged();};f.exports=j;}),null);
__d('ChatEmployeeAwayWarning',['MercuryIDs','MercuryParticipants','MercuryViewer'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={updateEmployeeAwayWarning:function i(j,k,l){c('MercuryParticipants').get(c('MercuryViewer').getID(),function(m){var n=m.employee;if(n)c('MercuryParticipants').getMulti(j.participants,function(o){var p=false,q=c('MercuryIDs').getUserIDFromThreadID(j.thread_id);if(!q)return;var r='fbid:'+q;for(var s in o)if(r==o[s].id&&o[s].is_employee_away)p=true;if(p){k();}else l();});});}};f.exports=h;}),null);
__d('ChatPhotoForwardButton.react',['cx','fbt','Link.react','MessagingForwardAttachmentDialog.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').PureComponent);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return n=(o=k.constructor).call.apply(o,[this].concat(q)),this.state={dialogShown:false},this.$ChatPhotoForwardButton1=function(){if(!this.state.dialogShown)return null;var s=i._("\u4ee5\u55ae\u7368\u8a0a\u606f\u8f49\u5bc4");return (c('React').createElement(c('MessagingForwardAttachmentDialog.react'),{attachmentID:this.props.photoIDs[0],onClose:this.$ChatPhotoForwardButton3,shown:this.state.dialogShown,title:s}));}.bind(this),this.$ChatPhotoForwardButton2=function(){this.setState({dialogShown:true});}.bind(this),this.$ChatPhotoForwardButton3=function(){this.setState({dialogShown:false});}.bind(this),n;}m.prototype.render=function(){return c('React').createElement('div',null,this.$ChatPhotoForwardButton1(),c('React').createElement(c('Link.react'),babelHelpers['extends']({},this.props,{onClick:this.$ChatPhotoForwardButton2,ref:'forwardButton',className:"_2t5q"+(!this.props.isFromViewer?' '+"_1_47":'')+(this.props.isFromViewer?' '+"_1_48":'')}),c('React').createElement('div',{className:"_2t5t"})));};m.propTypes={photoIDs:l.arrayOf(l.string).isRequired,isFromViewer:l.bool.isRequired};f.exports=m;}),null);
__d('MessengerFromViewerUtils',['CurrentUser','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return i.author===c('MercuryIDs').getParticipantIDFromUserID(c('CurrentUser').getID());}f.exports={isFromViewer:h};}),null);
__d('MNCommerceDialogStateActions',['MessengerDispatcher','MNCommerceActionTypes'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={showDialog:function i(j,k){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').DIALOG.SHOW,dialogContainer:j,state:k});},hideDialog:function i(){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').DIALOG.HIDE});}};f.exports=h;}),null);
__d('MNCommercePromotionStateActions',['MessengerDispatcher','MNCommerceActionTypes'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={stateLoaded:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').PROMOTION_STATE.LOADED,state:j});},stateLoadError:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').PROMOTION_STATE.LOAD_ERROR,pageID:j});},stateReload:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').PROMOTION_STATE.RELOAD,pageID:j});}};f.exports=h;}),null);
__d('MessengerRadioButton.react',['cx','React','XUIRadioInput.react'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').PureComponent);j=i&&i.prototype;k.prototype.render=function(){return (c('React').createElement(c('XUIRadioInput.react'),babelHelpers['extends']({},this.props,{className:"__rm"})));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('MessengerRadioList.react',['invariant','InputLabel.react','MessengerRadioButton.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;i=babelHelpers.inherits(n,c('React').Component);j=i&&i.prototype;function n(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return p=(q=j.constructor).call.apply(q,[this].concat(s)),this.$MessengerRadioListItem1=function(event){!(event.target instanceof HTMLInputElement)?h(0):void 0;this.props.onSelect&&this.props.onSelect(event.target.value);}.bind(this),p;}n.prototype.render=function(){return c('React').createElement('li',{className:this.props.className},c('React').createElement(c('InputLabel.react'),{display:'inline'},c('React').createElement(c('MessengerRadioButton.react'),{checked:this.props.selectedValue===this.props.value,disabled:!!this.props.disabled,name:this.props.name,onChange:this.$MessengerRadioListItem1,value:this.props.value}),c('React').createElement('label',null,this.props.children)));};n.propTypes={disabled:m.bool,name:m.string,onSelect:m.func,selectedValue:m.any,value:m.any};k=babelHelpers.inherits(o,c('React').Component);l=k&&k.prototype;o.prototype.render=function(){var p=c('React').Children.map(this.props.children,function(q){return c('React').cloneElement(q,{name:this.props.name,onSelect:this.props.onValueChange,selectedValue:this.props.selectedValue});},this);return c('React').createElement('ul',babelHelpers['extends']({},this.props,{name:null}),p);};function o(){k.apply(this,arguments);}o.propTypes={name:m.string,onValueChange:m.func,selectedValue:m.any};o.Item=n;f.exports=o;}),null);
__d('MessengerHotLikeSVG.react',['cssVar','cx','fbt','React','joinClasses','uniqueID'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes,n='transparent',o=j._("\u8c4e\u8d77\u5927\u62c7\u6307\u7684\u624b\u52e2");k=babelHelpers.inherits(p,c('React').Component);l=k&&k.prototype;function p(){var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return q=(r=l.constructor).call.apply(r,[this].concat(t)),this.state={titleId:c('uniqueID')()},q;}p.prototype.render=function(){var q=this.props.color||"#0084ff";return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,"_1i1j")},c('React').createElement('svg',{'aria-labelledby':this.state.titleId,height:'100%',role:'img',version:'1.1',viewBox:'0 0 381 400',width:'100%',x:'0px',y:'0px'},c('React').createElement('title',{id:this.state.titleId},o),c('React').createElement('g',null,c('React').createElement('g',null,c('React').createElement('path',{d:'M0,399.8h86.4V160.8H0V399.8z M381,220.7c0-13.6-7.4-25.5-18.5-31.8c8.8-6.6,14.5-17.4,14.5-29.3 c0-20.1-16.4-36.8-36.5-36.8H217c20.4-106.5-31.3-128.2-51.7-123c-12.3,3.1-13.6-0.3-11.4,24.2l3.4,42.7c0.3,3.5,0,7.2-0.8,10.8 c-0.8,3.6-2.7,6.9-4.6,10L106.8,160v208.7h195.3v-1.2c19.2-1.1,34.5-17.4,34.5-36.9c0-6.1-1.5-12-4.1-17 c17.3-2.8,30.4-18,30.4-36.1c0-8.2-2.7-15.9-7.4-22C370.1,250.8,381,237,381,220.7z',fill:q,stroke:n,strokeLinecap:'round',strokeWidth:'5%'}))))));};p.propTypes={color:m.string};f.exports=p;}),null);
__d('MessengerHotLikePreview.react',['cx','Animation','EmojiLikeConstants','EmojiLikeCxData','HotLikeSound','MercuryConfig','MessengerHotLikePreviewEvents','MessengerHotLikeSVG.react','MessengerHotLikeUtils','React','ReactDOM','StickerConstants','SubscriptionsHandler'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return m=(n=j.constructor).call.apply(n,[this].concat(p)),this.$MessengerHotLikePreview5=function(){this.$MessengerHotLikePreview6=new (c('Animation'))(c('ReactDOM').findDOMNode(this));this.$MessengerHotLikePreview7(-2,2,150,1000);this.$MessengerHotLikePreview7(-4,4,100,1000);this.$MessengerHotLikePreview7(-10,10,75,1000);this.$MessengerHotLikePreview6.go();}.bind(this),this.$MessengerHotLikePreview7=function(r,s,t,u){var v=Math.floor(u/t),w=null;for(var x=0;x<v;x++){w=x%2?r:s;this.$MessengerHotLikePreview6.to('rotateZ',w).duration(t).checkpoint();}}.bind(this),this.$MessengerHotLikePreview2=function(r,s){var t=s?c('MessengerHotLikePreviewEvents').FINISH_EMOJI_ANIMATION:c('MessengerHotLikePreviewEvents').FINISH_ANIMATION;if(this.$MessengerHotLikePreview8)return;this.$MessengerHotLikePreview8=true;var u=Date.now()-this.props.since,v=null;if(this.props.customLike)v=c('MessengerHotLikeUtils').getEmojiSizeForTime(u);var w=c('MessengerHotLikeUtils').getStickerIDForTime(u);c('HotLikeSound').snap(w);var x=c('MessengerHotLikeUtils').getMetadataForHotLike(v||w);this.$MessengerHotLikePreview6.stop();var y=30,z=-10;if(w===c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID){y=0;z=0;}this.$MessengerHotLikePreview4.stop().to('width',x.width*1.2).to('height',x.height*1.2).to('rotateZ',y).duration(100).checkpoint().to('width',x.width*.9).to('height',x.height*.9).to('rotateZ',z).duration(100).checkpoint().to('width',x.width).to('height',x.height).to('rotateZ',0).duration(100).ondone(function(){c('MessengerHotLikePreviewEvents').emit(t,r,w,v);}).go();}.bind(this),this.$MessengerHotLikePreview3=function(r){c('HotLikeSound').pop();this.$MessengerHotLikePreview4.stop().to('width',0).to('height',0).duration(100).ondone(function(){c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').REMOVE,r);}).go();}.bind(this),m;}l.prototype.componentDidMount=function(){this.$MessengerHotLikePreview1=new (c('SubscriptionsHandler'))();this.$MessengerHotLikePreview1.addSubscriptions(c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').STOP,this.$MessengerHotLikePreview2),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').STOP_EMOJI,this.$MessengerHotLikePreview2),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').POP,this.$MessengerHotLikePreview3));c('HotLikeSound').start();this.$MessengerHotLikePreview4=new (c('Animation'))(c('ReactDOM').findDOMNode(this)).to('width',80).to('height',80).duration(3000).go();this.$MessengerHotLikePreview5();};l.prototype.componentWillUnmount=function(){this.$MessengerHotLikePreview1&&this.$MessengerHotLikePreview1.release();};l.prototype.render=function(){if(this.props.customLike){var m=this.props.customLike;if(c('MercuryConfig').MessengerNewEmojiGK)var n=c('EmojiLikeCxData').getNewEmojiData(m.emoji,c('EmojiLikeConstants').size.LARGE);var o=n?n.url:this.props.customLike.large;if(m.uri)o=m.uri;return c('React').createElement('div',{className:"_4a9g _383m",style:{backgroundImage:'url('+o+')'}});}return c('React').createElement('div',{className:"_4a9g _576q"},c('React').createElement(c('MessengerHotLikeSVG.react'),{color:this.props.customColor}));};l.propTypes={customLike:k.object,since:k.number};f.exports=l;}),null);
__d('MNCommerceAttachmentConstants',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={XLARGE_IMAGE_DIMENSION:72,LARGE_IMAGE_DIMENSION:60,SMALL_IMAGE_DIMENSION:32,SINGLE_IMAGE_HEIGHT:108,BUBBLE_PADDING:6,IMAGE_HEIGHT:{CHAT:108,WEB_INBOX:130},UNLINK_ERROR_DIALOG:{WIDTH:300},DIALOG:{WIDTH:445,PADDING:12},MDOTCOMDIALOG:{WIDTH:495},ORDER_DETAIL:{SUB_TOTAL:'subTotal',SHIPPING:'shippingCost',TAX:'tax',TOTAL:'totalCost'}};f.exports=h;}),null);
__d('MNCommerceDialog.react',['cx','CurrentEnvironment','LayerFadeOnHide','LayerHideOnEscape','MNCommerceAttachmentConstants','MessengerDialog.react','React','XUIDialog.react','emptyFunction','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MNCommerceDialog',propTypes:{onToggle:i.func,shown:i.bool,width:i.number.isRequired},getDefaultProps:function k(){return {onToggle:c('emptyFunction'),repositionOnUpdate:true,shown:true,width:c('CurrentEnvironment').messengerdotcom?c('MNCommerceAttachmentConstants').MDOTCOMDIALOG.WIDTH:c('MNCommerceAttachmentConstants').DIALOG.WIDTH};},componentDidUpdate:function k(){if(this.props.repositionOnUpdate)setTimeout(function(){if(this.isMounted()&&this.refs.dialog&&this.refs.dialog.layer)this.refs.dialog.layer.updatePosition();}.bind(this),0);},render:function k(){var l=c('CurrentEnvironment').messengerdotcom,m=l?c('MessengerDialog.react'):c('XUIDialog.react');return (c('React').createElement(m,babelHelpers['extends']({behaviors:{LayerFadeOnHide:c('LayerFadeOnHide'),LayerHideOnEscape:c('LayerHideOnEscape')}},this.props,{className:c('joinClasses')(this.props.className,l?"_3rx0":''),ref:'dialog'}),this.props.children));}});f.exports=j;}),null);
__d('MNCommerceDialogBody.react',['CurrentEnvironment','MessengerDialogBody.react','React','XUIDialogBody.react'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.prototype.render=function(){var k=c('CurrentEnvironment').messengerdotcom,l=k?c('MessengerDialogBody.react'):c('XUIDialogBody.react');return (c('React').createElement(l,this.props,this.props.children));};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('MNCommerceDialogTitle.react',['CurrentEnvironment','MessengerDialogHeader.react','React','XUIDialogTitle.react'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.prototype.render=function(){var k=c('CurrentEnvironment').messengerdotcom,l=k?c('MessengerDialogHeader.react'):c('XUIDialogTitle.react');return (c('React').createElement(l,this.props,this.props.children));};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('MNCommerceDetailsDialog.react',['cx','fbt','React','MNCommerceDialog.react','MNCommerceDialogBody.react','MNCommerceDialogTitle.react','XUISpinner.react','XUIButton.react'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return n=(o=k.constructor).call.apply(o,[this].concat(q)),this.$MNCommerceDetailsDialog3=function(){return this.props.title?c('React').createElement(c('MNCommerceDialogTitle.react'),null,this.props.title):null;}.bind(this),this.$MNCommerceDetailsDialog2=function(){return (c('React').createElement('div',{className:"_4y9b"},c('React').createElement('p',{className:"_4y9c"},i._("\u5f88\u62b1\u6b49\uff0c\u6709\u4e9b\u5730\u65b9\u51fa\u932f\u4e86")),c('React').createElement('p',{className:"_4y9d"},this.props.errorMessage),c('React').createElement(c('XUIButton.react'),{onClick:this.props.onTryAgain,label:i._("\u518d\u8a66\u4e00\u6b21")})));}.bind(this),this.$MNCommerceDetailsDialog1=function(){return (c('React').createElement('div',{className:"_4y9e"},c('React').createElement(c('XUISpinner.react'),{background:'light',size:'large',paused:false})));},n;}m.prototype.render=function(){var n=null;if(this.props.loading){n=this.$MNCommerceDetailsDialog1();}else if(this.props.error){n=this.$MNCommerceDetailsDialog2();}else n=this.props.children;return c('React').createElement(c('MNCommerceDialog.react'),{className:this.props.className,modal:true,onToggle:this.props.onToggle,shown:this.props.shown},this.$MNCommerceDetailsDialog3(),c('React').createElement(c('MNCommerceDialogBody.react'),{useCustomPadding:true},n));};m.propTypes={error:l.object,errorMessage:l.string,loading:l.bool.isRequired,onToggle:l.func,onTryAgain:l.func,title:l.string,shown:l.bool.isRequired};m.defaultProps={shown:false};f.exports=m;}),null);
__d('MNCommerceButton.react',['CurrentEnvironment','MessengerDialogButton.react','React','XUIButton.react'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.prototype.render=function(){var k=c('CurrentEnvironment').messengerdotcom,l=k?c('MessengerDialogButton.react'):c('XUIButton.react'),m=this.props.type;if(!m)m=this.props.type==='confirm'?'primary':'secondary';var n=k?'default':this.props.use,o=babelHelpers['extends']({},this.props,{type:m,use:n});return (c('React').createElement(l,o,this.props.children));};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('MNCommerceDialogFooter.react',['cx','CurrentEnvironment','MessengerDialogFooter.react','React','XUIDialogFooter.react','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){var l=c('CurrentEnvironment').messengerdotcom,m=l?c('MessengerDialogFooter.react'):c('XUIDialogFooter.react'),n=void 0,o=this.props.children;if(l){n=c('React').Children.count(this.props.children);o=c('React').Children.map(this.props.children,function(p,q){if(!p)return null;return c('React').cloneElement(p,{className:c('joinClasses')(p.props.className,"_4ec0"),type:q===0&&n===2?'secondary':'primary'});});}return (c('React').createElement(m,this.props,o));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('MNCommercePromotionManageBlockDialog.react',['fbt','CurrentEnvironment','Link.react','MessengerRadioList.react','MNCommerceButton.react','MNCommerceDetailsDialog.react','MNCommerceDialogBody.react','MNCommerceDialogFooter.react','MNCommerceDialogTitle.react','MNCommerceBlockTypeJSInstance','React','URI','WorkModeConfig','XUIRadioList.react'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('MessengerRadioList.react').Item,l=c('XUIRadioList.react').Item,m=c('React').PropTypes;i=babelHelpers.inherits(n,c('React').Component);j=i&&i.prototype;function n(p,q){j.constructor.call(this,p,q);o.call(this);this.state=this.$MNCommercePromotionManageBlockDialog1();}n.prototype.componentWillReceiveProps=function(p){this.setState(this.$MNCommercePromotionManageBlockDialog1(p));};n.prototype.render=function(){var p=this.props.merchantName||'',q=h._("\u7ba1\u7406{label for merchant name}\u50b3\u4f86\u7684\u8a0a\u606f",[h.param('label for merchant name',p)]),r=h._("\u53d6\u6d88"),s=h._("\u78ba\u8a8d"),t=h._("\u7121\u6cd5\u986f\u793a\u7ba1\u7406\u9078\u9805\u3002"),u=c('WorkModeConfig').is_work_user?new (c('URI'))('https://facebook.com/help/work/1731361900459513').setSubdomain(c('WorkModeConfig').company_subdomain):new (c('URI'))('https://www.facebook.com/help/389645087895231'),v=c('React').createElement(c('Link.react'),{href:u,target:'_blank'},h._("\u77ad\u89e3\u8a73\u60c5"));return (c('React').createElement(c('MNCommerceDetailsDialog.react'),babelHelpers['extends']({errorMessage:t,onToggle:this.props.onToggle,shown:this.props.shown},this.props),c('React').createElement(c('MNCommerceDialogTitle.react'),{showCloseButton:true},q),c('React').createElement(c('MNCommerceDialogBody.react'),null,this.$MNCommercePromotionManageBlockDialog2()),c('React').createElement(c('MNCommerceDialogFooter.react'),{leftContent:v},c('React').createElement(c('MNCommerceButton.react'),{label:r,onClick:this.props.onCancelButtonClick,use:'default'}),c('React').createElement(c('MNCommerceButton.react'),{label:s,onClick:this.$MNCommercePromotionManageBlockDialog3,use:'confirm'}))));};n.propTypes={isAllBlocked:m.bool,isPromotionBlocked:m.bool,error:m.object,loading:m.bool.isRequired,merchantName:m.string,onCancelButtonClick:m.func,onConfirmButtonClick:m.func.isRequired,pageID:m.string};var o=function p(){this.$MNCommercePromotionManageBlockDialog1=function(q){var r=q||this.props,s=c('MNCommerceBlockTypeJSInstance').ALL;if(r.isAllBlocked){s=c('MNCommerceBlockTypeJSInstance').NONE;}else if(r.isPromotionBlocked)s=c('MNCommerceBlockTypeJSInstance').PROMOTION;return {type:s};}.bind(this);this.onTypeChange=function(q){this.setState({type:q});}.bind(this);this.$MNCommercePromotionManageBlockDialog2=function(){var q=c('CurrentEnvironment').messengerdotcom,r=q?c('MessengerRadioList.react'):c('XUIRadioList.react'),s=q?k:l;return (c('React').createElement(r,{selectedValue:this.state.type,onValueChange:this.onTypeChange},c('React').createElement(s,{value:c('MNCommerceBlockTypeJSInstance').ALL},h._("\u63a5\u6536\u6240\u6709\u8a0a\u606f")),c('React').createElement(s,{value:c('MNCommerceBlockTypeJSInstance').PROMOTION},h._("\u5c01\u9396\u8d0a\u52a9\u8a0a\u606f")),c('React').createElement(s,{value:c('MNCommerceBlockTypeJSInstance').NONE},h._("\u5c01\u9396\u6240\u6709\u8a0a\u606f"))));}.bind(this);this.$MNCommercePromotionManageBlockDialog3=function(q){var r=this.props;r.onToggle(false);if(!r.onConfirmButtonClick)return;var s=r.pageID;r.onConfirmButtonClick(s,this.state.type);}.bind(this);};f.exports=n;}),null);
__d("XMNCommercePromotionStateController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messages\/commerce\/promotion\/state\/",{page_id:{type:"String",required:true}});}),null);
__d('MNCommercePromotionStateDataManager',['AsyncRequest','MNCommercePromotionStateActions','XMNCommercePromotionStateController'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();h.prototype.fetchPromotionState=function(i){var j=c('XMNCommercePromotionStateController').getURIBuilder().setString('page_id',i).getURI();new (c('AsyncRequest'))().setURI(j).setHandler(this.$MNCommercePromotionStateDataManager1).setErrorHandler(this.$MNCommercePromotionStateDataManager2).send();};h.prototype.$MNCommercePromotionStateDataManager1=function(i){var j=i.getRequest().uri.getQueryData(),k=j.page_id;i.payload.pageID=k;c('MNCommercePromotionStateActions').stateLoaded(i.payload);};h.prototype.$MNCommercePromotionStateDataManager2=function(i){var j=i.getRequest().uri.getQueryData(),k=j.page_id;c('MNCommercePromotionStateActions').stateLoadError(k);};function h(){}f.exports=new h();}),null);
__d('MNCommercePromotionStateStore',['Cache','FluxStore','LoadObject','MessengerDispatcher','MNCommerceActionTypes','MNCommerceCacheTimeoutLimits','MNCommercePromotionStateDataManager'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('MessengerDispatcher'));this.$MNCommercePromotionStateStore1=new (c('Cache'))();}j.prototype.__onDispatch=function(k){var l=k.type,m=k.pageID||k.state&&k.state.pageID;switch(l){case c('MNCommerceActionTypes').PROMOTION_STATE.LOADED:var n=k.state;this.$MNCommercePromotionStateStore1.set(m,c('LoadObject').empty().setValue(n),null,c('MNCommerceCacheTimeoutLimits').SUCCESS_TIMEOUT);this.__emitChange();break;case c('MNCommerceActionTypes').PROMOTION_STATE.LOAD_ERROR:this.$MNCommercePromotionStateStore1.set(m,c('LoadObject').empty().setError(new Error('Unable to load permissions for: '+m)),null,c('MNCommerceCacheTimeoutLimits').ERROR_TIMEOUT);this.__emitChange();break;case c('MNCommerceActionTypes').PROMOTION_STATE.RELOAD:if(m){this.$MNCommercePromotionStateStore1.set(m,c('LoadObject').loading());c('MNCommercePromotionStateDataManager').fetchPromotionState(m);}this.__emitChange();break;}};j.prototype.getPromotionState=function(k){if(k&&!this.$MNCommercePromotionStateStore1.has(k)){this.$MNCommercePromotionStateStore1.set(k,c('LoadObject').loading().setValue({pageID:k}));c('MNCommercePromotionStateDataManager').fetchPromotionState(k);}return this.$MNCommercePromotionStateStore1.get(k)||c('LoadObject').empty();};f.exports=new j();}),null);
__d('MNCommercePromotionManageBlockDialogContainer.react',['MNCommerceDialogStateActions','MNCommerceDialogStateStore','MNCommercePromotionManageBlockDialog.react','MNCommercePromotionStateActions','MNCommercePromotionStateStore','PureStoreBasedStateMixin','React'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').createClass({displayName:'MNCommercePromotionManageBlockDialogContainer',mixins:[c('PureStoreBasedStateMixin')(c('MNCommercePromotionStateStore'))],statics:{calculateState:function i(){var j=c('MNCommerceDialogStateStore').getState(),k=null;if(j)k=j.pageID;var l=c('MNCommercePromotionStateStore').getPromotionState(k);return {shown:!!j,loading:l.isLoading(),onConfirmButtonClick:j&&j.onConfirmButtonClick,pageID:k,promotionState:l.getValue(),error:l.getError()};}},render:function i(){var j=this.state.promotionState;return (c('React').createElement(c('MNCommercePromotionManageBlockDialog.react'),{error:this.state.error,isAllBlocked:j&&j.is_all_blocked,isPromotionBlocked:j&&j.is_promotion_blocked,loading:this.state.loading,merchantName:j&&j.name,onCancelButtonClick:this._hideDialog,onToggle:this._onToggle,pageID:this.state.pageID,onTryAgain:this._onTryAgainClick,onConfirmButtonClick:this.state.onConfirmButtonClick,shown:this.state.shown}));},_onToggle:function i(j){if(!j)this._hideDialog();},_onTryAgainClick:function i(){c('MNCommercePromotionStateActions').stateReload(this.state.pageID);},_hideDialog:function i(){c('MNCommerceDialogStateActions').hideDialog();}});f.exports=h;}),null);
__d('MercuryShareAttachmentReactShape',['React'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=h.shape({share_id:h.string,description:h.string,media:h.shape({image:h.string,image_size:h.shape({height:h.number,width:h.number}),duration:h.number,playable:h.bool,source:h.string}),source:h.string,style_list:h.arrayOf(h.string),subattachments:h.array,target:h.object,title:h.string,properties:h.object,uri:h.string,action_links:h.array}).isRequired;f.exports=i;}),null);
__d('MessengerMomentsAppSnippet.react',['cx','fbt','ix','Image.react','MercuryShareAttachmentReactShape','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=this.props.attachment;if(!o||!o.target)return null;return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/messaging/docs/generic.png')}),o.target.snippet));};function n(){k.apply(this,arguments);}n.propTypes={attachment:c('MercuryShareAttachmentReactShape')};f.exports=n;}),null);
__d("XMNCommercePromotionBlockController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messages\/commerce\/promotion\/block\/",{page_id:{type:"String",required:true},type:{type:"String",required:true}});}),null);
__d('MNCommercePromotionBlockDataManager',['AsyncRequest','MNCommercePromotionStateActions','XMNCommercePromotionBlockController'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();h.prototype.block=function(i,j){var k=c('XMNCommercePromotionBlockController').getURIBuilder().setString('page_id',i).setString('type',j).getURI();new (c('AsyncRequest'))().setURI(k).setHandler(this.$MNCommercePromotionBlockDataManager1).setErrorHandler(this.$MNCommercePromotionBlockDataManager2).send();};h.prototype.$MNCommercePromotionBlockDataManager1=function(i){var j=i.getRequest().uri.getQueryData(),k=j.page_id;c('MNCommercePromotionStateActions').stateReload(k);};h.prototype.$MNCommercePromotionBlockDataManager2=function(i){var j=i.getRequest().uri.getQueryData(),k=j.page_id;c('MNCommercePromotionStateActions').stateLoadError(k);};function h(){}f.exports=new h();}),null);
__d('MercuryThreadMuter',['AsyncDialog','AsyncRequest','DOM','MercuryThreadInfo'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={showMuteChangeDialog:function i(j,k){c('AsyncDialog').send(new (c('AsyncRequest'))('/ajax/mercury/mute_thread_dialog.php').setRelativeTo(k),function(l){l.subscribe('confirm',function(){this.hide();var m;c('DOM').scry(this.getRoot(),'input[type="radio"]').forEach(function(n){if(n.checked)m=n.value;});m=h.convertRawMuteSetting(m);e(['MercuryThreadActions'],function(n){n.get().updateMuteSetting(j,m);});}.bind(l));});},convertRawMuteSetting:function i(j){switch(j){case 'always':return -1;case '30minutes':return 1800;case '1hour':return 3600;case '8hours':return 8*3600;case '24hours':return 24*3600;case '8am':var k,l=new Date(),m=new Date();m.setHours(8);m.setMinutes(0);m.setSeconds(0);if(m>l){k=m-l;}else k=m-l+24*3600*1000;return k/1000;default:return 0;}}};f.exports=h;}),null);
__d('FBRTCVideoCallButtonManagerImpl',['invariant','BanzaiLogger','CurrentUser','FBRTCCallabilityStore','FBRTCCore','FBRTCLogger','MercuryIDs','MercuryParticipants','Tooltip'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={onCallClicked:function j(k,l){if(l===c('FBRTCLogger').Trigger.WEB_MESSENGER)c('BanzaiLogger').log('VideoCallLoggerConfig',{event:'web_messenger_call_click'});var m=c('MercuryIDs').getUserIDFromThreadID(k);!m?h(0):void 0;c('FBRTCCore').startOutgoingCall(m,l,false);},isVideoCallableThread:function j(k){if(k){var l=c('MercuryIDs').getUserIDFromThreadID(k);if(l&&l!==c('CurrentUser').getID())return true;}return false;},updateVideoCallButton:function j(k,l){if(!l||!i.isVideoCallableThread(l))return;var m=c('MercuryIDs').getUserIDFromThreadID(l);!m?h(0):void 0;k.disabled=!c('FBRTCCallabilityStore').isCallable(m);c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(m),function(n){c('Tooltip').set(k,c('FBRTCCallabilityStore').callButtonTooltip(m,n.short_name));});}};f.exports=i;}),null);
__d('MercuryDrafts',['CacheStorage','MercurySingletonProvider','isEmpty'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();h.getForFBID=function(j){'use strict';return i.getForFBID(j);};h.get=function(){'use strict';return i.get();};function h(j){'use strict';this.$MercuryDrafts1=j;this.$MercuryDrafts2=new (c('CacheStorage'))('localstorage','mercury-drafts:'+this.$MercuryDrafts1);}h.prototype.saveDraft=function(j,k){'use strict';if(this.isMessageEmpty(k)){this.removeDraft(j);}else this.$MercuryDrafts2.set(j,this.$MercuryDrafts3(j,k));};h.prototype.removeDraft=function(j){'use strict';this.$MercuryDrafts2.remove(j);};h.prototype.getDraft=function(j){'use strict';var k=this.$MercuryDrafts2.get(j,{});return k.message;};h.prototype.isMessageEmpty=function(j){'use strict';return c('isEmpty')(j)||c('isEmpty')(j.body)&&c('isEmpty')(j.content_attachment)&&c('isEmpty')(j.raw_attachments)&&c('isEmpty')(j.photo_fbids)&&c('isEmpty')(j.image_ids);};h.prototype.$MercuryDrafts3=function(j,k){'use strict';return {thread_id:j,message:k};};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryDraftsController',['MercuryDrafts','Input','MercurySingletonProvider','isEmpty'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryDrafts').get();i.getForFBID=function(k){'use strict';return j.getForFBID(k);};i.get=function(){'use strict';return j.get();};function i(k){'use strict';this.$MercuryDraftsController1;}i.prototype.clearDraft=function(k){'use strict';if(this.canSaveDrafts(k))h.removeDraft(k);};i.prototype.saveDraft=function(k,l,m,n,o){'use strict';if(!this.canSaveDrafts(k))return;var p={body:c('Input').getValue(l)};if(m&&!c('isEmpty')(m.getAttachments())){p.has_attachment=true;p.raw_attachments=m.getAttachments();}if(m&&!c('isEmpty')(m.getImageFiles())){p.has_attachment=true;p.image_ids=m.getImageFiles();}if(o&&!c('isEmpty')(o.getSelectedFBIDs())){p.has_attachment=true;p.photo_fbids=o.getSelectedFBIDs();}if(n.getAttachData()){p.has_attachment=true;p.content_attachment=n.getAttachData();}h.saveDraft(k,p);};i.prototype.loadDraft=function(k,l,m,n,o){'use strict';if(!this.canSaveDrafts(k)||this.$MercuryDraftsController2(l,m,n,o))return;var p=h.getDraft(k);if(!c('isEmpty')(p)){if(p.body){l.focus();c('Input').setValue(l,p.body);}if(m&&!c('isEmpty')(p.raw_attachments))m.addCachedAttachments(p.raw_attachments);if(m&&!c('isEmpty')(p.image_ids))m.addCachedImageFiles(p.image_ids);if(!c('isEmpty')(p.content_attachment))n.loadShare(p.content_attachment.attachment.params.url);if(o&&!c('isEmpty')(p.photo_fbids))o.addCachedPhotos(p.photo_fbids);this.clearDraft(k);}};i.prototype.canSaveDrafts=function(k){'use strict';return !!k;};i.prototype.$MercuryDraftsController2=function(k,l,m,n){'use strict';return !c('Input').isEmpty(k)||l&&!c('isEmpty')(l.getAttachments())||l&&!c('isEmpty')(l.getImageFiles())||n&&!c('isEmpty')(n.getSelectedFBIDs())||m.getAttachData();};i.prototype.toString=function(){'use strict';return '[object MercuryDraftsController:'+this.$MercuryDraftsController1+']';};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryAttachmentSnippetType',['keyMirror'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({PHOTO:null,GIF:null,VIDEO:null,AUDIO_CLIP:null,STICKER:null,SHARE:null,ERROR:null,MIXED:null,GIFT:null,THIRDPARTYSTICKER:null,FILE:null,LIKE_STICKER:null});f.exports=h;}),null);
__d('P2PSnippetStringUtils',['fbt','P2PPaymentRequestStatus','P2PTransferStatus'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={getRequestCanceledSnippet:function j(k,l,m,n,o){if(k){return h._("\u4f60\u5c0d{receiver's name}\u7684{payment request amount}\u4ed8\u6b3e\u8981\u6c42\u5df2\u53d6\u6d88\u3002",[h.param('payment request amount',o),h.param('receiver\'s name',n)]);}else if(l){return h._("{requester's name}\u7684{payment request amount}\u4ed8\u6b3e\u8981\u6c42\u5df2\u53d6\u6d88\u3002",[h.param('requester\'s name',m),h.param('payment request amount',o)]);}else return h._("{requester's name}\u5c0d{receiver's name}\u7684{payment request amount}\u4ed8\u6b3e\u8981\u6c42\u5df2\u53d6\u6d88\u3002",[h.param('requester\'s name',m),h.param('payment request amount',o),h.param('receiver\'s name',n)]);},getRequestDeclinedSnippet:function j(k,l,m,n,o){if(k){return h._("{receiver's name}\u62d2\u7d55\u4e86\u4f60\u7684{payment request amount}\u4ed8\u6b3e\u8981\u6c42\u3002",[h.param('receiver\'s name',n),h.param('payment request amount',o)]);}else if(l){return h._("\u4f60\u62d2\u7d55\u4e86{requester's name}\u7684{payment request amount}\u4ed8\u6b3e\u8981\u6c42\u3002",[h.param('requester\'s name',m),h.param('payment request amount',o)]);}else return h._("{receiver's name}\u62d2\u7d55\u4e86{sender's name}\u7684{payment request amount}\u4ed8\u6b3e\u8981\u6c42\u3002",[h.param('receiver\'s name',n),h.param('sender\'s name',m),h.param('payment request amount',o)]);},getRequestSentSnippet:function j(k,l,m,n,o){if(k){return h._("\u4f60\u8981\u6c42{requestee name}\u652f\u4ed8{amount}",[h.param('amount',o),h.param('requestee name',n)]);}else if(l){return h._("{requester name}\u8981\u6c42\u4f60\u652f\u4ed8{amount}\u3002",[h.param('requester name',m),h.param('amount',o)]);}else return h._("{name}\u8981\u6c42{requestee name}\u652f\u4ed8{amount}\u3002",[h.param('name',m),h.param('amount',o),h.param('requestee name',n)]);},getRequestSnippetByStatus:function j(k,l,m,n,o,p){var q=k||c('P2PPaymentRequestStatus').INITED,r=[l,m,n,o,p];switch(q){case c('P2PPaymentRequestStatus').DECLINED:return this.getRequestDeclinedSnippet.apply(this,r);case c('P2PPaymentRequestStatus').TRANSFER_FAILED:case c('P2PPaymentRequestStatus').CANCELED:return this.getRequestCanceledSnippet.apply(this,r);}return this.getRequestSentSnippet.apply(this,r);},getTransferCanceledSnippet:function j(k,l,m,n,o){if(k){return h._("\u4f60\u5411{receiver_name}\u652f\u4ed8\u7684{amount}\u6b3e\u9805\u5df2\u53d6\u6d88\u3002",[h.param('amount',o),h.param('receiver_name',n)]);}else if(l){return h._("{sender name}\u7684{amount}\u4ed8\u6b3e\u5df2\u53d6\u6d88\u3002",[h.param('sender name',m),h.param('amount',o)]);}else return h._("{sender_name}\u4ed8\u7d66{receiver_name}\u7684{amount}\u6b3e\u9805\u5df2\u53d6\u6d88\u3002",[h.param('sender_name',m),h.param('amount',o),h.param('receiver_name',n)]);},getTransferDeclinedSnippet:function j(k,l,m,n,o){if(k){return h._("{receiver_name}\u672a\u63a5\u53d7\u4f60\u7684{amount}\u4ed8\u6b3e\u3002",[h.param('receiver_name',n),h.param('amount',o)]);}else if(l){return h._("\u4f60\u672a\u63a5\u53d7{sender name}\u7684{amount}\u4ed8\u6b3e\u3002",[h.param('sender name',m),h.param('amount',o)]);}else return h._("{receiver_name}\u672a\u63a5\u53d7{sender_name}\u7684{amount}\u4ed8\u6b3e\u3002",[h.param('receiver_name',n),h.param('sender_name',m),h.param('amount',o)]);},getTransferSentSnippet:function j(k,l,m,n,o){if(k){return h._("\u4f60\u5411{receiver name}\u652f\u4ed8\u4e86{amount}\u3002",[h.param('receiver name',n),h.param('amount',o)]);}else if(l){return h._("{name}\u652f\u4ed8\u4e86{amount}\u7d66\u4f60\u3002",[h.param('name',m),h.param('amount',o)]);}else return h._("{sender name}\u5411{receiver name}\u652f\u4ed8\u4e86{amount}\u3002",[h.param('sender name',m),h.param('receiver name',n),h.param('amount',o)]);},getTransferSnippetByStatus:function j(k,l,m,n,o,p){var q=[l,m,n,o,p],r=k||c('P2PTransferStatus').PENDING_SENDER_INITED;switch(r){case c('P2PTransferStatus').CANCELED_DECLINED:return this.getTransferDeclinedSnippet.apply(this,q);case c('P2PTransferStatus').CANCELED_SENDER_RISK:case c('P2PTransferStatus').CANCELED_RECIPIENT_RISK:case c('P2PTransferStatus').CANCELED_SYSTEM_FAIL:case c('P2PTransferStatus').CANCELED_EXPIRED:case c('P2PTransferStatus').CANCELED_SAME_CARD:return this.getTransferCanceledSnippet.apply(this,q);}return this.getTransferSentSnippet.apply(this,q);}};f.exports=i;}),null);
__d('MercuryAttachmentSnippetRenderer',['fbt','CurrentUser','MercuryAttachmentSnippetType','MercuryAttachmentType','MercuryAudioType','MercuryGiftSnippetRenderer','P2PSnippetStringUtils','StickerConstants','StoryAttachmentStyle'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={getAttachmentSnippetType:function j(k){if(this._hasOnlyPhotos(k))return c('MercuryAttachmentSnippetType').PHOTO;if(this._hasOnlyAnimatedImages(k))return c('MercuryAttachmentSnippetType').GIF;if(this._hasOnlyVideo(k))return c('MercuryAttachmentSnippetType').VIDEO;if(this._hasAudioClip(k))return c('MercuryAttachmentSnippetType').AUDIO_CLIP;if(this._hasLikeSticker(k))return c('MercuryAttachmentSnippetType').LIKE_STICKER;if(this._hasSticker(k))return c('MercuryAttachmentSnippetType').STICKER;if(this._hasThirdPartySticker(k))return c('MercuryAttachmentSnippetType').THIRDPARTYSTICKER;if(this._hasShare(k))return c('MercuryAttachmentSnippetType').SHARE;if(this._hasGift(k))return c('MercuryAttachmentSnippetType').GIFT;if(this._hasError(k))return c('MercuryAttachmentSnippetType').ERROR;if(this._hasFile(k))return c('MercuryAttachmentSnippetType').FILE;return c('MercuryAttachmentSnippetType').MIXED;},renderAttachmentSnippetText:function j(k,l,m,n){switch(k){case c('MercuryAttachmentSnippetType').PHOTO:return this._renderPhotoAttachmentSnippetText(l,m,this._getPhotoAttachments(n));case c('MercuryAttachmentSnippetType').GIF:return this._renderAnimatedImagesAttachmentSnippetText(l,m,this._getAnimatedImageAttachments(n));case c('MercuryAttachmentSnippetType').VIDEO:return l?h._("\u4f60\u50b3\u9001\u4e86\u4e00\u6bb5\u5f71\u7247\u3002"):h._("{sender name}\u50b3\u9001\u4e86\u4e00\u6bb5\u5f71\u7247\u3002",[h.param('sender name',m)]);case c('MercuryAttachmentSnippetType').AUDIO_CLIP:return l?h._("\u4f60\u9001\u51fa\u4e86\u8a9e\u97f3\u8a0a\u606f\u3002"):h._("{name}\u9001\u51fa\u4e00\u5247\u8a9e\u97f3\u8a0a\u606f\u3002",[h.param('name',m)]);case c('MercuryAttachmentSnippetType').STICKER:case c('MercuryAttachmentSnippetType').LIKE_STICKER:case c('MercuryAttachmentSnippetType').THIRDPARTYSTICKER:return l?h._("\u4f60\u9001\u51fa\u4e00\u5f35\u8cbc\u5716\u3002"):h._("{name}\u9001\u51fa\u4e00\u5f35\u8cbc\u5716\u3002",[h.param('name',m)]);case c('MercuryAttachmentSnippetType').SHARE:if(n&&this._hasP2PPayment(n))return this._renderP2PPaymentSnippetText(n[0]);if(n&&this._hasP2PPaymentRequest(n))return this._renderP2PPaymentRequestSnippetText(n[0]);if(n&&this._hasBusinessMessage(n))return this._renderBusinessMessageSnippetText(n[0],m);if(n&&this._hasLocation(n))return l?h._("\u4f60\u50b3\u9001\u4e86 1 \u500b\u5730\u9ede\u3002"):h._("{sender name}\u50b3\u9001\u4e86 1 \u500b\u5730\u9ede\u3002",[h.param('sender name',m)]);return l?h._("\u4f60\u50b3\u9001\u4e86\u4e00\u689d\u9023\u7d50\u3002"):h._("{sender name}\u50b3\u9001\u4e86\u4e00\u689d\u9023\u7d50\u3002",[h.param('sender name',m)]);case c('MercuryAttachmentSnippetType').GIFT:return c('MercuryGiftSnippetRenderer').renderText(l,m);case c('MercuryAttachmentSnippetType').FILE:return l?h._("\u4f60\u50b3\u9001\u4e86 1 \u500b\u9644\u4ef6\u3002"):h._("{sender name}\u50b3\u9001\u4e86 1 \u500b\u9644\u4ef6\u3002",[h.param('sender name',m)]);case c('MercuryAttachmentSnippetType').ERROR:return l?h._("\u4f60\u50b3\u9001\u4e86 1 \u500b\u9644\u4ef6\u3002"):h._("{sender name}\u50b3\u9001\u4e86 1 \u500b\u9644\u4ef6\u3002",[h.param('sender name',m)]);default:return '';}},_hasOnlyPhotos:function j(k){return this._getPhotoAttachments(k).length===k.length;},_hasThirdPartySticker:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').THIRDPARTYSTICKER);},_hasOnlyAnimatedImages:function j(k){return this._getAnimatedImageAttachments(k).length===k.length;},_hasOnlyVideo:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').VIDEO);},_hasAudioClip:function j(k){var l=k[0].metadata&&k[0].metadata.type;return (k.length===1&&(l===c('MercuryAudioType').AudioClip||l===c('MercuryAudioType').VoiceMessageWithTranscript));},_hasBusinessMessage:function j(k){return this._hasSingleShareAttachmentOfStyle(k,c('StoryAttachmentStyle').BUSINESS_MESSAGE_ITEMS);},_hasSticker:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').STICKER);},_hasLikeSticker:function j(k){if(k.length<1)return false;var l=k[0].metadata&&k[0].metadata.stickerID;return (k.length===1&&(l==c('StickerConstants').LIKE_STICKER_ID||l==c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID||l==c('StickerConstants').HOT_LIKE_MEDIUM_STICKER_ID||l==c('StickerConstants').HOT_LIKE_LARGE_STICKER_ID));},_hasLocation:function j(k){return this._hasSingleShareAttachmentOfStyle(k,c('StoryAttachmentStyle').MESSAGE_LOCATION);},_hasP2PPayment:function j(k){return this._hasSingleShareAttachmentOfStyle(k,c('StoryAttachmentStyle').ORION);},_hasP2PPaymentRequest:function j(k){return this._hasSingleShareAttachmentOfStyle(k,c('StoryAttachmentStyle').ORION_REQUEST);},_hasSingleShareAttachmentOfStyle:function j(k,l){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').SHARE&&k[0].share.style_list.indexOf(l)>=0);},_hasShare:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').SHARE);},_hasError:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').ERROR);},_hasGift:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').GIFT);},_hasFile:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').FILE);},_getPhotoAttachments:function j(k){if(!k)return [];return k.filter(function(l){return l.attach_type===c('MercuryAttachmentType').PHOTO;});},_getAnimatedImageAttachments:function j(k){if(!k)return [];return k.filter(function(l){return l.attach_type===c('MercuryAttachmentType').ANIMATED_IMAGE;});},_renderPhotoAttachmentSnippetText:function j(k,l,m){if(m.length===1){if(k){return h._("\u4f60\u5bc4\u51fa\u4e00\u5f35\u76f8\u7247\u3002");}else return h._("{name}\u50b3\u9001\u4e00\u5f35\u76f8\u7247\u3002",[h.param('name',l)]);}else if(k){return h._({"*":"\u4f60\u9001\u51fa\u4e86{num_photos}\u5f35\u76f8\u7247\u3002"},[h.param('num_photos',m.length,[0])]);}else return h._({"*":"{name}\u50b3\u9001\u4e86{num_photos}\u5f35\u76f8\u7247\u3002"},[h.param('name',l),h.param('num_photos',m.length,[0])]);},_renderAnimatedImagesAttachmentSnippetText:function j(k,l,m){if(m.length===1){if(k){return h._("\u4f60\u50b3\u9001\u4e86 1 \u5f35 GIF\u3002");}else return h._("{name}\u50b3\u9001\u4e86 1 \u5f35 GIF\u3002",[h.param('name',l)]);}else if(k){return h._("\u4f60\u50b3\u9001\u4e86{num_animated_images}\u5f35 GIF\u3002",[h.param('num_animated_images',m.length)]);}else return h._("{name}\u50b3\u9001\u4e86{num_animated_images}\u5f35 GIF\u3002",[h.param('name',l),h.param('num_animated_images',m.length)]);},_renderBusinessMessageSnippetText:function j(k,l){var m=k.share.target,n=m&&m.message||h._("{sender name}\u50b3\u9001\u4e86 1 \u500b\u9644\u4ef6\u3002",[h.param('sender name',l)]);return n;},_renderP2PPaymentSnippetText:function j(k){var l=k.share.target;return this.renderP2PPaymentSnippetText(c('CurrentUser').getID()===l.sender.id,l.sender.name,l.amountWithSymbol,l.status,c('CurrentUser').getID()===l.receiver.id,l.receiver.name);},_renderP2PPaymentRequestSnippetText:function j(k){var l=k.share.target;return this.renderP2PPaymentRequestSnippetText(c('CurrentUser').getID()===l.requester.id,l.requester.name,l.amountWithSymbol,l.currentStatus,c('CurrentUser').getID()===l.requestee.id,l.requestee.name);},renderP2PPaymentSnippetText:function j(k,l,m,n,o,p){return c('P2PSnippetStringUtils').getTransferSnippetByStatus(n,k,o||false,l||'',p||'',m);},renderP2PPaymentRequestSnippetText:function j(k,l,m,n,o,p){return c('P2PSnippetStringUtils').getRequestSnippetByStatus(n,k,o||false,l||'',p||'',m);}};f.exports=i;}),null);
__d('MercuryAnimatedShareSnippet.react',['cx','fbt','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=this.props.isViewerSender?i._("\u4f60\u50b3\u9001\u4e86 GIF \u5716\u50cf\u3002"):i._("{sender name}\u50b3\u9001\u4e86 GIF \u5716\u50cf\u3002",[i.param('sender name',this.props.senderName)]);return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/icons/photo.gif')}),o));};function n(){k.apply(this,arguments);}n.propTypes={isViewerSender:m.bool,senderName:m.string};f.exports=n;}),null);
__d('MercuryFallbackShareAttachmentSnippet.react',['cx','fbt','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=void 0;if(this.props.isViewerSender){o=i._("\u4f60\u50b3\u9001\u4e86\u4e00\u689d\u9023\u7d50\u3002");}else o=i._("{sender name}\u50b3\u9001\u4e86\u4e00\u689d\u9023\u7d50\u3002",[i.param('sender name',this.props.senderName)]);return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/messaging/docs/generic.png')}),o));};function n(){k.apply(this,arguments);}n.propTypes={isViewerSender:m.bool,senderName:m.oneOfType([m.string,m.object])};f.exports=n;}),null);
__d('MercuryFundraiserPTCShareSnippet.react',['cx','fbt','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=this.props.isViewerSender?i._("\u4f60\u5206\u4eab\u4e86 1 \u500b\u52df\u6b3e\u6d3b\u52d5"):i._("{sender name}\u5206\u4eab\u4e86 1 \u500b\u52df\u6b3e\u6d3b\u52d5",[i.param('sender name',this.props.senderName)]);return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/emoticons/heart.png')}),o));};function n(){k.apply(this,arguments);}n.propTypes={isViewerSender:m.bool,senderName:m.string};f.exports=n;}),null);
__d('MercuryMessageLiveLocationShareAttachmentSnippet.react',['cx','fbt','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=void 0;if(this.props.isViewerSender){o=i._("You sent a live location.");}else o=i._("{sender name} sent a live location.",[i.param('sender name',this.props.senderName)]);return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/messaging/location/location.png')}),o));};function n(){k.apply(this,arguments);}n.propTypes={isViewerSender:m.bool,senderName:m.string};f.exports=n;}),null);
__d('MercuryMessageLocationShareAttachmentSnippet.react',['cx','fbt','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=void 0;if(this.props.isViewerSender){o=i._("\u4f60\u50b3\u9001\u4e86 1 \u500b\u5730\u9ede\u3002");}else o=i._("{sender name}\u50b3\u9001\u4e86 1 \u500b\u5730\u9ede\u3002",[i.param('sender name',this.props.senderName)]);return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/messaging/location/location.png')}),o));};function n(){k.apply(this,arguments);}n.propTypes={isViewerSender:m.bool,senderName:m.string};f.exports=n;}),null);
__d('MercuryMessengerInviteShareAttachmentSnippet.react',['cx','React','MercuryShareAttachmentReactShape'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){return (c('React').createElement('span',{className:"_3l6h"},this.props.attachment.title));};function k(){i.apply(this,arguments);}k.propTypes={attachment:c('MercuryShareAttachmentReactShape')};f.exports=k;}),null);
__d('MercuryPhotoShareSnippet.react',['cx','fbt','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=this.props.isViewerSender?i._("\u4f60\u50b3\u9001\u4e86 1 \u5f35\u76f8\u7247\u3002"):i._("{sender name}\u50b3\u9001 1 \u5f35\u76f8\u7247\u3002",[i.param('sender name',this.props.senderName)]);return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/icons/photo.gif')}),o));};function n(){k.apply(this,arguments);}n.propTypes={isViewerSender:m.bool,senderName:m.string};f.exports=n;}),null);
__d('MercuryPromotionShareAttachmentSnippet.react',['cx','fbt','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=this.props.attachment,p=o&&o.target,q=p&&p.message||i._("{sender name}\u50b3\u9001\u4e86 1 \u500b\u9644\u4ef6\u3002",[i.param('sender name',this.props.senderName)]);return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/messaging/docs/generic.png')}),q));};function n(){k.apply(this,arguments);}n.propTypes={senderName:m.string,attachment:m.object};f.exports=n;}),null);
__d('MercurySaleGroupProductItemShareSnippet.react',['cx','fbt','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=this.props.isViewerSender?i._("\u4f60\u50b3\u9001\u4e86 1 \u500b\u62cd\u8ce3\u5546\u54c1\u3002"):i._("{sender name}\u50b3\u9001\u4e86 1 \u500b\u62cd\u8ce3\u5546\u54c1\u3002",[i.param('sender name',this.props.senderName)]);return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/messaging/docs/generic.png')}),o));};function n(){k.apply(this,arguments);}n.propTypes={isViewerSender:m.bool,senderName:m.string};f.exports=n;}),null);
__d('MercuryTransactionInvoiceShareSnippet.react',['cx','fbt','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=this.props.isViewerSender?i._("\u4f60\u50b3\u9001\u4e86 1 \u500b\u5e33\u55ae"):i._("{sender name}\u7c89\u7d72\u5c08\u9801\u50b3\u9001\u4e86 1 \u500b\u5e33\u55ae\u7d66\u4f60\u3002",[i.param('sender name',this.props.senderName)]);return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/messaging/docs/generic.png')}),o));};function n(){k.apply(this,arguments);}n.propTypes={isViewerSender:m.bool,senderName:m.string};f.exports=n;}),null);
__d('MercuryVideoShareSnippet.react',['cx','fbt','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;n.prototype.render=function(){var o=this.props.isViewerSender?i._("\u4f60\u50b3\u9001\u4e86 1 \u6bb5\u5f71\u7247\u3002"):i._("{sender name}\u50b3\u9001\u4e86 1 \u6bb5\u5f71\u7247\u3002",[i.param('sender name',this.props.senderName)]);return (c('React').createElement('span',{className:"uiIconText _3l6h"},c('React').createElement(c('Image.react'),{src:j('/images/icons/video.gif')}),o));};function n(){k.apply(this,arguments);}n.propTypes={isViewerSender:m.bool,senderName:m.oneOfType([m.string,m.object])};f.exports=n;}),null);
__d('P2PMercuryAttachmentSnippetRendererBase.react',['cx','ix','Image.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;m.prototype.render=function(){return (c('React').createElement('span',{className:"uiIconText _3l6h _3_io"},c('React').createElement(c('Image.react'),{height:12,src:i('/images/p2p/attachment-snippet-icon.png'),width:12}),this.props.text));};function m(){j.apply(this,arguments);}m.propTypes={text:l.node};f.exports=m;}),null);
__d('P2PMercuryAttachmentSnippet.react',['CurrentUser','MercuryAttachmentSnippetRenderer','P2PMercuryAttachmentSnippetRendererBase.react','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;k.prototype.render=function(){var l=c('MercuryAttachmentSnippetRenderer').renderP2PPaymentSnippetText(c('CurrentUser').getID()===this.props.sender.id,this.props.sender.name,this.props.amountWithSymbol,this.props.status,c('CurrentUser').getID()===this.props.receiver.id,this.props.receiver.name);return (c('React').createElement(c('P2PMercuryAttachmentSnippetRendererBase.react'),{text:l}));};function k(){h.apply(this,arguments);}k.propTypes={amount:j.string,amountWithSymbol:j.string,currency:j.string,groupThreadFBID:j.string,receiver:j.object,sender:j.object};k.defaultProps={sender:{},receiver:{}};f.exports=k;}),null);
__d('P2PMercuryShareAttachmentSnippet.react',['MercuryShareAttachmentReactShape','P2PMercuryAttachmentSnippet.react','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.prototype.render=function(){var k=this.props.attachment?this.props.attachment.target:{};return (c('React').createElement(c('P2PMercuryAttachmentSnippet.react'),k));};function j(){h.apply(this,arguments);}j.propTypes={attachment:c('MercuryShareAttachmentReactShape')};f.exports=j;}),null);
__d('P2PPaymentRequestMercuryAttachmentSnippet.react',['CurrentUser','MercuryAttachmentSnippetRenderer','P2PMercuryAttachmentSnippetRendererBase.react','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;k.prototype.render=function(){var l=c('MercuryAttachmentSnippetRenderer').renderP2PPaymentRequestSnippetText(c('CurrentUser').getID()===this.props.requester.id,this.props.requester.name,this.props.formattedAmount,this.props.status,c('CurrentUser').getID()===this.props.requestee.id,this.props.requestee.name);return (c('React').createElement(c('P2PMercuryAttachmentSnippetRendererBase.react'),{text:l}));};function k(){h.apply(this,arguments);}k.propTypes={formattedAmount:j.string.isRequired,requestee:j.object.isRequired,requester:j.object.isRequired,status:j.number.isRequired};f.exports=k;}),null);
__d('P2PPaymentRequestMercuryShareAttachmentSnippet.react',['MercuryShareAttachmentReactShape','P2PPaymentRequestMercuryAttachmentSnippet.react','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.prototype.render=function(){var k=this.props.attachment?this.props.attachment.target:{};return (c('React').createElement(c('P2PPaymentRequestMercuryAttachmentSnippet.react'),{formattedAmount:k.amountWithSymbol,requestee:k.requestee,requester:k.requester,status:k.currentStatus}));};function j(){h.apply(this,arguments);}j.propTypes={attachment:c('MercuryShareAttachmentReactShape')};f.exports=j;}),null);
__d('MercuryShareStyleMap',['cx','JSResource','Map','MercuryConfig','MercuryShareAttachmentRenderLocations','StoryAttachmentStyle','emptyFunction','MercuryFallbackShareAttachmentSnippet.react','P2PMercuryShareAttachmentSnippet.react','P2PPaymentRequestMercuryShareAttachmentSnippet.react','MercuryPromotionShareAttachmentSnippet.react','MessengerMomentsAppSnippet.react','MercuryPhotoShareSnippet.react','MercuryVideoShareSnippet.react','MercuryMessageLocationShareAttachmentSnippet.react','MercuryMessageLiveLocationShareAttachmentSnippet.react','MercuryAnimatedShareSnippet.react','MercurySaleGroupProductItemShareSnippet.react','MercuryTransactionInvoiceShareSnippet.react','MercuryFundraiserPTCShareSnippet.react','MercuryMessengerInviteShareAttachmentSnippet.react'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=new (c('Map'))();i.set(c('StoryAttachmentStyle').FALLBACK,{componentName:'MercuryFallbackShareAttachment.react',componentLoader:c('JSResource')('MercuryFallbackShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryFallbackShareAttachmentSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]])});i.set(c('StoryAttachmentStyle').EVENT,{componentName:'MercuryEventShareAttachment.react',componentLoader:c('JSResource')('MercuryEventShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryFallbackShareAttachmentSnippet.react');}});i.set(c('StoryAttachmentStyle').ORION,{componentName:'P2PMercuryShareAttachmentContainer.react',componentLoader:c('JSResource')('P2PMercuryShareAttachmentContainer.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('P2PMercuryShareAttachmentSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _3-50"]])});i.set(c('StoryAttachmentStyle').ORION_REQUEST,{componentName:'P2PPaymentRequestMercuryShareAttachmentContainer.react',componentLoader:c('JSResource')('P2PPaymentRequestMercuryShareAttachmentContainer.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('P2PPaymentRequestMercuryShareAttachmentSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _3-50"]])});if(c('MercuryConfig').WWWMessengerCommerceGK){i.set(c('StoryAttachmentStyle').RETAIL_RECEIPT,{componentName:'MNCommerceReceiptMercuryShareAttachment.react',componentLoader:c('JSResource')('MNCommerceReceiptMercuryShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d"]])});i.set(c('StoryAttachmentStyle').RETAIL_CANCELLATION,{componentName:'MNCommerceCancelationMercuryShareAttachment.react',componentLoader:c('JSResource')('MNCommerceCancelationMercuryShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d"]])});i.set(c('StoryAttachmentStyle').RETAIL_SHIPMENT,{componentName:'MNCommerceShippingMercuryShareAttachment.react',componentLoader:c('JSResource')('MNCommerceShippingMercuryShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d"]])});i.set(c('StoryAttachmentStyle').RETAIL_SHIPMENT_TRACKING_EVENT,{componentName:'MNCommerceShippingMercuryShareAttachment.react',componentLoader:c('JSResource')('MNCommerceShippingMercuryShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d"]])});i.set(c('StoryAttachmentStyle').RETAIL_NOW_IN_STOCK,{componentName:'MNCommerceProductSubscriptionMercuryShareAttachment.react',componentLoader:c('JSResource')('MNCommerceProductSubscriptionMercuryShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d"]])});i.set(c('StoryAttachmentStyle').RETAIL_PROMOTION,{componentName:'MNCommercePromotionMercuryShareAttachment.react',componentLoader:c('JSResource')('MNCommercePromotionMercuryShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d _28rg"]])});i.set(c('StoryAttachmentStyle').RETAIL_ITEM,{componentName:'MNCommercePromotionMercuryShareAttachment.react',componentLoader:c('JSResource')('MNCommercePromotionMercuryShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d _28rg"]])});i.set(c('StoryAttachmentStyle').BUSINESS_MESSAGE_ITEMS,{componentName:'MNCommercePromotionMercuryShareAttachment.react',componentLoader:c('JSResource')('MNCommercePromotionMercuryShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return (c('MercuryPromotionShareAttachmentSnippet.react'));},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d _28rg"]])});i.set(c('StoryAttachmentStyle').H_SCROLL,{componentName:'MNCommerceHScrollMessageAttachment.react',componentLoader:c('JSResource')('MNCommerceHScrollMessageAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return (c('MercuryPromotionShareAttachmentSnippet.react'));},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d _8ka"]])});}if(c('MercuryConfig').WWWMessengerTransportationGK){i.set(c('StoryAttachmentStyle').RIDE_ORDERED,{componentName:'MNTransportationRideConfirmationMercuryAttachment.react',componentLoader:c('JSResource')('MNTransportationRideConfirmationMercuryAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryPromotionShareAttachmentSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d"]])});i.set(c('StoryAttachmentStyle').RIDE_RECEIPT,{componentName:'MNTransportationRideReceiptMercuryAttachment.react',componentLoader:c('JSResource')('MNTransportationRideReceiptMercuryAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryPromotionShareAttachmentSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d"]])});}if(c('MercuryConfig').WWWMessengerAirlinesGK){i.set(c('StoryAttachmentStyle').AIRLINE_UPDATE,{componentName:'MNAirlineUpdateMercuryAttachment.react',componentLoader:c('JSResource')('MNAirlineUpdateMercuryAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d _8kb"]])});i.set(c('StoryAttachmentStyle').AIRLINE_ITINERARY,{componentName:'MNAirlineItineraryMercuryAttachment.react',componentLoader:c('JSResource')('MNAirlineItineraryMercuryAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d _8kb"]])});i.set(c('StoryAttachmentStyle').AIRLINE_CHECKIN_REMINDER,{componentName:'MNAirlineCheckInMercuryAttachment.react',componentLoader:c('JSResource')('MNAirlineCheckInMercuryAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d _8kb"]])});i.set(c('StoryAttachmentStyle').AIRLINE_BOARDING_PASS,{componentName:'MNAirlineBoardingPassMercuryAttachment.react',componentLoader:c('JSResource')('MNAirlineBoardingPassMercuryAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d _8kb"]])});}if(c('MercuryConfig').WWWMessengerMoneyPennyGK)i.set(c('StoryAttachmentStyle').RETAIL_AGENT_ITEM_SUGGESTION,{componentName:'MNCommerceAgentItemSuggestionMercuryShareAttachment.react',componentLoader:c('JSResource')('MNCommerceAgentItemSuggestionMercuryShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d"]])});if(c('MercuryConfig').MomentsMessengerWWWGK){var j={componentName:'MessengerMomentsAppShareAttachment.react',componentLoader:c('JSResource')('MessengerMomentsAppShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MessengerMomentsAppSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]])};i.set(c('StoryAttachmentStyle').MOMENTS_APP_INVITATION,j);i.set(c('StoryAttachmentStyle').MOMENTS_APP_PHOTO_REQUEST,j);}if(c('MercuryConfig').MercuryGenieRendering)i.set(c('StoryAttachmentStyle').GENIE_MESSAGE,{componentName:'GenieMessageShareAttachment.react',componentLoader:c('JSResource')('GenieMessageShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_2wrf"]]),getSnippetComponent:function l(){return c('MercuryFallbackShareAttachmentSnippet.react');}});if(c('MercuryConfig').MessengerEnhancedLinkShare)i.set(c('StoryAttachmentStyle').ENHANCED_LINK_REDDIT_POST,{componentName:'MercuryRedditPostShareAttachment.react',componentLoader:c('JSResource')('MercuryRedditPostShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryFallbackShareAttachmentSnippet.react');}});i.set(c('StoryAttachmentStyle').MOVIE_BOT_MOVIE_LIST,{componentName:'MovieBotMovieListShareAttachment.react',componentLoader:c('JSResource')('MovieBotMovieListShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]])});i.set(c('StoryAttachmentStyle').MOVIE_BOT_MOVIE_SHOWTIME_LIST,{componentName:'MovieBotMovieShowtimeListShareAttachment.react',componentLoader:c('JSResource')('MovieBotMovieShowtimeListShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]])});i.set(c('StoryAttachmentStyle').SHARE_LARGE_IMAGE,{componentName:'MercuryShareLargeImageAttachment.react',componentLoader:c('JSResource')('MercuryShareLargeImageAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryPhotoShareSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]]),unwrapInStory:c('emptyFunction').thatReturnsTrue});i.set(c('StoryAttachmentStyle').IMAGE_SHARE,{componentName:'MercuryImageShareAttachment.react',componentLoader:c('JSResource')('MercuryImageShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryPhotoShareSnippet.react');},cx:null,unwrapInStory:c('emptyFunction').thatReturnsTrue});i.set(c('StoryAttachmentStyle').VIDEO,{componentName:'MercuryVideoShareAttachment.react',componentLoader:c('JSResource')('MercuryVideoShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryVideoShareSnippet.react');},cx:null,unwrapInStory:c('emptyFunction').thatReturnsTrue});i.set(c('StoryAttachmentStyle').MESSAGE_LOCATION,{componentName:'MercuryMessageLocationShareAttachment.react',componentLoader:c('JSResource')('MercuryMessageLocationShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryMessageLocationShareAttachmentSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]])});i.set(c('StoryAttachmentStyle').MESSAGE_LIVE_LOCATION,{componentName:'MercuryMessageLiveLocationShareAttachment.react',componentLoader:c('JSResource')('MercuryMessageLiveLocationShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryMessageLiveLocationShareAttachmentSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]])});i.set(c('StoryAttachmentStyle').ANIMATED_IMAGE_SHARE,{componentName:'MercuryAnimatedShareAttachment.react',componentLoader:c('JSResource')('MercuryAnimatedShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryAnimatedShareSnippet.react');},cx:null,unwrapInStory:c('emptyFunction').thatReturnsFalse});i.set(c('StoryAttachmentStyle').GROUP_SELL_PRODUCT_ITEM,{componentName:'MercurySaleGroupProductItemShareAttachment.react',componentLoader:c('JSResource')('MercurySaleGroupProductItemShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercurySaleGroupProductItemShareSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]]),unwrapInStory:c('emptyFunction').thatReturnsTrue});i.set(c('StoryAttachmentStyle').COMMERCE_PRODUCT_ITEM,{componentName:'MercuryCommerceProductItemShareAttachment.react',componentLoader:c('JSResource')('MercuryCommerceProductItemShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryFallbackShareAttachmentSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]]),unwrapInStory:c('emptyFunction').thatReturnsTrue});i.set(c('StoryAttachmentStyle').TRANSACTION_INVOICE,{componentName:'MercuryTransactionInvoiceShareAttachment.react',componentLoader:c('JSResource')('MercuryTransactionInvoiceShareAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryTransactionInvoiceShareSnippet.react');},cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]]),unwrapInStory:c('emptyFunction').thatReturnsTrue});i.set(c('StoryAttachmentStyle').FINANCIAL_BILL_PAYMENT_REQUEST,{componentName:'MNBillPaymentRequestMercuryShareAttachment.react',componentLoader:c('JSResource')('MNBillPaymentRequestMercuryShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d _205d"]])});i.set(c('StoryAttachmentStyle').MUSIC_AGGREGATION,{componentName:'MercuryMusicAttachment.react',componentLoader:c('JSResource')('MercuryMusicAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]])});i.set(c('StoryAttachmentStyle').VIDEO_SHARE_YOUTUBE,{componentName:'MercuryVideoShareYoutubeAttachment.react',componentLoader:c('JSResource')('MercuryVideoShareYoutubeAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]])});i.set(c('StoryAttachmentStyle').RTC_CALL_LOG,{componentName:'MercuryRTCShareAttachment.react',componentLoader:c('JSResource')('MercuryRTCShareAttachment.react').__setRef('MercuryShareStyleMap')});i.set(c('StoryAttachmentStyle').FUNDRAISER_PERSON_TO_CHARITY,{componentName:'MercuryFundraiserPTCAttachment.react',componentLoader:c('JSResource')('MercuryFundraiserPTCAttachment.react').__setRef('MercuryShareStyleMap'),getSnippetComponent:function l(){return c('MercuryFundraiserPTCShareSnippet.react');}});i.set(c('StoryAttachmentStyle').MESSENGER_TEAM_BOT_SHARE,{componentName:'MessengerTeamBotShareAttachment.react',componentLoader:c('JSResource')('MessengerTeamBotShareAttachment.react').__setRef('MercuryShareStyleMap')});i.set(c('StoryAttachmentStyle').MESSENGER_INVITE,{componentName:'MercuryMessengerInviteShareAttachment.react',componentLoader:c('JSResource')('MercuryMessengerInviteShareAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_3thf"]]),getSnippetComponent:function l(){return c('MercuryMessengerInviteShareAttachmentSnippet.react');},unwrapInStory:c('emptyFunction').thatReturnsTrue});i.set(c('StoryAttachmentStyle').NATIVE_COMPONENT_FLOW_BOOKING_REQUEST,{componentName:'PagesPlatformRequestMercuryShareAttachmentContainer.react',componentLoader:c('JSResource')('PagesPlatformRequestMercuryShareAttachmentContainer.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]]),unwrapInStory:c('emptyFunction').thatReturnsTrue});i.set(c('StoryAttachmentStyle').FRIEND_REQUEST,{componentName:'MercuryMessengerFriendRequestAttachment.react',componentLoader:c('JSResource')('MercuryMessengerFriendRequestAttachment.react').__setRef('MercuryShareStyleMap'),cx:new (c('Map'))([[c('MercuryShareAttachmentRenderLocations').MESSENGER,"_5i_d"]]),unwrapInStory:c('emptyFunction').thatReturnsTrue});var k={getStyleFactory:function l(m){if(!m||!m.style_list)return null;if(m.style_list[0]===c('StoryAttachmentStyle').ATTACHED_STORY){var n=m.subattachments,o=n&&n.length?n[0].style_list:[],p=this._getStyleMapEntry(o);if(p&&p.unwrapInStory&&p.unwrapInStory())return {attachment:n[0],factory:p};}var q=this._getStyleMapEntry(m.style_list);if(!q)return null;return {attachment:m,factory:q};},_getStyleMapEntry:function l(m){for(var n=0;n<m.length;n++){var o=i.get(m[n]);if(o)return o;}return null;}};f.exports=k;}),null);
__d('MercuryShareAttachmentSnippet.react',['MercuryShareAttachmentReactShape','MercuryShareStyleMap','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;k.prototype.render=function(){var l=c('MercuryShareStyleMap').getStyleFactory(this.props.attachment);if(l.factory&&!!l.factory.getSnippetComponent){var m=l.factory.getSnippetComponent();return (c('React').createElement(m,babelHelpers['extends']({},this.props,{attachment:l.attachment})));}return null;};function k(){h.apply(this,arguments);}k.propTypes={attachment:c('MercuryShareAttachmentReactShape'),isSenderViewer:j.bool,senderName:j.oneOfType([j.string,j.object])};f.exports=k;}),null);
__d('MercuryAttachmentSnippet.react',['cx','ix','fbt','EmoticonsList','Image.react','MercuryAttachment','MercuryAttachmentSnippetRenderer','MercuryAttachmentSnippetType','MercuryAttachmentType','MercuryConfig','MercuryIDs','MercuryShareAttachmentSnippet.react','MessengerTextWithEmoticons.react','MercuryParticipants','React','StickerConstants','TextWithEmoticons.react','joinClasses'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;function n(){var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return q=(r=l.constructor).call.apply(r,[this].concat(t)),this.$MercuryAttachmentSnippet6=function(v){return this.$MercuryAttachmentSnippet17(c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetType').PHOTO,this.$MercuryAttachmentSnippet18,v,this.$MercuryAttachmentSnippet5));}.bind(this),this.$MercuryAttachmentSnippet7=function(v){return this.$MercuryAttachmentSnippet17(c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetType').GIF,this.$MercuryAttachmentSnippet18,v,this.$MercuryAttachmentSnippet5));}.bind(this),this.$MercuryAttachmentSnippet8=function(v){return this.$MercuryAttachmentSnippet17(c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetType').VIDEO,this.$MercuryAttachmentSnippet18,v));}.bind(this),this.$MercuryAttachmentSnippet9=function(v){return this.$MercuryAttachmentSnippet17(c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetType').AUDIO_CLIP,this.$MercuryAttachmentSnippet18,v));}.bind(this),this.$MercuryAttachmentSnippet15=function(v){return (c('React').createElement('span',null,c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetType').THIRDPARTYSTICKER,this.$MercuryAttachmentSnippet18,v)));}.bind(this),this.$MercuryAttachmentSnippet10=function(v){var w=c('MercuryConfig').MessengerNewEmojiGK?c('React').createElement(c('MessengerTextWithEmoticons.react'),{renderEmoticons:true,text:c('EmoticonsList').symbols.like}):c('React').createElement(c('TextWithEmoticons.react'),{renderEmoticons:true,text:c('EmoticonsList').symbols.like});if(this.$MercuryAttachmentSnippet18){return (c('React').createElement('span',null,j._("\u4f60\uff1a{conversation_snippet}",[j.param('conversation_snippet',w)])));}else return this.props.thread.is_canonical?c('React').createElement('span',null,j._("{conversation_snippet}",[j.param('conversation_snippet',w)])):c('React').createElement('span',null,j._("{sender name}\uff1a{conversation_snippet}",[j.param('sender name',v),j.param('conversation_snippet',w)]));}.bind(this),this.$MercuryAttachmentSnippet11=function(v){return (c('React').createElement('span',null,c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetType').STICKER,this.$MercuryAttachmentSnippet18,v)));}.bind(this),this.$MercuryAttachmentSnippet12=function(v){if(!!this.$MercuryAttachmentSnippet5[0].share)return (c('React').createElement(c('MercuryShareAttachmentSnippet.react'),{attachment:this.$MercuryAttachmentSnippet5[0].share,senderName:v,isViewerSender:this.$MercuryAttachmentSnippet18}));return this.$MercuryAttachmentSnippet17(c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetType').SHARE,this.$MercuryAttachmentSnippet18,v));}.bind(this),this.$MercuryAttachmentSnippet13=function(v){return (c('React').createElement('span',null,c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetType').GIFT,this.$MercuryAttachmentSnippet18,v)));}.bind(this),this.$MercuryAttachmentSnippet16=function(v){return (c('React').createElement('span',null,this.$MercuryAttachmentSnippet5.filter(function(w){return (w.attach_type===c('MercuryAttachmentType').FILE||w.attach_type===c('MercuryAttachmentType').PHOTO||w.attach_type===c('MercuryAttachmentType').VIDEO);}).map(function(w,x){return this.$MercuryAttachmentSnippet17(w.name,w.icon_type,x);}.bind(this))));}.bind(this),this.$MercuryAttachmentSnippet17=function(v,w,x){var y=c('MercuryAttachment').getAttachIconClass(w||this.$MercuryAttachmentSnippet5[0].icon_type),z=c('joinClasses')(y,"uiIconText _3l6h");return (c('React').createElement('span',{key:x},c('React').createElement('span',{className:z},c('React').createElement(c('Image.react'),{src:i('/images/messaging/docs/generic.png')})),v));}.bind(this),this.$MercuryAttachmentSnippet14=function(v){var w=c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetType').ERROR,this.$MercuryAttachmentSnippet18,v);return this.$MercuryAttachmentSnippet17(w);}.bind(this),this.$MercuryAttachmentSnippet2=function(v){this.$MercuryAttachmentSnippet19=v.viewer;this.$MercuryAttachmentSnippet20=v.thread.snippet_sender;this.$MercuryAttachmentSnippet5=v.thread.snippet_attachments;this.$MercuryAttachmentSnippet18=p(this.$MercuryAttachmentSnippet20,this.$MercuryAttachmentSnippet19);}.bind(this),this.$MercuryAttachmentSnippet4=function(){if(!this.$MercuryAttachmentSnippet20||this.$MercuryAttachmentSnippet18)return null;var v=c('MercuryParticipants').getNow(this.$MercuryAttachmentSnippet20);if(!v)return null;var w=c('MercuryIDs').getUserIDFromParticipantID(this.$MercuryAttachmentSnippet20),x=this.props.thread.custom_nickname&&this.props.thread.custom_nickname[w];if(x&&c('MercuryConfig').MessengerNewEmojiGK)x=c('React').createElement(c('MessengerTextWithEmoticons.react'),{renderEmoticons:true,renderEmoji:true,text:x});return x?x:v.short_name;}.bind(this),this.$MercuryAttachmentSnippet1=function(v){if(!v)return;this.$MercuryAttachmentSnippet3();if(!c('MercuryParticipants').getNow(v))this.$MercuryAttachmentSnippet21=c('MercuryParticipants').get(v,function(w){return this.forceUpdate();}.bind(this));}.bind(this),this.$MercuryAttachmentSnippet3=function(){this.$MercuryAttachmentSnippet21&&this.$MercuryAttachmentSnippet21.remove();}.bind(this),q;}n.prototype.componentWillMount=function(){this.$MercuryAttachmentSnippet1(this.props.thread.snippet_sender);this.$MercuryAttachmentSnippet2(this.props);};n.prototype.componentWillReceiveProps=function(q){this.$MercuryAttachmentSnippet1(q.thread.snippet_sender);this.$MercuryAttachmentSnippet2(q);};n.prototype.componentWillUnmount=function(){this.$MercuryAttachmentSnippet3();};n.prototype.render=function(){var q=this.$MercuryAttachmentSnippet4(),r=c('MercuryAttachmentSnippetRenderer').getAttachmentSnippetType(this.$MercuryAttachmentSnippet5);switch(r){case c('MercuryAttachmentSnippetType').PHOTO:return this.$MercuryAttachmentSnippet6(q);case c('MercuryAttachmentSnippetType').GIF:return this.$MercuryAttachmentSnippet7(q);case c('MercuryAttachmentSnippetType').VIDEO:return this.$MercuryAttachmentSnippet8(q);case c('MercuryAttachmentSnippetType').AUDIO_CLIP:return this.$MercuryAttachmentSnippet9(q);case c('MercuryAttachmentSnippetType').LIKE_STICKER:return this.$MercuryAttachmentSnippet10(q);case c('MercuryAttachmentSnippetType').STICKER:return this.$MercuryAttachmentSnippet11(q);case c('MercuryAttachmentSnippetType').SHARE:return this.$MercuryAttachmentSnippet12(q);case c('MercuryAttachmentSnippetType').GIFT:return this.$MercuryAttachmentSnippet13(q);case c('MercuryAttachmentSnippetType').ERROR:return this.$MercuryAttachmentSnippet14(q);case c('MercuryAttachmentSnippetType').THIRDPARTYSTICKER:return this.$MercuryAttachmentSnippet15(q);default:return this.$MercuryAttachmentSnippet16(q);}};n.propTypes={thread:m.object.isRequired,viewer:m.string.isRequired};function o(q){return (q==c('StickerConstants').LIKE_STICKER_ID||q==c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID||q==c('StickerConstants').HOT_LIKE_MEDIUM_STICKER_ID||q==c('StickerConstants').HOT_LIKE_LARGE_STICKER_ID);}function p(q,r){return !!(q&&c('MercuryIDs').getParticipantIDFromUserID(r)==q);}f.exports=n;}),null);
__d('EmojiSticker.react',['cx','Image.react','React','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;l.prototype.render=function(){var m=this.props.emojiImage?this.props.emojiImage:c('React').createElement(c('Image.react'),{src:this.props.sourceURI});return (c('React').createElement('div',{'aria-label':this.props.emoji,className:c('joinClasses')(this.props.className,"_383m"),tabIndex:'0'},m));};function l(){i.apply(this,arguments);}l.propTypes={emoji:k.string,emojiImage:k.any,sourceURI:k.string.isRequired};f.exports=l;}),null);
__d('MercuryShareAttachment.react',['cx','BootloadedComponent.react','DOM','Event','MercuryShareAttachmentReactShape','MercuryShareAttachmentRenderLocations','MercuryShareStyleMap','React','ReactDOM','emptyFunction','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return m=(n=j.constructor).call.apply(n,[this].concat(p)),this.$MercuryShareAttachment2=function(r,s){if(this.props.location===c('MercuryShareAttachmentRenderLocations').MESSENGER&&!this.props.isSubattachment)s=c('joinClasses')("_52mr _2poz _ui9",s);return s?c('React').createElement('div',{className:s},r):r;}.bind(this),this.$MercuryShareAttachment3=function(r){this.$MercuryShareAttachment1(r);c('DOM').scry(c('ReactDOM').findDOMNode(this),'img').forEach(function(s){var t=c('Event').listen(s,'load',function(){this.$MercuryShareAttachment1(s.height);t.remove();}.bind(this));}.bind(this));}.bind(this),this.$MercuryShareAttachment1=function(r){this.props.onComponentLoaded(r);}.bind(this),m;}l.prototype.componentDidMount=function(){this.$MercuryShareAttachment1();};l.prototype.render=function(){var m=c('MercuryShareStyleMap').getStyleFactory(this.props.attachment);if(!m)return null;var n=m.attachment,o=m.factory;return this.$MercuryShareAttachment2(c('React').createElement(c('BootloadedComponent.react'),babelHelpers['extends']({},this.props,{attachment:n,bootloadLoader:o.componentLoader,bootloadPlaceholder:c('React').createElement('div',null),module:o.componentName,onComponentLoad:this.$MercuryShareAttachment3})),o.cx&&o.cx.get(this.props.location));};l.propTypes={attachment:c('MercuryShareAttachmentReactShape'),isSponsored:k.bool,isSubattachment:k.bool,location:k.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()),messageID:k.string,onComponentLoaded:k.func.isRequired,pageID:k.string,threadID:k.string.isRequired};l.defaultProps={onComponentLoaded:c('emptyFunction')};f.exports=l;}),null);
__d('Sticker.react',['cx','fbt','Arbiter','Image.react','MessengerHotLikeSVG.react','React','ReactDOM','PaddedStickerConfig','StickerConstants','emptyFunction','getElementPosition','getObjectValues','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=83,l=5000,m=10,n={CLICK:'click',HOVER:'hover',LOAD_AND_HOVER:'load_and_hover'},o=c('React').createClass({displayName:'Sticker',propTypes:{accessibilityLabel:j.string,animationTrigger:j.oneOf(c('getObjectValues')(n)),forceCursorPointer:j.bool,frameCount:j.number.isRequired,frameRate:j.number,framesPerCol:j.number.isRequired,framesPerRow:j.number.isRequired,onAttachmentLoad:j.func,onStickerClick:j.func,packID:j.string,packName:j.string,sourceURI:j.string.isRequired,sourceWidth:j.number.isRequired,sourceHeight:j.number.isRequired,spriteURI:j.string,stickerID:j.string,subscribedThreadID:j.string,testID:j.string},getInitialState:function p(){return {index:0,hasAnimated:false,unsubscribeID:null};},getDefaultProps:function p(){return {accessibilityLabel:'',forceCursorPointer:false,frameRate:k,onStickerClick:c('emptyFunction'),packID:null,packName:''};},componentDidMount:function p(){this.props.onAttachmentLoad&&this.props.onAttachmentLoad();this._stopIntervalID=0;if(this.props.animationTrigger===n.LOAD_AND_HOVER&&this.props.frameCount>1&&this.props.spriteURI)this.startAnimation();if(this.props.subscribedThreadID&&this.props.frameCount>1){var q=c('Arbiter').subscribe(this.props.subscribedThreadID,function(r,s){this.isScrolledIntoView(s.scrollTop,s.viewHeight,s.top);}.bind(this));this.setState({unsubscribeID:q});}},componentWillUnmount:function p(){if(this.state.unsubscribeID)c('Arbiter').unsubscribe(this.state.unsubscribeID);if(this.isAnimating())clearInterval(this._stopIntervalID);},isAnimating:function p(){return !!this._stopIntervalID;},getWidth:function p(){return Math.floor(this.props.sourceWidth);},getHeight:function p(){return Math.floor(this.props.sourceHeight);},preloadSprite:function p(){var q=new window.Image();q.onload=function(){if(this.isMounted()&&!this.state.hasAnimated){this.setState({hasAnimated:true});this._stopIntervalID=setInterval(this.incrementFrameIndex,this.props.frameRate);}}.bind(this);if(c('PaddedStickerConfig').ChatPaddedAnimatedStickerGK&&this.props.paddedSpriteURI){q.src=this.props.paddedSpriteURI;}else q.src=this.props.spriteURI;},isScrolledIntoView:function p(q,r,s){var t=c('getElementPosition')(c('ReactDOM').findDOMNode(this)),u=q+t.y-s,v=q+r,w=u+t.height;if(this.props.frameCount>1&&!this.state.hasAnimated&&w-m<=v&&u+m>=q)this.startAnimation();},startAnimation:function p(){if(!this.state.hasAnimated&&this.props.spriteURI){this.preloadSprite();}else if(!this.isAnimating()){this.setState({hasAnimated:true});this._stopIntervalID=setInterval(this.incrementFrameIndex,this.props.frameRate);}},stopAnimation:function p(){this.setState({index:0});clearInterval(this._stopIntervalID);this._stopIntervalID=0;},toggleAnimation:function p(){if(this.isAnimating()){this.stopAnimation();}else this.startAnimation();},shouldStopAnimating:function p(){var q=this.state.index%this.props.frameCount;if(!(q===0&&this.state.index*this.props.frameRate>l))return false;if(this.props.animationTrigger===n.CLICK)return true;return !this.state.isHovered;},incrementFrameIndex:function p(){if(this.shouldStopAnimating()){this.stopAnimation();}else this.setState({index:this.state.index+1});},getStyle:function p(){var q=0,r=this.props.spriteURI;if(c('PaddedStickerConfig').ChatPaddedAnimatedStickerGK&&this.props.paddedSpriteURI){r=this.props.paddedSpriteURI;var s=240/Math.min(this.getHeight(),this.getWidth());q=Math.floor(c('StickerConstants').SPRITE_PADDING/s);}var t=this.state.index%this.props.frameCount,u=t%this.props.framesPerRow*(this.getWidth()+q*2)+q,v=Math.floor(t/this.props.framesPerRow)*(this.getHeight()+q*2)+q,w=this.props.frameCount>1&&this.props.animationTrigger===n.CLICK||this._isStickerClickable(this.props.packID),x=this.props.forceCursorPointer||w?'pointer':'default';if(!this.state.hasAnimated||!this.props.spriteURI){return {backgroundImage:this._isHotLike()?null:'url('+this.props.sourceURI+')',backgroundRepeat:'no-repeat',backgroundSize:this.getWidth()+'px '+this.getHeight()+'px',cursor:x,height:this.getHeight(),width:this.getWidth()};}else return {backgroundImage:'url('+r+')',backgroundPosition:-u+'px '+ -v+'px',backgroundSize:(this.getWidth()+q*2)*this.props.framesPerRow+'px '+(this.getHeight()+q*2)*this.props.framesPerCol+'px',cursor:x,height:this.getHeight(),width:this.getWidth(),imageRendering:'-webkit-optimize-contrast'};},_isStickerClickable:function p(q){return q&&q!=c('StickerConstants').MOBILE_LIKE_STICKER_PACK_ID&&q!=c('StickerConstants').GRAVEYARD_PACK_ID;},onStickerClick:function p(){if(!this._isStickerClickable(this.props.packID))return;if(this.props.onStickerClick)this.props.onStickerClick(this.props.packID,this.props.stickerID);},mouseLeft:function p(){this.setState({isHovered:false});},mouseEntered:function p(){this.setState({isHovered:true});if(!this.isAnimating())this.startAnimation();},tabFocusSelected:function p(){this.setState({isHovered:true});if(!this.isAnimating())this.startAnimation();},tabFocusUnselected:function p(){this.setState({isHovered:false});},getAriaLabel:function p(){return i._("{pack name}{sticker name}\u8cbc\u5716",[i.param('pack name',this.props.packName),i.param('sticker name',this.props.accessibilityLabel)]);},render:function p(){var q=void 0,r=void 0;if(this.props.animationTrigger===n.CLICK&&this.props.frameCount>1&&this.props.spriteURI){q=true;}else if((this.props.animationTrigger===n.HOVER||this.props.animationTrigger===n.LOAD_AND_HOVER)&&this.props.frameCount>1&&this.props.spriteURI)r=true;var s=q?this.toggleAnimation:null;if(this.props.packID)s=this.onStickerClick;var t=this.props.className,u=null;if(this._isHotLike()){t=c('joinClasses')(t,"_576q");u=c('React').createElement(c('MessengerHotLikeSVG.react'),{color:this.props.customColor});}return (c('React').createElement('div',{'aria-label':this.getAriaLabel(),className:t,'data-testid':this.props.testID,tabIndex:'0',role:'img',style:this.getStyle(),onClick:s,onMouseEnter:r?this.mouseEntered:null,onMouseLeave:r?this.mouseLeft:null,onFocus:this.tabFocusSelected,onBlur:this.tabFocusUnselected},u));},_isHotLike:function p(){if(!!document.createElementNS&&!!document.createElementNS('http://www.w3.org/2000/svg','svg').createSVGRect)return (this.props.stickerID===c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID||this.props.stickerID===c('StickerConstants').HOT_LIKE_MEDIUM_STICKER_ID||this.props.stickerID===c('StickerConstants').HOT_LIKE_LARGE_STICKER_ID);return false;}});f.exports=o;}),null);
__d("XStickerPackImagesController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true},sticker_size:{type:"Int",defaultValue:50}});}),null);
__d('StickerServerRequests',['Promise','AsyncRequest','XStickerPackImagesController'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={getStickersForPack:function i(j,k){var l=c('XStickerPackImagesController').getURIBuilder().setInt('pack_id',j).setInt('sticker_size',k).getURI();return new (c('Promise'))(function(m,n){return (new (c('AsyncRequest'))().setURI(l).setMethod('GET').setReadOnly(true).setHandler(function(o){return m(o.payload);}).send());});}};f.exports=h;}),null);
__d('StickerImages',['StickerServerRequests'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={},i={},j={requestStickersForPack:function k(l,m,n){if(!l)return;if(!i[l]){i[l]=c('StickerServerRequests').getStickersForPack(l,m);i[l].then(function(o){o.forEach(function(p){return this.cacheSticker(p);}.bind(this));}.bind(this));}i[l].then(function(o){return n(o);});},cacheSticker:function k(l){h[l.id]=l;},getSticker:function k(l){return h[l];}};f.exports=j;}),null);
__d("StickerUtils",[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={getScaledDimensions:function i(j,k,l){var m,n,o;if(k>j){o=l/k;m=j*o;n=k*o;}else{o=l/j;m=j*o;n=k*o;}return {height:Math.round(m),width:Math.round(n)};},capitalizeWords:function i(j){var k=j.split(" ");for(var l=0;l<k.length;l++){var m=k[l].charAt(0).toUpperCase();k[l]=m+k[l].substr(1);}return k.join(" ");}};f.exports=h;}),null);
__d('MercuryAttachmentRenderer',['cx','MercuryAttachmentAudioClip.react','ChatAttachmentAttribution.react','ChatPhotoForwardButton.react','EmojiLikeCxData','EmojiLikeUtils','EmojiSticker.react','ImmutableObject','MercuryAttachment','MercuryAttachmentFile.react','MercuryAttachmentPhoto.react','MercuryAttachmentPhotoContainer.react','MercuryAttachmentPhotoGrid.react','MercuryAttachmentPhotoGridContainer.react','MercuryAttachmentVideo.react','MercuryConfig','MercuryIDs','MercuryMessageInfo','MercuryShareAttachment.react','MercuryShareAttachmentRenderLocations','MessagingGiftWrapChecker','MessengerFromViewerUtils','MessengerHotLikeUtils','MessengerSharedPhotosContainerRoute','React','RelayRootContainer','Sticker.react','StickerAssetType','StickerConstants','StickerImages','StickerUtils','joinClasses','XStickerAssetController'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={renderFile:function j(k,l){return (c('React').createElement(c('MercuryAttachmentFile.react'),{name:k.name,open_url:l?null:k.open_url,rel:k.rel,type:k.icon_type,url:k.url}));},renderAudioClip:function j(k,l,m,n){var o=k.metadata.duration/1000,p=l?c('MercuryShareAttachmentRenderLocations').CHAT:c('MercuryShareAttachmentRenderLocations').WEB_INBOX,q=100,r=l?160:400,s=100;if(o>=5)s=(1-Math.pow(10,(o-5)/-30))*(r-q)+q;return [c('React').createElement(c('MercuryAttachmentAudioClip.react'),{customColor:m,duration:k.metadata.duration/1000,isChat:l,isFromViewer:c('MessengerFromViewerUtils').isFromViewer(n),location:p,key:'audioClip',rootClassName:c('MercuryAttachment').hasAttribution(k)?"_4yjw":'',showHelp:false,src:k.url,width:s}),c('React').createElement(c('ChatAttachmentAttribution.react'),{attachment:new (c('ImmutableObject'))(k),key:'audioAttribution'})];},renderVideo:function j(k,l,m,n){var o=l?k.metadata.chat_size:k.metadata.inbox_size,p=l?k.metadata.chat_preview:k.metadata.inbox_preview;return (c('React').createElement(c('MercuryAttachmentVideo.react'),{attachment:new (c('ImmutableObject'))(k),duration:k.metadata.duration,isInbound:c('MercuryMessageInfo').isInbound(m),isChat:l,name:k.name,onAttachmentLoad:n,pageID:k.metadata.pageid,thumbSize:o,thumbnail:p,videoSize:k.metadata.dimensions,videoID:k.metadata.fbid,videoURI:k.url}));},constructStickerComponent:function j(k,l,m,n,o,p){var q=n?'chatScrolled/':'messengerScrolled/';q+=k.thread_id;if(!l){l=c('MessengerHotLikeUtils').getMetadataForHotLike(k.sticker_id);if(!l){var r=c('StickerImages').getSticker(k.sticker_id),s=Object.assign({},r),t=r?c('StickerUtils').getScaledDimensions(r.height,r.width,c('StickerConstants').THREAD_SIZE):{height:c('StickerConstants').THREAD_SIZE,width:c('StickerConstants').THREAD_SIZE},u=t.height,v=t.width;s.height=u;s.width=v;s.stickerID=k.sticker_id;s.spriteURI='';s.spriteURI2x='';s.paddedSpriteURI='';s.paddedSpriteURI2x='';l=s;}}var w=null;if(l.stickerID){w=l.stickerID.toString();}else if(k.sticker_id)w=k.sticker_id.toString();var x=null;if(l.packID)x=l.packID.toString();var y=c('XStickerAssetController').getURIBuilder().setInt('sticker_id',w),z=null,aa=null;if(window.devicePixelRatio&&window.devicePixelRatio>1){aa=l.paddedSpriteURI2x;z=l.spriteURI2x;}else{aa=l.paddedSpriteURI;z=l.spriteURI;}var ba=!!c('MessengerHotLikeUtils').getMetadataForHotLike(w)&&c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(k);return (c('React').createElement(c('Sticker.react'),{animationTrigger:'hover',className:c('joinClasses')(ba?"_3m7x":'','mvs'),customColor:p,frameCount:l.frameCount||1,frameRate:l.frameRate||83,framesPerCol:l.framesPerCol||1,framesPerRow:l.framesPerRow||1,onAttachmentLoad:o,onStickerClick:m,packID:x,paddedSpriteURI:aa,sourceHeight:l.height,sourceURI:y.setEnum('image_type',c('StickerAssetType').IMAGE).getURI().toString(),sourceWidth:l.width,spriteURI:z,stickerID:w,subscribedThreadID:q}));},constructEmojiLikeAttachment:function j(k,l){var m=c('MercuryConfig').MessengerNewEmojiGK?c('EmojiLikeCxData').getNewEmojiData(l.body,k.size):null,n=m?m.emoji:undefined;if(!m){var o=c('EmojiLikeUtils').getURI(l.body,k.size);if(!o)return null;}return (c('React').createElement(c('EmojiSticker.react'),{className:"_2poz _ui9",key:'sticker:'+l.message_id,emoji:l.body,emojiImage:n,sourceURI:o?o:''}));},renderPhotoAttachments:function j(k,l,m,n){var o,p=k.length;if(!p)return null;var q=l&&l.thread_fbid;if(l&&!q)q=c('MercuryIDs').isLocalThread(l.thread_id)?null:c('MercuryIDs').getThreadFBIDFromThreadID(l.thread_id);var r=q?new (c('MessengerSharedPhotosContainerRoute'))({threadFBID:q,newViewGK:c('MercuryConfig').SharedPhotoNewView}):null;if(p===1){var o=function(){var t=k[0],u=c('MercuryAttachment').resizeContain({width:m,height:m},{width:t.preview_width,height:t.preview_height}),v=c('MessengerFromViewerUtils').isFromViewer(l),w=c('MercuryConfig').WWWPhotoForwardButton&&t.metadata&&t.metadata.fbid?c('React').createElement(c('ChatPhotoForwardButton.react'),{photoIDs:[t.metadata.fbid.toString()],isFromViewer:v}):null,x=!r||c('MercuryAttachment').hasAttribution(t)||!c('MercuryConfig').MessengerNavigateThreadPhotosGK?c('React').createElement(c('MercuryAttachmentPhoto.react'),{image:t,width:u.width,hasAttribution:true,height:u.height,message:l,onAttachmentLoad:n,round:true}):c('React').createElement(c('RelayRootContainer'),{Component:c('MercuryAttachmentPhotoContainer.react'),renderLoading:function y(){return null;},route:r,renderFetched:function y(z){return (c('React').createElement(c('MercuryAttachmentPhotoContainer.react'),babelHelpers['extends']({},z,{image:t,width:u.width,height:u.height,message:l,onAttachmentLoad:n,round:true})));}});return {v:c('React').createElement('div',{className:"_55pk"+(' '+"_59go")+(c('MercuryAttachment').hasAttribution(t)?' '+"_4yjw":'')},w,x,c('React').createElement(c('ChatAttachmentAttribution.react'),{attachment:new (c('ImmutableObject'))(k[0])}))};}();if(typeof o==="object")return o.v;}var s=c('MercuryConfig').MessengerNavigateThreadPhotosGK&&r?c('React').createElement(c('RelayRootContainer'),{Component:c('MercuryAttachmentPhotoGridContainer.react'),renderLoading:function t(){return null;},route:r,renderFetched:function t(u){return (c('React').createElement(c('MercuryAttachmentPhotoGridContainer.react'),babelHelpers['extends']({},u,{images:k,size:m,message:l})));}}):c('React').createElement(c('MercuryAttachmentPhotoGrid.react'),{images:k,size:m,message:l});return (c('React').createElement('div',{className:"_55pk"},s));},sortAttachmentsStablyByType:function j(k){var l=[c('MercuryAttachment').isEmojiLikeAttachment,c('MercuryAttachment').isPhotoAttachment,c('MercuryAttachment').isShareAttachment,c('MercuryAttachment').isFileAttachment,c('MercuryAttachment').isErrorAttachment];l.push(function(n){return true;});var m=l.map(function(n){return [];});k.forEach(function(n){for(var o=0;o<l.length;o++)if(l[o](n)){m[o].push(n);break;}});return Array.prototype.concat.apply([],m);},constructStoryBasedShareAttachment:function j(k,l,m,n,o){var p=m?c('MercuryShareAttachmentRenderLocations').CHAT:c('MercuryShareAttachmentRenderLocations').WEB_INBOX,q=void 0;if(c('MercuryConfig').ChatMessengerStyles)q={maxWidth:n};var r=null;if(k&&k.platform_xmd)r=JSON.parse(k.platform_xmd);return (c('React').createElement('div',{className:(!!(k.body&&m&&!c('MercuryConfig').ChatMessengerStyles)?"_r38":'')+(c('MercuryConfig').ChatMessengerStyles?' '+"_3_om":'')+(c('MercuryConfig').ChatMessengerStyles?' '+"_3cpq":''),style:q},c('React').createElement(c('MercuryShareAttachment.react'),{attachment:l.share,isSponsored:k.is_sponsored,location:p,maxWidth:n,messageID:k.message_id,mnMessageType:r&&r.template_type,onComponentLoaded:o,pageID:k.author,threadID:k.thread_id})));}};f.exports=i;}),null);
__d('MercuryAttachments.react',['cx','MercuryAttachmentRenderer','ImmutableObject','MercuryAttachment','MercuryAttachmentMalicious.react','MercuryAttachmentError.react','MessagingFlowerBorder.react','MessagingGiftWrap.react','MessengerHotLikePreview.react','MNCommerceMessageType','React','SubscriptionsHandler','emptyFunction','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return m=(n=j.constructor).call.apply(n,[this].concat(p)),this.$MercuryAttachments1=function(r){this.props.onAttachmentLoad&&this.props.onAttachmentLoad(r);}.bind(this),this.$MercuryAttachments2=null,this.$MercuryAttachments3=function(r){if(c('MercuryAttachment').isStickerAttachment(r)){return c('MercuryAttachmentRenderer').constructStickerComponent(this.props.message,this.props.attachments[0].metadata,this.props.onStickerClick,this.props.isChat,this.$MercuryAttachments1,this.props.customColor);}else if(c('MercuryAttachment').isEmojiLikeAttachment(r)){var s=c('MercuryAttachmentRenderer').constructEmojiLikeAttachment(r,this.props.message);return s?s:c('React').createElement(c('MercuryAttachmentError.react'),null);}else if(c('MercuryAttachment').isVoiceAttachment(r)){return c('MercuryAttachmentRenderer').renderAudioClip(this.props.attachments[0],this.props.isChat,this.props.customColor,this.props.message);}else if(c('MercuryAttachment').isVideoAttachment(r)){return c('MercuryAttachmentRenderer').renderVideo(r,this.props.isChat,this.props.message,this.$MercuryAttachments1);}else if(c('MercuryAttachment').isShareAttachment(r)){return c('MercuryAttachmentRenderer').constructStoryBasedShareAttachment(this.props.message,r,this.props.isChat,this.props.maxWidth,this.$MercuryAttachments1);}else if(c('MercuryAttachment').isFileAttachment(r)){return c('MercuryAttachmentRenderer').renderFile(r,this.props.isChat);}else if(c('MercuryAttachment').isErrorAttachment(r))return c('React').createElement(c('MercuryAttachmentError.react'),null);return c('React').createElement(c('MercuryAttachmentMalicious.react'),null);}.bind(this),m;}l.prototype.componentDidMount=function(){this.$MercuryAttachments2=new (c('SubscriptionsHandler'))();};l.prototype.componentWillUnmount=function(){this.$MercuryAttachments2&&this.$MercuryAttachments2.release();};l.prototype.render=function(){if(this.props.message.is_like_preview)return (c('React').createElement(c('MessengerHotLikePreview.react'),{isChat:this.props.isChat,key:'hlp:'+this.props.message.like_preview_since,since:this.props.message.like_preview_since,customLike:this.props.message.customLike,customColor:this.props.customColor}));if(this.props.attachments.length===0)return c('React').createElement('div',this.props);if(this.props.message.commerce_message_type===c('MNCommerceMessageType').RIDE_INTENT)return c('React').createElement('div',this.props);var m=c('MercuryAttachmentRenderer').renderPhotoAttachments(this.props.attachments.filter(c('MercuryAttachment').isPhotoAttachment),this.props.message,this.props.maxWidth,this.$MercuryAttachments1),n=c('MercuryAttachmentRenderer').sortAttachmentsStablyByType(this.props.attachments.filter(function(p){return !c('MercuryAttachment').isPhotoAttachment(p);})).map(function(p,q){return (c('React').createElement('span',{key:q},this.$MercuryAttachments3(p)));}.bind(this)),o=this.props.hasFlowerBorder?c('joinClasses')("_337n",this.props.className):this.props.className;return (c('React').createElement('div',babelHelpers['extends']({},this.props,{className:o}),m,n,this.props.renderProgressBar&&this.props.renderProgressBar(),this.props.isGiftWrapped?c('React').createElement(c('MessagingGiftWrap.react'),{onUnwrap:this.props.onUnwrap}):null,this.props.hasFlowerBorder?c('React').createElement(c('MessagingFlowerBorder.react'),null):null));};l.propTypes={attachments:k.array.isRequired,customColor:k.string,customLike:k.object,hasFlowerBorder:k.bool,maxWidth:k.number.isRequired,message:k.instanceOf(c('ImmutableObject')).isRequired,isChat:k.bool,isGiftWrapped:k.bool,onAttachmentLoad:k.func,onStickerClick:k.func,onProgressBarLoad:k.func,onUnwrap:k.func};l.defaultProps={isChat:false,onAttachmentLoad:c('emptyFunction'),onStickerClick:c('emptyFunction')};f.exports=l;}),null);
__d('WebMessengerStateConstants',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={STATE_CHANGE_EVENT:'state-changed',DETAIL:{COMPOSE_MAIN:'compose-main',COMPOSE_TYPEAHEAD_RESULTS:'compose-typeahead-results',COMPOSE_ALL_PEOPLE_RESULTS:'compose-all-people-results',RECENT_MESSAGES:'recent-messages',SEARCH_CONTEXT:'search-context',SEARCH_SNIPPET:'search-snippet',SEARCH_THREAD_SNIPPET:'search-thread-snippet',SHARED_PHOTOS:'shared-photos'},MASTER:{RECENT_THREADS:'recent-threads',SEARCH:'search'},MESSAGE_ACTION:{DELETE:'delete'}};f.exports=h;}),null);
__d('WebMessengerOldToNewPermalink',['WebMessengerPermalinkConstants','WebMessengerStateConstants'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(m){if(!i(m))return m;j(m);l(m);k(m);return m;}function i(m){var n=m.getQueryData();if(n.sk)switch(n.sk){case 'inbox':m.setPath(c('WebMessengerPermalinkConstants').BASE_PATH);m.removeQueryData('sk');break;case 'other':m.setPath(c('WebMessengerPermalinkConstants').OTHER_PATH);m.removeQueryData('sk');break;default:return false;}return true;}function j(m){var n=m.getQueryData();switch(n.action){case 'read':if(!n.tid){m.addQueryData({action:c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES});}else m.removeQueryData('action');break;}}function k(m){var n=m.getQueryData();if(n.tid){m.setPath(c('WebMessengerPermalinkConstants').getURIPathForThreadID(n.tid,m.getPath()));m.removeQueryData('tid');}}function l(m){var n=m.getQueryData();if(!m.getPath().match(c('WebMessengerPermalinkConstants').SEARCH_POSTFIX_PATH)&&n.action!=c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET&&!n.mid){var o=n.query;if(n.query){var p=/\bis:(archived|spam)\b(.*)/,q=p.exec(n.query);if(q){switch(q[1]){case 'archived':m.setPath(c('WebMessengerPermalinkConstants').ARCHIVED_PATH);break;case 'spam':m.setPath(c('WebMessengerPermalinkConstants').SPAM_PATH);break;}var r=n.query.substr(0,n.query.length-q[0].length),s=q[2];o=(r.trim()+' '+s.trim()).trim();}}if(n.thread_query){m.setPath(m.getPath()+c('WebMessengerPermalinkConstants').SEARCH_POSTFIX_PATH);m.setQueryData({query:n.thread_query});}else if(o){m.setPath(m.getPath()+c('WebMessengerPermalinkConstants').SEARCH_POSTFIX_PATH);m.addQueryData({query:o});}else m.removeQueryData('query');}}f.exports=h;}),null);
__d('WebMessengerStateStore',['MercuryAssert','PresenceState'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=null;function i(){var k=c('PresenceState').get();if(k&&k.wml)return k.wml;return {};}c('PresenceState').registerStateStorer(function(k){if(h)k.wml=h;h=null;});var j={getLastSeenThreadID:function k(){var l=i();return l.thread_id||null;},getLastSeenFolder:function k(){var l=i();return l.folder||null;},setLastSeen:function k(l,m){m&&c('MercuryAssert').isThreadID(m);h={folder:l,thread_id:m||null};c('PresenceState').doSync();}};f.exports=j;}),null);
__d('WebMessengerPermalinks',['MercuryAPIArgsSource','MercuryFilters','MercuryIDs','MercuryParticipants','MercuryParticipantTypes','MercuryThreadIDMap','MercuryTypeaheadConstants','MessagingTag','WebMessengerOldToNewPermalink','WebMessengerPermalinkConstants','WebMessengerStateConstants','WebMessengerStateStore','MercuryThreads','Token','URI','WebMessengerPreferences','WWWBase','MercuryUnreadState','createCancelableFunction','goURI','isWebMessengerURI'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get(),i=c('MercuryThreads').get(),j='(/|\\?|$)';c('MercuryParticipants');c('MercuryIDs');var k={getDefaultURI:function x(){var y=new (c('URI'))(c('WWWBase').uri);y.setPath(c('WebMessengerPermalinkConstants').BASE_PATH);return y;},goNextURI:function x(y,z,aa,ba){if(t(y,z,aa)){var ca=k.getURI(y,z,aa);c('goURI')(ca,false,ba);return true;}return false;},getURI:function x(y,z,aa){var ba=k.getDefaultURI();if(!y||!z||!aa)return ba;switch(aa.folder){case c('MessagingTag').OTHER:ba.setPath(c('WebMessengerPermalinkConstants').OTHER_PATH);break;case c('MessagingTag').ACTION_ARCHIVED:ba.setPath(c('WebMessengerPermalinkConstants').ARCHIVED_PATH);break;case c('MessagingTag').SPAM:ba.setPath(c('WebMessengerPermalinkConstants').SPAM_PATH);break;case c('MessagingTag').PENDING:ba.setPath(c('WebMessengerPermalinkConstants').PENDING_PATH);break;}if(aa.filter&&aa.filter!=c('MercuryFilters').ALL)ba.addQueryData({filter:aa.filter});var ca;switch(y){case c('WebMessengerStateConstants').MASTER.SEARCH:ca=false;ba.setPath(ba.getPath()+c('WebMessengerPermalinkConstants').SEARCH_POSTFIX_PATH);break;}switch(z){case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:case c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:ba.setPath(ba.getPath()+c('WebMessengerPermalinkConstants').COMPOSE_POSTFIX_PATH);ca=false;break;case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:ca=!aa.thread_id;break;case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:case c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS:ca=false;break;default:ca=true;break;}if(ca)ba.addQueryData({action:z});if(aa.thread_id){var da=c('MercuryIDs').getUserIDFromThreadID(aa.thread_id),ea=da&&c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(da));if(ea&&ea.type!==c('MercuryParticipantTypes').EVENT){var fa=ea&&ea.vanity||da;ba.setPath(c('WebMessengerPermalinkConstants').getURIPathForIDOrVanity(fa,ba.getPath()));}else{var ga=h.getServerIDFromClientIDNow(aa.thread_id),ha=ga?ga:aa.thread_id;ba.setPath(c('WebMessengerPermalinkConstants').getURIPathForThreadID(ha,ba.getPath()));}}if(aa.query)ba.addQueryData({query:aa.query});if(aa.message_query)ba.addQueryData({mquery:aa.message_query});if(aa.message_id)ba.addQueryData({mid:aa.message_id});if(aa.reuse_composer)ba.addQueryData({rc:true});if(aa.isStandaloneMode)ba.addQueryData({standalone:true});return ba;},processURI:function x(y,z){y=c('WebMessengerOldToNewPermalink')(y);if(!c('isWebMessengerURI')(y))return z(false);var aa,ba=u(y),ca=!ba.master_state||!ba.detail_state;if(ca){aa=v(y);}else{aa={data:{folder:r(y),filter:s(y)},redirect:false,master_state:ba.master_state,detail_state:ba.detail_state};if(y.getQueryData().rc)aa.data.reuse_composer=true;aa=o(y,aa);}aa.data.isStandaloneMode=y.getQueryData().standalone;if(ca)return z(aa);switch(ba.detail_state){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:return q(y,aa,z);case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:return l(y,aa,z);case c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET:return p(y,aa,z);case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:return q(y,aa,function(da){p(y,da,function(ea){n(y,ea,z);});});}aa.redirect=true;aa.detail_state=null;return z(aa);}};function l(x,y,z){var aa=null;if(x.getQueryData().to)aa=[].concat(x.getQueryData().to);z(m(aa,y));}function m(x,y){if(x){y.data.new_tokens=[];x.forEach(function(z){var aa=c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(z));if(aa){var ba={uid:z,text:aa.name,type:c('MercuryTypeaheadConstants').USER_TYPE};y.data.new_tokens.push(new (c('Token'))(ba));}});}y.data.start=true;return y;}function n(x,y){var z=x.getQueryData().mid;if(z){y.data.message_id=z;}else y.redirect=true;return y;}function o(x,y){var z=x.getQueryData().query;y.data.query=z;return y;}function p(x,y,z){var aa=x.getQueryData().mquery;y.data.message_query=aa;z(y);}function q(x,y,z){var aa=c('WebMessengerPermalinkConstants').getThreadIDFromURI(x);if(aa){var ba=c('MercuryIDs').isValidThreadID(aa)?aa:h.getClientIDFromServerIDNow(aa);if(ba){y.data.thread_id=ba;}else y.redirect=true;}else{var ca=c('WebMessengerPermalinkConstants').getUserIDOrVanity(x.getPath());if(ca){var da=c('MercuryParticipants').getIDFromVanityOrFBID(ca);if(!da){if(!y.waiting){y.waiting=true;y.retry=c('createCancelableFunction')(function(){q(x,y,z);});c('MercuryParticipants').addListener('change',y.retry);z(y);}return;}var ea=da&&i.getCanonicalThreadToParticipant(da,null,c('MercuryAPIArgsSource').WEBMESSENGER);if(ea){delete y.waiting;if(y.retry)y.retry.cancel();if(ea.timestamp){y.data.thread_id=ea.thread_id;}else{y.detail_state=c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN;y=m([c('MercuryIDs').getUserIDFromParticipantID(da)],y);}}else y.redirect=true;}}z(y);}function r(x,y){var z=x.getPath();if(z.match('^'+c('WebMessengerPermalinkConstants').ARCHIVED_PATH+j))return c('MessagingTag').ACTION_ARCHIVED;if(z.match('^'+c('WebMessengerPermalinkConstants').OTHER_PATH+j))return c('MessagingTag').OTHER;if(z.match('^'+c('WebMessengerPermalinkConstants').SPAM_PATH+j))return c('MessagingTag').SPAM;if(z.match('^'+c('WebMessengerPermalinkConstants').PENDING_PATH+j))return c('MessagingTag').PENDING;if(y!==undefined)return y;return c('MessagingTag').INBOX;}function s(x){return x.getQueryData().filter||c('MercuryFilters').ALL;}function t(x,y,z){if(y===c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT||y===c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET||y===c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS)return false;if(z&&z.no_uri===true){delete z.no_uri;return false;}var aa=y==c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN||y==c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS||y==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(aa&&(!z.start||z.new_tokens))return false;if(!x||!y||!z)return true;if(z.bug_reporting_enabled)return false;return !z.message_action;}function u(x){var y={},z=x.getPath(),aa=x.getQueryData(),ba=z.match(c('WebMessengerPermalinkConstants').BASE_PATH+'(/[^/]+)?'+c('WebMessengerPermalinkConstants').SEARCH_POSTFIX_PATH+j);y.master_state=ba&&aa.query?c('WebMessengerStateConstants').MASTER.SEARCH:c('WebMessengerStateConstants').MASTER.RECENT_THREADS;if(aa.action){y.detail_state=aa.action;return y;}if(z.match('(?:'+c('WebMessengerPermalinkConstants').BASE_PATH+'|'+c('WebMessengerPermalinkConstants').OTHER_PATH+')'+'(/[^/]+)?'+c('WebMessengerPermalinkConstants').COMPOSE_POSTFIX_PATH+j)){y.detail_state=c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN;return y;}if(z.match(c('WebMessengerPermalinkConstants').TID_POSTFIX_PARTIAL_PATH)||c('WebMessengerPermalinkConstants').getUserIDOrVanity(z)){if(aa.mid&&aa.mquery){y.detail_state=c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT;}else y.detail_state=c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES;}else if(aa.mquery)y.detail_state=c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET;return y;}function v(x){var y=r(x,null)||c('WebMessengerStateStore').getLastSeenFolder(),z=c('WebMessengerStateStore').getLastSeenThreadID()||w(y||c('MessagingTag').INBOX),aa=c('MercuryUnreadState').get();if(y===c('MessagingTag').OTHER&&aa.getUnreadCount(y)===0){var ba=c('MessagingTag').INBOX;if(aa.exceedsMaxCount(ba)||aa.getUnreadCount(ba)>0)y=ba;}var ca={redirect:!!z||!!y,replace:true,master_state:c('WebMessengerStateConstants').MASTER.RECENT_THREADS,detail_state:c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,data:{folder:y||c('MessagingTag').INBOX,filter:c('MercuryFilters').ALL,thread_id:z}};return ca;}function w(x){var y=c('WebMessengerPreferences').lastReadThreadForFolder[x];if(y){var z=y.other_user_fbid||y.thread_fbid;return h.getClientIDFromServerIDNow(z);}else return null;}f.exports=k;}),null);
__d('WebMessengerStateManager',['Arbiter','CurrentUser','Dialog','Focus','JSLogger','MercuryFilters','MessagingTag','WebMessengerPermalinks','WebMessengerStateConstants'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('JSLogger').create('wm_state_manager'),i=c('CurrentUser').getID(),j=false,k=Object.assign(new (c('Arbiter'))(),{getCurrentUserID:function r(){return i;},getCurrentMasterState:function r(){return n;},getCurrentDetailState:function r(){return o;},getCurrentStateData:function r(){return p;},getStandaloneMode:function r(){return j;},setUserID:function r(s){i=s||c('CurrentUser').getID();},setStandaloneMode:function r(s){j=Boolean(s);},updateMasterState:function r(s,t){k.updateAllStates(s,o,t);},updateDetailState:function r(s,t){k.updateAllStates(n,s,t);},updateAllStates:function r(s,t,u){for(var v=0;v<q.length;v++)if(q[v]){var w=q[v](s,t,u);if(w){h.log('confirmation_dialog',{master_state:n,detail_state:o,data:p,new_master_state:s,new_detail_state:t,new_data:u});w.setHandler(l.bind(null,s,t,u)).show();var x=w.getButtonElement(c('Dialog').OK.label);x&&c('Focus').set(x);return;}}l(s,t,u);},updateStateOnURI:function r(s,t,u){m(s,t,u);},registerConfirmationBeforeStateUpdate:function r(s){var t=q.length;q.push(s);return t;},unregisterConfirmationBeforeStateUpdate:function r(s){delete q[s];}});function l(r,s,t){if(!t.folder)t.folder=p.folder;if(!t.filter)t.filter=p.filter;t.isStandaloneMode=k.getStandaloneMode();if(!c('WebMessengerPermalinks').goNextURI(r,s,t))m(r,s,t);}function m(r,s,t){n=r;o=s;p=t;var u=babelHelpers['extends']({},p);u.new_tokens=[];(p.new_tokens||[]).forEach(function(v){u.new_tokens.push(v.getInfo());});u.new_tokens=[];h.log('state_updated',{master_state:n,detail_state:o,data:u});k.inform(c('WebMessengerStateConstants').STATE_CHANGE_EVENT);}var n=c('WebMessengerStateConstants').MASTER.RECENT_THREADS,o=c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,p={thread_id:null,folder:c('MessagingTag').INBOX,filter:c('MercuryFilters').ALL},q=[undefined];f.exports=k;}),null);
__d('WebMessengerAdsControl',['csx','cx','AdsMouseStateStore','Animation','Arbiter','WebMessengerConstants','CSS','CurrentUser','DataAttributeUtils','DOM','EgoAdsObjectSet','Event','KeyedCallbackManager','MercuryIDs','MercuryThreads','UIPagelet','URI','UserActivity','Vector','WebMessengerAdsConfig','WebMessengerStateManager','WebMessengerSubscriptionsHandler','cxodecode','getOrCreateDOMID','shield','throttle'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('MercuryThreads').get(),k=600,l=c('WebMessengerConstants').ADS_ROTATION_INTERVAL_PASSIVE,m=c('WebMessengerConstants').ADS_ROTATION_THRESHOLD_ACTIVE,n=c('WebMessengerConstants').MAX_ADS,o=2,p=165,q=c('AdsMouseStateStore').STATES,r='data-height',s=new (c('KeyedCallbackManager'))(),t='webMessengerAdsStage',u=0,v={},w=void 0,x=void 0;function y(){}Object.assign(y,{init:function fa(ga,ha){if(ga)w=c('cxodecode')(ga);if(ha)x=c('cxodecode')(ha);this._ads=new (c('EgoAdsObjectSet'))(w);this._initializedAds=false;this._loadingCount=null;this._stage=null;this._drawCount=0;this._lastRefresh=0;this._pageletInProgress=null;this._lastMousedOnAds=false;this._waitOn(['codes','container','sidebar','footer'],this.start.bind(this));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('UserActivity').subscribe(c('shield')(this._refreshIfReady,this)),c('Arbiter').subscribe('footerLoaded',function(){s.setResource('footer',1);}),c('Arbiter').subscribe(['sidebar/initialized','sidebar/visibility','minisidebar/show'],this._sideBarChanged.bind(this)),s);return this;},setContainer:function fa(ga){s.setResource('container',ga);this._container=ga;},setTrackingCodes:function fa(ga){s.setResource('codes',ga);},getTrackingCodes:function fa(){return s.getResource('codes');},updateRhcID:function fa(){var ga=c('DOM').scry(this._container,'div.ego_section')[0];if(!ga)return;c('AdsMouseStateStore').updateRhcID(c('getOrCreateDOMID')(ga));},start:function fa(){this._stage=c('DOM').create('div',{id:t,className:"_2rn"});this._ego=c('DOM').find(this._container,"._81");c('DOM').insertAfter(this._ego,this._stage);this.updateRhcID();this._updateFooterHeight();this.waitForAdsLoad(this._container,this._processOnPageUnits.bind(this));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(window,'resize',c('throttle')(this.draw,100,this)),c('Event').listen(this._ego,'mouseenter',c('shield')(this._mouseEvent,this,true)),c('Event').listen(this._ego,'mouseleave',c('shield')(this._mouseEvent,this,false)));},stateChanged:function fa(ga,ha){ga=ga||{};ha=ha||{};if(ga.thread_id&&ha.thread_id&&ha.thread_id!==ga.thread_id)this._refreshIfReady(true);},draw:function fa(){var ga=this._loadingCount<=0;if(!this._initializedAds||!this._drawCount&&!ga)return;this._adjustAdsToFit();},_processOnPageUnits:function fa(){this._ads.init(da(this._ego));this._initializedAds=true;this._adjustAdsToFit();},_processStagedUnits:function fa(){this._pageletInProgress=false;var ga=da(this._stage);if(!this._lastMousedOnAds&&ga.length&&!this._focusedOnAds()){c('DOM').empty(this._ego);while(this._stage.childNodes.length)c('DOM').appendContent(this._ego,this._stage.firstChild);this._ads.init(ga);this._lastRefresh=Date.now();this._adjustAdsToFit();}},waitForAdsLoad:function fa(ga,ha){var ia=da(ga);this._loadingCount=ia.length;if(!this._loadingCount){this._lastRefresh=Date.now()-l/2;this._pageletInProgress=false;return;}var ja=function(ka){ca(ka);if(--this._loadingCount<=0)ha();}.bind(this);ia.forEach(function(ka){function la(){setTimeout(ja.bind(null,ka),0);}var ma=c('DOM').scry(ka,'img.img')[0];if(!ma||ma.complete){la();}else c('Event').listen(ma,{load:la,error:la,abort:la});}.bind(this));},_adjustAdsToFit:function fa(){this._drawCount++;var ga=c('Vector').getViewportDimensions().y,ha=ga-this._footerHeight-p,ia=ha,ja=0;while(ia>0&&ja<this._ads.getCount()){ia-=ba(this._ads.getUnit(ja));if(ia>=0)ja++;}ja=Math.max(ja,o);for(var ka=0;ka<this._ads.getCount();ka++)aa(this._ads.getUnit(ka),ka>=ja);c('CSS').conditionShow(this._ego,ja);c('CSS').addClass(this._ads.getUnit(0),'ego_unit_no_top_border');var la=c('DOM').scry(this._container,'.ego_section');la.forEach(function(ma){z(ma,c('DOM').scry(ma,'[data-onscreen]').length);});z(this._container,true);this._registerImpressions(ja);this._registerHoldoutImpressions(ha);c('Arbiter').inform('WebMessengerAdsControl/adjustAds');},_waitOn:function fa(ga,ha){s.executeOrEnqueue(ga,ha);},_mouseEvent:function fa(ga){this._lastMousedOnAds=ga;},intentShown:function fa(){if(!c('WebMessengerAdsConfig').stateRefresh)return false;var ga=c('AdsMouseStateStore').getState();switch(ga){case q.STATIONARY:return !c('WebMessengerAdsConfig').refreshOnStationary;case q.INTENT:case q.HOVER:return true;default:return false;}},_focusedOnAds:function fa(){return c('DOM').contains(this._container,document.activeElement);},_refreshIfReady:function fa(ga){var ha=ga?m:l;if(this._lastRefresh===0){this._lastRefresh=Date.now();return;}else if(this._pageletInProgress||!this._drawCount||this._lastMousedOnAds||this._focusedOnAds()||this.intentShown()||this._lastRefresh+ha>Date.now())return;s.reset();this._waitOn(['codes'],this.waitForAdsLoad.bind(this,this._stage,this._processStagedUnits.bind(this)));this._pageletInProgress=c('UIPagelet').loadFromEndpoint('WebEgoPane',t,{pid:43,data:[c('CurrentUser').getID(),n,++u,ea()]},{crossPage:true,bundle:false,handler:this.onLoadHandler.bind(this)});},onLoadHandler:function fa(){if(!c('WebMessengerAdsConfig').fade)return;new (c('Animation'))(this._container).from('opacity',0).to('opacity',1).duration(k).go();},_updateFooterHeight:function fa(){c('CSS').hide(this._ego);this._footerHeight=c('Vector').getElementDimensions(this._container).y;c('CSS').show(this._ego);},_registerImpression:function fa(ga){var ha=this.getTrackingCodes();if(!ha||!ha[ga])return null;var ia=c('DOM').create('iframe',{src:new (c('URI'))('/ai.php').addQueryData({aed:ha[ga]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});ia.setAttribute('aria-hidden','true');c('DOM').appendContent(this._container,ia);return ia;},_registerImpressions:function fa(ga){var ha=this.getTrackingCodes(),ia=v;v={};for(var ja=0;ja<ga;ja++){if(!this._ads.getUnit(ja))continue;var ka=c('DOM').scry(this._ads.getUnit(ja),w||"div._4u8");if(!ka.length)continue;var la=c('DataAttributeUtils').getDataAttribute(ka[0],'data-ad'),ma=JSON.parse(la).adid;if(ma in ia){v[ma]=ia[ma];delete ia[ma];}else{if(!ha||!ha[ma])continue;var na=this._registerImpression(ma);delete ha[ma];if(na)v[ma]=na;}}for(ma in ia)c('DOM').remove(ia[ma]);},_registerHoldoutImpressions:function fa(ga){var ha=this._ads.getHoldoutAdIDsForSpace(ga,ba);if(ha)ha.forEach(this._registerImpression.bind(this));},_sideBarChanged:function fa(ga){if(ga=='sidebar/initialized')s.setResource('sidebar',1);this._initializedAds&&this.draw();}});function z(fa,ga){c('CSS').conditionClass(fa,"_2rn",!ga);}function aa(fa,ga){c('CSS').conditionClass(fa,x||"_53o5",ga);fa.setAttribute('aria-hidden',ga?'true':'false');if(ga){fa.removeAttribute('data-onscreen');}else fa.setAttribute('data-onscreen','1');}function ba(fa){if(!fa)return 0;var ga=fa.getAttribute(r)||ca(fa);return parseInt(ga,10);}function ca(fa){var ga=c('Vector').getElementDimensions(fa).y;fa.setAttribute(r,ga);return ga;}function da(fa){return c('DOM').scry(fa,'div.ego_unit');}function ea(){var fa=c('WebMessengerStateManager').getCurrentStateData();if(fa.thread_id){var ga=j.getThreadMetaNow(fa.thread_id);if(ga)return ga.participants.map(function(ha){return c('MercuryIDs').getUserIDFromParticipantID(ha);}).filter(function(ha){return ha&&ha!=c('CurrentUser').getID();});}return [];}f.exports=y;}),null);
__d('WebMessengerActionsMenuItem',['CSS','MenuItem','WebMessengerStateManager'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MenuItem'));i=h&&h.prototype;function j(k){'use strict';k.href=k.href||'#';i.constructor.call(this,k);this.setOnClickHandler(this.handleMenuItemClick);this.showFn=this._data.should_show_fn;this.hasAction=function(){return !this._data.hideManually;}.bind(this);}j.prototype.handleMenuItemClick=function(){'use strict';var k=c('WebMessengerStateManager').getCurrentStateData().thread_id;k&&this._data.onclick(k);};j.prototype.updateShownState=function(k){'use strict';if(this.showFn){this._isHidden=!this.showFn(k);if(this._root)c('CSS').conditionShow(this._root,!this._isHidden);}};j.prototype.isShown=function(k){'use strict';var l=this.showFn?this.showFn(k):true;return l;};j.prototype.render=function(){'use strict';var k=i.render.call(this);if(this._isHidden)c('CSS').hide(k);return k;};f.exports=j;}),null);
__d('MercuryDataSources',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i={add:function j(k,l){h[k]=l;},get:function j(k){!h[k];return h[k];}};f.exports=i;}),null);
__d('MercuryTypeahead',['cx','Event','ArbiterMixin','DOM','DOMDimensions','Input','Keys','MercuryTypeaheadTemplates','Tokenizer','Typeahead','TypeaheadCore','WorkModeConfig'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=function j(k,l){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=k;this._view=l;};Object.assign(i.prototype,c('ArbiterMixin'));Object.assign(i.prototype,{setPlaceholder:function j(k){this._placeholder=k;return this;},setExcludedParticipantsFromThreadMeta:function j(k){if(!k)return;if(!k.former_participants||c('WorkModeConfig').is_work_user){this.setExcludedParticipants(k.participants);return;}var l=k.former_participants.filter(function(m){return m.is_friend===false;}).map(function(m){return m.id;});this.setExcludedParticipants(l.concat(k.participants));},setExcludedParticipants:function j(k){this._exclusions=[];k.forEach(function(l){var m=l.indexOf(':');if(l.substr(0,m)=='fbid')this._exclusions.push(l.substr(m+1));}.bind(this));return this;},setViewNodeID:function j(k){this._viewNodeOrID=k;},setViewNode:function j(k){this._viewNodeOrID=k;},setFullWidthView:function j(k){var l=c('DOM').create('div',{className:"_4ck uiTypeaheadView"});c('DOM').setContent(k,l);this.setViewNode(l);},setViewOption:function j(k,l){this._viewOptions[k]=l;},addTokenizerBehavior:function j(k){this._tokenizerBehaviors.push(k);},build:function j(k){if(this._domElement)return;var l=c('MercuryTypeaheadTemplates')[':fb:mercury:tokenizer'].build(),m=c('MercuryTypeaheadTemplates')[':fb:mercury:typeahead'].build();this._domElement=l.getRoot();c('DOM').appendContent(this._domElement,m.getRoot());var n=m.getNode('textfield');c('Input').setPlaceholder(n,this._placeholder);n.setAttribute('data-placeholder',this._placeholder);this._input=n;var o={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},p={ctor:c('TypeaheadCore'),options:{setValueOnSelect:true}};this._typeahead=new (c('Typeahead'))(this._dataSource,o,p,m.getRoot());this._typeahead.init();var q={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new (c('Tokenizer'))(this._domElement,this._typeahead);this._tokenizer.init(l.getNode('tokenarea'),'participants',[],q);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',function(){this.inform('resize');}.bind(this));c('Event').listen(n,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));c('Event').listen(this._domElement,'click',this.focus.bind(this));c('Event').listen(n,'keydown',this.keydown.bind(this));this._heightPrev=c('DOMDimensions').getElementDimensions(this._domElement).height;},getElement:function j(){return this._domElement;},getSelectedParticipantIDs:function j(){var k=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(l){k.push('fbid:'+l);});return k;},getTokens:function j(){var k=[];if(this._tokenizer)k=this._tokenizer.getTokens();return k;},getTokenizer:function j(){return this._tokenizer;},keydown:function j(event){if(this._tokenizer.inline&&event.keyCode==c('Keys').ESC){if(c('Input').isEmpty(this._input)){var k=this._tokenizer.getLastToken();if(k&&k.isRemovable()){this._tokenizer.removeToken(k);event.stopPropagation();return;}}else{this._typeahead.getCore().reset();event.stopPropagation();return;}this.inform('esc-pressed');return;}if(c('Input').isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===c('Keys').RETURN){event.preventDefault();return this.inform('tokens-return');}},reset:function j(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function j(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function j(){return this._typeahead;},_resetDataSource:function j(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function j(){this.inform('tokens-changed');}});f.exports=i;}),null);
__d('MercuryTypeaheadRenderer',['cx','Event','Badge.react','CSS','DOM','Image.react','MercuryTypeaheadConstants','MercuryParticipantsConstants','React','ReactDOM','MercuryTypeaheadTemplates'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(k,l){var m;switch(k.type){case c('MercuryTypeaheadConstants').HEADER_TYPE:m=c('MercuryTypeaheadTemplates')[':fb:mercury:typeahead:header'].build();i.renderHeader(m,k);break;case c('MercuryTypeaheadConstants').USER_TYPE:case c('MercuryTypeaheadConstants').PAGE_TYPE:m=c('MercuryTypeaheadTemplates')[':fb:mercury:typeahead:result'].build();i.renderPerson(m,k);break;default:throw new Error('Unsupported result type: '+k.type);}return m.getRoot();}Object.assign(i,{renderHeader:function k(l,m){if(m.disabled){c('CSS').hide(l.getRoot());return;}var n=m.getLinkHandler&&m.getLinkHandler();if(n){var o=l.getNode('link');c('DOM').setContent(o,m.linkText);c('Event').listen(o,'click',n);}else c('CSS').hide(l.getNode('link'));l.setNodeContent('text',m.text);},renderPersonWithBigPhoto:function k(l,m){j(l,m,c('MercuryParticipantsConstants').BIG_IMAGE_SIZE);},renderPerson:function k(l,m){j(l,m,c('MercuryParticipantsConstants').IMAGE_SIZE);},renderPage:function k(l,m){j(l,m,c('MercuryParticipantsConstants').IMAGE_SIZE);}});function j(k,l,m){if(l.photo){var n=c('React').createElement(c('Image.react'),{width:m,height:m,src:l.photo});c('ReactDOM').render(n,k.getNode('image'));}if(l.text){c('DOM').setContent(k.getNode('name'),l.text);k.getRoot().setAttribute('aria-label',l.text);}var o=[];if(l.subtext||l.category){if(l.subtext)o.push(l.subtext);if(l.category)o.push(l.category);c('DOM').appendContent(k.getNode('snippet'),o.join(" \u00b7 "));}var p=null;if(l.is_verified){p=c('React').createElement(c('Badge.react'),{type:'verified',size:'xsmall'});c('ReactDOM').render(p,k.getNode('badge'));}else if(l.is_work_user){p=c('React').createElement(c('Badge.react'),{type:'work',size:'xsmall'});c('ReactDOM').render(p,k.getNode('badge'));}if(l.non_employee){if(o.length)c('DOM').prependContent(k.getNode('snippet')," \u00b7 ");var q=c('DOM').create('span',{className:"_52l8 highlight"},'(Non-Employee)');c('DOM').prependContent(k.getNode('snippet'),q);}if(l.render_type===c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE){var r={href:'/'+l.uid.toString(),target:'_blank',role:'link'};c('DOM').setAttributes(k.getNode('threadLink'),r);}}f.exports=i;}),null);
__d('WebMessengerAddPeopleToConversationDialog',['fbt','ContextualTypeaheadView','Dialog','DOM','MercuryAPIArgsSource','MercuryDataSources','MercuryIDs','MercuryLogMessageType','MercurySourceType','MercuryThreadActions','MercuryTypeahead','MercuryTypeaheadConstants','MercuryTypeaheadRenderer','MercuryViewer','MercuryMessageObject','MercuryMessageActions','MessengerAdminGroupUtils','WebMessengerTemplates','MercuryThreads','WorkModeConfig'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreadActions').get(),j=c('MercuryMessageObject').get(),k=c('MercuryMessageActions').get(),l=c('MercuryThreads').get(),m={show:function o(p){var q={};q[c('MercuryTypeaheadConstants').FRIEND_TYPE]={uid:c('MercuryTypeaheadConstants').FRIEND_TYPE,type:c('MercuryTypeaheadConstants').HEADER_TYPE,disabled:true};q[c('MercuryTypeaheadConstants').NON_FRIEND_TYPE]={uid:c('MercuryTypeaheadConstants').NON_FRIEND_TYPE,text:h._("\u5176\u4ed6\u4eba"),type:c('MercuryTypeaheadConstants').HEADER_TYPE};var r=new (c('MercuryTypeahead'))(c('MercuryDataSources').get('MercuryRecipientsDataSource'),c('ContextualTypeaheadView'));r.setViewOption('renderer',c('MercuryTypeaheadRenderer'));r.setViewOption('typeObjects',q);var s=[],t=c('WebMessengerTemplates')[':fb:web-messenger:add-people-dialog'].build();l.getThreadMeta(p,function(u){var v=c('MessengerAdminGroupUtils').shouldAddToApprovalQueue(u,c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID())),w=v?h._("\u9080\u8acb\u670b\u53cb"):h._("\u52a0\u5176\u4ed6\u4eba");s.push({name:'subscribe',label:w,handler:n.bind(null,u,r)});var x=c('WorkModeConfig').is_work_user?h._("\u5c07\u540c\u4e8b\u52a0\u5165\u804a\u5929\u5ba4"):h._("\u65b0\u589e\u670b\u53cb\u5230\u9019\u500b\u804a\u5929\u5ba4");x=v?h._("\u9080\u8acb\u670b\u53cb\u5230\u9019\u500b\u804a\u5929\u5ba4"):x;s.push(c('Dialog').CANCEL);r.setPlaceholder(x);var y=new (c('Dialog'))().setTitle(w).setButtons(s).setBody(t.getRoot()).showLoading();r.setFullWidthView(t.getNode('participantsTypeahead'));r.setExcludedParticipantsFromThreadMeta(u);r.build();c('DOM').appendContent(t.getNode('participantsTypeahead'),r.getElement());y.show();r.focus();},c('MercuryAPIArgsSource').WEBMESSENGER);}};function n(o,p){var q=p.getTokens(),r=q.map(function(s){return c('MercuryIDs').getParticipantIDFromUserID(s.getValue());});if(!r.length)return false;if(c('MessengerAdminGroupUtils').shouldAddToApprovalQueue(o,c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID()))){i.inviteToJoinableGroup(o.thread_fbid,q.map(function(s){return s.getValue();}));}else k.send(j.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,o.thread_id,c('MercuryLogMessageType').SUBSCRIBE,{added_participants:r}),null,c('MercuryAPIArgsSource').WEBMESSENGER);return true;}f.exports=m;}),null);
__d('WebMessengerDeleteThreadDialog',['fbt','React','SimpleXUIDialog','MercuryThreadActions','XUIDialogButton.react','XUIDialogCancelButton.react'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreadActions').get(),j={show:function k(l,m,n){var o=h._("\u522a\u9664\u6574\u4e32\u5c0d\u8a71\uff1f"),p=h._("\u4e00\u65e6\u4f60\u522a\u9664\u4e86\u4f60\u9019\u65b9\u7684\u5c0d\u8a71\u526f\u672c\uff0c\u5c31\u5c07\u7121\u6cd5\u5fa9\u539f\u3002"),q=c('React').createElement('div',null,c('React').createElement(c('XUIDialogCancelButton.react'),null),c('React').createElement(c('XUIDialogButton.react'),{action:'cancel',label:h._("\u522a\u9664\u5c0d\u8a71"),use:'confirm',onClick:function r(){i['delete'](l);m&&m();}}));c('SimpleXUIDialog').showEx(p,o,q,null,{causalElement:n});}};f.exports=j;}),null);
__d('WebMessengerEditThreadDialog',['csx','cx','Event','Button','ContextualDialog','CSS','DOM','FileInput','FileInputUploader','Input','InputSelection','LayerFadeOnHide','LayerFadeOnShow','LayerHideOnTransition','MercuryAPIArgsSource','MercuryLogMessageType','MercurySourceType','MercuryMessageObject','MercuryMessageActions','WebMessengerTemplates','MercuryThreads','URI','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('MercuryMessageObject').get(),k=c('MercuryMessageActions').get(),l=c('MercuryThreads').get(),m=':fb:web-messenger:read-view:header:edit-multichat';function n(){'use strict';var o=c('WebMessengerTemplates')[m].build();this._dialog=new (c('ContextualDialog'))({position:'below',addedBehaviors:[c('LayerFadeOnHide'),c('LayerFadeOnShow'),c('LayerHideOnTransition')]},o.getRoot());this._saveButton=o.getNode('saveButton');this._cancelButton=o.getNode('cancelButton');this._pictureInput=o.getNode('newPicture');this._uploadButton=o.getNode('uploadButton');this._uploadingThrobber=o.getNode('uploadingThrobber');this._uploadedFileDetails=o.getNode('uploadedFileDetails');this._fileNameNode=o.getNode('fileName');this._cancelImageButton=o.getNode('cancelImage');this._threadID=null;var p=o.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var q=c('DOM').scry(o.getRoot(),"._8-9")[0];this._pictureInput=c('DOM').create('input',{accept:'image/*',type:'file',className:"_n",name:'attachment[]',tabindex:2});new (c('FileInput'))(q,this._uploadButton,this._pictureInput);}var r=new (c('URI'))('/ajax/mercury/upload.php').setSubdomain('upload').toString();this._uploader=new (c('FileInputUploader'))(this._pictureInput).setURI(r).setAllowCrossOrigin(true).setData({images_only:true});c('WebMessengerSubscriptionsHandler').addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),this._uploader.subscribe('failure',this._onFileUploadFailure.bind(this)),c('Event').listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),c('Event').listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));c('Event').listen(this._saveButton,'click',function(){this.save(c('Input').getValue(p));this._dialog.hide();}.bind(this));c('Event').listen(this._cancelButton,'click',function(){this._dialog.hide();}.bind(this));this._dialog.subscribe('show',function(){var s=l.getThreadMetaNow(this._threadID);c('Input').setValue(p,s.name);this._resetImageUpload();}.bind(this));this._dialog.subscribe('aftershow',function(){c('InputSelection').set(p,0,c('Input').getValue(p).length);}.bind(this));}n.prototype.toggleShown=function(o,p){'use strict';if(!this._dialog.isShown()){this._dialog.setContext(o);this._threadID=p;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();};n.prototype.save=function(o){'use strict';var p=null,q=l.getThreadMetaNow(this._threadID);if(q)p=q.name;if((o||p)&&o!=p)k.send(j.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,this._threadID,c('MercuryLogMessageType').THREAD_NAME,{name:o}),null,c('MercuryAPIArgsSource').WEBMESSENGER);if(this._uploadedImage)k.send(j.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,this._threadID,c('MercuryLogMessageType').THREAD_IMAGE,{image:this._uploadedImage}));};n.prototype._onFileUploadChange=function(event){'use strict';var o=c('Input').getValue(event.getTarget());if(o){c('Button').setEnabled(this._saveButton,false);c('CSS').hide(this._uploadButton);c('CSS').hide(this._uploadedFileDetails);c('CSS').show(this._uploadingThrobber);this._uploader.send();}};n.prototype._onFileUploadSuccess=function(o,p){'use strict';var q=p.response.getPayload();this._uploadedImage=q.metadata[0];c('DOM').setContent(this._fileNameNode,this._uploadedImage.filename);c('CSS').hide(this._uploadingThrobber);c('CSS').hide(this._uploadButton);c('CSS').show(this._uploadedFileDetails);c('Button').setEnabled(this._saveButton,true);};n.prototype._onFileUploadFailure=function(o,p){'use strict';c('Button').setEnabled(this._saveButton,true);this._resetImageUpload();};n.prototype._resetImageUpload=function(){'use strict';this._uploadedImage=null;this._pictureInput.value=null;c('CSS').hide(this._uploadingThrobber);c('CSS').hide(this._uploadedFileDetails);c('CSS').show(this._uploadButton);};f.exports=n;}),null);
__d("ListInputTargetTracker",[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){"use strict";this._index=undefined;this._items=[];}h.prototype.getIndex=function(){"use strict";return this._index;};h.prototype.setIndex=function(i){"use strict";this._index=Math.max(0,Math.min(i,this._items.length-1));};h.prototype.getNumItems=function(){"use strict";return this._items.length;};h.prototype.getItem=function(){"use strict";if(this._index!==undefined)return this._items[this._index];};h.prototype.setTargetItem=function(i){"use strict";this.updateIndex(this._items,i);};h.prototype.addItem=function(i){"use strict";this._items.push(i);};h.prototype.removeItemAtIndex=function(i){"use strict";this._items.splice(i,1);};h.prototype.removeItemByValue=function(i){"use strict";var j=this._items.indexOf(i);this.removeItemAtIndex(j);};h.prototype.moveUp=function(){"use strict";if(this._index===undefined||this._index===0){if(this._items.length){this._index=this._items.length-1;return true;}}else if(this._index>0){this._index--;return true;}return false;};h.prototype.moveDown=function(){"use strict";if(this._index===undefined||this._index===this._items.length-1){if(this._items.length){this._index=0;return true;}}else if(this._index<this._items.length-1){this._index++;return true;}return false;};h.prototype.updateIndex=function(i,j){"use strict";this._items=i||[];if(j){var k=this._items.indexOf(j);if(k>=0){this._index=k;}else if(this._index!==undefined)if(this._items.length>0){this._index=Math.min(this._index,this._items.length-1);}else this._index=undefined;}else this._index=undefined;return this._index;};f.exports=h;}),null);
__d('WebMessengerShortcuts',['csx','cx','fbt','BanzaiODS','DialogX','DOM','KeyEventController','LayerHideOnEscape','ListInputTargetTracker','MercuryAPIArgsSource','MessagingTag','Parent','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','UserAgent_DEPRECATED','WebMessengerEvents','arrayContains','ge','getOrCreateDOMID','shield','MercuryThreadActions','MercuryThreads'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreadActions').get(),l=c('MercuryThreads').get(),m=null,n=null,o=null,p={g:{callback:v,description:j._("\u641c\u5c0b\u5c0d\u8a71"),section:'searchAndHelp',uses_meta:true},m:{callback:u,description:j._("\u958b\u59cb\u65b0\u7684\u8a0a\u606f"),section:'navigation',uses_meta:true},i:{callback:da.bind(null,c('MessagingTag').INBOX),description:j._("\u524d\u5f80\u6536\u4ef6\u5323"),section:'navigation',uses_meta:true},u:{callback:da.bind(null,c('MessagingTag').OTHER),description:j._("\u524d\u5f80\u5176\u4ed6"),section:'navigation',uses_meta:true},z:{callback:x,description:j._("\u5c01\u5b58\uff0f\u672a\u5c01\u5b58\u5c0d\u8a71"),otherKeys:['y'],section:'conversation',uses_meta:true},r:{callback:y,description:j._("\u6a19\u793a\u8a0a\u606f\u70ba\u5df2\u8b80\uff0f\u672a\u8b80"),section:'conversation',uses_meta:true},UP:{callback:z,description:j._("\u9078\u64c7\u4e0b\u4e00\u6bb5\u5c0d\u8a71"),section:'navigation',uses_meta:false},DOWN:{callback:aa,description:j._("\u9078\u64c7\u4e0a\u4e00\u6bb5\u5c0d\u8a71"),section:'navigation',uses_meta:false},q:{callback:c('shield')(fa),description:j._("\u986f\u793a\uff0f\u96b1\u85cf\u6240\u6709\u9375\u76e4\u6377\u5f91"),section:'searchAndHelp',uses_meta:true}},q={registerGeneralShortcuts:function ga(){n=new (c('ListInputTargetTracker'))();for(var ha in p){var ia=p[ha],ja=[ha];if(ia.otherKeys)ja=ia.otherKeys.concat(ja);for(var ka=0;ka<ja.length;ka++)c('KeyEventController').registerKey(ja[ka],ia.callback,t.bind(null,ia.uses_meta));}},updateThreadlistIndex:function ga(ha,ia,ja){m=ha;if(n){if(!c('arrayContains')(ia,ja))ja=null;n.updateIndex(ia,ja);}},openSearchThread:function ga(){var ha=ca(),ia=c('WebMessengerStateManager').getCurrentMasterState();if(ha&&ia==c('WebMessengerStateConstants').MASTER.SEARCH)m.openSearchThread(ha);},showOrHideShortcuts:fa};function r(){return c('UserAgent_DEPRECATED').osx()?'CTRL':'ALT';}function s(ga){function ha(){if(!o){var ia=c('DOM').find(document.body,"._ksg");o=[];do{ia=ia.parentNode;o.push(ia);}while(ia&&ia!==document.body);}return o;}if(!c('Parent').bySelector(ga,"._ksg"))if(!c('arrayContains')(ha(),ga))if(!c('DOM').scry(ga,"._5hu2").length)return false;return true;}function t(ga,event,ha){if(!c('KeyEventController').filterEventTypes(event,ha))return false;if(!s(event.getTarget()))return false;var ia;if(ga)switch(r()){case 'CTRL':ia='ctrlKey';break;case 'ALT':ia='altKey';break;}var ja=['ctrlKey','metaKey','altKey','shiftKey'];for(var ka=0;ka<ja.length;ka++)if(ja[ka]!==ia&&event[ja[ka]])return false;return !ga||event[ia];}function u(){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.compose');c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,{start:true});return false;}function v(){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.search');c('WebMessengerEvents').focusAndSelectSearch();return false;}function w(ga){var ha;if(n.getNumItems()>1){var ia=n.getIndex();n.setIndex(ia===0?1:ia-1);ha=ca();}ga();c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{folder:c('WebMessengerStateManager').getCurrentStateData().folder,thread_id:ha});if(ha)m._manager.scrollIntoView(c('ge')(n.getItem()),false);}function x(){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.toggle_archive');var ga=ca();if(ga){l.getThreadMeta(ga,function(ha){if(ha.folder==c('MessagingTag').SPAM)return;w(function(){if(ha.is_archived){k.unarchive(ha.thread_id);}else k.archive(ha.thread_id);});},c('MercuryAPIArgsSource').WEBMESSENGER);return false;}}function y(){var ga=ca();c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.toggle_read_status');if(ga){l.getThreadMeta(ga,function(ha){var ia=!ha.unread_count;ia?k.markUnread(ga):k.markRead(ga);},c('MercuryAPIArgsSource').WEBMESSENGER);return false;}}function z(){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.go_to_next');if(n)if(n.getIndex()===0){switch(c('WebMessengerStateManager').getCurrentMasterState()){case c('WebMessengerStateConstants').MASTER.SEARCH:n.moveUp();ba();m._manager.scrollToBottom(false);break;default:m._manager.scrollToTop(false);c('WebMessengerEvents').focusSearch();}}else{if(n.getItem()){n.moveUp();}else n.moveDown();ba();}return false;}function aa(){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.go_to_previous');var ga=c('WebMessengerStateManager').getCurrentMasterState();if(n&&(ga!==c('WebMessengerStateConstants').MASTER.RECENT_THREADS||n.getIndex()<n.getNumItems()-1)){n.moveDown();ba();}return false;}function ba(){var ga=ca();if(ga){var ha=c('WebMessengerStateManager').getCurrentMasterState();if(ha==c('WebMessengerStateConstants').MASTER.SEARCH){m.updateKeyboardSelection(ga);c('WebMessengerEvents').focusSearch();}else c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:ga});if(n)if(n.getIndex()===0){m._manager.scrollToTop(false);}else m._manager.scrollIntoView(c('ge')(n.getItem()),false);}}function ca(){var ga=n&&n.getItem();if(typeof ga==='string'&&ga.indexOf(':')!==-1)return ga.substr(ga.indexOf(':')+1);return null;}function da(ga){if(ga===c('MessagingTag').INBOX){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.go_to_inbox');}else if(ga===c('MessagingTag').OTHER)c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.go_to_other');var ha=c('WebMessengerStateManager').getCurrentMasterState(),ia=ha==c('WebMessengerStateConstants').MASTER.SEARCH?null:c('WebMessengerStateManager').getCurrentStateData().thread_id;c('WebMessengerStateManager').updateMasterState(c('WebMessengerStateConstants').MASTER.RECENT_THREADS,{thread_id:ia,folder:ga});}var ea;function fa(ga){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.show_or_hide_shortcuts');if(!ea){var ha={};for(var ia in p){var ja=p[ia];if(!ja.uses_meta)continue;var ka=c('WebMessengerTemplates')[':fb:web-messenger:shortcuts-dialog:row'].build(),la=[ia],ma=[];if(ja.otherKeys)la=ja.otherKeys.concat(la);for(var na=0;na<la.length;na++){var oa=c('WebMessengerTemplates')[':fb:web-messenger:shortcuts-dialog:key'].build();oa.setNodeContent('meta',r());oa.setNodeContent('key',la[na]);ma.push(oa.getRoot());}ka.setNodeContent('keys',ma);ka.setNodeContent('description',ja.description);if(!ha[ja.section])ha[ja.section]=[];ha[ja.section].push(ka.getRoot());}var pa=c('WebMessengerTemplates')[':fb:web-messenger:shortcuts-dialog'].build();for(var qa in ha)pa.setNodeContent(qa,ha[qa]);var ra=c('DOM').scry(pa.getRoot(),"._1yw")[0],sa=null;if(ra)sa=c('getOrCreateDOMID')(ra);ea=new (c('DialogX'))({modal:true,titleID:sa,width:565},pa.getRoot());ea.enableBehavior(c('LayerHideOnEscape'));}if(ea.isShown()){ea.hide();}else{ea.show();if(typeof ga==='function')ea.subscribeOnce('hide',ga);}return false;}f.exports=q;}),null);
__d("XMessagingLeaveConversationDialogController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/leave_conversation\/",{__asyncDialog:{type:"Int"}});}),null);
__d("XNFXStartForMessageThreadController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/nfx\/start_message_thread\/",{thread_fbid:{type:"String",required:true},responsible_fbid:{type:"Int"},av:{type:"Int"},location:{type:"Enum",enumType:1},__asyncDialog:{type:"Int"}});}),null);
__d('WebMessengerDetailViewActionsMenuControl',['fbt','WebMessengerAddPeopleToConversationDialog','AsyncDialog','AsyncRequest','Bootloader','ChatEditParticipantsUtils','ChatOpenTab','ChatOpenTabEventLogger','ContextualDialogArrow','CSS','CurrentUser','WebMessengerDeleteThreadDialog','DOM','WebMessengerEditThreadDialog','Event','FantaTabActions','FBRTCCallabilityStore','FBRTCCore','FBRTCVideoCallButtonManager','Input','Keys','Menu','MenuSeparator','MercuryAPIArgsSource','MercuryBlockedParticipants','MercuryConfig','MercuryIDs','MercuryLogMessageType','MercuryParticipants','MercurySourceType','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreadMuter','MercuryViewer','MercuryMessageActions','MercuryMessageObject','MessagingTag','MessengerAdminGroupUtils','Popover','PopoverMenu','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','Toggler','URI','WebMessengerActionsMenuItem','WebMessengerSubscriptionsHandler','XEventCreateDialogController','XMessagingLeaveConversationDialogController','XNFXStartForMessageThreadController','XUIMenuTheme','emptyFunction','goURI'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('FBRTCVideoCallButtonManager').module,j=c('MercuryBlockedParticipants').get(),k=c('MercuryThreadIDMap').get(),l=c('MercuryMessageActions').get(),m=c('MercuryMessageObject').get(),n=c('MercuryThreadActions').get(),o=c('MercuryThreadInformer').get(),p=c('MercuryThreads').get();function q(jb,kb){'use strict';this._rootElement=jb;this._headerControl=kb;this._menuTemplate=c('WebMessengerTemplates')[':fb:web-messenger:actions-menu'].build();this._newMessageButton=this._menuTemplate.getNode('newMessageButton');this._actionsMenu=this._menuTemplate.getNode('menu');this._searchThreadInput=this._menuTemplate.getNode('searchThreadInput');this._searchThreadButton=this._menuTemplate.getNode('searchThreadButton');this._searchCloseButton=this._menuTemplate.getNode('searchCloseButton');this._videoCallButton=this._menuTemplate.getNode('videoCallButton');var lb=this._menuTemplate.getNode('actionsButton'),mb=function(event){if(!this._searchMode){s(this,true);}else{var nb=c('Input').getValue(this._searchThreadInput);if(nb){var ob=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{message_query:nb});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET,ob);this._searchThreadInput.focus();}else s(this,false);}event.kill();}.bind(this);c('WebMessengerSubscriptionsHandler').addSubscriptions(o.subscribe('threads-updated',function(nb,ob){ob[this._threadID]&&this.updateView();}.bind(this)),c('Event').listen(this._menuTemplate.getNode('newMessageButton'),'click',function(){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{start:true,thread_id:undefined}));}),c('Event').listen(this._actionsMenu,'keydown',function(event){if(event.keyCode===c('Keys').ESC){lb.focus();event.preventDefault();}}),c('Event').listen(this._searchThreadButton,'mousedown',mb),c('Event').listen(this._searchThreadButton,'keydown',function(event){if(event.keyCode===c('Keys').RETURN||event.keyCode===c('Keys').SPACE)mb(event);}),c('Event').listen(this._searchThreadButton,'click',c('emptyFunction').thatReturnsFalse),c('Event').listen(this._searchCloseButton,'keydown',function(event){if(event.keyCode===c('Keys').RETURN||event.keyCode===c('Keys').SPACE){u(this);this._menuTemplate.getNode('searchThreadButton').focus();}}.bind(this)),c('Event').listen(this._searchCloseButton,'mousedown',function(event){u(this);}.bind(this)),c('Event').listen(this._searchThreadInput,'blur',function(event){var nb=c('Input').getValue(this._searchThreadInput);if(!nb)s(this,false);}.bind(this)),c('Event').listen(this._searchThreadInput,'keyup',function(event){var nb=c('Input').getValue(this._searchThreadInput),ob=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{message_query:nb});if(event.keyCode==c('Keys').RETURN&&nb)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET,ob);if(event.keyCode==c('Keys').ESC)c('Input').reset(this._searchThreadInput);}.bind(this)),c('Event').listen(this._videoCallButton,'click',function(){i.onCallClicked(this._threadID,'web_messenger');}.bind(this)),c('FBRTCCallabilityStore').addListener(function(){i.updateVideoCallButton(this._videoCallButton,this._threadID);}.bind(this)));this.initItems();c('DOM').setContent(this._rootElement,this._menuTemplate.getRoot());}q.prototype.initItems=function(){'use strict';var jb=this._menuTemplate.getNode('actionsButton'),kb=this._menuTemplate.getNode('newMessageButton'),lb=function nb(){jb.focus();},mb=function nb(){kb.focus();};this.menuItems=[];this.menuItems.push({ctor:c('WebMessengerActionsMenuItem'),label:h._("\u52a0\u5176\u4ed6\u4eba\u22ef\u22ef"),onclick:ra,should_show_fn:w},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u7de8\u8f2f\u804a\u5929\u5ba4\u6210\u54e1\u2026\u2026"),onclick:sa,should_show_fn:w},{ctor:c('WebMessengerActionsMenuItem'),hideManually:true,label:h._("\u7de8\u8f2f\u5c0d\u8a71\u540d\u7a31"),onclick:ua.bind(null,this),should_show_fn:aa},{ctor:c('WebMessengerActionsMenuItem'),hideManually:true,label:h._("\u7de8\u8f2f\u5c0d\u8a71\u5716\u7247"),onclick:ua.bind(null,this),should_show_fn:aa},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u96e2\u958b\u5c0d\u8a71\u22ef\u22ef"),onclick:ta,should_show_fn:w},{ctor:c('MenuSeparator'),should_show_fn:w});this.menuItems.push({ctor:c('WebMessengerActionsMenuItem'),hideManually:true,label:h._("\u5728\u804a\u5929\u5ba4\u4e2d\u958b\u5553"),onclick:x,should_show_fn:c('ChatOpenTab').canOpenTab},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u5728\u8a0e\u8ad6\u4e32\u4e2d\u6aa2\u8996\u76f8\u7247"),onclick:pa},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u6a19\u793a\u70ba\u5df2\u8b80\u8a0a\u606f"),onclick:db.bind(null,lb),should_show_fn:la},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u6a19\u793a\u70ba\u672a\u8b80\u8a0a\u606f"),onclick:cb.bind(null,lb),should_show_fn:ga(la)});this.menuItems.push({ctor:c('MenuSeparator')},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u79fb\u81f3\u5de5\u4f5c\u5e33\u865f"),onclick:ea,should_show_fn:da},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u5c01\u5b58"),onclick:xa.bind(null,mb),should_show_fn:ga(ka)},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u53d6\u6d88\u5b58\u6a94"),onclick:ya.bind(null,mb),should_show_fn:ka},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u5c0d\u8a71\u975c\u97f3\u22ef\u22ef"),onclick:function nb(ob){c('MercuryThreadMuter').showMuteChangeDialog(ob,jb);},should_show_fn:ga(c('MercuryThreadInfo').isMuted)},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u6062\u5fa9\u5c0d\u8a71"),onclick:t.bind(null,lb),should_show_fn:c('MercuryThreadInfo').isMuted},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u79fb\u5230\u6536\u4ef6\u5323"),onclick:z.bind(null,mb,c('MessagingTag').INBOX),should_show_fn:y.bind(null,c('MessagingTag').OTHER)},{ctor:c('WebMessengerActionsMenuItem'),hideManually:true,label:h._("\u522a\u9664\u5c0d\u8a71\u2026\u2026"),onclick:fa},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u522a\u9664\u8a0a\u606f\u22ef\u22ef"),onclick:eb});this.menuItems.push({ctor:c('MenuSeparator')},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u5efa\u7acb\u793e\u5718......"),onclick:ab,should_show_fn:ba},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u5efa\u7acb\u6d3b\u52d5......"),onclick:bb,should_show_fn:ca},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u5c01\u9396\u8a0a\u606f\u2026\u2026"),onclick:na.bind(null),should_show_fn:ha},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u89e3\u9664\u5c01\u9396\u8a0a\u606f\u2026\u2026"),onclick:va.bind(null),should_show_fn:ia},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u6aa2\u8209\u5783\u573e\u8a0a\u606f\u6216\u6feb\u7528\u2026\u2026"),onclick:oa.bind(null,lb),should_show_fn:ga(ja)},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u4e0d\u662f\u5783\u573e\u90f5\u4ef6"),onclick:qa.bind(null,mb),should_show_fn:ja},{ctor:c('WebMessengerActionsMenuItem'),hideManually:true,label:h._("\u9375\u76e4\u5feb\u901f\u9375"),onclick:ib.bind(null,lb)},{ctor:c('WebMessengerActionsMenuItem'),label:h._("\u610f\u898b\u56de\u994b"),onclick:c('goURI').bind(null,'/help/?page=134259426717336')});this._menu=new (c('Menu'))(this.menuItems,{theme:c('XUIMenuTheme')});this._popover=new (c('PopoverMenu'))(new (c('Popover'))(jb.parentNode,jb,[c('ContextualDialogArrow')],{alignh:'right'}),jb,this._menu);v(function(nb){if(!nb)return;var ob=[{ctor:c('MenuSeparator')},{ctor:c('WebMessengerActionsMenuItem'),label:'Enable bug reporting',onclick:fb.bind(null,lb),should_show_fn:ga(ma)},{ctor:c('WebMessengerActionsMenuItem'),label:'Disable bug reporting',onclick:gb.bind(null,lb),should_show_fn:ma}];Array.prototype.push.apply(this.menuItems,ob);ob.forEach(function(pb){this._menu.addItem(new pb.ctor(pb));},this);}.bind(this));};q.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);};q.prototype.updateView=function(){'use strict';this.hideView();var jb=c('WebMessengerStateManager').getCurrentDetailState(),kb=false,lb=false,mb=false,nb=false,ob=false,pb=false;switch(jb){case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:case c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:r(this);this._threadID=null;break;case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:if(this._state!==jb)r(this);var qb=c('WebMessengerStateManager').getCurrentStateData().thread_id;kb=true;if(this._searchMode&&this._threadID===qb){nb=true;}else{r(this);lb=true;mb=true;}this._threadID=qb;if(this._threadID)ob=true;break;case c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET:var rb=c('WebMessengerStateManager').getCurrentStateData();c('Input').setValue(this._searchThreadInput,rb.message_query);this._threadID=rb.thread_id;kb=true;nb=true;pb=true;break;case c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS:var sb=c('WebMessengerStateManager').getCurrentStateData();this._threadID=sb.thread_id;kb=true;lb=true;mb=true;ob=true;break;default:r(this);kb=true;lb=true;this._threadID=null;break;}this._state=jb;c('CSS').conditionShow(this._searchThreadInput,nb);c('CSS').conditionShow(this._searchThreadButton,ob);c('CSS').conditionShow(this._searchCloseButton,pb);c('CSS').conditionShow(this._newMessageButton,lb);c('CSS').conditionShow(this._rootElement,kb);i.updateVideoCallButton(this._videoCallButton,this._threadID);c('CSS').conditionShow(this._videoCallButton,i.isVideoCallableThread(this._threadID)&&!this._searchMode&&c('FBRTCCore').shouldEnableVideoCalling());this._threadSubscription&&p.unsubscribe(this._threadSubscription);if(mb&&this._threadID){this._threadSubscription=p.getThreadMeta(this._threadID,function(tb){this._menu.forEachItem(function(ub){return ub.updateShownState&&ub.updateShownState(tb);});c('CSS').show(this._menuTemplate.getNode('menu'));c('CSS').show(this._rootElement);}.bind(this),c('MercuryAPIArgsSource').WEBMESSENGER);}else c('CSS').hide(this._menuTemplate.getNode('menu'));};q.prototype.destroy=function(){'use strict';};function r(jb){jb._searchMode=false;c('Input').reset(jb._searchThreadInput);}function s(jb,kb){if(kb){jb._searchMode=true;}else r(jb);c('CSS').conditionShow(jb._newMessageButton,!kb);c('CSS').conditionShow(jb._videoCallButton,!kb&&i.isVideoCallableThread(jb._threadID));c('CSS').conditionShow(jb._actionsMenu,!kb);c('CSS').conditionShow(jb._searchThreadInput,kb);if(kb){jb._searchThreadInput.focus();c('Toggler').hide(this._actionsMenu);}}function t(jb,kb){n.unmute(kb);c('Toggler').hide();jb();}function u(jb){s(jb,false);c('CSS').conditionShow(jb._searchThreadButton,true);c('CSS').conditionShow(jb._searchCloseButton,false);var kb=c('WebMessengerStateManager').getCurrentDetailState();if(kb!==c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:c('WebMessengerStateManager').getCurrentStateData().thread_id});}function v(jb){c('MercuryParticipants').get(c('MercuryViewer').getID(),function(kb){jb(kb&&kb.employee);});}function w(jb){return !jb.is_canonical&&jb.is_subscribed&&!jb.has_email_participant&&!jb.read_only;}function x(jb){c('Toggler').hide();if(c('MercuryConfig').FantaTabs){c('FantaTabActions').openTab(jb);c('ChatOpenTabEventLogger').log('WebMessengerDetailViewActionsMenuControl',jb);}else c('ChatOpenTab').openThread(jb,'WebMessengerDetailViewActionsMenuControl');}function y(jb,kb){return !kb.is_archived&&kb.folder==jb;}function z(jb,kb,lb){n.changeFolder(lb,kb);hb();jb();}function aa(jb){var kb=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID()),lb=c('MessengerAdminGroupUtils').canUpdateThreadCustomization(jb,kb);return lb&&w(jb);}function ba(jb){var kb=za(jb.participants);return kb.length>2;}function ca(jb){var kb=za(jb.participants);return kb.length>2;}function da(jb){if(!c('CurrentUser').isEmployee()||!c('CurrentUser').hasWorkUser()||!c('MercuryIDs').isGroupChat(jb.thread_id))return false;var kb=jb.participants;for(var lb=0;lb<kb.length;++lb){var mb=c('MercuryParticipants').getNow(kb[lb]);if(!mb||!mb.employee)return false;}return true;}function ea(jb){if(!p.isEmptyLocalThread(jb)){var kb=m.constructLogMessageObject(c('MercurySourceType').MESSENGER_WEB,jb,c('MercuryLogMessageType').SWITCH_TO_WORK,{removed_participants:[c('MercuryViewer').getID()]});l.send(kb,null,c('MercuryAPIArgsSource').WEBMESSENGER);hb();}return true;}function fa(jb){c('Toggler').hide();c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,c('WebMessengerStateManager').getCurrentStateData());c('WebMessengerDeleteThreadDialog').show(jb);}function ga(jb){return function(){return !jb.apply(this,arguments);};}function ha(jb){return jb.is_canonical&&!j.isMessageBlocked(jb);}function ia(jb){return jb.is_canonical&&j.isMessageBlocked(jb);}function ja(jb){return jb.folder===c('MessagingTag').SPAM;}function ka(jb){return jb.is_archived;}function la(jb){return jb.unread_count>0;}function ma(){return c('WebMessengerStateManager').getCurrentStateData().bug_reporting_enabled;}function na(jb){n.blockMessages(jb);}function oa(jb,kb){k.getServerIDFromClientID(kb,function(lb){var mb=c('XNFXStartForMessageThreadController').getURIBuilder().setString('thread_fbid',lb).getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(mb));});}function pa(jb){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS,babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData()));}function qa(jb,kb){n.unmarkSpam(kb);hb();jb();}function ra(jb){c('WebMessengerAddPeopleToConversationDialog').show(jb);}function sa(jb){c('ChatEditParticipantsUtils').showParticipantsModal(jb);}function ta(jb){var kb=c('XMessagingLeaveConversationDialogController').getURIBuilder().getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(kb),function(lb){lb.subscribe('confirm',function(){wa(jb);lb.hide();});});}function ua(jb,kb){c('Toggler').hide();var lb=new (c('WebMessengerEditThreadDialog'))();lb.toggleShown(jb._headerControl?jb._headerControl._headerBar.getNode('headerName'):jb._rootElement,kb);}function va(jb){var kb=p.getThreadMetaNow(jb);if(!kb)return;var lb=c('MercuryIDs').getParticipantIDFromFromThreadID(jb);c('MercuryParticipants').get(lb,function(mb){c('Bootloader').loadModules(["MessageBlockedDialog"],function(nb){nb.show(jb,kb.can_reply,j.isMessageBlocked(kb),mb.short_name);},'WebMessengerDetailViewActionsMenuControl');});}function wa(jb){l.send(m.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,jb,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);return true;}function xa(jb,kb){n.archive(kb);hb();jb();}function ya(jb,kb){n.unarchive(kb);hb();jb();}function za(jb){var kb=[];for(var lb=0;lb<jb.length;lb++){var mb=jb[lb];if(/^fbid:\d+$/.test(mb))kb.push(mb.substr(5));}return kb;}function ab(jb){p.getThreadMeta(jb,function(kb){var lb=za(kb.participants),mb=new (c('URI'))('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger',members:lb,message_thread_fbid:kb.thread_fbid,parent_id:'0'});c('AsyncDialog').send(new (c('AsyncRequest'))(mb));},c('MercuryAPIArgsSource').WEBMESSENGER);}function bb(jb){p.getThreadMeta(jb,function(kb){var lb=za(kb.participants),mb=c('XEventCreateDialogController').getURIBuilder().setString('acontext',JSON.stringify({})).setIntVector('invite_ids',lb).getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(mb));},c('MercuryAPIArgsSource').WEBMESSENGER);}function cb(jb,kb){n.markUnread(kb);c('Toggler').hide();jb();}function db(jb,kb){n.markRead(kb);c('Toggler').hide();jb();}function eb(){var jb=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{message_action:c('WebMessengerStateConstants').MESSAGE_ACTION.DELETE});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),jb);}function fb(jb){var kb=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{bug_reporting_enabled:true});c('Toggler').hide();c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),kb);jb();}function gb(jb){var kb=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{bug_reporting_enabled:false});c('Toggler').hide();c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),kb);jb();}function hb(){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{folder:c('WebMessengerStateManager').getCurrentStateData().folder});}function ib(jb){c('Toggler').hide();c('WebMessengerShortcuts').showOrHideShortcuts(jb);}f.exports=q;}),null);
__d('ExpandableDataSource',['DataSource'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('DataSource'));i=h&&h.prototype;function j(k,l,m){'use strict';k=k||{};k.maxResults=l;i.constructor.call(this,k);this._initialLimit=l;this._moreResultsLimit=m;this._states={};}j.prototype.query=function(k,l,m){'use strict';this.setQueryData({offset:0,limit:this._initialLimit});i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){'use strict';var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){'use strict';if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this._initialLimit;this.setQueryData({offset:k[this.value],limit:this._moreResultsLimit});k[this.value]+=this._moreResultsLimit;if(k[this.value]>this._maxResults)this._maxResults=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){'use strict';return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){'use strict';var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){'use strict';return this._states;};j.prototype.getState=function(k){'use strict';var l=this.getStates();if(!l[k])l[k]={};return l[k];};j.prototype.getQueryCache=function(){'use strict';return this.getState('query_cache');};f.exports=j;}),null);
__d('WebMessengerDetailViewAllPeopleResultsControl',['csx','cx','CSS','DataStore','DOM','Event','ExpandableDataSource','MercuryIDs','Parent','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','Token','WebMessengerEvents','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=5,k=5;function l(q){'use strict';this._rootElement=q;c('DOM').empty(this._rootElement);var r=c('WebMessengerTemplates')[':fb:web-messenger:all-people-results'].build();c('DOM').setContent(this._rootElement,r.getRoot());this._loadingSpinner=r.getNode('loadingSpinner');this._peopleResults=r.getNode('results');this._loadMoreButton=r.getNode('loadMoreButton');this._loadMoreLink=r.getNode('loadMoreLink');c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._loadMoreLink,'click',function(){c('CSS').addClass(this._loadMoreButton,'async_saving');this._peopleDataSource&&this._peopleDataSource.loadMore();}.bind(this)));}l.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);};l.prototype.updateView=function(){'use strict';var q=c('WebMessengerStateManager').getCurrentDetailState();if(q==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){c('CSS').show(this._rootElement);m(this);c('WebMessengerEvents').detailDOMChanged();}};l.prototype.destroy=function(){'use strict';};function m(q){c('CSS').show(q._loadingSpinner);c('CSS').hide(q._peopleResults);c('CSS').hide(q._loadMoreButton);var r=c('WebMessengerStateManager').getCurrentStateData(),s=r.all_people_query||'';n(q);var t=(r.participants||[]).map(function(u){return c('MercuryIDs').tokenize(u).value;});q._peopleDataSource.setExclusions(t);q._peopleDataSource.query(s);}function n(q){if(!q._peopleDataSource){q._peopleDataSource=new (c('ExpandableDataSource'))({queryEndpoint:'/ajax/mercury/search_people.php'},j,k);q._peopleDataSource.init();c('WebMessengerSubscriptionsHandler').addSubscriptions(q._peopleDataSource.subscribe('respond',o.bind(null,q)),c('Event').listen(q._rootElement,'click',function(event){var r=event.getTarget().parentNode;if(c('CSS').matchesSelector(r,"._4wt"))p(event.getTarget(),q._peopleDataSource);}));}}function o(q,r,s){var t=c('WebMessengerStateManager').getCurrentDetailState(),u=c('WebMessengerStateManager').getCurrentStateData();if(t==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS&&u.all_people_query==s.value){c('DOM').empty(q._peopleResults);c('CSS').show(q._peopleResults);s.results.forEach(function(v){var w=c('DOM').create('div',{className:'personResult'},v.detail_markup);c('DataStore').set(w,'uid',v.uid);c('DOM').appendContent(q._peopleResults,w);});if(s.results.length){c('CSS').hide(q._loadingSpinner);c('CSS').conditionShow(q._loadMoreButton,!q._peopleDataSource.hasLoadedAllResults());c('CSS').conditionClass(q._loadMoreButton,'async_saving',q._peopleDataSource.isLoadingMore());}}}function p(q,r){var s=c('Parent').byClass(q,'personResult'),t=r.getEntry(c('DataStore').get(s,'uid')),u=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{new_tokens:[new (c('Token'))(t)],start:false});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,u);}f.exports=l;}),null);
__d('Ellipsizer',['cx','CSS','Style','UserAgent_DEPRECATED','getElementText'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=1;function j(k){this.elements=[];this.descend=true;k.forEach(function(l){c('CSS').addClass(l,"_6qy");this.elements.push({node:l});},this);return this;}j.prototype.setDescend=function(k){this.descend=k;return this;};j.prototype.$Ellipsizer1=function(){var k=void 0;this.elements.forEach(function(l){k=l.node;if(this.descend)while(k.children.length===1)k=k.children[0];if(k===l.node)c('Style').set(k,'width','');c('UserAgent_DEPRECATED').ie()&&c('Style').set(k,'position','absolute');l.width=k.offsetWidth;c('UserAgent_DEPRECATED').ie()&&c('Style').set(k,'position','');},this);this.elements.sort(function(l,m){return l.width-m.width;});};j.prototype.confineWithin=function(k,l){l=l||i;this.$Ellipsizer1();var m=k;this.elements.forEach(function(n,o){var p=Math.floor(m/(this.elements.length-o));if(n.width<=p||n.width<=0||p<=0||n.width<=p*l&&m>=p*l){c('CSS').removeClass(n.node,"_6s5");c('Style').set(n.node,'width','');m-=n.width;if(n.titleSet){n.node.setAttribute('title','');n.titleSet=false;}}else{c('CSS').addClass(n.node,"_6s5");c('Style').set(n.node,'width',p+'px');m-=p;if(!n.titleSet&&!n.node.getAttribute('title')){n.node.setAttribute('title',c('getElementText')(n.node));n.titleSet=true;}}},this);};f.exports=j;}),null);
__d('MercuryReadOnlyReason',['fbt','Link.react','MercuryConfig','React','URI'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={getReason:function j(k){if(k.has_email_participant){var l=c('MercuryConfig').DYIDeepLink;return h._("\u5f88\u62b1\u6b49\uff0c\u6b64\u5c0d\u8a71\u5df2\u4e0d\u518d\u6709\u6548\uff0c\u56e0\u70ba\u8a0a\u606f\u5df2\u7121\u6cd5\u518d\u50b3\u9001\u81f3\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\u30022016 \u5e74 5 \u6708 1 \u65e5\u4e4b\u5f8c\uff0c\u900f\u904e\u96fb\u5b50\u90f5\u4ef6\u5730\u5740\u63a5\u6536\u7684\u8a0a\u606f\u53ea\u6703\u4ee5 Facebook \u8cc7\u6599\u526f\u672c\u7684\u65b9\u5f0f\u63d0\u4f9b\u3002{download your information}",[h.param('download your information',c('React').createElement('a',{href:l},h._("\u77ad\u89e3\u8a73\u60c5")))]);}else if(c('MercuryConfig').ViewerIsReadOnly){return h._("\u4f60\u5df2\u66ab\u6642\u906d\u7981\u6b62\u50b3\u9001\u8a0a\u606f\u3002{learn more about blocks}",[h.param('learn more about blocks',c('React').createElement(c('Link.react'),{href:new (c('URI'))('https://www.facebook.com/help/181183045316843'),target:'_blank'},'Learn more'))]);}else return h._("\u4f60\u7121\u6cd5\u56de\u8986\u9019\u5247\u5c0d\u8a71\u3002");}};f.exports=i;}),null);
__d('MessagesEmoticonView',['csx','cx','DOM','EmoticonsList','Event','Focus','InputSelection','Keys','Parent','SubscriptionsHandler','TextAreaControl','Toggler','UserAgent_DEPRECATED'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('EmoticonsList').symbols;function k(n){return c('Parent').bySelector(n,"._5r8h");}function l(n,o,p,q){var r=c('Parent').byClass(n,'emoticon');if(!r)return;var s='emoticon_',t=null;r.className.split(' ').forEach(function(aa){if(aa.startsWith(s))t=aa.substring(s.length);});if(!j[t])return;if(!q)return true;var u=c('TextAreaControl').getInstance(o),v=u.getValue(),w=j[t],x=v.substring(0,p.start),y=v.substring(p.end);if(p.start>0&&!x.endsWith(' '))w=' '+w;if(!y.startsWith(' '))w+=' ';var z=x+w+y;p.start+=w.length;p.end=p.start;u.setValue(z);c('InputSelection').set(o,p.start,p.end);return true;}function m(n,o){var p={start:0,end:0};function q(){p=c('InputSelection').get(o);}var r=c('DOM').find(n,'.uiToggleFlyout');this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('Toggler').subscribe('show',function(s,t){if(t.active&&c('DOM').contains(n,t.active)){c('InputSelection').set(o,p.start,p.end);var u=c('DOM').scry(r,'a.emoticon')[0];u&&c('Focus').setWithoutOutline(u);}}),c('Event').listen(r,'click',function(event){l(event.getTarget(),o,p,true);}),c('Event').listen(r,'keyup',function(event){if(event.keyCode===c('Keys').ESC){c('Toggler').hide(n);c('InputSelection').set(o,p.start,p.end);}}),c('Event').listen(o,'keyup',q),c('Event').listen(o,'click',q));if(c('UserAgent_DEPRECATED').chrome()||c('UserAgent_DEPRECATED').ie()||c('UserAgent_DEPRECATED').opera())this._subscriptions.addSubscriptions(c('Event').listen(r,'mousedown',function(event){var s=c('Event').listen(document.documentElement,'click',function(event){var t=event.getTarget(),u=l(t,o,p,false),v=k(t);!u&&!v&&c('Toggler').show(n);s.remove();});}.bind(this)));}Object.assign(m.prototype,{destroy:function n(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;}});Object.assign(m,{create:function n(o,p){return new m(o,p);}});f.exports=m;}),null);
__d('MessagesEmoticons.react',['cx','fbt','Grid.react','React','emptyFunction'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('Grid.react').GridItem,m=c('React').PropTypes,n=8,o={smile:i._("\u7b11\u81c9"),frown:i._("\u76ba\u7709"),tongue:i._("\u5410\u820c"),grin:i._("\u9732\u9f52\u7b11\u81c9"),gasp:i._("\u9a5a\u8a1d"),wink:i._("\u7728\u773c"),pacman:i._("\u5c0f\u7cbe\u9748"),grumpy:i._("\u751f\u6c23"),unsure:i._("\u7169\u60f1"),cry:i._("\u54ed\u81c9"),kiki:i._("\u7b11\u81c9\u742a\u742a"),glasses:i._("\u773c\u93e1"),sunglasses:i._("\u58a8\u93e1"),heart:i._("\u5fc3\u578b"),devil:i._("\u60e1\u9b54"),angel:i._("\u5929\u4f7f"),squint:i._("\u7787\u773c"),confused:i._("\u56f0\u60d1"),upset:i._("\u6101\u7709\u82e6\u81c9"),colonthree:i._("\u7d50\u8178\u4e09"),like:i._("\u8b9a")};j=babelHelpers.inherits(p,c('React').Component);k=j&&j.prototype;function p(){var q,r;'use strict';for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return q=(r=k.constructor).call.apply(r,[this].concat(t)),this.getEmoticons=function(){return Object.keys(o).map(function(v){return (c('React').createElement(l,{key:v},c('React').createElement('div',{className:"panelCell"},c('React').createElement('a',{'aria-label':o[v],className:'emoticon emoticon_'+v,onClick:function(){return this.props.onEmoticonSelect(v);}.bind(this)}))));}.bind(this));}.bind(this),q;}p.prototype.render=function(){'use strict';return (c('React').createElement('div',{className:"emoticonsTable"},c('React').createElement(c('Grid.react'),{cols:n,alignv:'middle',alignh:'center',spacing:'pam'},this.getEmoticons())));};p.propTypes={onEmoticonSelect:m.func};p.defaultProps={onEmoticonSelect:c('emptyFunction')};f.exports=p;}),null);
__d('StickersStoreController',['cx','Bootloader','DialogFitHeight','DOM','LayerAutoFocus','LayerFadeOnHide','LayerHideOnEscape','PureStoreBasedStateMixin','React','ReactDOM','StickersActions','StickersDispatcher','StickersStateStore','XUIDialog.react','XUIDialogBody.react','XUISpinner.react','isSocialPlugin','requestAnimationFrame'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=688,k=320,l=null,m=c('React').createClass({displayName:'StoreLayer',mixins:[c('PureStoreBasedStateMixin')(c('StickersStateStore'))],propTypes:{isComposer:i.bool,onToggle:i.func.isRequired,shown:i.bool.isRequired},getDefaultProps:function r(){return {isComposer:false};},statics:{calculateState:function r(){return {packID:c('StickersStateStore').getState().get('storePackID')};}},getInitialState:function r(){return {renderStore:function s(){return (c('React').createElement('div',{className:"_5r5e"},c('React').createElement(c('XUISpinner.react'),{background:'light',size:'large'})));}};},componentWillMount:function r(){c('StickersDispatcher').explicitlyRegisterStores([c('StickersStateStore')]);},shouldComponentUpdate:function r(s){return !!s.shown;},componentDidMount:function r(){c('Bootloader').loadModules(["StickersStore.react","RelayRootContainer","StickersStorePackListRoute","StickersStorePackDetailRoute"],function(s,t,u,v){this.setState({renderStore:function(){var w=this.state.packID?new v({packID:this.state.packID}):new u();return (c('React').createElement(t,{Component:s,route:w,renderFetched:function(x){return (c('React').createElement(s,babelHelpers['extends']({},x,{isComposer:this.props.isComposer,packID:this.state.packID,shown:this.props.shown})));}.bind(this)}));}.bind(this)});}.bind(this),'StickersStoreController');},_onToggle:function r(s){c('requestAnimationFrame')(function(){return this.props.onToggle(s);}.bind(this));},render:function r(){var s=c('isSocialPlugin')()&&document.body.offsetWidth<j?k:j;return (c('React').createElement(c('XUIDialog.react'),{behaviors:{DialogFitHeight:c('DialogFitHeight'),LayerAutoFocus:c('LayerAutoFocus'),LayerFadeOnHide:c('LayerFadeOnHide'),LayerHideOnEscape:c('LayerHideOnEscape')},onToggle:this._onToggle,shown:this.props.shown,width:s},c('React').createElement(c('XUIDialogBody.react'),{className:"_5rq- autofocus"},this.state.renderStore())));}}),n=function r(s){if(!l){l=c('DOM').create('div');c('DOM').appendContent(document.body,l);}c('ReactDOM').render(c('React').createElement(m,{isComposer:s,onToggle:p,shown:true}),l);},o=function r(){if(!l)return;c('ReactDOM').render(c('React').createElement(m,{shown:false,onToggle:p}),l);},p=function r(s){s?n():o();},q={showStore:function r(s,t){c('StickersActions').selectStorePack(s);n(!!t);}};f.exports=q;}),null);
__d('StickersFlyoutPackSelector.react',['cx','fbt','ix','Animation','CurrentUser','Image.react','Locale','React','ReactDOM','Relay','RelayMutation','RelayMutationType','RelayQL','RelayStore','StickersConfig','StickersActions','StickersStoreController','StickerConstants','StickerInterfaces','XUIBadge.react','emptyFunction','getObjectValues','getViewerRecordID'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m,n;if(c.__markCompiled)c.__markCompiled();var o=c('React').PropTypes,p=4,q=200,r=i._("\u8cbc\u5716\u5546\u5e97"),s=function w(x){if(x.id==c('StickerConstants').SEARCH_PACK_ID)return j('/images/messaging/stickers/icons/search.png');if(x.id==c('StickerConstants').MRU_STICKER_PACK)return j('/images/messaging/stickers/icons/recent.png');if(x.id==c('StickerConstants').EMOTICON_PACK_ID)return j('/images/messaging/stickers/icons/emoji.png');if(x.id==c('StickerConstants').OZ_PACK_ID)return x.icon;return x.thumbnail_image.uri;},t=function w(x){var y=x.pack,z=c('StickersConfig').search_pack?x.index===1||x.index===2:x.index===1,aa="_5r8a"+(x.selected?' '+"_5r8b":'')+(y.id==c('StickerConstants').MRU_STICKER_PACK?' '+"_5qcj":'')+(y.id==c('StickerConstants').SEARCH_PACK_ID?' '+"_5qck":'')+(z?' '+"_eb3":''),ba=x.isComments&&!y.is_comments_capable&&y.id!==c('StickerConstants').MRU_STICKER_PACK&&y.id!==c('StickerConstants').SEARCH_PACK_ID&&y.id!==c('StickerConstants').EMOTICON_PACK_ID,ca=i._("\u6b64\u8cbc\u5716\u96c6\u50c5\u63d0\u4f9b\u76f8\u7247\u7248\u672c"),da=i._("\u6b64\u8cbc\u5716\u96c6\u50c5\u53ef\u5728\u8a0a\u606f\u4e2d\u4f7f\u7528"),ea=ba?c('emptyFunction'):function(){return x.onClick(y.id);},fa=s(y);if(fa===null)return null;var ga=!y.is_messenger_capable&&y.is_composer_capable?ca:da;return (c('React').createElement('a',{'aria-label':ba?ga:y.name,className:aa,'data-id':y.id,'data-hover':'tooltip','data-tooltip-content':ba?ga:y.name,onClick:ea,tabIndex:'0'},c('React').createElement(c('Image.react'),{className:(ba?"_2ji6":'')+(' '+"_5r8c")+(c('StickersConfig').search_pack?' '+"_1viy":''),src:fa})));};t.propTypes={index:o.number,isComments:o.bool,onClick:o.func,pack:o.object.isRequired,selected:o.bool};t.defaultProps={isComments:false,onClick:c('emptyFunction')};k=babelHelpers.inherits(u,c('React').Component);l=k&&k.prototype;function u(){var w,x;for(var y=arguments.length,z=Array(y),aa=0;aa<y;aa++)z[aa]=arguments[aa];return w=(x=l.constructor).call.apply(x,[this].concat(z)),this.state={animating:false,page:0},this.onFlyoutShown=function(){if(this.$StickersFlyoutPackSelector2().length>0){var ba=this.$StickersFlyoutPackSelector3(this.props.selectedPackID);if(this.state.page!==ba)this.$StickersFlyoutPackSelector4(ba,0);}}.bind(this),this.$StickersFlyoutPackSelector1=function(){var ba=this.$StickersFlyoutPackSelector2();if(ba.length>0){this.$StickersFlyoutPackSelector5(ba[0].id);}else c('StickersActions').trayLoaded();}.bind(this),this.$StickersFlyoutPackSelector2=function(){var ba=this.props.packs.sticker_store.tray_packs.edges.map(function(ca){return ca.node;});if(c('StickersConfig').oz_pack)ba.unshift(c('StickersConfig').oz_pack);if(c('StickersConfig').mru_stickers_count!==0)ba.unshift(c('StickersConfig').mru_pack);if(c('StickersConfig').search_pack)ba.unshift(c('StickersConfig').search_pack);return ba;}.bind(this),this.$StickersFlyoutPackSelector3=function(ba){var ca=this.$StickersFlyoutPackSelector2();for(var da=0;da<ca.length;da++)if(ca[da].id==ba)return da<=p?0:Math.floor((da-1)/p);return 0;}.bind(this),this.$StickersFlyoutPackSelector4=function(ba,ca){if(this.state.animating)return;this.setState({animating:true,page:ba},function(){var da=c('ReactDOM').findDOMNode(this.refs.positioner),ea=this.$StickersFlyoutPackSelector6(ba);new (c('Animation'))(da).to(ea.reference,ea.offset+'px').ondone(function(){return this.setState({animating:false});}.bind(this)).duration(ca).go();});}.bind(this),this.$StickersFlyoutPackSelector6=function(ba){var ca=c('ReactDOM').findDOMNode(this.refs.positioner),da=ca.childNodes[ba].offsetLeft;if(c('Locale').isRTL()){var ea=ca.offsetWidth,fa=ca.childNodes[ba].offsetWidth;return {reference:'right',offset:da+fa-ea};}return {reference:'left',offset:-da};}.bind(this),this.$StickersFlyoutPackSelector7=function(){return Math.max(1,Math.ceil((this.$StickersFlyoutPackSelector2().length-1)/p));}.bind(this),this.$StickersFlyoutPackSelector8=function(){return this.state.page>0;}.bind(this),this.$StickersFlyoutPackSelector9=function(){return this.state.page+1<this.$StickersFlyoutPackSelector7();}.bind(this),this.$StickersFlyoutPackSelector10=function(){this.$StickersFlyoutPackSelector8()&&this.$StickersFlyoutPackSelector4(this.state.page-1,q);}.bind(this),this.$StickersFlyoutPackSelector11=function(){this.$StickersFlyoutPackSelector9()&&this.$StickersFlyoutPackSelector4(this.state.page+1,q);}.bind(this),this.$StickersFlyoutPackSelector12=function(){c('StickersStoreController').showStore(null,this.props.stickerInterface==c('StickerInterfaces').COMPOSER);c('RelayStore').commitUpdate(new v({actor_id:c('CurrentUser').getID()}),{onSuccess:c('emptyFunction'),onFailure:c('emptyFunction')});}.bind(this),this.$StickersFlyoutPackSelector5=function(ba){c('StickersActions').selectTrayPack(ba);},this.$StickersFlyoutPackSelector16=function(){var ba=this.$StickersFlyoutPackSelector2().map(function(fa,ga){return (c('React').createElement(t,{key:fa.id,onClick:function(){return this.$StickersFlyoutPackSelector5(fa.id);}.bind(this),pack:fa,selected:this.props.selectedPackID===fa.id,index:ga,isComments:this.props.stickerInterface==c('StickerInterfaces').COMMENTS}));}.bind(this)),ca=[];for(var da=0;da<ba.length;da+=p){var ea=da;da===0&&da++;ca.push(c('React').createElement('div',{className:"_5r81",key:da},ba.slice(ea,da+p)));}return ca;}.bind(this),this.$StickersFlyoutPackSelector13=function(){return (c('React').createElement('a',{'aria-label':r,className:"_5r86 rfloat",'data-hover':'tooltip',onClick:this.$StickersFlyoutPackSelector12},c('React').createElement(c('Image.react'),{className:"_5r87",src:j('/images/messaging/stickers/selector/sticker_store.png')}),this.$StickersFlyoutPackSelector17()));}.bind(this),this.$StickersFlyoutPackSelector17=function(){if(!this.props.packs.num_new_sticker_packs)return null;return (c('React').createElement(c('XUIBadge.react'),{className:"rfloat _3fhs",count:this.props.packs.num_new_sticker_packs,maxcount:9,type:'special'}));}.bind(this),this.$StickersFlyoutPackSelector14=function(){if(!this.$StickersFlyoutPackSelector8())return null;var ba=c('Locale').isRTL()?j('/images/messaging/stickers/selector/right.png'):j('/images/messaging/stickers/selector/left.png');return (c('React').createElement('a',{className:"_37wu"+(' '+"lfloat"),onClick:this.$StickersFlyoutPackSelector10},c('React').createElement(c('Image.react'),{className:"_5r84",src:ba})));}.bind(this),this.$StickersFlyoutPackSelector15=function(){if(!this.$StickersFlyoutPackSelector9())return null;var ba=c('Locale').isRTL()?j('/images/messaging/stickers/selector/left.png'):j('/images/messaging/stickers/selector/right.png');return (c('React').createElement('a',{className:"_37wv"+(' '+"rfloat"),onClick:this.$StickersFlyoutPackSelector11},c('React').createElement(c('Image.react'),{className:"_5r84",src:ba})));}.bind(this),w;}u.prototype.componentDidMount=function(){if(this.props.selectedPackID)return;this.$StickersFlyoutPackSelector1();};u.prototype.shouldComponentUpdate=function(w,x){return !x.animating;};u.prototype.componentWillReceiveProps=function(w){if(w.selectedPackID)return;this.$StickersFlyoutPackSelector1();};u.prototype.render=function(){return c('React').createElement('div',{className:"_5r85"},this.$StickersFlyoutPackSelector13(),this.$StickersFlyoutPackSelector14(),this.$StickersFlyoutPackSelector15(),c('React').createElement('div',{className:"_5r88"},c('React').createElement('div',{className:"_5r89",ref:'positioner'},this.$StickersFlyoutPackSelector16())));};u.propTypes={stickerInterface:o.oneOf(c('getObjectValues')(c('StickerInterfaces'))),selectedPackID:o.string};u.defaultProps={stickerInterface:c('StickerInterfaces').MESSAGES};f.exports=c('Relay').createContainer(u,{initialVariables:{stickerInterface:c('StickerInterfaces').MESSAGES},fragments:{packs:function w(x){return function(){return {children:[{fieldName:'num_new_sticker_packs',kind:'Field',metadata:{},type:'Int'},{children:[{calls:[{kind:'Call',metadata:{type:'StickerInterfaces'},name:'interface',value:{kind:'CallVariable',callVariableName:'stickerInterface'}},{kind:'Call',metadata:{},name:'first',value:{kind:'CallValue',callValue:10000}}],children:[{children:[{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'is_comments_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'is_messenger_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'is_composer_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'name',kind:'Field',metadata:{},type:'String'},{calls:[{kind:'Call',metadata:{},name:'width',value:{kind:'CallValue',callValue:20}},{kind:'Call',metadata:{},name:'height',value:{kind:'CallValue',callValue:20}}],children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'thumbnail_image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{fieldName:'is_promoted',kind:'Field',metadata:{},type:'Boolean'}],fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'StickerPack'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'PacksInTrayEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'tray_packs',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true},type:'PacksInTrayConnection'}],fieldName:'sticker_store',kind:'Field',metadata:{canHaveSubselections:true},type:'StickerStore'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutPackSelector_react_PacksRelayQL',type:'Viewer'};}();}}});m=babelHelpers.inherits(v,c('RelayMutation'));n=m&&m.prototype;v.prototype.getMutation=function(){return function(){return {calls:[{kind:'Call',metadata:{},name:'set_sticker_store_opened',value:{kind:'CallVariable',callVariableName:'input'}}],children:[{fieldName:'client_mutation_id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],kind:'Mutation',metadata:{inputType:'SetStickerStoreOpenedData!'},name:'StickersFlyoutPackSelector_react',responseType:'SetStickerStoreOpenedResponsePayload'};}();};v.prototype.getVariables=function(){return {actor_id:this.props.actor_id};};v.prototype.getFatQuery=function(){return function(){return {children:[{children:[{fieldName:'num_new_sticker_packs',kind:'Field',metadata:{},type:'Int'}],fieldName:'viewer',kind:'Field',metadata:{canHaveSubselections:true},type:'Viewer'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutPackSelector_reactRelayQL',type:'SetStickerStoreOpenedResponsePayload'};}();};v.prototype.getOptimisticResponse=function(){return {viewer:{num_new_sticker_packs:0}};};v.prototype.getConfigs=function(){var w=c('getViewerRecordID')();return [{type:c('RelayMutationType').FIELDS_CHANGE,fieldIDs:w?{viewer:w}:{}}];};function v(){m.apply(this,arguments);}}),null);
__d('StickersFlyoutPackSelectorRoute',['RelayQL','RelayRoute'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='StickersFlyoutPackSelectorRoute';j.paramDefinitions={stickerInterface:{required:true,type:'String'}};j.queries={packs:function k(l,m){return function(n){return {children:[].concat.apply([],[c('RelayQL').__frag(n)]),fieldName:'viewer',kind:'Query',metadata:{},name:'StickersFlyoutPackSelectorRoute',type:'Viewer'};}(l.getFragment('packs',{stickerInterface:m.stickerInterface}));}};f.exports=j;}),null);
__d('StickersFlyoutStickerSelector.react',['cx','fbt','ix','Grid.react','Image.react','React','Relay','RelayQL','ScrollableArea.react','Sticker.react','StickerConstants','StickerInterfaces','StickersActions','StickersConfig','StickersStateStore','StickerUtils','getObjectValues','throttle'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('Grid.react').GridItem,n=c('React').PropTypes,o=320,p=278,q=44,r=112,s=Math.ceil(c('StickerConstants').TRAY_SIZE*(window.devicePixelRatio||1));k=babelHelpers.inherits(t,c('React').Component);l=k&&k.prototype;function t(){var v,w;for(var x=arguments.length,y=Array(x),z=0;z<x;z++)y[z]=arguments[z];return v=(w=l.constructor).call.apply(w,[this].concat(y)),this.$StickersFlyoutStickerSelector1=function(){if(this.props.stickers_for_pack||this.props.stickers_for_mru_pack){var aa=this.props.stickers_for_pack?this.props.stickers_for_pack.stickers.edges:this.props.stickers_for_mru_pack.recently_used_stickers.edges;if(this.props.stickers_for_mru_pack){var ba=c('StickersStateStore').getState();if(!ba.get('recentStickersLoaded')){c('StickersActions').loadRecentStickers(this.props.stickers_for_mru_pack.recently_used_stickers.edges.map(function(ca){return ca.node;}));}else return this.props.recentStickers.filter(function(ca){return this.$StickersFlyoutStickerSelector5(ca);}.bind(this));}return aa.filter(function(ca){return this.$StickersFlyoutStickerSelector5(ca.node);}.bind(this));}else if(this.props.stickers_for_search){return this.props.stickers_for_search.sticker_results.edges;}else return null;}.bind(this),this.$StickersFlyoutStickerSelector5=function(aa){var ba=this.props.stickerInterface,ca=aa.pack;if(ba===c('StickerInterfaces').COMPOSER){return ca.is_composer_capable;}else if(ba===c('StickerInterfaces').COMMENTS){return ca.is_comments_capable;}else if(ba===c('StickerInterfaces').MESSAGES){return ca.is_messenger_capable;}else return true;}.bind(this),this.$StickersFlyoutStickerSelector2=function(){var aa=(o-q*2-r)/2;return (c('React').createElement('div',{className:"_5jdt",style:{marginTop:aa+'px'}},c('React').createElement(c('Image.react'),{src:j('/images/messaging/stickers/icons/sad_face.png')}),c('React').createElement('p',null,i._("\u6c92\u6709\u8cbc\u5716\u53ef\u986f\u793a"))));},this.$StickersFlyoutStickerSelector4=function(aa){return aa.map(function(ba){var ca=ba.node||ba,da=ca.sprite_image?ca.sprite_image.uri:null,ea=ca.padded_sprite_image?ca.padded_sprite_image.uri:null,fa=c('StickerUtils').getScaledDimensions(ca.image.height,ca.image.width,c('StickerConstants').TRAY_SIZE);return (c('React').createElement(m,{key:ca.id},c('React').createElement('div',{className:"_5r8h",onClick:function(event){return this.props.onStickerClick(ca,event);}.bind(this),onKeyDown:function(event){return this.props.onStickerKeyDown(ca.id,event);}.bind(this)},c('React').createElement(c('Sticker.react'),{accessibilityLabel:ca.label,animationTrigger:'hover',className:"_5r8i",forceCursorPointer:true,frameCount:ca.frame_count,frameRate:ca.frame_rate||83,framesPerCol:ca.frames_per_column,framesPerRow:ca.frames_per_row,sourceHeight:fa.height,sourceURI:ca.image.uri,sourceWidth:fa.width,spriteURI:da,packName:ca.pack.name,paddedSpriteURI:ea,stickerID:ca.id}))));}.bind(this));}.bind(this),this.$StickersFlyoutStickerSelector3=function(){var aa=this.refs.stickerScrollable;if(aa){var ba=aa.getArea().getScrollTop();this.props.onScroll&&this.props.onScroll(ba);}}.bind(this),v;}t.prototype.render=function(){var v=this.$StickersFlyoutStickerSelector1();if(!v||v.length===0)return this.$StickersFlyoutStickerSelector2();return c('React').createElement(c('ScrollableArea.react'),{ref:'stickerScrollable',height:this.props.height||o,onScroll:c('throttle')(this.$StickersFlyoutStickerSelector3,200),width:p,fade:true},c('React').createElement('div',{className:"_5r8k"},c('React').createElement(c('Grid.react'),{cols:4,fixed:true},this.$StickersFlyoutStickerSelector4(v))));};t.propTypes={height:n.number,onScroll:n.func,onStickerClick:n.func.isRequired,onStickerKeyDown:n.func.isRequired,recentStickers:n.array.isRequired,stickerInterface:n.oneOf(c('getObjectValues')(c('StickerInterfaces')))};t.defaultProps={stickerInterface:c('StickerInterfaces').MESSAGES};var u=function(v,w,x,y,z,aa){return {children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'label',kind:'Field',metadata:{},type:'String'},{fieldName:'frame_count',kind:'Field',metadata:{},type:'Int'},{fieldName:'frame_rate',kind:'Field',metadata:{},type:'Int'},{fieldName:'frames_per_column',kind:'Field',metadata:{},type:'Int'},{fieldName:'frames_per_row',kind:'Field',metadata:{},type:'Int'},{calls:[{kind:'Call',metadata:{},name:'width',value:c('RelayQL').__var(v)},{kind:'Call',metadata:{},name:'height',value:c('RelayQL').__var(w)}],children:[{fieldName:'height',kind:'Field',metadata:{},type:'Int'},{fieldName:'width',kind:'Field',metadata:{},type:'Int'},{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{calls:[{kind:'Call',metadata:{},name:'width',value:c('RelayQL').__var(x)},{kind:'Call',metadata:{},name:'height',value:c('RelayQL').__var(y)}],children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'sprite_image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{calls:[{kind:'Call',metadata:{},name:'width',value:c('RelayQL').__var(z)},{kind:'Call',metadata:{},name:'height',value:c('RelayQL').__var(aa)}],children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'padded_sprite_image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{children:[{fieldName:'name',kind:'Field',metadata:{},type:'String'},{fieldName:'is_comments_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'is_composer_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'is_messenger_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'pack',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id'},type:'StickerPack'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutStickerSelector_reactRelayQL',type:'Sticker'};}(s,s,s,s,s,s);f.exports=c('Relay').createContainer(t,{initialVariables:{stickerInterface:c('StickerInterfaces').MESSAGES},fragments:{stickers_for_pack:function v(){return function(w){return {children:[{calls:[{kind:'Call',metadata:{},name:'first',value:{kind:'CallValue',callValue:1000}}],children:[{children:[{children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},c('RelayQL').__frag(w)]),fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'Sticker'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'StickersInPackEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'stickers',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true,isFindable:true},type:'StickersInPackConnection'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutStickerSelector_react_Stickers_for_packRelayQL',type:'StickerPack'};}(u);},stickers_for_search:function v(w){var x=w.stickerInterface;return function(y){return {children:[{calls:[{kind:'Call',metadata:{type:'StickerInterfaces'},name:'interface',value:{kind:'CallVariable',callVariableName:'stickerInterface'}},{kind:'Call',metadata:{},name:'first',value:{kind:'CallValue',callValue:40}}],children:[{children:[{children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},c('RelayQL').__frag(y)]),fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'Sticker'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'StickerSearchResultsEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'sticker_results',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true},type:'StickerSearchResultsConnection'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutStickerSelector_react_Stickers_for_searchRelayQL',type:'StickerSearchQuery'};}(u);},stickers_for_mru_pack:function v(){return function(w,x){return {children:[{calls:[{kind:'Call',metadata:{},name:'first',value:c('RelayQL').__var(w)}],children:[{children:[{children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},c('RelayQL').__frag(x)]),fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'Sticker'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'RecentlyUsedStickersEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'recently_used_stickers',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true,isFindable:true},type:'RecentlyUsedStickersConnection'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutStickerSelector_react_Stickers_for_mru_packRelayQL',type:'Viewer'};}(c('StickersConfig').max_mru_stickers,u);}}});}),null);
__d('StickersFlyoutStickersForMRUPackRoute',['RelayQL','RelayRoute'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='StickersFlyoutStickersForMRUPackRoute';j.queries={stickers_for_mru_pack:function k(l){return function(m){return {children:[].concat.apply([],[c('RelayQL').__frag(m)]),fieldName:'viewer',kind:'Query',metadata:{},name:'StickersFlyoutStickersForMRUPackRoute',type:'Viewer'};}(l.getFragment('stickers_for_mru_pack'));}};f.exports=j;}),null);
__d('StickersFlyoutStickersForPackRoute',['RelayQL','RelayRoute'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='StickersFlyoutStickersForPackRoute';j.paramDefinitions={id:{required:true,type:'String'}};j.queries={stickers_for_pack:function k(l){return function(m){return {calls:[{kind:'Call',metadata:{type:'ID!'},name:'id',value:{kind:'CallVariable',callVariableName:'id'}}],children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'},c('RelayQL').__frag(m)]),fieldName:'node',kind:'Query',metadata:{isAbstract:true,identifyingArgName:'id',identifyingArgType:'ID!'},name:'StickersFlyoutStickersForPackRoute',type:'Node'};}(l.getFragment('stickers_for_pack'));}};f.exports=j;}),null);
__d('StickersFlyoutStickersForSearchRoute',['RelayQL','RelayRoute'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='StickersFlyoutStickersForSearchRoute';j.paramDefinitions={query:{required:true,type:'String'},stickerInterface:{required:true,type:'String'}};j.queries={stickers_for_search:function k(l,m){var n=m.stickerInterface;return function(o){return {calls:[{kind:'Call',metadata:{type:'String!'},name:'query',value:{kind:'CallVariable',callVariableName:'query'}}],children:[].concat.apply([],[c('RelayQL').__frag(o)]),fieldName:'sticker_search',kind:'Query',metadata:{identifyingArgName:'query',identifyingArgType:'String!'},name:'StickersFlyoutStickersForSearchRoute',type:'StickerSearchQuery'};}(l.getFragment('stickers_for_search',{stickerInterface:n}));}};f.exports=j;}),null);
__d('StickersFlyoutTags.react',['cx','Grid.react','Image.react','React','Relay','RelayQL','ScrollableArea.react','XUIButton.react'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('Grid.react').GridItem,j=function k(l){var m=l.tags.sticker_store.sticker_tags.edges.filter(function(n){return n.node.thumbnail_image.uri!==null;}).sort(function(n,o){return n.node.order-o.node.order;}).map(function(n,o){return (c('React').createElement(i,{key:o},c('React').createElement('div',{className:"_t5c"+(o<2?' '+"_1b27":'')+(o%2===0?' '+"_t5d":'')+(o%2!==0?' '+"_t5e":'')},c('React').createElement(c('XUIButton.react'),{image:c('React').createElement(c('Image.react'),{src:n.node.thumbnail_image.uri}),label:n.node.name,onClick:function p(){return l.onTagSelect(n.node);},className:"_5jdu",style:{background:'#'+n.node.color_code},disabled:l.inputDisabled}))));});return (c('React').createElement(c('ScrollableArea.react'),{height:l.height,width:l.width,shadow:true,fade:true,className:"_5jei"},c('React').createElement(c('Grid.react'),{spacing:'pas',cols:2,fixed:true},m)));};f.exports=c('Relay').createContainer(j,{fragments:{tags:function k(){return function(){return {children:[{children:[{calls:[{kind:'Call',metadata:{type:'StickerTagType'},name:'sticker_tag_type',value:{kind:'CallValue',callValue:'FEATURED'}},{kind:'Call',metadata:{},name:'first',value:{kind:'CallValue',callValue:20}}],children:[{children:[{children:[{fieldName:'order',kind:'Field',metadata:{},type:'Int'},{fieldName:'color_code',kind:'Field',metadata:{},type:'String'},{fieldName:'name',kind:'Field',metadata:{},type:'String'},{children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'thumbnail_image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'StickerTag'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'AllStickerTagsEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'sticker_tags',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true},type:'AllStickerTagsConnection'}],fieldName:'sticker_store',kind:'Field',metadata:{canHaveSubselections:true},type:'StickerStore'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutTags_react_TagsRelayQL',type:'Viewer'};}();}}});}),null);
__d('StickersFlyoutTagsRoute',['RelayQL','RelayRoute'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='StickersFlyoutTagsRoute';j.queries={tags:function k(l){return function(m){return {children:[].concat.apply([],[c('RelayQL').__frag(m)]),fieldName:'viewer',kind:'Query',metadata:{},name:'StickersFlyoutTagsRoute',type:'Viewer'};}(l.getFragment('tags'));}};f.exports=j;}),null);
__d('StickersFlyoutTagSelector.react',['cx','fbt','React','RelayRootContainer','StickersFlyoutStickerSelector.react','StickersFlyoutStickersForSearchRoute','StickersFlyoutTags.react','StickersFlyoutTagsRoute','StickerInterfaces','StickersTypedLogger','StickerUtils','XUICloseButton.react','XUISpinner.react','XUITextInput.react','getObjectValues'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=320,l=278,m=44,n=c('React').createClass({displayName:'StickersFlyoutTagSelector',propTypes:{onStickerClick:j.func.isRequired,onStickerKeyDown:j.func.isRequired,stickerInterface:j.oneOf(c('getObjectValues')(c('StickerInterfaces'))),shown:j.bool},getInitialState:function o(){return {input:'',isScrolling:false,tagChosen:false};},getDefaultProps:function o(){return {stickerInterface:c('StickerInterfaces').MESSAGES};},componentDidMount:function o(){this._focusInput();},componentWillReceiveProps:function o(p){if(p.shown&&!this.props.shown)this.setState(this.getInitialState(),this._focusInput);},shouldComponentUpdate:function o(p){return p.shown;},render:function o(){return (c('React').createElement('div',{className:"_217a"+(this.state.isScrolling?' '+"_1hg1":'')},c('React').createElement('div',{className:"_5jdr"},c('React').createElement('span',{className:"_5jds"}),c('React').createElement(c('XUITextInput.react'),{onChange:this._inputChanged,ref:'inputField',placeholder:i._("\u641c\u5c0b\u8cbc\u5716"),value:this.state.input}),c('React').createElement(c('XUICloseButton.react'),{size:'small',onClick:this._handleResetButtonClick,className:this.state.input.length===0?"hidden_elem":''})),this._renderContentArea()));},_renderContentArea:function o(){var p=this._normalizeInput(this.state.input),q=c('React').createElement('div',{className:"_e0r"},c('React').createElement(c('XUISpinner.react'),{size:'large'}));if(this.state.tagChosen||p.length>1){return (c('React').createElement(c('RelayRootContainer'),{Component:c('StickersFlyoutStickerSelector.react'),route:new (c('StickersFlyoutStickersForSearchRoute'))({query:p,stickerInterface:this.props.stickerInterface}),renderLoading:function r(){return q;},renderFetched:function(r){return (c('React').createElement(c('StickersFlyoutStickerSelector.react'),babelHelpers['extends']({},r,{ref:'selector',height:k-m,onScroll:this._onScroll,onStickerClick:this.props.onStickerClick,onStickerKeyDown:this.props.onStickerKeyDown,recentStickers:[],stickerInterface:this.props.stickerInterface})));}.bind(this)}));}else return (c('React').createElement(c('RelayRootContainer'),{Component:c('StickersFlyoutTags.react'),route:new (c('StickersFlyoutTagsRoute'))(),renderLoading:function r(){return q;},renderFetched:function(r){return (c('React').createElement(c('StickersFlyoutTags.react'),babelHelpers['extends']({},r,{height:k-m,inputDisabled:p.length===1,onTagSelect:this._selectTag,width:l-16})));}.bind(this)}));},_onScroll:function o(p){this.setState({isScrolling:!!p});},_selectTag:function o(p){new (c('StickersTypedLogger'))().setEvent('select_tag').setTagid(p.id).log();this.setState({tagChosen:true,input:c('StickerUtils').capitalizeWords(p.name)});this._focusInput();},_normalizeInput:function o(p){return p.trim().replace(/\s+/,' ').toLowerCase();},_handleResetButtonClick:function o(p){p.preventDefault();this.setState(this.getInitialState());},_inputChanged:function o(p){this.setState({input:p.target.value,tagChosen:false,isScrolling:false});},_focusInput:function o(){this.refs.inputField.focusInput&&this.refs.inputField.focusInput();}});f.exports=n;}),null);
__d('StickersFlyout.react',['csx','cx','fbt','Event','Keys','MessagesEmoticons.react','ReactComponentWithPureRenderMixin','PureStoreBasedStateMixin','React','ReactDOM','RelayQL','RelayRootContainer','RelayStore','StickerConstants','StickersActions','StickersConfig','StickersFlyoutPackSelector.react','StickersFlyoutPackSelectorRoute','StickersFlyoutStickerSelector.react','StickersFlyoutStickersForPackRoute','StickersFlyoutStickersForMRUPackRoute','StickersFlyoutTagSelector.react','StickerInterfaces','StickersStateStore','StickersDispatcher','StickersTypedLogger','XUISpinner.react','getObjectValues','joinClasses'],(function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=c('StickerConstants').SEARCH_PACK_ID,m=['Enter',' '],n=c('React').createClass({displayName:'StickersFlyout',mixins:[c('ReactComponentWithPureRenderMixin'),c('PureStoreBasedStateMixin')(c('StickersStateStore'))],statics:{calculateState:function o(){var p=c('StickersStateStore').getState();return {packID:p.get('trayPackID'),trayLoaded:p.get('trayLoaded')};}},propTypes:{stickerInterface:k.oneOf(c('getObjectValues')(c('StickerInterfaces'))),onStickerSelect:k.func.isRequired,onEmoticonSelect:k.func,onShown:k.func,onHidden:k.func,onEscKeyDown:k.func,shown:k.bool},getDefaultProps:function o(){return {stickerInterface:c('StickerInterfaces').MESSAGES,shown:false};},componentWillMount:function o(){c('StickersDispatcher').explicitlyRegisterStores([c('StickersStateStore')]);},componentDidMount:function o(){if(this.props.shown)this._onShown();},componentWillReceiveProps:function o(p){if(p.shown){this._onShownWrapper();}else this._onHidden();},componentDidUpdate:function o(p){if(!p.shown&&this.props.shown){this._onShown();}else if(p.shown&&!this.props.shown)this._onHidden();},_onShownWrapper:function o(){if(this.props.onShown){this.props.onShown(this._onShown);}else this._onShown();},_onShown:function o(){new (c('StickersTypedLogger'))().setEvent('open_tray').log();},_onHidden:function o(){this.props.onHidden&&this.props.onHidden();},_onKeyDown:function o(event){if(event.keyCode===c('Keys').ESC&&this.props.onEscKeyDown){event.stopPropagation();event.preventDefault();this.props.onEscKeyDown();}},_onKeyPress:function o(event){if(this.state.packID!==l&&m.indexOf(event.key)===-1)c('StickersActions').selectTrayPack(l);},loadPack:function o(){var p=c('React').createElement('div',{className:"_e0r"},c('React').createElement(c('XUISpinner.react'),{size:'large'}));if(!this.state.trayLoaded)return p;if(this.state.packID===c('StickerConstants').EMOTICON_PACK_ID)return (c('React').createElement('div',{className:"_5r8l",'data-id':this.state.packID},c('React').createElement(c('MessagesEmoticons.react'),{onEmoticonSelect:this.props.onEmoticonSelect})));if(this.state.packID===l&&c('StickersConfig').search_pack)return (c('React').createElement('div',{className:"_5r8l"},c('React').createElement(c('StickersFlyoutTagSelector.react'),{className:"fbStickersFlyoutTagSelector",stickerInterface:this.props.stickerInterface,shown:this.props.shown,onStickerClick:this._onStickerClick,onStickerKeyDown:this._onStickerKeyDown})));var q=this.state.packID===c('StickerConstants').MRU_STICKER_PACK?new (c('StickersFlyoutStickersForMRUPackRoute'))():new (c('StickersFlyoutStickersForPackRoute'))({id:this.state.packID});return (c('React').createElement('div',{className:"_5r8l",'data-id':this.state.packID},c('React').createElement(c('RelayRootContainer'),{Component:c('StickersFlyoutStickerSelector.react'),route:q,renderLoading:function r(){return p;},renderFetched:function(r){return (c('React').createElement(c('StickersFlyoutStickerSelector.react'),babelHelpers['extends']({},r,{recentStickers:c('StickersStateStore').getState().get('recentStickers'),stickerInterface:this.props.stickerInterface,onStickerClick:this._onStickerClick,onStickerKeyDown:this._onStickerKeyDown})));}.bind(this)})));},_onStickerClick:function o(p,event){if(c('StickersStateStore').getState().get('recentStickersLoaded'))c('StickersActions').addRecentSticker(p);this.props.onStickerSelect(p.id,event);},_onStickerKeyDown:function o(p,event){if(event.keyCode===c('Keys').RETURN){event.stopPropagation();event.preventDefault();this.props.onStickerSelect(p,event);}},render:function o(){return (c('React').createElement('div',{'aria-label':j._("\u8cbc\u5716"),className:c('joinClasses')(this.props.className,"_5r8f"),onKeyDown:this._onKeyDown,onKeyPress:this._onKeyPress,role:'dialog'},c('React').createElement('div',{className:"_5r8e"},c('React').createElement(c('RelayRootContainer'),{Component:c('StickersFlyoutPackSelector.react'),route:new (c('StickersFlyoutPackSelectorRoute'))({stickerInterface:this.props.stickerInterface}),renderFetched:function(p){return (c('React').createElement(c('StickersFlyoutPackSelector.react'),babelHelpers['extends']({},p,{selectedPackID:this.state.packID,stickerInterface:this.props.stickerInterface,shown:this.props.shown})));}.bind(this)})),c('React').createElement('div',{className:"_5r8m"},this.loadPack())));}});f.exports=n;}),null);
__d("XStickerInTrayController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/in_tray\/",{pack_id:{type:"Int",required:true}});}),null);
__d('StickersPackInTray',['Promise','AsyncRequest','RelayQL','RelayStore','XStickerInTrayController','createRelayQuery'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={onIsPackInTray:function i(j,k,l){var m=c('createRelayQuery')(function(){return {children:[{children:[{calls:[{kind:'Call',metadata:{type:'StickerInterfaces'},name:'interface',value:{kind:'CallVariable',callVariableName:'stickerInterface'}},{kind:'Call',metadata:{},name:'first',value:{kind:'CallValue',callValue:10000}}],children:[{children:[{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'}],fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'StickerPack'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'PacksInTrayEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'tray_packs',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true},type:'PacksInTrayConnection'}],fieldName:'sticker_store',kind:'Field',metadata:{canHaveSubselections:true},type:'StickerStore'}],fieldName:'viewer',kind:'Query',metadata:{},name:'StickersPackInTray',type:'Viewer'};}(),{stickerInterface:k}),n=c('RelayStore').readQuery(m);n=n&&n.length>0?n[0]:null;if(n&&n.sticker_store&&n.sticker_store.tray_packs&&n.sticker_store.tray_packs.edges)return new (c('Promise'))(function(p,q){return p({in_sticker_tray:n.sticker_store.tray_packs.edges.filter(function(r){return r.node.id===j;}).length>0});}).then(l);var o=c('XStickerInTrayController').getURIBuilder().setInt('pack_id',j).getURI();return new (c('Promise'))(function(p,q){return (new (c('AsyncRequest'))(o).setHandler(function(r){return p(r.getPayload());}).setAllowCrossPageTransition(true).send());}).then(l);}};f.exports=h;}),null);
__d('TabIndexDelegator',['CSS','DOM','Event','Focus','JSXDOM'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){'use strict';this._placeholder=j||c('JSXDOM').button(null);this._placeholder.setAttribute('aria-hidden',true);c('CSS').addClass(this._placeholder,'accessible_elem');this._listener=c('Event').listen(this._placeholder,'click',function(){i.click();});c('Focus').relocate(this._placeholder,i);this.enable();}h.prototype.enable=function(){'use strict';c('CSS').show(this._placeholder);};h.prototype.disable=function(){'use strict';c('CSS').hide(this._placeholder);};h.prototype.getPlaceholder=function(){'use strict';return this._placeholder;};h.prototype.destroy=function(){'use strict';this._listener.remove();c('DOM').remove(this._placeholder);};f.exports=h;}),null);
__d('UnsentMessageDialog',['fbt','Dialog','WebMessengerEvents'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={get:function j(){var k=[{label:h._("\u4e0d\u8981\u5bc4\u51fa"),name:c('Dialog').OK.name},{label:h._("\u7e7c\u7e3e\u505c\u5728\u8a0a\u606f"),name:c('Dialog').CANCEL.name,className:c('Dialog').CANCEL.className}];return new (c('Dialog'))().setTitle(h._("\u4e0d\u8981\u50b3\u9001\u8a0a\u606f\uff1f")).setBody(h._("\u5982\u679c\u4f60\u96e2\u958b\u4e86\u9019\u500b\u9801\u9762\uff0c\u4f60\u7684\u8a0a\u606f\u4e0d\u6703\u88ab\u5bc4\u51fa\u3002")).setButtons(k).setCloseHandler(c('WebMessengerEvents').inform.bind(c('WebMessengerEvents'),c('WebMessengerEvents').FOCUS_COMPOSER)).setModal(true);}};f.exports=i;}),null);
__d("XMessagingSetPreferencesController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/preferences\/",{send_on_enter:{type:"Bool",defaultValue:false}});}),null);
__d('WebMessengerDetailViewBottomShelfControl',['csx','cx','fbt','ARIA','Arbiter','AsyncDialog','AsyncRequest','BanzaiLogger','Bootloader','Button','CSS','DOM','MercuryDraftsController','WebMessengerDeleteThreadDialog','Ellipsizer','Event','Focus','MercuryFolders','Input','Keys','Locale','MercuryAPIArgsSource','MercuryBlockedParticipants','MercuryConfig','MercuryIDs','MercuryFileUploader','MercuryParticipants','MercuryPhotoUploader','MercuryReadOnlyReason','MercuryThreadIDMap','MercuryShareLinkUploader','MercurySourceType','MercuryThreadInfo','MercuryThreadActions','MercuryMessageObject','MessagesEmoticonView','MercuryMessageActions','MessagingTag','MessageRequestUtils','P2PSendMoneyContainerBootloader.react','PUWMethods','PagesEventObserver','PagesEventType','PhotosUploadWaterfall','WebMessengerPreferences','React','ReactComponentRenderer','ReactDOM','MercuryShareAttachmentRenderLocations','Run','Set','SiteData','WebMessengerStateConstants','WebMessengerStateManager','StickerInterfaces','StickersFlyout.react','StickersStoreController','StickersPackInTray','StickersActions','Style','TabIndexDelegator','WebMessengerTemplates','TextAreaControl','MercuryThreadInformer','MercuryThreads','Toggler','UnsentMessageDialog','URI','UserAgent_DEPRECATED','VaultBoxURI','Vector','WebMessengerEvents','WebMessengerSubscriptionsHandler','WorkFileUploadsGating','XMessagingSetPreferencesController','arrayContains','containsNode','ge','isWebMessengerURI'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryDraftsController').get(),l=c('MercuryBlockedParticipants').get(),m=c('MercuryThreadIDMap').get(),n=c('MercuryThreadActions').get(),o=c('MercuryMessageObject').get(),p=c('MercuryMessageActions').get(),q=c('MercuryThreadInformer').get(),r=c('MercuryThreads').get(),s="_1rh";function t(za,ab){'use strict';this._manager=za;this._rootElement=ab;this._sendOnEnterDefault=c('WebMessengerPreferences').sendOnEnter;c('DOM').empty(this._rootElement);var bb=c('WebMessengerTemplates')[':fb:web-messenger:read-view:bottom-shelf'].build();c('DOM').setContent(this._rootElement,bb.getRoot());this._bottomShelfToolbar=bb.getNode('toolbar');this._bottomShelfComposer=bb.getNode('composer');this._bottomShelfButtons=bb.getNode('buttons');this._bottomPendingActions=bb.getNode('pendingActions');this._bottomPendingDeleteAction=bb.getNode('deletePendingButton');this._bottomPendingIgnoreAction=bb.getNode('ignorePendingButton');this._autogrowContainer=bb.getNode('autogrowContainer');this._composerBox=bb.getNode('composerTextarea');this._composerGrid=bb.getNode('composerGrid');this._sendContainer=bb.getNode('sendContainer');this._replyButton=bb.getNode('replyButton');this._uploadingWarning=bb.getNode('uploadingWarning');this._replyButtonLabel=c('DOM').find(this._sendContainer,"._1ri");this._sendOnEnterButton=bb.getNode('sendOnEnterButton');this._loadingIndicator=bb.getNode('loadingIndicator');this._cannotReplyAlert=bb.getNode('noReplyMessage');this._ariaOwns=this._composerBox.getAttribute('aria-owns');c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._autogrowContainer,'click',this.focusComposer.bind(this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').UPDATE_SELECTION,ya.bind(null,this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').FOCUS_COMPOSER,this.focusComposer.bind(this)));this._emoteWrapper=bb.getNode('emoteWrapper');this._p2pWrapper=bb.getNode('p2pWrapper');this._stickersFlyoutToggler=bb.getNode('emoticons');this._emoticonsPanel=new (c('MessagesEmoticonView'))(this._stickersFlyoutToggler,this._composerBox);var cb=bb.getNode('stickers');if(cb)c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Toggler').listen('show',this._stickersFlyoutToggler,function(){this._renderStickersFlyout(cb,true);}.bind(this)),c('Toggler').listen('hide',this._stickersFlyoutToggler,function(){this._renderStickersFlyout(cb,false);}.bind(this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').STICKER_CLICKED,this._onStickerClick.bind(this)));this._messageSent=false;if(c('WorkFileUploadsGating').canUploadFiles)this._fileUploader=new (c('MercuryFileUploader'))(bb.getNode('attachmentShelf'),bb.getNode('attachButtonForm'),bb.getNode('fileInput'),bb.getNode('attachID'));this._shareLinkUploader=new (c('MercuryShareLinkUploader'))(bb.getNode('shareStage'),bb.getNode('shareStageContent'),bb.getNode('shareStageLoadingIndicator'),bb.getNode('shareStageCloseButton'),this._composerBox);c('Focus').relocate(this._replyButton,this._replyButtonLabel);this._delegator=new (c('TabIndexDelegator'))(this._replyButtonLabel);c('DOM').prependContent(this._bottomShelfToolbar,this._delegator.getPlaceholder());e(['TypingDetectorController'],function(gb){this._typingDetector=new gb(null,this._composerBox,'web-messenger',null,null);xa(this);}.bind(this));this._photoUploader=new (c('MercuryPhotoUploader'))(this._composerGrid,bb.getNode('photoButton'),c('WebMessengerSubscriptionsHandler'),bb.getNode('composer'));var db=false;c('WebMessengerSubscriptionsHandler').addSubscriptions(this._photoUploader.subscribe('dom-updated',c('WebMessengerEvents').detailDOMChanged.bind(c('WebMessengerEvents'))),this._photoUploader.subscribe('menu-show',function(gb,hb){if(!db){this.waterfallStep(c('PhotosUploadWaterfall').BEGIN,hb);db=true;}}.bind(this)),this._photoUploader.subscribe('selection-start',function(gb,hb){this.waterfallStep(c('PhotosUploadWaterfall').SELECT_START,hb);}.bind(this)),this._photoUploader.subscribe('upload-started',function(gb,hb){this.waterfallStep(c('PhotosUploadWaterfall').IMAGES_SELECTED,{method:hb.method||this._photoUploader.getCurrentMethod()});this.waterfallStep(c('PhotosUploadWaterfall').UPLOAD_START,{count:hb.imageCount});}.bind(this)),this._photoUploader.subscribe('upload-completed',function(gb,hb){var ib=this._photoUploader.getCurrentMethod();if(ib!==c('PUWMethods').FILE_SELECTOR)this.waterfallStep(c('PhotosUploadWaterfall').IMAGES_SELECTED,{method:ib});for(var jb=0;jb<hb.fbids.length;++jb)this.waterfallStep(c('PhotosUploadWaterfall').ONE_UPLOAD_DONE);this._composerBox.focus();var kb=j._("\u4f60\u7684\u8a0a\u606f\u5df2\u9644\u4e0a\u76f8\u7247\u3002");c('ARIA').notify(kb);}.bind(this)),this._photoUploader.subscribe('all-uploads-completed',function(gb,hb){if(this._blockedOnUpload){pa(this,false);ma(this);}this.waterfallStep(c('PhotosUploadWaterfall').ALL_UPLOADS_DONE,hb);}.bind(this)));var eb=c('DOM').scry(this._bottomShelfToolbar,"._6q-");eb.push(bb.getNode('sendOnEnterButtonLabel'));this._ellipsizer=new (c('Ellipsizer'))(eb);if(this._fileUploader)c('WebMessengerSubscriptionsHandler').addSubscriptions(this._fileUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){pa(this,false);ma(this);}}.bind(this)),this._fileUploader.subscribe('upload-canceled',pa.bind(null,this,false)),this._fileUploader.subscribe('dom-updated',c('WebMessengerEvents').detailDOMChanged.bind(c('WebMessengerEvents'))));this._confirmationSubscription=c('WebMessengerStateManager').registerConfirmationBeforeStateUpdate(function(gb,hb,ib){if(!k.canSaveDrafts(this._threadID)&&ta(this)&&u(this,hb,ib))return c('UnsentMessageDialog').get();return false;}.bind(this));ua(this);this._prefilledMessages={};c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Arbiter').subscribe('page_transition',function(gb,hb){if(c('isWebMessengerURI')(hb.uri))ua(this);}.bind(this)),this._shareLinkUploader.subscribe('link-detected',c('WebMessengerEvents').detailDOMChanged.bind(c('WebMessengerEvents'))),this._shareLinkUploader.subscribe('closed',this.focusComposer.bind(this)),c('Arbiter').subscribe('chat/prefilled_messages_set',function(gb,hb){if(hb)this._prefilledMessages=hb;}.bind(this)));c('TextAreaControl').getInstance(this._composerBox).subscribe('resize',function(){c('WebMessengerEvents').detailDOMChanged();}.bind(this));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._replyButtonLabel,'click',ma.bind(null,this)),c('Event').listen(this._replyButton,'keydown',z.bind(null,this)),c('Event').listen(this._composerBox,'keydown',z.bind(null,this)),c('Event').listen(this._composerBox,'paste',aa.bind(null,this)),c('Event').listen(this._sendOnEnterButton,'click',ca.bind(null,this)),c('Event').listen(bb.getNode('cancelButton'),'click',qa),c('Event').listen(bb.getNode('deleteButton'),'click',ra.bind(null,this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').DETAIL_DOM_CHANGED,ba.bind(null,this)));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(bb.getNode('ignorePendingButton'),'click',function(){n.changeFolder(this._threadID,c('MessagingTag').OTHER);c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,c('WebMessengerStateManager').getCurrentStateData());}.bind(this)),c('Event').listen(bb.getNode('deletePendingButton'),'click',function(){c('WebMessengerDeleteThreadDialog').show(this._threadID,function(){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,c('WebMessengerStateManager').getCurrentStateData());});}.bind(this)),c('Event').listen(bb.getNode('replyPendingButton'),'click',function(){n.changeFolder(this._threadID,c('MessagingTag').INBOX);c('CSS').hide(this._bottomPendingActions);c('CSS').show(this._bottomShelfComposer);c('CSS').removeClass(this._bottomShelfComposer,'invisible_elem');}.bind(this)));c('WebMessengerSubscriptionsHandler').addSubscriptions(q.subscribe('threads-updated',function(gb,hb){hb[this._threadID]&&this.updateView();}.bind(this)));this._replySet=new (c('Set'))();var fb=new (c('URI'))(window.location.href);this._uriData=fb.getQueryData();this._shouldLogMessageSend=!!this._uriData.loggedoutpage;}t.prototype._renderStickersFlyout=function(za,ab){'use strict';this._stickersFlyout=c('ReactDOM').render(c('React').createElement(c('StickersFlyout.react'),{onStickerSelect:function(bb){return la(this,bb);}.bind(this),shown:ab}),za);};t.prototype._logMessageSend=function(){'use strict';c('PagesEventObserver').notify(c('PagesEventType').MESSAGES_SEND_ENTRY_POINT,this._uriData.loggedoutpage,{was_logged_out:true});};t.prototype._onStickerClick=function(za,ab){'use strict';if(!ab||!ab.packID)return;var bb=ab.packID,cb=ab.stickerID;c('BanzaiLogger').log('StickersLoggerConfig',{event:'click_sticker',packid:bb,stickerid:cb});c('StickersPackInTray').onIsPackInTray(bb,c('StickerInterfaces').MESSAGES,function(db){if(db.in_sticker_tray){var eb=this._stickersFlyoutToggler;if(!eb)return;c('StickersActions').selectTrayPack(bb);c('Toggler').show(eb);}else c('StickersStoreController').showStore(bb);}.bind(this));};t.prototype.waterfallStep=function(za,ab){'use strict';var bb=this._photoUploader.getWaterfallID();if(!bb)return;c('PhotosUploadWaterfall').sendSignal(babelHelpers['extends']({qn:bb,step:za,uploader:c('PhotosUploadWaterfall').APP_MESSENGER},ab||{}));};t.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);};t.prototype.updateView=function(){'use strict';var za=c('WebMessengerStateManager').getCurrentDetailState();c('CSS').show(this._rootElement);var ab=c('WebMessengerStateManager').getCurrentStateData();u(this,za,ab)&&oa(this);c('CSS').hide(this._bottomShelfComposer);c('CSS').removeClass(this._bottomShelfComposer,'invisible_elem');c('CSS').hide(this._bottomShelfButtons);c('CSS').show(this._sendOnEnterButton);c('CSS').hide(this._cannotReplyAlert);ea(this,this._sendOnEnterDefault);switch(za){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:this._threadID=ab.thread_id;if(ab.message_action==c('WebMessengerStateConstants').MESSAGE_ACTION.DELETE){c('CSS').hide(this._bottomPendingActions);va(this,ab.message_action);}else if(this._threadID)r.getThreadMeta(this._threadID,function(bb){if(!this._replySet.has(this._threadID)&&bb&&c('MessageRequestUtils').isMessageRequest(bb)){wa(this,bb);}else if(c('MercuryThreadInfo').showComposer(bb)&&!c('MercuryConfig').ViewerIsReadOnly){c('CSS').show(this._bottomShelfComposer);k.loadDraft(this._threadID,this._composerBox,this._fileUploader,this._shareLinkUploader,this._photoUploader);this._shareLinkUploader.check();}else{c('ReactDOM').render(c('React').createElement('span',null,c('MercuryReadOnlyReason').getReason(bb)),this._cannotReplyAlert);c('CSS').show(this._cannotReplyAlert);}y(this,bb);w(this,bb);}.bind(this));break;case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:this._threadID=null;c('CSS').show(this._bottomShelfComposer);x(this,ab.participants);y(this,null);w(this);break;default:this._threadID=null;break;}v(this,za,ab);xa(this);c('WebMessengerEvents').detailDOMChanged();this._state=za;};t.prototype.focusComposer=function(){'use strict';this._composerBox.focus();};t.prototype.submitReply=function(){'use strict';ma(this);};t.prototype.destroy=function(){'use strict';this._emoticonsPanel&&this._emoticonsPanel.destroy();this._fileUploader&&this._fileUploader.destroy();c('WebMessengerStateManager').unregisterConfirmationBeforeStateUpdate(this._confirmationSubscription);if(this._sendMoneyDialogStoreSub){this._sendMoneyDialogStoreSub.remove();this._sendMoneyDialogStoreSub=null;}if(this._p2pButton)this._p2pButton.unmount();};t.prototype.getStickersFlyoutToggler=function(){'use strict';return this._stickersFlyoutToggler;};function u(za,ab,bb){switch(ab){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:return !bb.reuse_composer&&(za._threadID!=bb.thread_id||za._state!=ab);case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:return bb.start;case c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET:case c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET:case c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS:return true;}return false;}function v(za,ab,bb){var cb=bb.participants&&bb.participants.length>0;c('CSS').conditionClass(za._replyButtonLabel,'uiButtonDisabled',ab==c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN&&!cb);}function w(za,ab){var bb=ab&&ab.thread_id;if(!za._p2pWrapper)return;if(!bb){c('CSS').addClass(za._p2pWrapper,'invisible_elem');if(za._p2pButton)za._p2pButton.setProps({sendMoneyDialogShown:false});return;}c('CSS').removeClass(za._p2pWrapper,'invisible_elem');if(!za._p2pButton){za._p2pButton=new (c('ReactComponentRenderer'))(c('P2PSendMoneyContainerBootloader.react'),za._p2pWrapper);za._p2pButton.setProps({referrer:c('MercuryShareAttachmentRenderLocations').WEB_INBOX});}if(za._p2pButton)za._p2pButton.setProps({threadID:bb});}function x(za,ab){var bb,cb='';if(ab&&ab.length===1){bb=c('MercuryIDs').getUserIDFromParticipantID(ab[0]);cb=za._prefilledMessages[bb];}c('Input').setValue(za._composerBox,cb);}function y(za,ab){var bb,cb;if(!ab){bb=j._("\u9001\u51fa");cb=j._("\u5beb\u8a0a\u606f\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7");}else if(ab.participants&&ab.participants.length<=2){bb=j._("\u56de\u8986");cb=j._("\u7b54\u8986\u22ef\u22ef");}else{bb=j._("\u56de\u8986\u6240\u6709\u4eba");cb=j._("\u7b54\u8986\u22ef\u22ef");}if(za._composerBox.getAttribute('placeholder')!=cb)c('Input').setPlaceholder(za._composerBox,cb&&cb.toString());c('Button').setLabel(za._replyButton,bb);ha(za);}function z(za,event){var ab=event.getModifiers();if(ab.any&&event.keyCode!==c('Keys').RETURN)return;var bb=false;switch(event.keyCode){case c('Keys').ESC:var cb=za.getStickersFlyoutToggler();c('Toggler').hide(cb);return;case c('Keys').SPACE:bb=event.getTarget()===za._replyButton;break;case c('Keys').RETURN:var db=!c('CSS').hasClass(za._bottomShelfComposer,s),eb=event.getTarget()===za._replyButton,fb=false;if(!db){if(c('UserAgent_DEPRECATED').windows()){fb=ab.control;}else if(c('UserAgent_DEPRECATED').osx()){fb=ab.meta;}else fb=ab.control||ab.meta;}else if(event.getModifiers().any)return;bb=eb||db||fb;break;case c('Keys').UP:case c('Keys').DOWN:var gb=c('WebMessengerStateManager').getCurrentDetailState();if(za._composerBox.value||gb!=c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES)event.stop();break;}if(bb){ma(za);za.focusComposer();return false;}}function aa(za,event){if(c('UserAgent_DEPRECATED').chrome()){var ab=event.clipboardData||event.originalEvent.clipboardData;if(!ab||!ab.items||ab.items.length<1)return;var bb=ab.items[0].type;if(bb!=='image/png')return;if(ab.items[0].getAsFile){var cb=ab.items[0].getAsFile();za._photoUploader.uploadPastedFile(cb);}}}function ba(za){fa(za);}function ca(za){da(za);var ab=!za._sendOnEnterDefault;za.focusComposer();za._sendOnEnterDefault=ab;c('WebMessengerPreferences').sendOnEnter=ab;var bb=c('XMessagingSetPreferencesController').getURIBuilder().setBool('send_on_enter',ab).getURI();new (c('AsyncRequest'))(bb).send();}function da(za){c('CSS').toggleClass(za._bottomShelfComposer,s);if(c('CSS').hasClass(za._bottomShelfComposer,s)){za._sendOnEnterButton.setAttribute('aria-checked','false');}else za._sendOnEnterButton.setAttribute('aria-checked','true');ha(za,true);c('WebMessengerEvents').detailDOMChanged();}function ea(za,ab){if(ab==c('CSS').hasClass(za._bottomShelfComposer,s))da(za);}function fa(za){var ab;if(c('CSS').hasClass(za._bottomShelfComposer,s)){ab=ga(za);}else ab=0;var bb=c('Vector').getElementDimensions(za._bottomShelfToolbar).x;za._ellipsizer.confineWithin(bb-ab-120,1.3);}function ga(za){return c('Vector').getElementDimensions(za._replyButtonLabel).x+20;}function ha(za,ab){var bb='',cb='';if(!c('CSS').hasClass(za._bottomShelfComposer,s)){cb=ga(za)+'px';bb='-1';za._delegator.disable();}else za._delegator.enable();c('CSS').conditionClass(za._sendContainer,'transition',ab);za._replyButton.setAttribute('tabindex',bb);c('Style').set(za._sendContainer,c('Locale').isRTL()?'right':'left',cb);}function ia(){var za=new (c('URI'))(window.location.href).getQueryData();if(za.source===c('MercurySourceType').PAGES_MESSAGE_SHORTLINK)return c('MercurySourceType').PAGES_MESSAGE_SHORTLINK;return c('MercurySourceType').TITAN_WEB;}function ja(za){var ab=c('WebMessengerStateManager').getCurrentStateData(),bb=o.constructUserGeneratedMessageObject(c('Input').getValue(za._composerBox),ia(),ab.thread_id,ab.participants);if(za._fileUploader){var cb=za._fileUploader.getAttachments();if(cb&&cb.length){bb.has_attachment=true;bb.raw_attachments=cb;}}var db=za._photoUploader.getSelectedFBIDs();if(db.length>0){bb.has_attachment=true;bb.photo_fbids=db;}if(za._fileUploader){var eb=za._fileUploader.getImageFiles();if(eb.length>0){bb.has_attachment=true;bb.image_ids=eb;}var fb=za._fileUploader.getAnimatedImageFiles();if(fb.length>0){bb.has_attachment=true;bb.gif_ids=fb;}var gb=za._fileUploader.getVideoFiles();if(gb.length>0){bb.has_attachment=true;bb.video_ids=gb;}var hb=za._fileUploader.getAudioFiles();if(hb.length>0){bb.has_attachment=true;bb.audio_ids=hb;}var ib=za._fileUploader.getFiles();if(ib.length>0){bb.has_attachment=true;bb.file_ids=ib;}}if(za._shareLinkUploader.getAttachData()){bb.has_attachment=true;bb.content_attachment=za._shareLinkUploader.getAttachData();}bb.force_sms=true;bb.ui_push_phase=c('SiteData').push_phase;return bb;}function ka(za,ab,bb){var cb=za._threadID&&r.getThreadMetaNow(za._threadID);if(cb&&cb.is_canonical&&!c('MercuryThreadInfo').canReply(cb)){na(za._threadID,cb);if(c('CSS').hasClass(za._bottomShelfComposer,s)){c('CSS').hide(za._loadingIndicator);c('CSS').show(za._replyButtonLabel);za._composerBox.removeAttribute('disabled');}return;}za.waterfallStep(c('PhotosUploadWaterfall').SESSION_POSTED);if(za._threadID)za._replySet.add(za._threadID);za._sendSubscription=p.send(ab,function(db){za.waterfallStep(c('PhotosUploadWaterfall').POST_PUBLISHED);if(!bb){k.clearDraft(db);oa(za);}za._messageSent=true;if(za._shouldLogMessageSend)za._logMessageSend();var eb=za.getStickersFlyoutToggler(),fb=false;if(eb)fb=c('Toggler').isShown(eb);var gb=c('MercuryFolders').getFromMeta(r.getThreadMetaNow(db));if(gb===c('MessagingTag').PENDING)n.movePendingToInbox(db);var hb=c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES;if(c('WebMessengerStateManager').getCurrentDetailState()!==hb)c('WebMessengerStateManager').updateDetailState(hb,{thread_id:db,folder:gb,reuse_composer:bb});za._messageSent=false;if(eb&&fb)c('Toggler').show(eb);},c('MercuryAPIArgsSource').WEBMESSENGER);za.focusComposer();}function la(za,ab){var bb=c('WebMessengerStateManager').getCurrentStateData(),cb=o.constructUserGeneratedMessageObject('',c('MercurySourceType').TITAN_WEB,bb.thread_id,bb.participants);if(!cb.thread_id&&!cb.specific_to_list.length)return;cb.has_attachment=true;cb.sticker_id=ab;ka(za,cb,true);}function ma(za){if(za._fileUploader&&za._fileUploader.isUploading()||za._photoUploader.isUploading()){pa(za,true);return;}var ab=ja(za),bb=c('Input').isEmpty(za._composerBox);if(bb&&!ab.has_attachment||!ab.thread_id&&!ab.specific_to_list.length)return;if(c('CSS').hasClass(za._bottomShelfComposer,s)){c('CSS').show(za._loadingIndicator);c('CSS').hide(za._replyButtonLabel);za._composerBox.setAttribute('disabled','disabled');}ka(za,ab);}function na(za,ab){var bb=c('MercuryIDs').getParticipantIDFromFromThreadID(za);c('MercuryParticipants').get(bb,function(cb){c('Bootloader').loadModules(["MessageBlockedDialog"],function(db){db.show(ab.thread_id,ab.can_reply,l.isMessageBlocked(ab),cb.short_name);},'WebMessengerDetailViewBottomShelfControl');});}function oa(za){c('Input').reset(za._composerBox);za._typingDetector&&za._typingDetector.resetState();za._fileUploader&&za._fileUploader.removeAttachments();za._shareLinkUploader.clear();if(za._photoUploader.getSelectedFBIDs().length>0)za._photoUploader.clear();c('CSS').hide(za._loadingIndicator);c('CSS').show(za._replyButtonLabel);za._composerBox.removeAttribute('disabled');if(za._sendSubscription)za._sendSubscription=null;pa(za,false);}function pa(za,ab){c('CSS').conditionShow(za._uploadingWarning,ab);za._blockedOnUpload=ab;}function qa(){var za=c('WebMessengerStateManager').getCurrentDetailState(),ab=c('WebMessengerStateManager').getCurrentStateData();delete ab.message_action;c('WebMessengerStateManager').updateDetailState(za,ab);}function ra(za){var ab=za._manager.getSelectedMessageIDs().length;c('AsyncDialog').send(new (c('AsyncRequest'))('/ajax/mercury/delete_messages_dialog.php').setData({count:ab}),function(bb){bb.subscribe('confirm',sa.bind(null,za,bb));});}function sa(za,ab){var bb=za._manager.getSelectedMessageIDs();p['delete'](za._threadID,bb);ab.hide();var cb=c('WebMessengerStateManager').getCurrentStateData();if(cb.message_action){var db=babelHelpers['extends']({},cb);delete db.message_action;c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),db);}}function ta(za){if(za._messageSent)return false;if(!c('Input').isEmpty(za._composerBox))return true;if(za._fileUploader){var ab=za._fileUploader.getAttachments();if(ab&&ab.length||za._fileUploader.getImageFiles().length>0||za._fileUploader.getAnimatedImageFiles().length>0||za._fileUploader.getVideoFiles().length>0||za._fileUploader.getAudioFiles().length>0||za._fileUploader.getFiles().length>0||za._shareLinkUploader.getAttachData()||za._photoUploader.getSelectedFBIDs().length>0)return true;}var bb=c('WebMessengerStateManager').getCurrentStateData(),cb=c('WebMessengerStateManager').getCurrentDetailState(),db=cb==c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN||cb==c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS||cb==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(db&&!bb.start&&(bb.participants||[]).length)return true;return false;}function ua(za){c('Run').onBeforeUnload(function(){var ab=c('URI').getNextURI();if(!ab.getQueryData().hasOwnProperty('theater')&&!c('VaultBoxURI').isVaultBoxURI(ab))k.saveDraft(za._threadID,za._composerBox,za._fileUploader,za._shareLinkUploader,za._photoUploader);if(!c('isWebMessengerURI')(ab)&&!ab.getQueryData().hasOwnProperty('theater')&&!c('VaultBoxURI').isVaultBoxURI(ab)&&ta(za))return j._("\u4f60\u4e26\u672a\u9001\u51fa\u8a0a\u606f\u3002");},true);c('Run').onBeforeUnload(function(){if(c('isWebMessengerURI')(c('URI').getNextURI())&&ta(za))return j._("\u4f60\u4e26\u672a\u9001\u51fa\u8a0a\u606f\u3002");},false);c('Run').onUnload(function(){k.saveDraft(za._threadID,za._composerBox,za._fileUploader,za._shareLinkUploader,za._photoUploader);});}function va(za,ab){c('CSS').show(za._bottomShelfComposer);c('CSS').addClass(za._bottomShelfComposer,'invisible_elem');c('CSS').conditionClass(za._bottomShelfButtons,'delete',ab==c('WebMessengerStateConstants').MESSAGE_ACTION.DELETE);c('CSS').show(za._bottomShelfButtons);}function wa(za,ab){c('CSS').show(za._bottomShelfComposer);c('CSS').addClass(za._bottomShelfComposer,'invisible_elem');c('CSS').show(za._bottomPendingActions);var bb=c('MessageRequestUtils').isFiltered(ab);c('CSS').conditionClass(za._bottomPendingIgnoreAction,"hidden_elem",bb);c('CSS').conditionClass(za._bottomPendingDeleteAction,"hidden_elem",!bb);}function xa(za){if(za._typingDetector){var ab=za._threadID,bb=null;if(ab){bb=c('MercuryIDs').getUserIDFromThreadID(ab);var cb=r.getThreadMetaNow(ab);if((!cb||cb.is_canonical)&&!bb)ab=null;}if(!ab){za._typingDetector.setUserAndThread(bb,ab);return;}m.getServerIDFromClientID(ab,function(db){za._typingDetector.setUserAndThread(bb,db);});}}function ya(za,ab,bb){if(c('containsNode')(c('ge')(za._ariaOwns),c('ge')(bb)))za._composerBox.setAttribute('aria-activedescendant',bb);}f.exports=t;}),null);
__d('MNAdsLogMessageUtils',['MercuryConfig','MessagingTag','MessengerAdsWebTypedLogger','MNAdsLoggerEventEnum','AdPageMessageTypeEnum'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MercuryConfig').LOG_INTERVAL_MS||60000;function i(){this.$MNAdsLogMessageUtils1={};}i.prototype.isLoggedWithinInterval=function(j){if(this.$MNAdsLogMessageUtils1[j]&&this.$MNAdsLogMessageUtils1[j]-Date.now()<h)return true;return false;};i.prototype.setLoggingTime=function(j){this.$MNAdsLogMessageUtils1[j]=Date.now();};i.prototype.logAdsThreadListImpression=function(j){switch(j.folder){case c('MessagingTag').INBOX:this.logWithThreadMetaData(j,c('MNAdsLoggerEventEnum').MESSAGE_SEEN_INBOX);break;case c('MessagingTag').PENDING:this.logWithThreadMetaData(j,c('MNAdsLoggerEventEnum').MESSAGE_SEEN_REQUEST);break;default:return;}};i.prototype.logWithThreadMetaData=function(j,event){if(j.last_message_type!==c('AdPageMessageTypeEnum').NON_AD){var k=j.last_message_timestamp+String(event);if(this.isLoggedWithinInterval(k))return;new (c('MessengerAdsWebTypedLogger'))().setEvent(event).setMessageTimestamp(j.last_message_timestamp).setPageID(j.other_user_fbid).log();this.setLoggingTime(k);}};f.exports=new i();}),null);
__d('MNAdsMessageUtils',['cx','fbt','AdPageMessageTypeEnum','Bootloader','FBJSON','Link.react','MercuryConfig','MercuryIDs','MessagingGenericAdminTextType','MessagingTag','MNCommerceDialogStateActions','MNCommercePromotionBlockDataManager','React','getPageIDFromThreadID'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j='offsite_ad';k.prototype.isAdsMessageRequest=function(l){return l.folder==c('MessagingTag').PENDING&&l.last_message_type!==c('AdPageMessageTypeEnum').NON_AD;};k.prototype.renderAdsMessageRequestStatus=function(){var l=i._("\u8d0a\u52a9");return (c('React').createElement('span',null,l));};k.prototype.isAdsAdminMessage=function(l){return l&&l.log_message_data&&l.log_message_data.message_type&&l.log_message_data.message_type===c('MessagingGenericAdminTextType').AD_MANAGE_MESSAGE;};k.prototype.isOffsiteAd=function(l){if(l.log_message_data&&l.log_message_data.untypedData&&l.log_message_data.untypedData.ad_properties){var m=c('FBJSON').parse(l.log_message_data.untypedData.ad_properties);for(var n=m,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q;if(r===j)return true;}}return false;};k.prototype.getadPreferencesUrl=function(l){if(l.log_message_data&&l.log_message_data.untypedData&&l.log_message_data.untypedData.ad_preferences_url)return l.log_message_data.untypedData.ad_preferences_url;return '';};k.prototype.getAdsPageManage=function(l,m){var n=null;if(c('MercuryConfig').WWWMessengerManageAdminGK){var o=function(){var p=this.isOffsiteAd(l),q=c('getPageIDFromThreadID')(l.thread_id);if(!q)q=c('MercuryIDs').getUserIDFromParticipantID(l.author);var r=this.getadPreferencesUrl(l),s=function t(u,v){return c('MNCommercePromotionBlockDataManager').block(u,v);};c('Bootloader').loadModules(["MNAdsMessagesManageBlockDialogContainer.react"],function(t){c('MNCommerceDialogStateActions').showDialog(t,{adPreferencesUrl:r,isOffsiteAd:p,onConfirmButtonClick:s,pageID:q});},'MNAdsMessageUtils');}.bind(this);n=c('React').createElement(c('Link.react'),{className:(!m?"_3kyk":'')+(m?' '+"_3kyl":''),onClick:o},i._("\u7ba1\u7406"));return (c('React').createElement('span',{className:!m?"_3kym":''},l.log_message_body,' ','·',' ',n));}return (c('React').createElement('span',{className:!m?"_3kym":''},l.log_message_body));};function k(){}f.exports=new k();}),null);
__d('MercurySeenByAll',['CSS','DataStore','MercuryDelayedRoger','DOM','MercuryIDs','MercuryViewer','MercuryThreads'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryDelayedRoger').get(),i=c('MercuryThreads').get(),j={},k={updateOnSeenChange:function m(n,o,p){j[n.tagName]=true;c('DataStore').set(n,'thread-id',o.thread_id);c('CSS').addClass(n,'seenByListener');l(n,o,p);}};function l(m,n,o){var p=null;if(o){p=c('MercuryIDs').getParticipantIDFromUserID(o);}else p=c('MercuryViewer').getID();var q=n.participants.filter(function(s){return s!==p;}),r=n.participants.length>0&&n.participants[0]===p;c('CSS').conditionClass(m,'repliedLast',r);c('CSS').conditionClass(m,'seenByAll',r&&h.getSeenBy(n.thread_id).length===q.length);}h.subscribe('state-changed',function(m,n){for(var o in j){var p=c('DOM').scry(document.body,o+'.seenByListener');for(var q=0;q<p.length;q++){var r=p[q],s=c('DataStore').get(r,'thread-id');if(n[s])i.getThreadMeta(s,function(t){l(r,t);});}}});f.exports=k;}),null);
__d('MercuryThreadMetadataRenderer',['cx','fbt','CSS','DOM','Emoji','HTML','JSLogger','MercuryAttachmentType','MercuryIDs','MercuryMessageSourceTags','MercurySingletonProvider','MercuryThreadImage.react','MercuryThreadIDMap','MercuryThreadMetadataRawRenderer','MercuryThreadTitle.react','MNAdsLogMessageUtils','MNAdsMessageUtils','MercuryParticipants','React','ReactDOM','MercurySeenByAll','MercuryServerRequests','Style','MercuryThreads','Tooltip','URI','WebMessengerThreadPermalinks','WorkModeConfig','arrayContains','createArrayFromMixed','formatDate'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('JSLogger').create('wm_timestamp');function k(p){this.$MercuryThreadMetadataRenderer1=p;this.$MercuryThreadMetadataRenderer2=c('MercuryServerRequests').getForFBID(p);this.$MercuryThreadMetadataRenderer3=c('MercuryThreads').getForFBID(p);this.$MercuryThreadMetadataRenderer4=c('MercuryThreadIDMap').getForFBID(p);}k.getForFBID=function(p){return o.getForFBID(p);};k.get=function(){return o.get();};k.prototype.renderTimestamp=function(p,q,r,s){if(s){if(!q){j.warn('no_title');q=new Date(s).toLocaleDateString();}p.setAttribute('title',q);p.setAttribute('data-utime',(s/1000).toString());if(!r){j.warn('no_display');r=c('formatDate')(new Date(s),'g:ia');}c('DOM').setContent(p,r);c('CSS').show(p);}};k.prototype.renderMessageSourceTags=function(p,q,r,s){var t='',u='',v='';if(c('arrayContains')(r,c('MercuryMessageSourceTags').MESSENGER)){v="_9g";if(!c('WorkModeConfig').is_work_user){t=i._("\u5f9e Messenger \u9001\u51fa");u=new (c('URI'))('/mobile/messenger');}else{t=i._("Sent from Work Chat");u=new (c('URI'))('https://work.fb.com/workchat/');}}else if(c('arrayContains')(r,c('MercuryMessageSourceTags').MOBILE)){t=i._("\u5f9e\u624b\u6a5f\u767c\u9001");u=new (c('URI'))('/mobile/');v="_9j";}else if(c('arrayContains')(r,c('MercuryMessageSourceTags').CHAT)){t=i._("\u5bc4\u81ea\u804a\u5929\u5ba4");v="_9h";}else if(c('arrayContains')(r,c('MercuryMessageSourceTags').EMAIL)){if(s){t=i._("\u5f9e{email}\u5bc4\u9001",[i.param('email',s)]);}else t=i._("\u5df2\u901a\u904e\u96fb\u90f5\u50b3\u9001");v="_9i";}if(v){c('Tooltip').set(p,t);c('CSS').addClass(q,v);if(u){p.setAttribute('href',u);}else p.removeAttribute('href');}else c('CSS').hide(p);};k.prototype.renderSpoofWarning=function(p,q,r){if(q){c('CSS').addClass(p,"_sa");c('Tooltip').set(p,i._("\u7121\u6cd5\u78ba\u8a8d{name_or_email}\u70ba\u9001\u4ef6\u4eba\u3002",[i.param('name_or_email',r.name)]));}};k.prototype.renderChatSpoofWarning=function(p,q,r){if(q)c('DOM').appendContent(p,i._("\u7121\u6cd5\u78ba\u8a8d{name_or_email}\u70ba\u9001\u4ef6\u4eba\u3002",[i.param('name_or_email',r.name)]));};k.prototype.renderAdsMessageRequestStatus=function(p,q){if(q)c('ReactDOM').render(q,p);c('CSS').show(p);};k.prototype.renderCoreThreadlist=function(p,q,r,s,t){s=s||{};this.renderThreadImage(p,q.getNode('image'));var u=q.getNode('accessibleName'),v=[q.getNode('name')];if(u)v.push(u);this.$MercuryThreadMetadataRenderer5(p,v,s);if(p.folder&&t)n(q.getNode('folderBadge'),p.folder);var w=q.getNode('timestamp');if(c('MNAdsMessageUtils').isAdsMessageRequest(p)){this.renderAdsMessageRequestStatus(w,c('MNAdsMessageUtils').renderAdsMessageRequestStatus());}else this.renderTimestamp(w,p.timestamp_absolute,p.timestamp_relative,p.timestamp);this.renderSnippet(p,q.getNode('snippet'));m(q,p);r(q,p);};k.prototype.renderAndSeparatedParticipantList=function(p,q,r){r=r||{};r.last_separator_uses_and=true;this.$MercuryThreadMetadataRenderer3.getThreadMeta(p,function(s){this.$MercuryThreadMetadataRenderer5(s,q,r);}.bind(this));};k.prototype.renderSnippet=function(p,q){var r=false,s=c('DOM').create('span');c('CSS').addClass(s,"_3jy5");c('DOM').appendContent(q,s);c('MercurySeenByAll').updateOnSeenChange(s,p,this.$MercuryThreadMetadataRenderer1);c('MNAdsLogMessageUtils').logAdsThreadListImpression(p);var t=p.snippet;if(t){if(p.snippet_has_attachment)c('DOM').appendContent(q,c('DOM').create('span',{className:"_j0r"}));if(t.substr(0,4)=='?OTR'){t=i._("[\u5df2\u52a0\u5bc6\u8a0a\u606f]");}else t=t.replace(/\r\n|[\r\n]/g," ");t=c('HTML')(c('Emoji').htmlEmojiAndEmote(t));}else if(p.snippet_has_attachment&&p.snippet_attachments&&p.snippet_attachments.length){r=true;t=c('DOM').create('span');e(['MercuryAttachmentSnippet.react'],function(w){c('ReactDOM').render(c('React').createElement(w,{thread:p,viewer:this.$MercuryThreadMetadataRenderer1}),t);}.bind(this));}var u=p.participants.length;if(p.is_subscribed)u--;var v=p.snippet_sender;if(!r&&v&&c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryThreadMetadataRenderer1)!=v&&u>1){c('MercuryParticipants').get(v,function(w){if(w.short_name){c('DOM').appendContent(q,i._("{name}\uff1a{conversation_snippet}",[i.param('name',w.short_name),i.param('conversation_snippet',t)]));}else c('DOM').appendContent(q,t);});}else c('DOM').appendContent(q,t);};k.prototype.renderWebMessengerLink=function(p,q,r,s){c('WebMessengerThreadPermalinks').getThreadURI(p,function(t){q.setAttribute('href',t);r&&r();},s);};k.prototype.renderThreadImage=function(p,q){c('ReactDOM').render(c('React').createElement(c('MercuryThreadImage.react'),{thread:p,viewer:this.$MercuryThreadMetadataRenderer1}),q);};k.prototype.renderParticipantList=function(p,q,r,s){return c('MercuryThreadMetadataRawRenderer').renderRawParticipantList(this.$MercuryThreadMetadataRenderer4.getServerIDFromClientIDNow(p),q,r,s);};k.prototype.renderThreadNameAndParticipantList=function(p,q,r,s){var t=c('MercuryThreadMetadataRawRenderer').renderRawParticipantList(this.$MercuryThreadMetadataRenderer4.getServerIDFromClientIDNow(p),q,r,s),u=this.$MercuryThreadMetadataRenderer3.getThreadMetaNow(p);if(!u)return null;if(!u.name)return t;return i._("{conversation_name}[\u548c{participant_list}]",[i.param('conversation_name',u.name),i.param('participant_list',t)]);};k.prototype.renderParticipantCount=function(p,q){return c('MercuryThreadMetadataRawRenderer').renderRawParticipantCount(q);};k.prototype.$MercuryThreadMetadataRenderer5=function(p,q,r){q=c('createArrayFromMixed')(q);var s=this.$MercuryThreadMetadataRenderer1;if(p.name){q.forEach(function(u){c('ReactDOM').render(c('React').createElement(c('MercuryThreadTitle.react'),{thread:p,viewer:s,showUnreadCount:!!r.show_unread_count}),u);});return;}var t=p.participants;if(p.participants.length>1)t=p.participants.filter(function(u){return u!=c('MercuryIDs').getParticipantIDFromUserID(s);});c('MercuryParticipants').getMulti(t,function(u){c('MercuryThreadMetadataRawRenderer').renderParticipantListWithNoThreadName(this.$MercuryThreadMetadataRenderer4.getServerIDFromClientIDNow(p.thread_id),p,t,u,q,r);}.bind(this));};function l(p){if(!p.snippet_attachments)return [];return p.snippet_attachments.filter(function(q){return q.attach_type===c('MercuryAttachmentType').PHOTO;});}function m(p,q){var r=l(q);if(r.length===0)return;var s=r[0].thumbnail_url;if(!s)return;var t=r.length==1?'snippet-thumbnail-single':'snippet-thumbnail-multiple',u=p.getNode(t);if(!u)return;var v=c('DOM').find(u,'i');c('Style').set(v,'background-image','url('+s+')');c('CSS').show(u);}function n(p,q){c('createArrayFromMixed')(p).forEach(function(r){c('DOM').setContent(r,q);});}var o=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercuryDataSourceHelper',['MercuryPayloadSource','MercuryTypeaheadConstants','MercuryServerPayloadPreprocessor','MercuryThreadMetadataRawRenderer','MercuryThreadMetadataRenderer'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryServerPayloadPreprocessor').get(),i=c('MercuryThreadMetadataRenderer').get(),j={updateMercuryOnFetchComplete:function k(l){l.subscribe('fetchComplete',function(m,n){var o={participants:[],threads:[],pages:[],payload_source:c('MercuryPayloadSource').SERVER_SEARCH};n.response.getPayload().entries.forEach(function(p){if(p.type==c('MercuryTypeaheadConstants').THREAD_TYPE){o.threads=o.threads.concat(p.mercury_thread);o.participants=o.participants.concat(p.participants_to_render);}else if(p.type==c('MercuryTypeaheadConstants').PAGE_TYPE)o.pages=o.pages.concat(p);});if(o.threads.length){h.handleUpdate(o);n.response.getPayload().entries.forEach(function(p){if(p.mercury_thread)p.text=i.renderThreadNameAndParticipantList(p.mercury_thread.thread_id,p.participants_to_render,p.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:c('MercuryThreadMetadataRawRenderer').renderShortNames});});}});}};f.exports=j;}),null);
__d('WebMessengerComposerTypeaheadView',['cx','fbt','BucketedTypeaheadView','CSS','DataStore','MercuryTypeaheadConstants','WebMessengerStateConstants','WebMessengerStateManager'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();j=babelHelpers.inherits(l,c('BucketedTypeaheadView'));k=j&&j.prototype;function l(p,q){'use strict';k.constructor.call(this,p,q);this.typeObjects={};this.typeObjects[c('MercuryTypeaheadConstants').FRIEND_TYPE]={disabled:true,uid:c('MercuryTypeaheadConstants').FRIEND_TYPE,type:c('MercuryTypeaheadConstants').HEADER_TYPE};this.typeObjects[c('MercuryTypeaheadConstants').THREAD_TYPE]={uid:c('MercuryTypeaheadConstants').THREAD_TYPE,text:i._("\u7fa4\u804a"),type:c('MercuryTypeaheadConstants').HEADER_TYPE,linkText:i._("\u986f\u793a\u66f4\u591a"),getLinkHandler:o.bind(null,this)};this.typeObjects[c('MercuryTypeaheadConstants').PAGE_TYPE]={uid:c('MercuryTypeaheadConstants').PAGE_TYPE,text:i._("\u696d\u52d9\u6210\u679c"),type:c('MercuryTypeaheadConstants').HEADER_TYPE};this.typeObjects[c('MercuryTypeaheadConstants').COMMERCE_PAGE_TYPE]=this.typeObjects[c('MercuryTypeaheadConstants').PAGE_TYPE];this.typeObjects[c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE]={uid:c('MercuryTypeaheadConstants').PAGE_TYPE,text:i._("\u6703\u8b70\u5ba4"),type:c('MercuryTypeaheadConstants').HEADER_TYPE};this.typeObjects[c('MercuryTypeaheadConstants').FB4C_TYPE]={uid:c('MercuryTypeaheadConstants').THREAD_TYPE,text:i._("\u540c\u4e8b"),type:c('MercuryTypeaheadConstants').HEADER_TYPE};this.typeObjects[c('MercuryTypeaheadConstants').NON_FRIEND_TYPE]={uid:c('MercuryTypeaheadConstants').NON_FRIEND_TYPE,text:i._("\u5176\u4ed6\u4eba"),type:c('MercuryTypeaheadConstants').HEADER_TYPE,linkText:i._("\u986f\u793a\u5168\u90e8"),getLinkHandler:function(){return function(){n(this.value);}.bind(this);}.bind(this)};}l.prototype.setTypeahead=function(p){'use strict';k.setTypeahead.call(this,p);var q=c('DataStore').get(p,'Typeahead');q.subscribe('loading',function(r,s){var t=q.getData();if(this._threadHeader)c('CSS').conditionClass(this._threadHeader,"_355",t.isLoadingMore(this.value));}.bind(this));};l.prototype.setNewHeader=function(p,q){'use strict';if(q.uid===c('MercuryTypeaheadConstants').THREAD_TYPE)this._threadHeader=p;};l.prototype.mouseover=function(event){'use strict';if(!m(this,event))k.mouseover.call(this,event);};l.prototype.mouseup=function(event){'use strict';if(!m(this,event))k.mouseup.call(this,event);};l.prototype.clearSelected=function(){'use strict';this.index=-1;this.highlight(-1);};function m(p,event){var q=p.getIndex(event);return q>=0&&q<p.results.length&&p.results[q].type==c('MercuryTypeaheadConstants').HEADER_TYPE;}function n(p){var q=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{all_people_query:p,start:false});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,q);}function o(p){var q=c('DataStore').get(p.typeahead,'Typeahead'),r=q.getData();if(r.hasLoadedInitialResults(p.value)&&!r.hasLoadedAllResults(p.value))return r.loadMore.bind(r);}f.exports=l;}),null);
__d('MercuryExpandableDataSource',['MercuryTypeaheadDataSource'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MercuryTypeaheadDataSource'));i=h&&h.prototype;function j(k,l,m){'use strict';k=k||{};k.maxResults=l;i.constructor.call(this,k);this.$MercuryExpandableDataSource1=l;this.$MercuryExpandableDataSource2=m;this.$MercuryExpandableDataSource3={};}j.prototype.query=function(k,l,m){'use strict';this.setQueryData({offset:0,limit:this.$MercuryExpandableDataSource1});return i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){'use strict';var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){'use strict';if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this.$MercuryExpandableDataSource1;this.setQueryData({offset:k[this.value],limit:this.$MercuryExpandableDataSource2});k[this.value]+=this.$MercuryExpandableDataSource2;if(k[this.value]>this.$MercuryExpandableDataSource4)this.$MercuryExpandableDataSource4=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){'use strict';return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){'use strict';var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){'use strict';return this.$MercuryExpandableDataSource3;};j.prototype.getState=function(k){'use strict';var l=this.getStates();if(!l[k])l[k]={};return l[k];};f.exports=j;}),null);
__d('WebMessengerTypeaheadDataSource',['MercuryExpandableDataSource','MercuryIDs','MercuryParticipants','MercuryTypeaheadConstants','WebMessengerStateManager'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MercuryExpandableDataSource'));i=h&&h.prototype;function j(m){'use strict';m=m||{};m.kanaNormalization=true;i.constructor.call(this,m,c('MercuryTypeaheadConstants').COMPOSER_THREADS_INITIAL_LIMIT,c('MercuryTypeaheadConstants').COMPOSER_SHOW_MORE_LIMIT);this.setMaxResults(c('MercuryTypeaheadConstants').COMPOSER_WM_MAX);}j.prototype.bootstrap=function(){'use strict';if(!i.bootstrap.call(this))this.fetchEntryBigProfilePic();};j.prototype.updateBootstrapData=function(){'use strict';i.updateBootstrapData.call(this);this.fetchEntryBigProfilePic();};j.prototype.buildData=function(m){'use strict';var n=[],o=[],p=[],q=[],r=[];m.forEach(function(t){var u=i.getEntry.call(this,t);switch(u.render_type){case c('MercuryTypeaheadConstants').FRIEND_TYPE:if(n.length<c('MercuryTypeaheadConstants').COMPOSER_FRIENDS_MAX)n.push(t);break;case c('MercuryTypeaheadConstants').THREAD_TYPE:var v=u.mercury_thread.thread_fbid;u.uid=v;i.setEntry.call(this,v,u);if(k().length===0)o.push(v);break;case c('MercuryTypeaheadConstants').NON_FRIEND_TYPE:if(p.length<c('MercuryTypeaheadConstants').COMPOSER_NON_FRIENDS_MAX)p.push(t);break;case c('MercuryTypeaheadConstants').FB4C_TYPE:if(q.length<c('MercuryTypeaheadConstants').COMPOSER_FB4C_MAX)q.push(t);break;case c('MercuryTypeaheadConstants').PAGE_TYPE:case c('MercuryTypeaheadConstants').COMMERCE_PAGE_TYPE:case c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE:if(r.length<c('MercuryTypeaheadConstants').COMPOSER_PAGES_MAX&&k().length===0)r.push(t);break;}}.bind(this),this);var s=n.concat(q,o,r,p);return i.buildData.call(this,s);};j.prototype.query=function(m,n,o){'use strict';this.value=m;if(!i.query.call(this,m,n,o)){if(this.getState('loaded_all_threads_per_query')[m]==null)this.getState('loaded_all_threads_per_query')[m]=true;this.getState('loaded_initial_per_query')[m]=true;}};j.prototype.respond=function(m,n,o){'use strict';return i.respond.call(this,m,n,o);};j.prototype.getQueryData=function(m,n){'use strict';var o=i.getQueryData.call(this,m,n);o.existing_token_ids=k();return o;};j.prototype.fetchHandler=function(m,n){'use strict';this.getState('loaded_all_threads_per_query')[n.value]=m.getPayload().end_of_threads;this.getState('loaded_initial_per_query')[n.value]=true;i.fetchHandler.call(this,m,n);};j.prototype.hasLoadedInitialResults=function(m){'use strict';if(m===undefined)m=this.value;return this.getState('loaded_initial_per_query')[m]||m&&m.length<=1;};j.prototype.hasLoadedAllResults=function(m){'use strict';if(m===undefined)m=this.value;return this.getState('loaded_all_threads_per_query')[m];};j.prototype.fetchEntryBigProfilePic=function(){'use strict';var m=this.getCachedShortProfileIDs().map(function(n){return c('MercuryIDs').getParticipantIDFromUserID(n);});c('MercuryParticipants').getBigImageMulti(m,l.bind(this));};j.prototype.loadMore=function(){'use strict';this.setMaxResults(this.buildQueryResults(this.value).length+c('MercuryTypeaheadConstants').COMPOSER_SHOW_MORE_LIMIT*2);i.loadMore.call(this);};function k(){var m=c('WebMessengerStateManager').getCurrentStateData();return (m.participants||[]).map(function(n){return c('MercuryIDs').tokenize(n).value;});}function l(m){for(var n in m)if(m.hasOwnProperty(n)){var o=this.getEntry(c('MercuryIDs').getUserIDFromParticipantID(n));if(o)o.photo=m[n];}if(this.value)this.query(this.value);}f.exports=j;}),null);
__d('WebMessengerTypeaheadRenderer',['CurrentUser','DOM','ImmutableObject','MercuryAPIArgsSource','MercuryThreadImage.react','MercuryThreadIDMap','MercuryTypeaheadConstants','MercuryTypeaheadRenderer','React','ReactDOM','WebMessengerTemplates','MercuryThreadMetadataRawRenderer','MercuryThreadMetadataRenderer','MercuryThreads'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get(),i=c('MercuryThreadMetadataRenderer').get(),j=c('MercuryThreads').get(),k=50;function l(n,o){var p;switch(n.type){case c('MercuryTypeaheadConstants').HEADER_TYPE:p=c('WebMessengerTemplates')[':fb:web-messenger:typeahead-header'].build();c('MercuryTypeaheadRenderer').renderHeader(p,n);if(this.setNewHeader)this.setNewHeader(p.getRoot(),n);break;case c('MercuryTypeaheadConstants').USER_TYPE:case c('MercuryTypeaheadConstants').PAGE_TYPE:p=c('WebMessengerTemplates')[':fb:web-messenger:threadlist-row'].build();c('MercuryTypeaheadRenderer').renderPersonWithBigPhoto(p,n);break;case c('MercuryTypeaheadConstants').THREAD_TYPE:p=c('WebMessengerTemplates')[':fb:web-messenger:threadlist-row'].build();m(p,n);break;default:return c('DOM').create('div');}return p.getRoot();}function m(n,o){var p=h.getClientIDFromServerIDNow(o.uid),q=c('React').createElement(c('MercuryThreadImage.react'),{size:k,thread:new (c('ImmutableObject'))(o.mercury_thread),viewer:c('CurrentUser').getID()});c('ReactDOM').render(q,n.getNode('image'));var r=i.renderThreadNameAndParticipantList(p,o.participants_to_render,o.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:c('MercuryThreadMetadataRawRenderer').renderShortNames});c('DOM').setContent(n.getNode('name'),r);n.getRoot().setAttribute('data-tooltip-content',r);j.getThreadMeta(p,function(s){i.renderSnippet(s,n.getNode('snippet'));i.renderTimestamp(n.getNode('timestamp'),s.timestamp_absolute,s.timestamp_relative,s.timestamp);},c('MercuryAPIArgsSource').WEBMESSENGER);}f.exports=l;}),null);
__d('WebMessengerDetailViewComposeTypeaheadControl',['fbt','Event','WebMessengerComposerTypeaheadView','CSS','DOM','MercuryFolders','Keys','MercuryDataSourceHelper','MercuryIDs','MercuryTypeahead','MercuryTypeaheadConstants','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','MercuryThreads','WebMessengerEvents','WebMessengerTypeaheadDataSource','WebMessengerSubscriptionsHandler','WebMessengerTypeaheadRenderer'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreads').get();function j(n,o){'use strict';this._typeaheadRoot=n;this._resultsRoot=o;c('DOM').empty(this._typeaheadRoot);c('DOM').empty(this._resultsRoot);}j.prototype.hideView=function(){'use strict';c('CSS').hide(this._typeaheadRoot);c('CSS').hide(this._resultsRoot);};j.prototype.updateView=function(){'use strict';var n=c('WebMessengerStateConstants');switch(c('WebMessengerStateManager').getCurrentDetailState()){case n.DETAIL.COMPOSE_MAIN:this.renderComposeTypeahead();c('CSS').hide(this._resultsRoot);break;case n.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this.renderComposeTypeahead();c('CSS').show(this._resultsRoot);break;}c('WebMessengerEvents').detailDOMChanged();};j.prototype.renderComposeTypeahead=function(){'use strict';var n=c('WebMessengerStateManager').getCurrentStateData();c('CSS').show(this._typeaheadRoot);c('CSS').show(this._resultsRoot);if(!this._initiated){var o=c('WebMessengerTemplates')[':fb:web-messenger:read-view:compose:typeahead'].build();c('DOM').setContent(this._typeaheadRoot,o.getRoot());var p=c('WebMessengerTemplates')[':fb:web-messenger:read-view:compose:typeahead:results'].build();c('DOM').setContent(this._resultsRoot,p.getRoot());this._initialResultsLoadingSpinner=p.getNode('initialResultsLoadingSpinner');this._typeaheadFooter=p.getNode('typeaheadFooter');this._moreResultsLink=p.getNode('moreResultsLink');this._typeaheadCaption=p.getNode('caption');this.buildTypeahead(p.getNode('results'));c('DOM').appendContent(o.getNode('typeahead'),this._typeahead.getElement());this._initiated=true;}if(n.start){if(!n.participants)this._typeahead.reset();this._typeahead.focus();var q=this._typeahead.getTypeahead().getCore();q.getElement().removeAttribute('disabled');}l(this);if(n.start)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{start:false,new_tokens:undefined}));};j.prototype.buildTypeahead=function(n){'use strict';if(this._typeahead)return;var o=new (c('WebMessengerTypeaheadDataSource'))({queryEndpoint:'/ajax/mercury/composer_query.php'});c('MercuryDataSourceHelper').updateMercuryOnFetchComplete(o);var p=new (c('MercuryTypeahead'))(o,c('WebMessengerComposerTypeaheadView'));p.setPlaceholder(h._("\u59d3\u540d"));p.setViewNodeID(n);p.setViewOption('renderer',c('WebMessengerTypeaheadRenderer'));c('WebMessengerSubscriptionsHandler').addSubscriptions(p.subscribe('tokens-changed',this.onTokensChanged.bind(this)));p.build();c('WebMessengerSubscriptionsHandler').addSubscriptions(p.getTypeahead().subscribe(['respond','focus'],function(){k(!!p.getTypeahead().getCore().getValue());}),p.getTypeahead().subscribe(['reset','blur'],function(){k(false);}),p.getTypeahead().subscribe('render',function(q,r){m(this,r.length);}.bind(this)),p.getTypeahead().subscribe('reset',function(){m(this,false);}.bind(this)),p.getTypeahead().subscribe('query',function(q,r){c('DOM').setContent(this._moreResultsLink,h._("\u67e5\u770b\u66f4\u591a\u6709\u95dc\u300c{query}\u300d\u7684\u7d50\u679c",[h.param('query',r.value)]));}.bind(this)),c('Event').listen(p.getElement(),'keydown',function(q){if(q.keyCode===c('Keys').TAB&&!q.getModifiers().any){c('WebMessengerEvents').focusComposer();return false;}}),c('Event').listen(this._typeaheadFooter,'mousedown',function(){return false;}),c('Event').listen(this._moreResultsLink,'click',function(){var q=this._typeahead.getTypeahead().getCore().getValue(),r=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{all_people_query:q,start:false});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,r);}.bind(this)),c('Event').listen(this._typeaheadFooter,'mouseover',function(){this._typeahead.getTypeahead().getView().clearSelected();}.bind(this)));this._typeahead=p;};j.prototype.onTokensChanged=function(){'use strict';var n=c('WebMessengerStateManager').getCurrentDetailState();if(n==c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN||n==c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS||n==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){var o=this._typeahead,p=o.getTokens(),q=p[p.length-1];if(q&&q.getInfo().mercury_thread){var r=q.getInfo().mercury_thread.thread_id,s=c('MercuryFolders').getFromMeta(i.getThreadMetaNow(r));c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:r,folder:s,reuse_composer:true});}else{var t=p.map(function(v){if(v.getInfo().render_type===c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE){o.getTypeahead().getCore().reset();o.getTokenizer().removeToken(v);window.open('/'+v.getInfo().uid,'_blank');return null;}if(v.getInfo().type===c('MercuryTypeaheadConstants').PAGE_TYPE){var w=o.getTypeahead().getCore();w.getElement().setAttribute('disabled','disabled');}return c('MercuryIDs').getParticipantIDFromUserID(v.getValue());}).filter(Boolean),u=c('WebMessengerStateManager').getCurrentStateData();if(!u.start||(t||[]).length)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,babelHelpers['extends']({},u,{participants:t}));}}};j.prototype.destroy=function(){'use strict';};function k(n){var o=c('WebMessengerStateManager').getCurrentDetailState(),p=c('WebMessengerStateConstants');if(o!=p.DETAIL.COMPOSE_MAIN&&o!=p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS)return;var q;if(n){q=p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS;}else if(o==p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS){q=p.DETAIL.COMPOSE_MAIN;}else q=o;if(q!=o){var r=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{start:false,new_tokens:undefined});c('WebMessengerStateManager').updateDetailState(q,r);}}function l(n){var o=c('WebMessengerStateManager').getCurrentStateData();if(o.new_tokens){var p=n._typeahead.getTypeahead().getCore();p.reset();o.new_tokens.forEach(function(q){n._typeahead.getTokenizer().addToken(q);});}}function m(n,o){var p=n._typeahead.getTypeahead(),q=p.getCore().getValue(),r=p.getData().hasLoadedInitialResults(q);c('CSS').conditionShow(n._initialResultsLoadingSpinner,!r);c('CSS').conditionShow(n._moreResultsLink,r&&o);if(!o&&r){c('DOM').setContent(n._typeaheadCaption,h._("\u67e5\u7121\u7d50\u679c"));}else c('DOM').setContent(n._typeaheadCaption,h._("\u986f\u793a\u71b1\u9580\u641c\u5c0b\u7d50\u679c"));}f.exports=j;}),null);
__d("Autosize",["cx","CSS","DOM","Style"],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=['fontFamily','fontStyle','fontVariant','fontWeight','letterSpacing','textDecoration','textIndent','textTransform','whiteSpace','wordSpacing','wordWrap'],j=/^[0-9]+$/;function k(p){var q=p.cloneNode(true);c("CSS").addClass(q,"_4g");var r=p.clientWidth-c("Style").getFloat(p,'paddingLeft')-c("Style").getFloat(p,'paddingRight');c("Style").set(q,'width',r+'px');var s=p.clientHeight-c("Style").getFloat(p,'paddingTop')-c("Style").getFloat(p,'paddingBottom');c("Style").set(q,'height',s+'px');c("DOM").insertAfter(p,q);return q;}function l(p,q,r,s,t){var u=p.style.fontSize,v=p.style.height;c("Style").set(p,"height","auto");if(q!==null){var w=p.style.width;c("Style").set(p,"width","auto");}var x=0,y=t.length-1;while(x<y){var z=Math.ceil((x+y)/2);c("Style").set(p,"font-size",t[z]+s);if(r!==null&&p.scrollHeight>r||q!==null&&p.scrollWidth>q){y=z-1;}else x=z;}p.style.fontSize=u;p.style.height=v;if(q!==null)p.style.width=w;return t[x]+s;}function m(p,q,r,s,t,u){var v=p.style.fontSize,w=p.style.height;c("Style").set(p,"height","auto");if(q!==null){var x=p.style.width;c("Style").set(p,"width","auto");}c("Style").set(p,"font-size",u+s);if((r===null||p.scrollHeight<=r)&&(q===null||p.scrollWidth<=q)){p.style.fontSize=v;p.style.height=w;if(q!==null)p.style.width=x;return u+s;}c("Style").set(p,"font-size",t+s);if(r!==null&&p.scrollHeight>r||q!==null&&p.scrollWidth>q){p.style.fontSize=v;p.style.height=w;if(q!==null)p.style.width=x;return t+s;}while(t+1<u){var y=Math.ceil((t+u)/2);c("Style").set(p,"font-size",y+s);if(r!==null&&p.scrollHeight>r||q!==null&&p.scrollWidth>q){u=y;}else t=y;}p.style.fontSize=v;p.style.height=w;if(q!==null)p.style.width=x;return t+s;}function n(p,q){this._wrap=p;this._attr=q;if(this._attr.sizes){var r=this._attr.sizes;for(var s=1,t=r.length;s<t;s++){if(r[s-1]<=r[s])continue;r.sort(function(v,w){return v-w;});break;}}else if(q.min>q.max){var u=q.min;q.min=q.max;q.max=u;}this.fit();}n.prototype.fit=function(p,q){var r=this._wrap;if(!r.clientWidth){o.push(this);return;}var s=k(r);if(typeof p==="undefined")p=this._attr.width;if(j.test(p)){s.style.width=p+"px";}else if(p!==null&&p!=="auto")s.style.width=p;if(typeof q==="undefined")q=this._attr.height;if(j.test(q)){s.style.height=q+"px";}else if(q!==null&&q!=="auto")s.style.height=q;var t=null;if(!this._attr.wrap)t=s.clientWidth;var u=null;if(this._attr.wrap||q!==null)u=s.clientHeight;var v;if(this._attr.sizes){v=l(s,t,u,"px",this._attr.sizes);}else v=m(s,t,u,"px",this._attr.min,this._attr.max);c("DOM").remove(s);c("Style").set(r,"font-size",v);c("CSS").removeClass(r,"invisible_elem");};var o=[];n.onNodeInserted=function(){var p=o;o=[];p.forEach(function(q){q.fit();});};f.exports=n;}),null);
__d('MercuryPresence',['fbt','Arbiter','AvailableListConstants','DOM','CSS','requireWeak'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={},j={},k={updateOnPresenceChanges:function q(r,s){j[s.tagName]=true;i[r]=true;c('CSS').addClass(s,'presenceListener_'+r);var t=l(r);m(s,t.classes);n(s,t.label);}};function l(q){var r=p(q),s={presenceActive:false,presenceMobile:false},t=null;switch(r){case c('AvailableListConstants').ACTIVE:s.presenceActive=true;t=h._("\u555f\u7528");break;case c('AvailableListConstants').MOBILE:s.presenceMobile=true;t=h._("\u884c\u52d5\u7248");break;default:break;}return {classes:s,label:t};}function m(q,r){for(var s in r)c('CSS').conditionClass(q,s,r[s]);}function n(q,r){if(q&&r){var s=c('DOM').create('span',{className:'accessible_elem'},r);c('DOM').setContent(q,s);}}function o(){for(var q in i){var r=l(q);for(var s in j){var t=c('DOM').scry(document,s+'.presenceListener_'+q);for(var u=0;u<t.length;u++){m(t[u],r.classes);n(t[u],r.label);}}}}var p=function q(r){return c('AvailableListConstants').OFFLINE;};c('requireWeak')('AvailableList',function(q){p=q.get;o();});c('Arbiter').subscribe(c('AvailableListConstants').ON_AVAILABILITY_CHANGED,o);f.exports=k;}),null);
__d('WebMessengerDetailViewHeaderControl',['csx','cx','fbt','WebMessengerAddPeopleToConversationDialog','Autosize','AvailableListConstants','Bootloader','ChatOpenTabEventLogger','ContextualDialog','CSS','DOM','WebMessengerEditThreadDialog','Event','HovercardLink','HoverFlyout','JSXDOM','LastActiveTimes','LayerFadeOnHide','LayerFadeOnShow','LayerHideOnTransition','MercuryAPIArgsSource','MercuryConfig','MercuryIDs','MercuryThreadInfo','MercuryViewer','MNCommerceDialogStateActions','MNCommercePromotionBlockDataManager','MNCommercePromotionManageBlockDialogContainer.react','MercuryParticipants','MercuryPresence','ScrollableArea','WebMessengerStateConstants','WebMessengerStateManager','Style','WebMessengerTemplates','MercuryThreadInformer','MercuryThreadMetadataRenderer','MercuryThreads','Tooltip','WebMessengerConstants','WebMessengerEvents','WebMessengerSubscriptionsHandler','curry','isNode'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreadInformer').get(),l=c('MercuryThreadMetadataRenderer').get(),m=c('MercuryThreads').get(),n=null;function o(y){'use strict';this._rootElement=y;c('DOM').empty(this._rootElement);this._renderHeaderBar();}o.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);};o.prototype.updateView=function(){'use strict';c('CSS').removeClass(this._rootElement,'hasMultiChatThreadActions');c('CSS').show(this._rootElement);if(this._listener){k.unsubscribe(this._listener);this._listener=null;}var y=c('WebMessengerStateConstants');switch(c('WebMessengerStateManager').getCurrentDetailState()){case y.DETAIL.RECENT_MESSAGES:case y.DETAIL.SEARCH_CONTEXT:case y.DETAIL.SEARCH_THREAD_SNIPPET:case y.DETAIL.SHARED_PHOTOS:this.setThreadID(c('WebMessengerStateManager').getCurrentStateData().thread_id);break;default:this.setThreadID(null);break;}c('WebMessengerEvents').detailDOMChanged();};o.prototype.setThreadID=function(y){'use strict';this._threadID=y;if(this._threadID){this._listener=k.listen(this._threadID,this.updateView.bind(this));c('WebMessengerSubscriptionsHandler').addSubscriptions(this._listener);}y&&m.getThreadMeta(y,function(z){if(this._threadID==y)c('CSS').conditionClass(this._rootElement,'hasMultiChatThreadActions',!z.is_canonical&&c('MercuryThreadInfo').canReply(z));}.bind(this));};o.prototype._renderHeaderBar=function(){'use strict';this._headerBar=c('WebMessengerTemplates')[':fb:web-messenger:read-view:header'].build();c('DOM').appendContent(this._rootElement,this._headerBar.getRoot());var y=this._headerBar.getNode('editThreadName'),z=this._headerBar.getNode('addPeopleToThread'),aa=new (c('WebMessengerEditThreadDialog'))(),ba=this._headerBar.getNode('webMessengerManageButton'),ca=function da(ea,fa){return c('MNCommercePromotionBlockDataManager').block(ea,fa);};this._title_node_wrapper=this._headerBar.getNode('headerName');this._relationship_status=this._headerBar.getNode('relationshipStatus');c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._headerBar.getNode('closeButton'),'click',function(){var da=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{all_people_query:undefined});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,da);}),c('Event').listen(y,'click',function(event){this._threadID&&aa.toggleShown(this._headerBar.getNode('headerName'),this._threadID);return true;}.bind(this)),c('Event').listen(z,'click',function(event){this._threadID&&c('WebMessengerAddPeopleToConversationDialog').show(this._threadID);return true;}.bind(this)),c('Event').listen(ba,'click',function(event){this._threadID&&c('MNCommerceDialogStateActions').showDialog(c('MNCommercePromotionManageBlockDialogContainer.react'),{pageID:c('MercuryIDs').getUserIDFromThreadID(this._threadID),onConfirmButtonClick:ca});return true;}.bind(this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').DETAIL_DOM_CHANGED,this.updateHeaderBar.bind(this)));};o.prototype.updateHeaderBar=function(){'use strict';var y=this._headerBar.getNode('headerButtons');this._title_node_wrapper.style.fontSize='';var z=c('JSXDOM').span(null);c('DOM').setContent(this._title_node_wrapper,z);var aa=this._headerBar.getNode('webMessengerRecIndicator');aa&&c('CSS').hide(aa);var ba=this._headerBar.getNode('webMessengerManageButton');ba&&c('CSS').hide(ba);var ca=c('WebMessengerStateManager').getCurrentDetailState(),da=ca==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;c('CSS').conditionShow(this._headerBar.getNode('closeButton'),da);c('CSS').conditionClass(this._title_node_wrapper,'allPeopleResults',da);c('CSS').hide(this._relationship_status);c('CSS').removeClass(this._title_node_wrapper,"_50jz");var ea,fa;switch(ca){case c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:fa=c('WebMessengerStateManager').getCurrentStateData().all_people_query;ea=j._("\u8207{query}\u76f8\u7b26\u7684\u4eba",[j.param('query',c('DOM').create('strong',{},fa))]);break;case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:case c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS:ea=j._("\u65b0\u8a0a\u606f\uff01");break;case c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET:fa=c('WebMessengerStateManager').getCurrentStateData().message_query;if(fa)ea=j._("\u5305\u542b\u6b64\u5b57\u8a5e\u7684\u8a0a\u606f\uff1a{query}",[j.param('query',fa)]);break;}var ga=!ea&&!this._threadID;if(ga)ea=j._("\u6c92\u6709\u9078\u64c7");c('CSS').conditionClass(this._title_node_wrapper,"_3jd",ga);if(ea){c('DOM').setContent(z,ea);x(this._title_node_wrapper,this._threadID,y,aa);return;}l.renderAndSeparatedParticipantList(this._threadID,z,{check_length:false,names_renderer:function(ha){var ia=m.getThreadMetaNow(this._threadID),ja=ha.map(function(la){var ma=ha.length===1?la.name:la.short_name;if(ia&&ia.custom_nickname){var na=c('MercuryIDs').getUserIDFromParticipantID(la.id);if(ia.custom_nickname[na])ma=ia.custom_nickname[na];}var oa=la.id?c('MercuryIDs').getUserIDFromParticipantID(la.id):null;if(oa&&la.href){var pa=c('JSXDOM').a({href:la.href},ma);if(ha.length===1)pa.setAttribute('data-hovercard',c('HovercardLink').constructEndpoint({id:oa}));if(c('WebMessengerStateManager').getStandaloneMode())pa.setAttribute('target','_blank');return pa;}else return ma;}.bind(this));if(ha.length===1&&ha[0].fbid!==null){var ka=c('JSXDOM').span(null);c('DOM').setContent(ka,ja[0]);q(ha[0],ka);ja[0]=ka;}return ja;}.bind(this)});if(aa)m.getThreadMeta(this._threadID,function(ha){t(ha,aa);});if(ba)m.getThreadMeta(this._threadID,function(ha){u(ha,ba);});this.renderParticipantListFlyout(z);this.renderNamedThreadParticipantCount(z);x(this._title_node_wrapper,this._threadID,y,aa);new (c('Autosize'))(this._title_node_wrapper,{min:11,max:16,height:100,width:this._title_node_wrapper.offsetWidth,wrap:false});};o.prototype.renderNamedThreadParticipantCount=function(y){'use strict';m.getThreadMeta(this._threadID,function(z){if(z.name){var aa=l.renderParticipantCount(z.thread_id,{count:z.participants.length}),ba=c('DOM').create('span',{className:"_1us"},j._("{participants}",[j.param('participants',aa)]));c('DOM').appendContent(y,ba);}},c('MercuryAPIArgsSource').WEBMESSENGER);};o.prototype.renderParticipantListFlyout=function(y){'use strict';this._dialog&&this._dialog.destroy();delete this._dialog;this._flyout&&this._flyout.destroy();delete this._flyout;var z=this._threadID;m.getThreadMeta(this._threadID,function(aa){var ba=aa.participants;if(!aa.name){ba=ba.filter(function(ca){return ca!==c('MercuryViewer').getID();});if(ba.length<=1)return;}c('MercuryParticipants').getMulti(ba,function(ca){if(this._threadID!=z)return;var da=0,ea=c('WebMessengerTemplates')[':fb:web-messenger:flyoutlist'].build();for(var fa in ca){if(!ca.hasOwnProperty(fa))continue;var ga=ca[fa],ha=c('WebMessengerTemplates')[':fb:web-messenger:flyoutlist-profile-item'].build();ha.getNode('profilePhoto').setAttribute('src',ga.image_src);var ia=ha.getNode('title');if(ga.href){var ja=c('JSXDOM').a({href:ga.href});c('DOM').setContent(ia,ja);ia=ja;var ka=ha.getNode('profilePhoto'),la=c('JSXDOM').a({href:ga.href});c('DOM').replace(ka,la);c('DOM').setContent(la,ka);if(c('WebMessengerStateManager').getStandaloneMode()){ja.setAttribute('target','_blank');la.setAttribute('target','_blank');}}c('DOM').setContent(ia,ga.name);q(ga,ha.getNode('title'));c('DOM').setContent(ha.getNode('infoLine'),w(ga));da++;c('DOM').appendContent(ea.getNode('list'),ha.getRoot());}var ma=ea.getRoot();this._dialog=new (c('ContextualDialog'))({context:y,position:'below',addedBehaviors:[c('LayerFadeOnHide'),c('LayerFadeOnShow'),c('LayerHideOnTransition')]},ma);this._flyout=new (c('HoverFlyout'))();this._flyout.init(this._dialog);this._flyout.initNode(y);v(this._flyout,ma,da);}.bind(this));}.bind(this),c('MercuryAPIArgsSource').WEBMESSENGER);};o.prototype.destroy=function(){'use strict';};function p(y,z,aa){var ba=c('LastActiveTimes').getShortDisplay(aa);if(!ba||y.get(aa)!==c('AvailableListConstants').MOBILE){c('Tooltip').remove(z);return;}c('Tooltip').set(z,j._("\u6700\u8fd1\u4e00\u6b21\u4e0a\u7dda\u70ba{time}\u4e4b\u524d",[j.param('time',ba)]),'right');}function q(y,z){var aa=c('MercuryIDs').getUserIDFromParticipantID(y.id);if(!aa)return;var ba=c('JSXDOM').span(null);c('MercuryPresence').updateOnPresenceChanges(aa,ba);if(c('isNode')(z)){if(c('MercuryConfig').FantaTabs){r(ba,aa);}else s(ba,aa);c('DOM').appendContent(z,ba);}}function r(y,z){c('Bootloader').loadModules(["PresenceStatus","FantaTabActions"],function(aa,ba){c('Event').listen(y,'mouseenter',c('curry')(p,aa,y,z));c('Event').listen(y,'click',function(){var ca=c('MercuryIDs').getThreadIDFromUserID(z);ba.openTab(ca);c('ChatOpenTabEventLogger').logUser('web messenger header',z);});},'WebMessengerDetailViewHeaderControl');}function s(y,z){c('Bootloader').loadModules(["PresenceStatus","ChatOpenTab"],function(aa,ba){c('Event').listen(y,'mouseenter',c('curry')(p,aa,y,z));c('Event').listen(y,'click',function(){ba.openUserTab(z,'web messenger header');});},'WebMessengerDetailViewHeaderControl');}function t(y,z){if(z)c('MercuryParticipants').getMulti(y.participants,function(aa){var ba=true;for(var ca in aa)if(aa.hasOwnProperty(ca))ba=ba&&aa[ca].employee;c('CSS').conditionShow(z,ba);});}function u(y,z){if(c('MercuryConfig').WWWMessengerManageButtonGK&&z&&y.thread_fbid)c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(y.thread_fbid),function(aa){var ba=aa.is_business_enabled;c('CSS').conditionShow(z,ba);});}function v(y,z,aa){if(aa<=c('WebMessengerConstants').MAX_VISIBLE_IN_FLYOUT)return;var ba=c('ScrollableArea').fromNative(z,{fade:true});z.style.height=c('WebMessengerConstants').PARTICIPANTS_FLYOUT_HEIGHT+'px';y.subscribe('show',function(){ba.showScrollbar(false);});}function w(y){return '';}function x(y,z,aa,ba){var ca=aa.offsetWidth;if(ba){n=n||ba.offsetWidth;ca+=n;}var da=c('DOM').scry(document.body,"div._2nd");if(da.length)ca+=da[0].offsetWidth;var ea=y.parentNode.offsetWidth;if(ea>ca)c('Style').set(y,'max-width',ea-ca+'px');}f.exports=o;}),null);
__d('MercuryListUpdateRenderer',['DOM','ge'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={updateList:function i(j,k,l,m,n){var o=[];for(var p=0;p<k.length;p++){if(n){var q=n(p);q&&o.push(q);}var r=c('ge')(k[p]);if(r&&l(p)){o.push(r);}else o.push(m(p));}c('DOM').setContent(j,o);}};f.exports=h;}),null);
__d('WebMessengerUnseenMessageNoticeRenderer',['cx','fbt','JSXDOM','ContextualLayer','LayerFadeOnHide','Event'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={renderNoticeTooltip:function l(m,n){var o=c('JSXDOM').div({className:"_40p"},k(m),c('JSXDOM').i({className:"_40q"})),p=new (c('ContextualLayer'))(n||{},o).enableBehavior(c('LayerFadeOnHide'));return p;}};function k(l){var m=c('JSXDOM').div({className:"_40r"},i._("\u4f60\u6709\u65b0\u8a0a\u606f"));c('Event').listen(m,'click',l);return m;}f.exports=j;}),null);
__d('WebMessengerMessagesNotice',['LayerDestroyOnHide','MercuryViewer','WebMessengerUnseenMessageNoticeRenderer'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';this._notice=null;this._noticeContextNode=null;this._active=false;}h.prototype.getActive=function(){'use strict';return this._active;};h.prototype.showMessageNotice=function(i,j){'use strict';if(!this._active)return;if(!this._notice)this._notice=c('WebMessengerUnseenMessageNoticeRenderer').renderNoticeTooltip(i,{context:this._noticeContextNode,offsetY:2,position:j,alignment:'center'});this._notice.show();};h.prototype.hideMessageNotice=function(){'use strict';this._notice&&this._notice.hide();};h.prototype.removeMessageNotice=function(){'use strict';if(this._notice){this._notice.enableBehavior(c('LayerDestroyOnHide')).hide();this._notice=null;}};h.prototype.setNoticeContextNode=function(i){'use strict';this._noticeContextNode=i;};h.prototype.hideView=function(){'use strict';this._active=false;this.hideMessageNotice();};h.prototype.updateView=function(){'use strict';this._active=true;};h.prototype.destroy=function(){'use strict';this._active=false;this.removeMessageNotice();};h.prototype.onlyReceivedFromSelf=function(i){'use strict';for(var j in i){if(!i.hasOwnProperty(j))continue;for(var k=0,l=i[j].length;k<l;k++)if(i[j][k].author!==c('MercuryViewer').getID())return false;}return true;};f.exports=h;}),null);
__d('WebMessengerDetailViewUnreadMessagesNotice',['MercuryThreadlistConstants','WebMessengerStateManager','throttle','MercuryThreadInformer','MercuryThreadActions','UserActivity','WebMessengerMessagesNotice','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('MercuryThreadInformer').get(),k=c('MercuryThreadActions').get(),l=c('MercuryThreadlistConstants').MESSAGE_NOTICE_INACTIVITY_THRESHOLD;h=babelHelpers.inherits(m,c('WebMessengerMessagesNotice'));i=h&&h.prototype;function m(n){'use strict';i.constructor.call(this);this._manager=n;c('WebMessengerSubscriptionsHandler').addSubscriptions(j.subscribe('thread-read-changed',this._updateReadStatus.bind(this)));this._manager.addScrollCallback(c('throttle').withBlocking(function(o){if(this._shouldMarkAsRead(o)){this.removeMessageNotice();if(c('UserActivity').isActive(5000)){var p=c('WebMessengerStateManager').getCurrentStateData().thread_id;k.markRead(p);}else c('UserActivity').subscribeOnce(function(){if(this._shouldMarkAsRead(o)){var q=c('WebMessengerStateManager').getCurrentStateData().thread_id;k.markRead(q);}}.bind(this));}}.bind(this),100,null));}m.prototype.updateOnMessagesReceived=function(n,o,p,q){'use strict';var r=!c('UserActivity').isActive(l);if(!i.getActive.call(this))return;if(r||i.onlyReceivedFromSelf.call(this,q)){this.removeMessageNotice();this._manager.scrollToBottom(true);}else if(!this._manager.isScrolledToBottom()){var s=p-(o-n);this._manager.setScrollTop(s,false);this.showMessageNotice();}};m.prototype.showMessageNotice=function(){'use strict';var n=function(){this._manager.scrollToBottom();}.bind(this);i.showMessageNotice.call(this,n,'above');};m.prototype._shouldMarkAsRead=function(n){'use strict';var o=c('WebMessengerStateManager').getCurrentStateData().thread_id;return o&&i.getActive.call(this)&&n.isScrolledToBottom();};m.prototype._updateReadStatus=function(n,o){'use strict';var p=c('WebMessengerStateManager').getCurrentStateData().thread_id;if(p&&o[p]&&o[p].mark_as_read)this.removeMessageNotice();};f.exports=m;}),null);
__d('WebMessengerInfoBoxRenderer',['cx','Event','DOM','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={render:function j(k,l){var m=c('DOM').create('div',{className:"_4rk"},k),n=c('DOM').create('div',{}),o=true;l.forEach(function(p){if(!o){var q=c('DOM').create('span',{className:"_4rl"},'\u00b7');c('DOM').appendContent(n,q);}o=false;var r=c('DOM').create('a',{},p.text);if(p.handler)c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(r,'click',p.handler));c('DOM').appendContent(n,r);});return c('DOM').create('div',{className:"_4rh"},[m,n]);}};f.exports=i;}),null);
__d('WebMessengerMessageIDFinder',['csx','DataStore','DOM'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={find:function j(k,l){var m=l?c('DOM').find(k,l):k,n=c('DataStore').get(m,'MessageRenderer:messageID');return n;},findAll:function j(k){var l=c('DOM').scry(k,"._53"),m=[];if(l.length){var n=l[0];for(var o=0;o<n.childNodes.length;o++)m.push(c('DataStore').get(n.childNodes[o],'MessageRenderer:messageID'));}return m;}};f.exports=i;}),null);
__d('WebMessengerMessagesSelection',['csx','CSS','DOM','getObjectValues','WebMessengerMessageIDFinder'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={};function j(m,n){var o=m,p=n;if(o==p)return 0;while(true){o=o.nextSibling;p=p.nextSibling;if(!o||p==m){return 1;}else if(!p||o==n)return -1;}}function k(m,n){var o=m.id,p=c('DOM').scry(m,"._yh input")[0];if(n){i[o]=m;c('CSS').addClass(m,'selected');p.checked=true;}else{delete i[o];c('CSS').removeClass(m,'selected');p.checked=false;}}var l={clear:function m(){for(var n in i)k(i[n],false);},selectClick:function m(n){k(n,!(n.id in i));},getSelectedMessageIDs:function m(){var n=c('getObjectValues')(i);n.sort(j);var o=[];n.forEach(function(p){o=o.concat(c('WebMessengerMessageIDFinder').findAll(p));});return o;}};f.exports=l;}),null);
__d('DOMEmployeeLink',['cx','EmployeeLinkMatcher','EmployeeLinkRanges','JSXDOM','TransformTextToDOMMixin'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={match:function j(k){if(!c('EmployeeLinkMatcher').isMatch(k))return false;var l=c('EmployeeLinkMatcher').match(k);return {startIndex:l.idx,endIndex:l.idx+l.lnk.length,element:this._element(l.lnk)};},_element:function j(k){var l=c('EmployeeLinkRanges').get(k);if(l.length==0)return k;return c('JSXDOM').a({className:"_553k",href:l[0].entity.url,target:'_blank',rel:'nofollow'},k);}};f.exports=Object.assign(i,c('TransformTextToDOMMixin'));}),null);
__d('DOMHyperlink',['cx','Env','JSXDOM','TransformTextToDOMMixin','UntrustedLink','URI','URLScraper','isFacebookURI'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={MAX_ITEMS:40,match:function j(k,l){var m=c('URLScraper').match(k);if(!m)return false;var n=k.indexOf(m),o=n+m.length;return {startIndex:n,endIndex:o,element:this._element(m,l)};},_element:function j(k,l){var m=k,n=m.replace(/"/g,'%22');if(!/^[a-z][a-z0-9\-+.]+:\/\//i.test(k))n='http://'+n;if(!c('URI').isValidURI(n))return m;var o=c('JSXDOM').a({className:"_553k",href:n,target:"_blank",rel:"nofollow"},m);if(l&&!c('isFacebookURI')(new (c('URI'))(n)))o.onmousedown=function(p){c('UntrustedLink').bootstrap(this,c('Env').lhsh,p);};return o;}};f.exports=Object.assign(i,c('TransformTextToDOMMixin'));}),null);
__d('MercuryMessageRenderer',['DOM','DOMEmoji','DOMEmote','DOMEmployeeLink','DOMHyperlink','JSXDOM','URI','shouldAddMRefParam','transformTextToDOM'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={formatMessageBody:function l(m,n,o){var p=(m||'').replace(/\s+$/,'');if(!n)return k(p,false,o);var q=Object.keys(n).map(function(t){return window.parseInt(t);}).sort(function(t,u){return t-u;}),r=[],s=0;q.forEach(function(t){var u=p.slice(s,t);if(u)r.push(k(u,false,o));s=t+n[t].length;var v=p.slice(t,s);if(v)r.push(k(v,true,o));});if(s<p.length)r.push(k(p.slice(s),false,o));return r.length===0?null:r.length===1?r[0]:c('DOM').create('span',{},r);}};function i(l,m){var n=m(l);if(Array.isArray(n))n.forEach(function(o){if(o.href){var p=new (c('URI'))(o.href);if(c('shouldAddMRefParam')(p))o.href=p.addQueryData({__mref:'message'}).toString();}});return n;}function j(l,m){var n=l.replace(/\r\n?/g,'\n').split(/\n{2,}/);return n.filter(function(o){return o.length;}).map(function(o){return c('JSXDOM').p(null,i(o,m));});}function k(l,m,n){if(l.length===0&&!m)return null;var o=function p(q){return c('transformTextToDOM')(q,[c('DOMHyperlink').params(true),c('DOMEmoji'),c('DOMEmote'),c('DOMEmployeeLink')]);};return (c('JSXDOM').span({className:m?'highlight':null},n?j(l,o):i(l,o)));}f.exports=h;}),null);
__d('WebMessengerThreadMessagesRenderer',['csx','cx','fbt','AsyncRequest','MercuryAttachment','CSS','DataStore','DOM','Event','MercuryDisplayTimeFilterMessageRenderer','HovercardLink','Image.react','ImmutableObject','LinkController','MercuryLogMessageRenderer','MercuryActionType','MercuryAttachments.react','MercuryAttachmentType','MercuryErrorInfo','MercuryIDs','MercuryLogMessageType','MercuryMessageError.react','MercuryMessageGroup','MercuryTimePassed','MercuryViewer','MercuryMessageRenderer','WebMessengerMessagesSelection','MercuryMessages','Parent','MercuryParticipants','MercuryParticipantsConstants','React','ReactDOM','WebMessengerStateManager','Style','WebMessengerTemplates','MercuryThreadMetadataRenderer','Vector','WebMessengerConstants','WebMessengerEvents','WebMessengerSubscriptionsHandler','formatDate','ge','isRTL'],(function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('MercuryMessages').get(),l=c('MercuryThreadMetadataRenderer').get(),m={updateSelection:function o(p){var q=c('WebMessengerStateManager').getCurrentStateData().message_action;c('CSS').conditionClass(p,'selectionEnabled',q);},setupSelectionListener:function o(p){c('LinkController').registerHandler(function(q){var r=c('WebMessengerStateManager').getCurrentStateData().message_action;if(r&&c('Parent').byClass(q,'webMessengerMessageGroup'))return false;});c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(p,'click',function(event){var q=c('WebMessengerStateManager').getCurrentStateData().message_action;if(q){var r=null;for(var s=event.getTarget();s;s=s.parentNode)if(c('CSS').hasClass(s,'webMessengerMessageGroup'))r=s;r&&c('WebMessengerMessagesSelection').selectClick(r);}}));},renderForwardedMessages:function o(p,q){var r=c('MercuryMessageGroup').calculateMessageGroups(q),s=null;r.forEach(function(t){var u=m.renderMessageGroup(t,true);c('DOM').appendContent(p,u.getRoot());s=t[t.length-1];});},renderMessageGroup:function o(p,q,r){var s,t=p[0],u=t.action_type===c('MercuryActionType').LOG_MESSAGE,v=u&&(t.log_message_type===c('MercuryLogMessageType').VIDEO_CALL||t.log_message_type===c('MercuryLogMessageType').PHONE_CALL),w=!v&&u?c('WebMessengerTemplates')[':fb:web-messenger:read-view:log-message'].build():c('WebMessengerTemplates')[':fb:web-messenger:read-view:message-group'].build();w.getRoot().setAttribute('id',(r||'wm:')+t.message_id);if(v){(function(){var x={attach_type:'share',share:{style_list:['rtc_call_log','fallback'],log_message_body:t.log_message_body,log_message_data:t.log_message_data,log_message_type:t.log_message_type,timestamp:t.timestamp}},y=c('ImmutableObject').setProperty(t,'attachments',[x]);y=c('ImmutableObject').setProperty(y,'has_attachment',true);y=c('ImmutableObject').setProperty(y,'body','');c('MercuryParticipants').get(t.author,function(z){return m.renderSingleMessage(w,y,z,q);});})();}else if(u){m.renderSingleLogMessage(w,t);}else c('MercuryParticipants').get(t.author,function(x){m.renderSingleMessage(w,t,x,q);for(var y=1;y<p.length;y++)m.appendMessageToGroup(w,p[y]);});return w;},appendMessageToGroup:function o(p,q){var r=c('WebMessengerTemplates')[':fb:web-messenger:read-view:message'].build();if(q.is_filtered_content_bh||q.is_filtered_content_account||q.is_filtered_content_quasar||q.is_filtered_content_invalid_app||q.is_filtered_content){c('ReactDOM').render(c('React').createElement('div',{className:"uiBoxYellow _2ph- _3-95"},c('MercuryDisplayTimeFilterMessageRenderer').renderFilteredContent(q)),r.getNode('message'));}else r.setNodeContent('message',c('MercuryMessageRenderer').formatMessageBody(q.body,null,true));c('ReactDOM').render(c('React').createElement(c('MercuryMessageError.react'),{message:new (c('ImmutableObject'))(q)}),r.getNode('status'));var s=r.getRoot();c('DataStore').set(s,'MessageRenderer:messageID',q.message_id);c('CSS').addClass(r.getNode('message'),c('isRTL')(q.body)?'direction_rtl':'direction_ltr');c('DOM').appendContent(p.getNode('bodyDiv'),s);c('MercuryParticipants').get(c('MercuryViewer').getID(),function(t){if(t.employee){var u=c('WebMessengerTemplates')[':fb:web-messenger:bug-reporting'].build();u.getNode('fbtrace').setAttribute('data-timestamp',q.timestamp);u.getNode('brokenheart').setAttribute('data-timestamp',q.timestamp);c('DOM').setContent(r.getNode('bugReporting'),u.getRoot());}});},renderSingleLogMessage:function o(p,q){var r=p.getNode('attachment');c('MercuryLogMessageRenderer').renderLegacy(p.getNode('icon'),p.getNode('message'),r,q);m.renderStatus(p,q);l.renderTimestamp(p.getNode('timestamp'),q.timestamp_absolute,q.timestamp_relative,q.timestamp);},renderMessageSeparator:function o(p){var q=c('WebMessengerTemplates')[':fb:mercury:timestamp'].render();q.removeAttribute('title');var r=p.timestamp_absolute;if(!r)r=c('formatDate')(new Date(p.timestamp),{withinWeek:'l',withinYear:'F jS',older:'F jS, Y'});if(k.isFirstMessage(p))if(p.timestamp_time_passed===c('MercuryTimePassed').TODAY){r=j._("\u4eca\u5929\u958b\u59cb\u7684\u5c0d\u8a71");}else r=j._("\u5c0d\u8a71\u958b\u59cb\u65bc{timestamp}",[j.param('timestamp',r)]);c('DOM').setContent(q,r);c('CSS').show(q);return c('DOM').create('li',{className:"_2n3"},q);},renderMessageSeparatorForIndex:function o(p,q){var r=p[q][0];if(q){var s=r.timestamp,t=p[q-1],u=t[t.length-1].timestamp,v=c('WebMessengerConstants').READ_VIEW_SEPARATOR_TIME_LIMIT;if(s-u<v)return false;}return m.renderMessageSeparator(r);},renderRawAttachments:function o(p,q){var r=c('MercuryAttachment').convertRaw(q.raw_attachments||[]),s=(q.photo_fbids?q.photo_fbids.length:0)+(q.image_ids?q.image_ids.length:0);for(var t=0;t<s;t++)r.push({attach_type:c('MercuryAttachmentType').PHOTO,preview_width:206,preview_height:206});if(q.sticker_id)r.push({attach_type:c('MercuryAttachmentType').STICKER});m.renderAttachments(p,r,q);},renderAttachments:function o(p,q,r){c('ReactDOM').render(c('React').createElement(c('MercuryAttachments.react'),{attachments:q,maxWidth:450,message:r,isChat:false,onStickerClick:c('WebMessengerEvents').stickerClicked.bind(c('WebMessengerEvents'))}),p);},renderStatus:function o(p,q){if(c('MercuryErrorInfo').hasErrorStatus(q)){var r=c('React').createElement(c('MercuryMessageError.react'),{message:new (c('ImmutableObject'))(q)}),s=p.getNode('statusContainer');if(s&&r){c('ReactDOM').render(r,s);c('CSS').show(s);}}},renderSingleMessage:function o(p,q,r,s){m.appendMessageToGroup(p,q);var t=void 0;if(r.href){t=c('DOM').create('a',{href:r.href},r.name);if(c('WebMessengerStateManager').getStandaloneMode())t.setAttribute('target','_blank');var u=c('MercuryIDs').getUserIDFromParticipantID(r.id);if(u)t.setAttribute('data-hovercard',c('HovercardLink').constructEndpoint({id:u}));}else t=r.name;p.setNodeContent('authorName',t);var v=p.getNode('image');c('CSS').removeClass(v,'MercuryThreadImage');var w=c('React').createElement(c('Image.react'),{alt:r.name,width:c('MercuryParticipantsConstants').IMAGE_SIZE,height:c('MercuryParticipantsConstants').IMAGE_SIZE,src:r.image_src,className:"_50dv"});if(r.href)w=c('React').createElement('a',{href:r.href},w);w=c('ReactDOM').render(w,v);var x=void 0;if(q.timestamp_time_passed===c('MercuryTimePassed').TODAY){x='g:ia';}else x='n/j, g:ia';var y=c('formatDate')(new Date(q.timestamp),x);l.renderTimestamp(p.getNode('timestamp'),q.timestamp_absolute,y,q.timestamp);l.renderMessageSourceTags(p.getNode('tooltipForSource'),p.getNode('sourceIcon'),q.source_tags||[],q.author_email);l.renderSpoofWarning(p.getNode('spoofWarning'),q.is_spoof_warning,r);if(q.subject)p.setNodeContent('subject',q.subject);if(q.has_attachment){var z=p.getNode('attachments');if(q.attachments&&q.attachments.length===0){m.renderRawAttachments(z,q);}else if(q.attachments!==null&&q.attachments.length>0){m.renderAttachments(z,q.attachments,q);}else if(q.raw_attachments!=null&&q.raw_attachments.length>0)m.renderRawAttachments(z,q.raw_attachments);}var aa=p.getNode('forwards'),ba=q.forward_count&&k.getMessagesFromIDs(q.forward_message_ids);if(ba)m.renderForwardedMessages(aa,ba);c('CSS').conditionShow(aa,ba);}};function n(o,p,q){var r=c('ge')(o),s=c('DOM').find(r,'iframe'),t=c('DOM').find(s,"^._5xm"),u=t.firstChild;c('Style').set(s,'width',p+'px');c('Style').set(s,'height',q+1+'px');s.setAttribute('scrolling','no');var v=r&&c('Vector').getElementDimensions(r).x/p;if(v&&v<1){c('Style').set(t,'height',Math.round(v*(q+1))+'px');var w=s.style,x=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],y=void 0;while(y=x.shift())if(typeof w[y]!=='undefined'){c('Style').set(s,y,'scale('+v+','+v+')');return;}c('Style').set(u,'zoom',v);}}f.exports=m;}),null);
__d('WebMessengerDetailViewRecentMessagesControl',['cx','fbt','Event','Animation','CSS','WebMessengerDetailViewUnreadMessagesNotice','DOM','Arbiter','GroupChatMessageBlockAlert','MercuryLastMessageIndicator.react','MercuryListUpdateRenderer','MercuryAPIArgsSource','MercuryBlockedParticipants','MercuryConfig','MercuryLogMessageType','MercurySourceType','MercuryThreadlistConstants','MercuryViewer','MercuryMessageGroup','MercuryMessageActions','MercuryMessageObject','MercuryMessages','WebMessengerMessagesSelection','MessagingTag','MessengerContextBannerBootloader','ReactDOM','ReactComponentRenderer','MercuryShareAttachmentRenderLocations','WebMessengerStateConstants','WebMessengerStateManager','Style','WebMessengerTemplates','MercuryThreadInformer','WebMessengerThreadMessagesRenderer','MercuryThreadActions','MercuryThreads','UserActivity','WebMessengerConstants','WebMessengerInfoBoxRenderer','WebMessengerMessageIDFinder','WebMessengerSubscriptionsHandler','debounce','formatDate','ge'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('MercuryBlockedParticipants').get(),k=c('MercuryMessageActions').get(),l=c('MercuryMessageObject').get(),m=c('MercuryMessages').get(),n=c('MercuryThreadInformer').get(),o=c('MercuryThreadActions').get(),p=c('MercuryThreads').get();function q(ka,la,ma,na,oa,pa,qa,ra){'use strict';this._manager=ka;this._rootElement=la;this._loadingSpinner=ma;this._noSelectedConversation=na;this._newMessageLink=oa;this._showUnreadLink=pa;this.contextBanner=qa;c('DOM').empty(this._rootElement);this._pagerExponent=-1;var sa=c('WebMessengerTemplates')[':fb:web-messenger:read-view:recent-messages'].build();c('DOM').setContent(this._rootElement,sa.getRoot());this._selectedConversationView=sa.getRoot();this._messageList=sa.getNode('messagelist');this._loadMoreButton=sa.getNode('loadMoreButton');this._loadMoreLink=sa.getNode('loadMoreLink');this._loadMoreCount=sa.getNode('loadMoreCount');this._loadingMoreCount=sa.getNode('loadingMoreCount');this._indicatorNode=sa.getNode('lastMessageIndicator');this._unseenMessagesNotice=new (c('WebMessengerDetailViewUnreadMessagesNotice'))(this._manager);this._unseenMessagesNotice.setNoticeContextNode(ra);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._firstContact={};this._loadMessagesInFlight={};this._olderMessageID={};c('WebMessengerThreadMessagesRenderer').setupSelectionListener(this._messageList);this._manager.addScrollCallback(c('debounce')(ja.bind(null,this),500));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._loadMoreLink,'click',ba.bind(null,this)),n.subscribe('messages-reordered',function(ta,ua){var va=this._threadID&&ua[this._threadID];if(va){if(!this._olderMessageID[this._threadID])this._firstContact[this._threadID]=true;x(this);}}.bind(this)),n.subscribe('messages-updated',function(ta,ua){var va=this._threadID&&ua[this._threadID];if(va)var wa=Object.keys(va),xa=wa.length&&va[wa[0]];if(va&&xa)x(this,ua[this._threadID]);}.bind(this)),n.subscribe('messages-updated',ja.bind(null,this)),n.subscribe('messages-received',function(ta,ua){if(this._threadID&&ua[this._threadID])aa(this,ua);}.bind(this)),n.subscribe('thread-read-changed',function(ta,ua){if(ua[this._threadID])ga(this,ua[this._threadID]);}.bind(this)),this._manager.subscribe('scrolledNearTop',function(){this._active&&ba(this);}.bind(this)));}q.prototype.hideView=function(){'use strict';this._active=false;c('CSS').hide(this._rootElement);c('CSS').hide(this._loadingSpinner);c('CSS').hide(this._noSelectedConversation);c('CSS').hide(this.contextBanner);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);};q.prototype.updateView=function(){'use strict';this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);c('CSS').show(this._rootElement);if(this.contextBanner)c('CSS').show(this.contextBanner);var ka=s(this);t(this);c('WebMessengerMessagesSelection').clear();if(ka){u(this);}else ea(this);};q.prototype.renderContextBanner=function(ka,la){'use strict';if(this.contextBanner&&!this.contextBannerElem)c('MessengerContextBannerBootloader').bootload(ka,c('MercuryShareAttachmentRenderLocations').WEB_INBOX,function(ma){this.contextBannerElem=ma;c('Style').set(this._rootElement,'padding-top','80px');c('DOM').prependContent(this.contextBanner,this.contextBannerElem);c('CSS').show(this.contextBanner);}.bind(this),la);};q.prototype.unmountContextBanner=function(){'use strict';if(this.contextBannerElem){c('ReactDOM').unmountComponentAtNode(this.contextBannerElem);this.contextBannerElem=null;c('DOM').empty(this.contextBanner);}};q.prototype.destroy=function(){'use strict';r(this);this._unseenMessagesNotice.destroy();c('ReactDOM').unmountComponentAtNode(this._indicatorNode);this.unmountContextBanner();};function r(ka){ka._messagesSubscription&&m.unsubscribe(ka._messagesSubscription.subscriber_id,ka._messagesSubscription.thread_id);ka._messagesSubscription=null;}function s(ka){var la=c('WebMessengerStateManager').getCurrentStateData();if(!ka._threadID||ka._threadID!=la.thread_id)return true;return false;}function t(ka){var la=c('WebMessengerStateManager').getCurrentStateData();ka._state=c('WebMessengerStateManager').getCurrentDetailState();ka._threadID=la.thread_id;ka._selectionEnabled=!!la.message_action;ka._bugReportingEnabled=la.bug_reporting_enabled;c('WebMessengerThreadMessagesRenderer').updateSelection(ka._messageList);c('CSS').conditionClass(ka._messageList,'bugReportingEnabled',ka._bugReportingEnabled);}function u(ka){c('DOM').scry(ka._rootElement,'.stickerContainer').forEach(function(ma){return c('ReactDOM').unmountComponentAtNode(ma);});c('DOM').empty(ka._messageList);ka.unmountContextBanner();var la=null;if(ka._threadID)la=p.getThreadMetaNow(ka._threadID);if(la&&j.isPresentInGroupThread(la)){c('GroupChatMessageBlockAlert').show(j.inGroupThread(la),function(){return v(ka);},function(){k.send(l.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,ka._threadID,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);v(ka);});}else v(ka);}function v(ka){c('CSS').show(ka._loadingSpinner);c('CSS').hide(ka._loadMoreButton);r(ka);ka._pagerExponent=-1;c('ReactDOM').unmountComponentAtNode(ka._indicatorNode);if(ka._lastMessageIndicator){ka._lastMessageIndicator.unmount();delete ka._lastMessageIndicator;}if(ka._threadID){c('CSS').show(ka._selectedConversationView);c('CSS').hide(ka._noSelectedConversation);ka._manager._flexArea.showAtTop(false);if(!ka._olderMessageID[ka._threadID]){w(ka);}else x(ka);ka._manager.scrollToBottom(false);}else{ia(ka);c('CSS').hide(ka._selectedConversationView);c('CSS').show(ka._noSelectedConversation);c('CSS').hide(ka._loadingSpinner);ka._manager._flexArea.showAtTop(true);}}function w(ka){ka._loadMessagesInFlight[ka._threadID]=true;ka._currentCountMap[ka._threadID]=c('WebMessengerConstants').INITIAL_MESSAGES_LIMIT;c('CSS').hide(ka._loadMoreButton);var la=m.getThreadMessagesRange(ka._threadID,0,ka._currentCountMap[ka._threadID],y.bind(null,ka),null,c('MercuryAPIArgsSource').WEBMESSENGER);if(la){ka._messagesSubscription={subscriber_id:la,thread_id:ka._threadID};}else x(ka);}function x(ka,la){if(!ka._threadID||!ka._olderMessageID[ka._threadID]&&!ka._firstContact[ka._threadID])return;var ma=m.getThreadMessagesSinceTimestamp(ka._threadID,ha(ka._olderMessageID[ka._threadID]));if(ma.length>ka._currentCountMap[ka._threadID])ka._currentCountMap[ka._threadID]=ma.length;z(ka,ma,la);}function y(ka,la){ka._loadMessagesInFlight[ka._threadID]=false;if(la&&la.length){var ma=la[0].timestamp,na=ka._olderMessageID[ka._threadID]?ha(ka._olderMessageID[ka._threadID]):null;if(!na||ma<na)ka._olderMessageID[ka._threadID]=la[0].message_id;}}function z(ka,la,ma){c('CSS').hide(ka._loadingSpinner);c('CSS').conditionShow(ka._loadMoreButton,!m.hasLoadedAllMessages(ka._threadID));var na=p.getThreadMetaNow(ka._threadID);if(na){var oa=na.message_count-la.length;oa=oa<0?0:oa;c('DOM').setContent(ka._loadMoreCount,oa);c('DOM').setContent(ka._loadingMoreCount,oa);}if(na&&na.is_canonical&&c('MercuryConfig').ShowContextBanner&&m.hasLoadedAllMessages(ka._threadID))ka.renderContextBanner(ka._threadID);var pa=function xa(ya){var za,ab=c('ge')('wm:'+ya);if(ab)za=c('WebMessengerMessageIDFinder').findAll(ab);return za||[];},qa=[],ra=c('MercuryMessageGroup').calculateMessageGroups(la),sa={},ta=[];ra.forEach(function(xa){var ya=xa[0].message_id,za=false;if(ma){za=xa.some(function(bb){return bb.message_id in ma;});if(!za){qa=pa(ya);za=qa.some(function(bb){return bb in ma;});}}if(!za){qa=pa(ya);if(xa.length==qa.length){for(var ab=0;ab<xa.length;ab++)if(xa[ab].message_id!=qa[ab]){za=true;break;}}else za=true;}if(za)sa[ya]=1;ta.push('wm:'+ya);});var ua=function xa(ya){return !sa[ra[ya][0].message_id];},va=function xa(ya){var za=ra[ya],ab=c('WebMessengerThreadMessagesRenderer').renderMessageGroup(za);if(ya==ta.length-1)ka._messageGroup=ab;return ab.getRoot();},wa=function xa(ya){return c('WebMessengerThreadMessagesRenderer').renderMessageSeparatorForIndex(ra,ya);};c('MercuryListUpdateRenderer').updateList(ka._messageList,ta,ua,va,wa);ka._lastMessage=la[la.length-1];da(ka);ea(ka);ka._manager.poke();}function aa(ka,la){var ma=la[ka._threadID],na=ka._manager._flexArea.getScrollableArea(),oa=na.getScrollHeight();ma.forEach(function(ra){ra.timestamp_relative=c('formatDate')(new Date(ra.timestamp),'g:ia');var sa=c('MercuryMessageGroup').canAppendMessageToLastGroup(ka._lastMessage,ra);if(!sa){ka._messageGroup=c('WebMessengerThreadMessagesRenderer').renderMessageGroup([ra]);var ta=ra.timestamp,ua=ka._lastMessage?ka._lastMessage.timestamp:0,va=c('WebMessengerConstants').READ_VIEW_SEPARATOR_TIME_LIMIT;if(!ua||ta-ua>=va){var wa=c('WebMessengerThreadMessagesRenderer').renderMessageSeparator(ra);c('DOM').appendContent(ka._messageList,wa);}c('DOM').appendContent(ka._messageList,ka._messageGroup.getRoot());}else c('WebMessengerThreadMessagesRenderer').appendMessageToGroup(ka._messageGroup,ra);if(ra.author!=c('MercuryViewer').getID())c('CSS').addClass(ka._messageGroup.getRoot(),'unreadHighlight');ka._lastMessage=ra;});ka._manager._flexArea.poke();var pa=na.getScrollHeight(),qa=na.getScrollTop();ka._unseenMessagesNotice.updateOnMessagesReceived(oa,pa,qa,la);da(ka);if(ka._manager.isScrolledToBottom())ea(ka);}function ba(ka){c('CSS').addClass(ka._loadMoreButton,'async_saving');if(ka._loadMessagesInFlight[ka._threadID])return;ka._loadMessagesInFlight[ka._threadID]=true;ka._pagerExponent=Math.min(ka._pagerExponent+1,c('WebMessengerConstants').EXPONENTIAL_PAGER_MAX_CYCLES);var la=Math.pow(2,ka._pagerExponent),ma=ka._currentCountMap[ka._threadID]+la*c('MercuryThreadlistConstants').WEBMESSENGER_MORE_MESSAGES_COUNT;r(ka);var na=m.getThreadMessagesRange(ka._threadID,0,ma,function(oa){c('CSS').removeClass(ka._loadMoreButton,'async_saving');ka._currentCountMap[ka._threadID]=ma;y(ka,oa);ka._loadMessagesInFlight[ka._threadID]=false;},null,c('MercuryAPIArgsSource').WEBMESSENGER);if(na){ka._messagesSubscription={subscriber_id:na,thread_id:ka._threadID};}else x(ka);}function ca(ka){if(!ka._lastMessageIndicator){var la;ka._lastMessageIndicator=new (c('ReactComponentRenderer'))(c('MercuryLastMessageIndicator.react'),ka._indicatorNode);ka._lastMessageIndicator.setProps({threadID:ka._threadID,className:"_510o",indicatorWillShow:function ma(){return (la=ka._manager.isScrolledToBottom());},indicatorDidShow:function ma(){return (la&&ka._manager.scrollToBottom(true));}});}return ka._lastMessageIndicator;}function da(ka,la){ca(ka).setProps({lastMessage:ka._lastMessage});}function ea(ka){if(c('UserActivity').isActive(5000)){fa(ka);}else c('UserActivity').subscribeOnce(fa.bind(null,ka));}function fa(ka){if(!ka._threadID||!ka._active)return;o.markRead(ka._threadID);var la=c('DOM').scry(ka._messageList,'.unreadHighlight');la.forEach(function(ma){c('CSS').removeClass(ma,'unreadHighlight');c('CSS').addClass(ma,'unreadFading');new (c('Animation'))(ma).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(c('Animation').ease.both).duration(1500).ondone(function(){c('CSS').removeClass(ma,'unreadFading');c('Style').set(ma,'background','');c('Style').set(ma,'borderColor','');}).go();});}function ga(ka,la){if(!la.mark_as_read)return;var ma=c('DOM').scry(ka._messageList,'.unreadHighlight');for(var na=0;na<ma.length;na++){var oa=ma[na],pa=c('WebMessengerMessageIDFinder').findAll(oa),qa=m.getMessagesFromIDs(pa);if(qa[qa.length-1].timestamp<la.timestamp)c('CSS').removeClass(oa,'unreadHighlight');}}function ha(ka){if(!ka)return 0;var la=m.getMessagesFromIDs([ka])[0];return la?la.timestamp:0;}function ia(ka){if(ka._builtNoSelectionBox)return;var la=function na(){var oa=c('WebMessengerStateManager').getCurrentStateData(),pa=babelHelpers['extends']({},oa);c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,Object.assign(pa,{start:true,thread_id:undefined}));},ma=function na(){var oa=c('WebMessengerStateManager').getCurrentStateData(),pa=babelHelpers['extends']({},oa);c('WebMessengerStateManager').updateMasterState(c('WebMessengerStateConstants').MASTER.RECENT_THREADS,Object.assign(pa,{folder:c('MessagingTag').INBOX,filter:c('MessagingTag').UNREAD}));};c('DOM').setContent(ka._noSelectedConversation,c('WebMessengerInfoBoxRenderer').render(i._("\u6c92\u6709\u9078\u64c7\u5c0d\u8a71"),[{text:i._("\u65b0\u8a0a\u606f"),handler:la},{text:i._("\u986f\u793a\u672a\u8b80\u8a0a\u606f"),handler:ma}]));ka._builtNoSelectionBox=true;}function ja(ka){var la=ka._manager._flexArea.getScrollableArea(),ma=ka._manager.getFlexAreaBoundingClientRect();c('Arbiter').inform('messengerScrolled/'+ka._threadID,{scrollTop:la.getScrollTop(),top:ma.y,viewHeight:ma.height});}f.exports=q;}),null);
__d('MercurySearchContextResults',['KeyedCallbackManager','MercuryAPIArgsSource','MercuryIDs','MercuryThreadlistConstants','MercuryThreadIDMap','RangedCallbackManager','MercuryServerDispatcher','MercuryServerPayloadPreprocessor','WebMessengerConstants'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get(),i=c('MercuryServerPayloadPreprocessor').get(),j=new (c('KeyedCallbackManager'))(),k=c('MercuryThreadlistConstants').WEBMESSENGER_SEARCH_SNIPPET_COUNT,l=c('WebMessengerConstants').MORE_SEARCH_CONTEXT_COUNT,m={getSearchContext:function q(r,s,t){if(r){var u=j.executeOrEnqueue(r,function(z){var aa=o(z,r);t(aa);}),v=j.getUnavailableResources(u);if(v.length){var w={message_id:r,limit:k+1},x=h.getServerIDFromClientIDNow(s),y=c('MercuryIDs').tokenize(s);if(y.type=='user'){w.other_user_fbid=x;}else w.thread_fbid=x;p(w);}return u;}},getMoreSearchContext:function q(r,s,t,u){if(r){var v=j.getResource(r);if(v){var w=t==c('WebMessengerConstants').MORE_SEARCH_CONTEXT_UP?v.up_message_ids:v.down_message_ids,x=w.getCurrentArraySize()+l,y=w.executeOrEnqueue(0,x,function(){var da=o(v,r);u(da);}),z=w.getUnavailableResources(y);if(z.length){var aa={message_id:r,limit:x,direction:t},ba=h.getServerIDFromClientIDNow(s),ca=c('MercuryIDs').tokenize(s);if(ca.type=='user'){aa.other_user_fbid=ba;}else aa.thread_fbid=ba;p(aa);}return y;}}},handleUpdate:function q(r){if(r.mercury_payload)i.handleUpdate(r.mercury_payload);var s=r.search_context||{};for(var t in s){var u=s[t],v=u.other_user_fbid||u.thread_fbid,w=h.getClientIDFromServerIDNow(v),x=!j.getResource(t),y=x?{thread_id:w,up_message_ids:new (c('RangedCallbackManager'))(),down_message_ids:new (c('RangedCallbackManager'))()}:j.getResource(t),z=x?k+1:l;if(u.up_message_ids&&(y.up_message_ids.getCurrentArraySize()===0||u.up_message_ids.length>=y.up_message_ids.getCurrentArraySize()))n(y.up_message_ids,u.up_message_ids,z);if(u.down_message_ids&&(y.down_message_ids.getCurrentArraySize()===0||u.down_message_ids.length>=y.down_message_ids.getCurrentArraySize()))n(y.down_message_ids,u.down_message_ids,z);if(x)j.setResource(t,y);}},unsubscribe:function q(r,s,t){if(s){var u=j.getResource(s);if(u){if(t==c('WebMessengerConstants').MORE_SEARCH_CONTEXT_UP){u.up_message_ids.unsubscribe(r);}else u.down_message_ids.unsubscribe(r);}else j.unsubscribe(r);}}};function n(q,r,s){var t=q.getCurrentArraySize(),u=r.length<t+s;if(r.length){q.removeAllResources();q.addResourcesWithoutSorting(r,0);}if(u)q.setReachedEndOfArray();}function o(q,r){var s=q.up_message_ids.hasReachedEndOfArray(),t=q.up_message_ids.getAllResources();if(!s)t.shift();var u=q.down_message_ids.hasReachedEndOfArray(),v=q.down_message_ids.getAllResources();if(!u)v.pop();return {thread_id:q.thread_id,message_id:r,up_message_ids:t,up_exhausted:s,down_message_ids:v,down_exhausted:u};}function p(q){q.client=c('MercuryAPIArgsSource').WEBMESSENGER;c('MercuryServerDispatcher').trySend('/ajax/mercury/search_context.php',q);}c('MercuryServerDispatcher').registerEndpoints({'/ajax/mercury/search_context.php':{mode:c('MercuryServerDispatcher').IMMEDIATE,handler:m.handleUpdate}});f.exports=m;}),null);
__d('MercurySearchSnippetResults',['CurrentEnvironment','MercuryAPIArgsSource','MercuryIDs','MercurySingletonMixin','MercuryThreadlistConstants','MercuryThreadIDMap','RangedCallbackManager','MercuryServerDispatcher','MercuryServerPayloadPreprocessor'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('CurrentEnvironment').messengerdotcom?c('MercuryAPIArgsSource').MESSENGER:c('MercuryAPIArgsSource').WEBMESSENGER,i={},j={},k=null,l=c('MercuryThreadlistConstants').WEBMESSENGER_SEARCH_SNIPPET_COUNT,m=c('MercuryThreadlistConstants').WEBMESSENGER_SEARCH_SNIPPET_LIMIT,n=c('MercuryThreadlistConstants').WEBMESSENGER_SEARCH_SNIPPET_MORE;function o(x){'use strict';this.$MercurySearchSnippetResults1=x;this.$MercurySearchSnippetResults2=c('MercuryServerPayloadPreprocessor').getForFBID(x);c('MercuryServerDispatcher').registerEndpoints({'/ajax/mercury/search_snippets.php':{request_user_id:x,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(y){this.handleUpdate(y);}.bind(this)}});this.$MercurySearchSnippetResults3=c('MercuryThreadIDMap').getForFBID(x);}o.prototype.getFBID=function(){'use strict';return this.$MercurySearchSnippetResults1;};o.prototype.getThreadIDMap=function(){'use strict';return this.$MercurySearchSnippetResults3;};o.prototype.getAllThreadSearchResults=function(x,y){'use strict';if(x)p(this.$MercurySearchSnippetResults1,x,m,0,y);};o.prototype.getAllThreadSearchMoreResults=function(x,y){'use strict';if(x){var z=i[x];if(z){var aa=z.getCurrentArraySize();p(this.$MercurySearchSnippetResults1,x,n,aa,y);}}};o.prototype.getSingleThreadSearchResults=function(x,y,z){'use strict';if(!x||!y)return;q.call(this,x,y,l,0,z);};o.prototype.getSingleThreadSearchMoreResults=function(x,y,z){'use strict';if(!x||!y)return;if(!j[y])return;var aa=j[y][x];if(aa){var ba=aa.num_total_snippets,ca=aa.snippets_cbm.getCurrentArraySize(),da=ba-ca;if(da>0){var ea=da>n?n:da;q.call(this,x,y,ea,ca,z);}}};o.prototype.countSnippetsMatchingQueryInThread=function(x,y){'use strict';var z=j[y][x];if(z)return z.num_total_snippets;};o.prototype.findIndexOfSnippet=function(x,y,z,aa){'use strict';var ba=v(x,y),ca=ba.getAllResources();for(var da=0;da<ca.length;da++)if(z===ca[da].message_id)return da;};o.prototype.findSnippetAtIndex=function(x,y,z,aa){'use strict';s(x,y,z);t.call(this,x,y,z,aa);};o.prototype.handleUpdate=function(x){'use strict';if(x.mercury_payload)this.$MercurySearchSnippetResults2.handleUpdate(x.mercury_payload);var y=x.search_snippets||{};Object.keys(y).filter(function(na){return !!y[na];}).forEach(function(na){Object.keys(y[na]).forEach(function(oa){y[na][oa].snippets.forEach(function(pa){pa.matched_keywords=r(pa.matched_keywords);});});});var z=x.offset,aa=[];for(var ba in y){var ca=y[ba];for(var da in ca){var ea=ca[da],fa=x.other_user_fbid||x.thread_fbid,ga=this.$MercurySearchSnippetResults3.getClientIDFromServerIDNow(da),ha=ea.snippets,ia=v(ba,ga),ja=ia.getCurrentArraySize();if(!fa){aa.push(ga);if(ja)continue;}else if(z!=ja)continue;var ka=j[ga][ba];ka.num_total_snippets=ea.num_total_snippets;ia.addResourcesWithoutSorting(ha,ja);if(!fa||x.limit>ha.length)if(ia.getCurrentArraySize()==ka.num_total_snippets)ia.setReachedEndOfArray();}if(!fa){var la=u(ba),ma=la.getCurrentArraySize();if(z==ma){la.addResourcesWithoutSorting(aa,ma);if(x.limit>aa.length)la.setReachedEndOfArray();}}}};function p(x,y,z,aa,ba){if(k)if(!k.thread_id){var ca=u(k.query);ca.unsubscribe(k.subscriber_id);k=null;}var ca=u(y),da=aa+z,ea=ca.executeOrEnqueue(0,da,function(ha){var ia={};for(var ja=0;ja<ha.length;ja++){var ka=ha[ja],la=j[ka][y];ia[ka]={num_total_snippets:la.num_total_snippets,snippets:la.snippets_cbm.getAllResources()};}var ma=ca.hasReachedEndOfArray();ba(ia,ma);}),fa=ca.getUnavailableResources(ea);if(fa.length){k={query:y,thread_id:null,subscriber_id:ea};var ga={query:y,offset:aa,limit:z+1,snippetLimit:l};ga.identifier='thread_fbid';w(ga,x);}}function q(x,y,z,aa,ba){if(k)if(k.thread_id){var ca=v(k.query,k.thread_id);ca.unsubscribe(k.subscriber_id);k=null;}var ca=v(x,y),da=aa+z,ea=ca.executeOrEnqueue(0,da,function(){var ka=ca.getAllResources(),la=j[y][x].num_total_snippets;ba(ka,la);}),fa=ca.getUnavailableResources(ea);if(fa.length){k={query:x,thread_id:y,subscriber_id:ea};var ga={query:x,snippetOffset:aa,snippetLimit:z},ha=this.getThreadIDMap().getServerIDFromClientIDNow(y),ia=c('MercuryIDs').tokenize(y),ja=ia.type;if(ja=='user'){ga.other_user_fbid=ha;}else ga.thread_fbid=ha;ga.identifier='thread_fbid';w(ga,this.getFBID());}}function r(x){if(x instanceof Array){var y={};for(var z=0;z<x.length;z++)y[z.toString()]=x[z];return y;}else return x;}function s(x,y,z){}function t(x,y,z,aa){var ba=j[y][x],ca=ba.snippets_cbm.getAllResources(),da=ba.num_total_snippets,ea=ca.length;if(z<ea){aa(ca[z].message_id);return;}var fa=da-ea,ga=fa>n?n:fa;q.call(this,x,y,ga,ea,function(ha,ia){t.call(this,x,y,z,aa);});}function u(x){if(!i[x])i[x]=new (c('RangedCallbackManager'))();return i[x];}function v(x,y){if(!j[y])j[y]={};var z=j[y][x];if(!z){z={num_total_snippets:-1,snippets_cbm:new (c('RangedCallbackManager'))()};j[y][x]=z;}return z.snippets_cbm;}function w(x,y){x.client=h;c('MercuryServerDispatcher').trySend('/ajax/mercury/search_snippets.php',x,null,y);}Object.assign(o,c('MercurySingletonMixin'));f.exports=o;}),null);
__d('WebMessengerDetailViewSearchContextControl',['fbt','Event','CSS','DOM','MercuryMessageGroup','MercuryMessages','WebMessengerMessagesSelection','MercurySearchContextResults','MercurySearchSnippetResults','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerThreadMessagesRenderer','WebMessengerConstants','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryMessages').get(),j=c('MercurySearchSnippetResults').get();function k(u,v,w){'use strict';this._manager=u;this._rootElement=v;this._paginationBox=w;c('DOM').empty(this._rootElement);var x=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-context'].build(),y=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-pagination-box'].build();c('DOM').setContent(this._rootElement,x.getRoot());c('DOM').setContent(this._paginationBox,y.getRoot());this._messagelistRoot=x.getRoot();this._loadingSpinner=x.getNode('loadingSpinner');this._messageList=x.getNode('messagelist');this._loadMoreButton=x.getNode('loadMoreButton');this._loadMoreLink=x.getNode('loadMoreLink');this._downMoreButton=x.getNode('downMoreButton');this._downMoreLink=x.getNode('downMoreLink');this._nextSnippet=y.getNode('nextSnippet');this._previousSnippet=y.getNode('previousSnippet');this._backToSnippetsButton=y.getNode('backToSnippetsButton');this._snippetCountDescription=y.getNode('snippetCountDescription');this._paginationBoxCloseButton=y.getNode('paginationBoxCloseButton');this._state=null;this._threadID=null;this._messageID=null;c('WebMessengerThreadMessagesRenderer').setupSelectionListener(this._messageList);c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._loadMoreLink,'click',function(){c('CSS').addClass(this._loadMoreButton,'async_saving');s(this,c('WebMessengerConstants').MORE_SEARCH_CONTEXT_UP);}.bind(this)),c('Event').listen(this._downMoreLink,'click',function(){c('CSS').addClass(this._downMoreButton,'async_saving');s(this,c('WebMessengerConstants').MORE_SEARCH_CONTEXT_DOWN);}.bind(this)),c('Event').listen(this._nextSnippet,'click',l.bind(null,this,1)),c('Event').listen(this._previousSnippet,'click',l.bind(null,this,-1)),c('Event').listen(this._backToSnippetsButton,'click',function(){var z=c('WebMessengerStateManager').getCurrentStateData(),aa=z.single_thread_search?c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET:c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET,ba={folder:z.folder,message_query:z.message_query,query:z.query};if(z.single_thread_search)ba.thread_id=z.thread_id;c('WebMessengerStateManager').updateDetailState(aa,ba);}),c('Event').listen(this._paginationBoxCloseButton,'click',function(){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:c('WebMessengerStateManager').getCurrentStateData().thread_id});}.bind(this)));}k.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);c('CSS').hide(this._paginationBox);};k.prototype.updateView=function(){'use strict';c('CSS').show(this._rootElement);c('CSS').show(this._paginationBox);var u=o(this);p(this);c('WebMessengerMessagesSelection').clear();if(u)r(this);};k.prototype.destroy=function(){'use strict';n(this);};function l(u,v){var w=c('WebMessengerStateManager').getCurrentStateData(),x=j.findIndexOfSnippet(u._messageQuery,w.thread_id,w.message_id),y=x+v;c('CSS').hide(u._messageList);c('CSS').hide(u._loadMoreButton);c('CSS').hide(u._downMoreButton);c('CSS').show(u._loadingSpinner);j.findSnippetAtIndex(u._messageQuery,w.thread_id,y,function(z){c('CSS').show(u._messageList);m(w,z);});}function m(u,v){var w={folder:u.folder,message_id:v,message_query:u.message_query,query:u.query,single_thread_search:u.single_thread_search,thread_id:u.thread_id};c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),w);}function n(u){u._searchContextSubscription&&c('MercurySearchContextResults').unsubscribe(u._searchContextSubscription.subscriber_id,u._searchContextSubscription.message_id,u._searchContextSubscription.direction);u._searchThreadsSubscription=null;}function o(u){var v=c('WebMessengerStateManager').getCurrentStateData();if(u._threadID!=v.thread_id)return true;if(u._messageQuery!=v.message_query)return true;if(u._messageID!=v.message_id)return true;return false;}function p(u){var v=c('WebMessengerStateManager').getCurrentStateData();u._state=c('WebMessengerStateManager').getCurrentDetailState();u._threadID=v.thread_id;u._messageQuery=v.message_query;u._messageID=v.message_id;u._selectionEnabled=!!v.message_action;c('WebMessengerThreadMessagesRenderer').updateSelection(u._messageList);c('CSS').conditionClass(u._messageList,'bugReportingEnabled',v.bug_reporting_enabled);}function q(u,v){c('DOM').setAttributes(u,{disabled:v});var w=c('DOM').find(u,'^label');c('CSS').conditionClass(w,'uiButtonDisabled',v);}function r(u){var v=c('DOM').create('strong',{},u._messageQuery),w=j.countSnippetsMatchingQueryInThread(u._messageQuery,u._threadID),x=j.findIndexOfSnippet(u._messageQuery,u._threadID,u._messageID),y=x+1,z=h._({"*":"{query}\u5171\u6709{index}\uff0f{count}\u500b\u7d50\u679c"},[h.param('index',y),h.param('count',w,[0]),h.param('query',v)]);c('DOM').setContent(u._snippetCountDescription,z);q(u._previousSnippet,x===0);q(u._nextSnippet,x===w-1);c('DOM').empty(u._messageList);c('CSS').show(u._loadingSpinner);c('CSS').hide(u._loadMoreButton);c('CSS').hide(u._downMoreButton);n(u);if(u._threadID&&u._messageID){var aa=c('MercurySearchContextResults').getSearchContext(u._messageID,u._threadID,function(ba){c('CSS').hide(u._loadingSpinner);t(u,ba);});if(aa)u._searchContextSubscription={subscriber_id:aa,message_id:u._messageID};}}function s(u,v){n(u);if(u._threadID&&u._messageID){var w=c('MercurySearchContextResults').getMoreSearchContext(u._messageID,u._threadID,v,function(x){if(v==c('WebMessengerConstants').MORE_SEARCH_CONTEXT_UP){c('CSS').removeClass(u._loadMoreButton,'async_saving');}else c('CSS').removeClass(u._downMoreButton,'async_saving');t(u,x);});if(w)u._searchContextSubscription={subscriber_id:w,message_id:u._messageID,direction:v};}}function t(u,v){c('CSS').conditionShow(u._loadMoreButton,!v.up_exhausted);c('CSS').conditionShow(u._downMoreButton,!v.down_exhausted);var w=v.up_message_ids.concat([v.message_id],v.down_message_ids),x=i.getMessagesFromIDs(w);c('DOM').empty(u._messageList);var y=c('MercuryMessageGroup').calculateMessageGroups(x);y.forEach(function(z,aa){var ba=c('WebMessengerThreadMessagesRenderer').renderMessageSeparatorForIndex(y,aa);if(ba)c('DOM').appendContent(u._messageList,ba);var ca=c('WebMessengerThreadMessagesRenderer').renderMessageGroup(z,false,'context:').getRoot(),da=z.some(function(ea){return ea.message_id==v.message_id;});if(da)c('CSS').addClass(ca,'selectedHighlight');c('DOM').appendContent(u._messageList,ca);});}f.exports=k;}),null);
__d('WebMessengerSearchSnippetsRenderer',['cx','fbt','Event','CSS','DOM','Image.react','MercuryMessageRenderer','MercuryParticipants','MercuryParticipantsConstants','React','ReactDOM','MercurySearchSnippetResults','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','MercuryThreadMetadataRenderer'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('MercurySearchSnippetResults').get(),k=c('MercuryThreadMetadataRenderer').get(),l={renderMultipleSnippetBlocks:function r(s,t,u){u=u||{};var v=true;for(var w in u){v=false;var x=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-snippets-block'].build();c('DOM').appendContent(s,x.getRoot());l.renderSingleSnippetBlock(x,t,w,u[w]);}if(v)q(s);},renderThreadSnippetBlock:function r(s,t,u,v,w){if(!v||!v.length){q(s);return;}var x=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-snippets-block'].build();c('DOM').appendContent(s,x.getRoot());c('CSS').hide(x.getNode('searchThreadName'));m(x,t,u,v,w);},renderSingleSnippetBlock:function r(s,t,u,v){var w=s.getNode('searchThreadName'),x=c('DOM').create('h3');c('DOM').setContent(w,x);k.renderAndSeparatedParticipantList(u,x);m(s,t,u,v.snippets,v.num_total_snippets);},renderMultipleSnippets:function r(s,t,u,v){(v||[]).forEach(function(w){var x=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-snippet'].build();c('DOM').appendContent(s,x.getRoot());c('MercuryParticipants').get(w.author,function(y){l.renderSingleSnippet(x,t,u,w,y);});});},renderSingleSnippet:function r(s,t,u,v,w){s.setNodeProperty('bodyDiv','id','snippet:'+v.message_id);var x=v.matched_keywords||undefined,y=c('MercuryMessageRenderer').formatMessageBody(v.body,x);s.setNodeContent('body',y);var z=s.getNode('image');c('CSS').removeClass(z,'MercuryThreadImage');c('CSS').addClass(z,'MercuryMediumThreadImage');var aa=c('React').createElement(c('Image.react'),{width:c('MercuryParticipantsConstants').IMAGE_SIZE,height:c('MercuryParticipantsConstants').IMAGE_SIZE,src:w.image_src});if(w.href)aa=c('React').createElement('a',{href:w.href},aa);c('ReactDOM').render(aa,z);var ba=w.short_name;s.setNodeContent('shortName',i._("{name}\uff1a",[i.param('name',ba)])+' ');k.renderTimestamp(s.getNode('timestamp'),v.timestamp_absolute,v.timestamp_relative,v.timestamp);var ca=s.getNode('seeContext');c('Event').listen(ca,'click',function(){var da=c('WebMessengerStateManager').getCurrentStateData(),ea={message_query:t,query:da.query,thread_id:u,message_id:v.message_id},fa=c('WebMessengerStateManager').getCurrentDetailState();if(fa===c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET)ea.single_thread_search=true;c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT,ea);return false;});}};function m(r,s,t,u,v){var w=r.getNode('snippetList');l.renderMultipleSnippets(w,s,t,u);var x=v-u.length;n(r,s,t,v,x);}function n(r,s,t,u,v){var w=r.getNode('totalSnippetsCount'),x=r.getNode('moreSnippetsLink');c('CSS').conditionShow(x,v>0);if(v>0){var y=p(v);c('DOM').setContent(x,y);}c('DOM').setContent(w,o(u));if(v>0)c('Event').listen(x,'click',function(){j.getSingleThreadSearchMoreResults(s,t,function(z){c('DOM').empty(r.getNode('snippetList'));m(r,s,t,z,u);});});}function o(r){if(r==1){return i._("\u7e3d\u8a08 1 \u7b46\u7d50\u679c");}else return i._({"*":"\u7e3d\u8a08{count}\u7b46\u7d50\u679c"},[i.param('count',r,[0])]);}function p(r){if(r==1){return i._("\u591a\u986f\u793a\u4e00\u7b46\u7d50\u679c");}else return i._({"*":"\u591a\u986f\u793a{count}\u7b46\u7d50\u679c"},[i.param('count',r,[0])]);}function q(r){var s=i._("\u67e5\u7121\u7d50\u679c"),t=c('DOM').create('div',{className:"_2n4"},s);c('DOM').setContent(r,t);}f.exports=l;}),null);
__d('WebMessengerDetailViewSearchSnippetsControl',['cx','fbt','JSXDOM','Event','CSS','DOM','MercurySearchSnippetResults','WebMessengerSearchSnippetsRenderer','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerPermalinks','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('MercurySearchSnippetResults').get();function k(p,q){'use strict';this._manager=p;this._rootElement=q;c('DOM').empty(this._rootElement);var r=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-snippets'].build();c('DOM').setContent(this._rootElement,r.getRoot());this._loadingSpinner=r.getNode('loadingSpinner');this._messageList=r.getNode('messagelist');this._downMoreButton=r.getNode('downMoreButton');this._downMoreLink=r.getNode('downMoreLink');this._state=null;this._messageQuery=null;this._threadID=null;c('CSS').hide(this._downMoreButton);c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._downMoreLink,'click',function(){c('CSS').addClass(this._downMoreButton,'async_saving');o(this);}.bind(this)));}k.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);};k.prototype.updateView=function(){'use strict';c('CSS').show(this._rootElement);var p=l(this);m(this);if(p)n(this);};k.prototype.destroy=function(){'use strict';};function l(p){var q=c('WebMessengerStateManager').getCurrentDetailState();if(p._state!=q)return true;var r=c('WebMessengerStateManager').getCurrentStateData();if(p._messageQuery!=r.message_query)return true;if(q==c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET)if(p._threadID!=r.thread_id)return true;return false;}function m(p){p._state=c('WebMessengerStateManager').getCurrentDetailState();var q=c('WebMessengerStateManager').getCurrentStateData();p._threadID=q.thread_id;p._messageQuery=q.message_query;}function n(p){c('CSS').hide(p._downMoreButton);c('DOM').empty(p._messageList);if(p._messageQuery){c('CSS').show(p._loadingSpinner);if(p._state===c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET&&p._threadID){j.getSingleThreadSearchResults(p._messageQuery,p._threadID,function(q,r){c('CSS').hide(p._loadingSpinner);c('WebMessengerSearchSnippetsRenderer').renderThreadSnippetBlock(p._messageList,p._messageQuery,p._threadID,q,r);var s=c('JSXDOM').a({className:"_4-ii"},i._("\u641c\u5c0b\u6240\u6709\u300c{query}\u300d\u7684\u5c0d\u8a71",[i.param('query',p._messageQuery)])),t=c('WebMessengerPermalinks').getURI(c('WebMessengerStateConstants').MASTER.SEARCH,c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET,{query:p._messageQuery,message_query:p._messageQuery});s.setAttribute('href',t);c('DOM').prependContent(p._messageList,c('JSXDOM').div({className:"_4-ij"},s));});}else j.getAllThreadSearchResults(p._messageQuery,function(q,r){c('CSS').hide(p._loadingSpinner);c('WebMessengerSearchSnippetsRenderer').renderMultipleSnippetBlocks(p._messageList,p._messageQuery,q);c('CSS').conditionShow(p._downMoreButton,!r);});}}function o(p){if(p._messageQuery)j.getAllThreadSearchMoreResults(p._messageQuery,function(q,r){c('CSS').removeClass(p._downMoreButton,'async_saving');c('DOM').empty(p._messageList);c('WebMessengerSearchSnippetsRenderer').renderMultipleSnippetBlocks(p._messageList,p._messageQuery,q);c('CSS').conditionShow(p._downMoreButton,!r);});}f.exports=k;}),null);
__d('WebMessengerSharedPhotos.react',['cx','fbt','glyph','AsyncRequest','Grid.react','Image.react','immutable','LoadingIndicator.react','MercuryAttachmentViewer','MessagesViewerSetID','Pixelz.react','React','WebMessengerStateConstants','WebMessengerStateManager','URI','XUIButton.react'],(function a(b,c,d,e,f,g,h,i,j){var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes,n=c('Grid.react').GridItem,o=i._("\u8fd4\u56de\u5c0d\u8a71"),p=42;k=babelHelpers.inherits(q,c('React').Component);l=k&&k.prototype;function q(){var r,s;'use strict';for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return r=(s=l.constructor).call.apply(s,[this].concat(u)),this.state={isLoadingMore:true,moreImages:true,imagesData:c('immutable').List()},this.isVisible=function(){return !(this.state.isLoadingMore&&this.state.moreImages&&this.state.imagesData.isEmpty());}.bind(this),this.loadMoreImages=function(){if(this.state.moreImages&&!this.state.isLoadingMore){this.setState({isLoadingMore:true});this.requestImages();}}.bind(this),this.renderImages=function(){var w=Math.floor((this.props.totalWidth-p)/3),x=this.state.imagesData,y=x.map(function(z){return (c('React').createElement(n,{key:z.fbid},c('React').createElement('div',{className:"_5dq3",onClick:this.viewFullImage.bind(null,z)},c('React').createElement(c('Pixelz.react'),{upscale:true,width:w,height:w,resizeMode:'cover',src:z.uri,borderRadius:1,insetBorderColor:'rgba(0, 0, 0, 0.1)'}))));}.bind(this));return y;}.bind(this),this.viewFullImage=function(w){var x=new (c('URI'))('/ajax/messaging/attachments/sharedphotos.php').setQueryData({thread_id:this.props.threadID,image_id:w.fbid});c('MercuryAttachmentViewer').bootstrapWithConfig({fbid:w.fbid,dimensions:w.dim,src:w.uri,disablePaging:this.state.imagesData.size===1,endpoint:x,setID:c('MessagesViewerSetID').MESSAGES_VIEW_ALL_IN_THREAD});}.bind(this),this.requestImages=function(){new (c('AsyncRequest'))().setURI('/ajax/messaging/attachments/sharedphotos.php').setMethod('POST').setData({thread_id:this.props.threadID,offset:this.state.imagesData.size,limit:30}).setHandler(function(w){var x=w.getPayload();this.setState({isLoadingMore:false,moreImages:x.moreImagesToLoad,imagesData:this.state.imagesData.concat(x.imagesData)});}.bind(this)).send();}.bind(this),this.returnToThread=function(){var w=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData());c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,w);},r;}q.prototype.componentDidMount=function(){'use strict';this.requestImages();c('MercuryAttachmentViewer').preload();};q.prototype.componentDidUpdate=function(){'use strict';if(!this.isVisible())this.requestImages();};q.prototype.componentWillReceiveProps=function(r){'use strict';if(r.threadID&&r.threadID!==this.props.threadID)this.setState({isLoadingMore:true,moreImages:true,imagesData:c('immutable').List()});};q.prototype.render=function(){'use strict';var r=c('React').createElement('div',{className:(this.isVisible()?"_5dq2":'')+(!this.isVisible()?' '+"_5dq1":'')+(!this.isVisible()?' '+"_5dpz":'')},c('React').createElement(c('LoadingIndicator.react'),{color:'white',size:'large'}));if(!this.isVisible()){return r;}else if(!this.state.isLoadingMore)r=null;return (c('React').createElement('div',{className:"_5dpz"},c('React').createElement('div',{className:"_5dp-"},c('React').createElement(c('XUIButton.react'),{image:c('React').createElement(c('Image.react'),{src:j('back')}),label:o,size:'medium',onClick:this.returnToThread})),c('React').createElement('div',{className:"_5dq0"},c('React').createElement(c('Grid.react'),{cols:3,fixed:false},this.renderImages()),r)));};q.propTypes={threadID:m.string.isRequired,totalWidth:m.number.isRequired};f.exports=q;}),null);
__d('WebMessengerDetailViewSharedPhotosControl',['CSS','DOM','ReactComponentRenderer','MercuryThreadIDMap','WebMessengerSharedPhotos.react','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerEvents','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get();function i(j,k){'use strict';this.manager=j;this.rootElement=k;this.renderer=null;this.serverID=null;this.state=null;this.threadID=null;c('DOM').empty(this.rootElement);c('WebMessengerSubscriptionsHandler').addSubscriptions(this.manager.subscribe('scrolledNearBottom',this.notifyImageRequest.bind(this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').DETAIL_DOM_CHANGED,this.render.bind(this)));}i.prototype.hideView=function(){'use strict';c('CSS').hide(this.rootElement);};i.prototype.updateView=function(){'use strict';c('CSS').show(this.rootElement);this.updateStateAndData();this.render();};i.prototype.destroy=function(){'use strict';c('WebMessengerSubscriptionsHandler').release();};i.prototype.updateStateAndData=function(){'use strict';this.state=c('WebMessengerStateManager').getCurrentDetailState();var j=c('WebMessengerStateManager').getCurrentStateData();this.threadID=j.thread_id;};i.prototype.render=function(){'use strict';this.serverID=h.getServerIDFromClientIDNow(this.threadID);if(!this.serverID)return;if(!this.renderer){this.renderer=new (c('ReactComponentRenderer'))(c('WebMessengerSharedPhotos.react'),this.rootElement);this.renderer.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});}else this.renderer.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});};i.prototype.notifyImageRequest=function(){'use strict';var j=c('WebMessengerStateManager').getCurrentDetailState();if(j===c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS&&this.renderer)this.renderer.component.loadMoreImages();};f.exports=i;}),null);
__d('MercurySheetView',['cx','Animation','ArbiterMixin','Bootloader','CSS','DOM','JSLogger','MercuryIDs','MercuryParticipants','MercurySheetPolicy','MercuryThreadActions','MercuryThreadIDMap','MercuryMessageActions','MercuryMessageObject','React','ReactDOM','Style','MercuryThreads','Vector','emptyFunction','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreadActions').get(),j=c('MercuryThreadIDMap').get(),k=c('MercuryMessageActions').get(),l=c('MercuryMessageObject').get(),m=c('MercuryThreads').get(),n=5000,o='/ajax/chat/multichat/name_conversation/dismiss.php',p={},q=function r(s,t,u,v){this._threadID=s;this._rootElement=t;this._tabMainElement=u;this._view=v;this._openSheet=null;};Object.assign(q.prototype,c('ArbiterMixin'),{destroy:function r(){c('DOM').empty(this._rootElement);},_clearAndOpen:function r(s,t,u){if(!t||s===this._openSheet)return false;this.clear(function(){this._openSheet=s;c('CSS').show(this._rootElement);if(t.type&&typeof t.type==='function'){c('ReactDOM').render(t,this._rootElement);}else t.render();if(u){c('CSS').addClass(this._tabMainElement,'sheetSlide');c('CSS').addClass(this._tabMainElement,"_1sk4");var v=c('Vector').getElementDimensions(this._rootElement).y;c('Style').set(this._rootElement,'bottom',v+'px');this.resize();this._animation=new (c('Animation'))(this._rootElement).to('bottom',0).duration(150).ease(c('Animation').ease.both).ondone(function(){c('CSS').removeClass(this._tabMainElement,'sheetSlide');c('CSS').removeClass(this._tabMainElement,"_1sk4");this.resize();}.bind(this)).go();}else this.resize();if(!c('MercurySheetPolicy').isPermanent(s))this.resetTimeout(s);}.bind(this));return true;},_openNewSheet:function r(s,t,u){if(this._openSheet&&!c('MercurySheetPolicy').canReplaceOpenSheet(this._openSheet,s))return false;if(typeof s==='string'){this._openSheetByType(s,t,u);return false;}else{this._clearAndOpen(s,s,t);return true;}},_openSheetByType:function r(s,t,u){switch(s){case c('MercurySheetPolicy').sheets.ChatThreadIsMutedTabSheet:c('Bootloader').loadModules(["ChatThreadIsMutedTabSheet.react"],function(v){var w=c('React').createElement(v,{onUnmute:function(){i.unmute(this._threadID);this._view.focus();}.bind(this)});this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserFocusBypassSheet:c('Bootloader').loadModules(["ChatUserFocusBypassSheet.react"],function(v){var w=c('React').createElement(v,null);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserFocusSheet:c('Bootloader').loadModules(["ChatUserFocusSheet.react"],function(v){var w=m.getThreadMetaNow(this._threadID),x=c('React').createElement(v,{thread:w});this._clearAndOpen(s,x,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatMontageSheet:c('Bootloader').loadModules(["ChatMontageSheet.react"],function(v){var w=c('React').createElement(v,{threadID:this._threadID});this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserTimezoneSheet:c('Bootloader').loadModules(["ChatUserTimezoneSheet.react"],function(v){var w=function(){this.close(s);}.bind(this),x=c('React').createElement(v,{data:u,threadID:this._threadID,resize:function(){return this.resize();}.bind(this),onDismiss:w});this._clearAndOpen(s,x,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserBlockedTabSheet:c('Bootloader').loadModules(["ChatPrivacyActionController","ChatUserBlockedTabSheet.react"],function(v,w){var x=c('MercuryIDs').getUserIDFromThreadID(this._threadID);if(!x){var y=c('JSLogger').create('blackbird');y.error('user_blocked_sheet_open_with_non_friend');return;}var z=new v(x,c('emptyFunction')),aa=c('MercuryIDs').getParticipantIDFromUserID(x);c('MercuryParticipants').get(aa,function(ba){var ca=c('React').createElement(w,{shortName:ba.short_name,gender:ba.gender,privacyActionController:z});this._clearAndOpen(s,ca,t);}.bind(this));}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUploadWarningTabSheet:c('Bootloader').loadModules(["ChatUploadWarningTabSheet.react"],function(v){var w=c('React').createElement(v,null);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatThreadIsMessageBlockedSheet:c('Bootloader').loadModules(["ChatThreadIsMessageBlockedSheet.react"],function(v){var w=c('MercuryIDs').getUserIDFromThreadID(this._threadID),x=c('MercuryIDs').getParticipantIDFromUserID(w);if(x)c('MercuryParticipants').get(x,function(y){var z=c('React').createElement(v,{shortName:y.short_name,onUnblock:function(){i.unblockMessages(this._threadID);this._view.focus();}.bind(this)});this._clearAndOpen(s,z,t);}.bind(this));}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatReadOnlyTabSheet:case c('MercurySheetPolicy').sheets.ChatReadOnlyPermanentTabSheet:c('Bootloader').loadModules(["ChatReadOnlyTabSheet.react","MercuryReadOnlyReason"],function(v,w){var x=m.getThreadMetaNow(this._threadID),y=x?w.getReason(x):null;if(y){var z=c('React').createElement(v,{reason:y});this._clearAndOpen(s,z,t);}}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatOfflineTabSheet:c('Bootloader').loadModules(["ChatOfflineTabSheet.react","ChatPrivacyActionController","ChatVisibility"],function(v,w,x){var y=c('JSLogger').create('blackbird'),z=c('MercuryIDs').getUserIDFromThreadID(this._threadID);if(!z){y.error('offline_sheet_open_with_non_friend');return;}var aa=new w(z,c('emptyFunction')),ba=c('MercuryIDs').getParticipantIDFromUserID(z);c('MercuryParticipants').get(ba,function(ca){var da=c('React').createElement(v,{shortName:ca.short_name,privacyActionController:aa,turnOnChat:function ea(event){event.preventDefault();if(x.isOnline())y.error('tab_sheet_already_online');aa.togglePrivacy();y.log('tab_sheet_go_online',{tab_id:z});}});this._clearAndOpen(s,da,t);}.bind(this));}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatNoRecipientsTabSheet:if(!c('MercuryIDs').getUserIDFromThreadID(this._threadID))c('Bootloader').loadModules(["ChatNoRecipientsTabSheet.react"],function(v){var w=c('React').createElement(v,null);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatNewMessagesTabSheet:c('Bootloader').loadModules(["ChatNewMessagesTabSheet.react"],function(v){var w=c('React').createElement(v,{onClick:function(){this._view.newMessageClicked();}.bind(this)});this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatNameConversationTabSheet:c('Bootloader').loadModules(["AsyncRequest","ChatNameConversationTabSheet.react","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType"],function(v,w,x,y,z){m.getThreadMeta(this._threadID,function(aa){var ba=void 0,ca=function fa(ga,ha){var ia=ga.name;if((ha||ia)&&ha!=ia)k.send(l.constructLogMessageObject(z.CHAT_WEB,ga.thread_id,y.THREAD_NAME,{name:ha}),null,x.CHAT);},da=function(fa){if(!fa.name_conversation_sheet_dismissed||!p[this._threadID]){p[this._threadID]=true;j.getServerIDFromClientID(fa.thread_id,function(ga){new v(o).setData({thread_fbid:ga}).send();});}this.close(s);}.bind(this);ba=c('React').createElement(w,{defaultThreadName:aa.name,onDone:function fa(ga){ca(aa,ga);da(aa);}});var ea=u&&u.automatic;if(!ea||ea&&!p[this._threadID])this._clearAndOpen(s,ba,t);}.bind(this));}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatEmployeeAwaySheet:c('Bootloader').loadModules(["ChatEmployeeAwaySheet.react"],function(v){var w=c('React').createElement(v,null);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserIsPersonalUserSheet:c('Bootloader').loadModules(["ChatUserIsPersonalUserSheet.react"],function(v){var w=function(){this.close(s);}.bind(this);u=u||{};var x=c('React').createElement(v,{myself:u.myself,participant:u.participant,threadID:this._threadID,onDismiss:w});this._clearAndOpen(s,x,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatPageResponsivenessIndicator:c('Bootloader').loadModules(["ChatPageResponsivenessIndicator.react"],function(v){var w=c('React').createElement(v,u);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatEventReminderTabSheet:c('Bootloader').loadModules(["ChatEventReminderContainer.react","EventReminderActions","EventReminderStateStore"],function(v,w,x){var y=void 0,z=m.getThreadMetaNow(this._threadID),aa={threadID:'',flyoutNoSheet:false};if(z.lightweight_events){var ba=z.lightweight_events.message_thread_id.toString(),ca={eventName:z.lightweight_events.title,eventDate:z.lightweight_events.event_time,eventID:z.lightweight_events.oid.toString(),threadID:ba};aa.threadID=ba;y=x.getEvent(ba);if(y&&!y.eventDate)w.updateEventReminder(ca);}if(!y)this.close(s);var da=c('React').createElement(v,aa);this._clearAndOpen(s,da,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatAppointmentBanner:c('Bootloader').loadModules(["ChatAppointmentBannerRoot.react"],function(v){var w=c('React').createElement(v,u);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;}},resetTimeout:function r(s){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=c('setTimeoutAcrossTransitions')(function(){this.close(s);}.bind(this),n);},set:function r(s){return this._openNewSheet(s,false);},open:function r(s,t){return this._openNewSheet(s,true,t);},close:function r(s,t){if(this._openSheet!==s)return;if(!this._openSheet){t&&t();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}c('CSS').addClass(this._tabMainElement,'sheetSlide');c('CSS').addClass(this._tabMainElement,"_1sk4");var u=c('Vector').getElementDimensions(this._rootElement).y;this.resize();this._animation=new (c('Animation'))(this._rootElement).to('bottom',u+'px').duration(100).ease(c('Animation').ease.begin).ondone(function(){c('DOM').empty(this._rootElement);c('CSS').hide(this._rootElement);c('CSS').removeClass(this._tabMainElement,'sheetSlide');c('CSS').removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();t&&t();}.bind(this)).go();},clear:function r(s){this.close(this._openSheet,s);},resize:function r(){this.inform('resize');}});f.exports=q;}),null);
__d('WebMessengerEmployeeAwaySheet',['ArbiterMixin','DOM','mixin','WebMessengerTemplates'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k,l,m){'use strict';i.constructor.call(this);this.$WebMessengerEmployeeAwaySheet1=k;this.$WebMessengerEmployeeAwaySheet2=l;this.$WebMessengerEmployeeAwaySheet3=m;}j.prototype.render=function(){'use strict';var k=c('WebMessengerTemplates')[':fb:mercury:employee-away-sheet'].build();c('DOM').setContent(this.$WebMessengerEmployeeAwaySheet2,k.getRoot());};j.prototype.isPermanent=function(){'use strict';return true;};j.prototype.getType=function(){'use strict';return 'employee-away';};j.prototype.open=function(){'use strict';this.$WebMessengerEmployeeAwaySheet3.open(this);};j.prototype.close=function(){'use strict';this.$WebMessengerEmployeeAwaySheet3.close(this);};f.exports=j;}),null);
__d('WebMessengerIsMessageBlockedSheet',['fbt','ArbiterMixin','DOM','Event','WebMessengerTemplates','mixin'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function k(l,m,n){'use strict';j.constructor.call(this);this.$WebMessengerIsMessageBlockedSheet1=l;this.$WebMessengerIsMessageBlockedSheet2=m;this.$WebMessengerIsMessageBlockedSheet3=n;}k.prototype.render=function(){'use strict';var l=c('WebMessengerTemplates')[':fb:mercury:messages-blocked-sheet'].build(),m=h._("\u5df2\u5c01\u9396\u4f86\u81ea\u6b64\u6536\u4ef6\u8005\u7684\u8a0a\u606f\u3002");c('DOM').setContent(this.$WebMessengerIsMessageBlockedSheet2,l.getRoot());c('DOM').setContent(l.getNode('text'),m+' ');c('Event').listen(l.getNode('unblockButton'),'click',function(){this.inform('clicked',this.$WebMessengerIsMessageBlockedSheet1);}.bind(this));};k.prototype.isPermanent=function(){'use strict';return true;};k.prototype.getType=function(){'use strict';return 'message-blocked';};k.prototype.open=function(){'use strict';this.$WebMessengerIsMessageBlockedSheet3.open(this);};k.prototype.close=function(){'use strict';this.$WebMessengerIsMessageBlockedSheet3.close(this);};f.exports=k;}),null);
__d('WebMessengerThreadIsMutedTabSheet',['fbt','Event','ArbiterMixin','DOM','WebMessengerTemplates','mixin'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function k(l,m){'use strict';j.constructor.call(this);this._rootElement=l;this._sheetView=m;}k.prototype.render=function(){'use strict';var l=c('WebMessengerTemplates')[':fb:web-messenger:read-view:message-mute-sheet'].build();c('DOM').setContent(l.getNode('text'),h._("\u9019\u6bb5\u5c0d\u8a71\u5df2\u95dc\u9589\u3002\u804a\u5929\u5ba4\u9801\u7c64\u4e0d\u6703\u5f48\u51fa\uff0c\u63a8\u64ad\u901a\u77e5\u4e5f\u5df2\u95dc\u9589\u3002"));c('DOM').setContent(this._rootElement,l.getRoot());c('Event').listen(l.getNode('unmuteButton'),'click',function(){this.inform('clicked',null);}.bind(this));};k.prototype.isPermanent=function(){'use strict';return false;};k.prototype.getType=function(){'use strict';return 'wb-thread-is-muted';};k.prototype.open=function(){'use strict';this._sheetView.open(this);};k.prototype.close=function(){'use strict';this._sheetView.close(this);};f.exports=k;}),null);
__d('WebMessengerDetailViewSheetControl',['DOM','ArbiterMixin','WebMessengerStateManager','MercuryBlockedParticipants','MercurySheetView','MercuryThreadInfo','WebMessengerTemplates','MercuryThreadInformer','MercuryThreadActions','MercuryThreads','WebMessengerEmployeeAwaySheet','ChatEmployeeAwayWarning','WebMessengerIsMessageBlockedSheet','WebMessengerThreadIsMutedTabSheet','WebMessengerSubscriptionsHandler','mixin'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('MercuryBlockedParticipants').get(),k=c('MercuryThreadInformer').get(),l=c('MercuryThreadActions').get(),m=c('MercuryThreads').get();h=babelHelpers.inherits(n,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function n(o){'use strict';i.constructor.call(this);this._template=c('WebMessengerTemplates')[':fb:web-messenger:tab-sheet-container'].build();this._rootElement=this._template.getNode('sheet');this._threadID=c('WebMessengerStateManager').getCurrentStateData().thread_id;this._sheetView=new (c('MercurySheetView'))(this._threadID,this._rootElement,o);this._threadIsMessageBlockedSheet=new (c('WebMessengerIsMessageBlockedSheet'))(this._threadID,this._rootElement,this._sheetView);this._employeeAwaySheet=new (c('WebMessengerEmployeeAwaySheet'))(this._threadID,this._rootElement,this._sheetView);this._threadIsMutedTabSheet=new (c('WebMessengerThreadIsMutedTabSheet'))(this._rootElement,this._sheetView);this._muteSetting=undefined;c('DOM').setContent(o,this._template.getRoot());this._threadMessageBlockedSub=this._threadIsMessageBlockedSheet.subscribe('clicked',function(){l.unblockMessages(this._threadID);}.bind(this));this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',function(){l.unmute(this._threadID);}.bind(this));c('WebMessengerSubscriptionsHandler').addSubscriptions(this._sheetView.subscribe('resize',this.inform.bind(this,'resize')),k.subscribe('threads-updated',function(p,q){if(this._threadID&&q[this._threadID])this.updateTabSheet(false);}.bind(this)));this.updateTabSheet(true);}n.prototype.updateView=function(){'use strict';var o=c('WebMessengerStateManager').getCurrentStateData().thread_id;if(this._threadID!=o){this._threadID=o;this.updateTabSheet(true);}};n.prototype.updateTabSheet=function(o){'use strict';if(!this._threadID)return;m.getThreadMeta(this._threadID,function(p){var q=c('MercuryThreadInfo').getMuteSetting(p);if(q!=this._muteSetting||o){if(q){this._threadIsMutedTabSheet.open();}else this._threadIsMutedTabSheet.close();this._muteSetting=q;}if(j.isMessageBlocked(p)){this._threadIsMessageBlockedSheet.open();}else this._threadIsMessageBlockedSheet.close();c('ChatEmployeeAwayWarning').updateEmployeeAwayWarning(p,function(){this._employeeAwaySheet.open();}.bind(this),function(){this._employeeAwaySheet.close();}.bind(this));}.bind(this));};n.prototype.destroy=function(){'use strict';this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();this._employeeAwaySheet&&this._employeeAwaySheet.close();};f.exports=n;}),null);
__d('WebMessengerFlexibleArea',['cx','ArbiterMixin','CSS','DOM','Event','Style','Vector','mixin','throttle'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();var k=[];function l(){k.forEach(function(n){n.draw();});}c('Event').listen(window,'resize',c('throttle')(l,50));i=babelHelpers.inherits(m,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function m(n){'use strict';j.constructor.call(this);this.minFlexAreaHeight=0;this.flexArea=n;this.container=null;this.padding=0;this.sizeToFit=false;k.push(this);}m.prototype.setContainer=function(n){'use strict';this.container=n;return this;};m.prototype.setPadding=function(n){'use strict';this.padding=n;return this;};m.prototype.setMinFlexAreaHeight=function(n){'use strict';this.minFlexAreaHeight=n;return this;};m.prototype.setSizeToFit=function(n){'use strict';this.sizeToFit=n;return this;};m.prototype.draw=function(){'use strict';if(this.flexArea){var n=this._flexHeight;this.inform('predraw',{old_height:n});var o=c('Vector').getViewportDimensions().y-this.padding;o-=c('Vector').getElementPosition(this.container||this.flexArea).y;if(this.container){Array.from(this.container.childNodes).forEach(function(p){o-=c('Vector').getElementDimensions(p).y;});o+=c('Vector').getElementDimensions(this.flexArea).y;}if(this.sizeToFit)o=Math.min(o,this._getNaturalHeight());if(o<this.minFlexAreaHeight)o=this.minFlexAreaHeight;if(isNaN(o)||o<0)o=0;if(o!==n){c('Style').set(this.flexArea,'height',o+'px');this._flexHeight=o;this.inform('height_changed',{height:o,old_height:n});}}return this;};m.prototype.destroy=function(){'use strict';var n=k.indexOf(this);n>=0&&k.splice(n,1);l();};m.prototype._getNaturalHeight=function(){'use strict';var n=this.flexArea.cloneNode(true);c('CSS').addClass(n,"_2ys");c('Style').set(n,'height','auto');c('DOM').insertAfter(this.flexArea,n);var o=c('Vector').getElementDimensions(n).y;c('DOM').remove(n);return o;};m.prototype._getFlexHeight=function(){'use strict';if(isNaN(this._flexHeight))this._flexHeight=c('Vector').getElementDimensions(this.flexArea).y;return this._flexHeight;};f.exports=m;}),null);
__d('WebMessengerFlexibleScrollArea',['CSS','DOMQuery','ScrollableArea','Style','WebMessengerFlexibleArea','throttle'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('WebMessengerFlexibleArea'));i=h&&h.prototype;function j(k,l){'use strict';i.constructor.call(this,k);this._scroll=c('ScrollableArea').fromNative(k,l);this._scrollBody=c('DOMQuery').find(this.flexArea,'.uiScrollableAreaBody');var m=c('DOMQuery').scry(this.flexArea,'.uiScrollableAreaShadow');this._shadow=m.length?m[0]:null;this._scrollContent=c('DOMQuery').find(this.flexArea,'.uiScrollableAreaContent');this._scrollCallbacks=[];this._drawSubscription=this.subscribe('height_changed',this.poke.bind(this));this._scrollSub=this._scroll.subscribe('scroll',c('throttle')(this._onScroll,50,this));this._nearTop=false;this._nearBottom=false;this._lastScrollHeight=0;}j.prototype.showAtTop=function(k){'use strict';if(k){c('Style').set(this._scrollContent,'top','0');c('Style').set(this._scrollContent,'bottom','');}else{c('Style').set(this._scrollContent,'top','');c('Style').set(this._scrollContent,'bottom','0');}};j.prototype.setBottomAligned=function(k){'use strict';var l=k!==false;if(this._bottomEdgeBias===l)return;c('CSS').conditionClass(this.flexArea,'uiScrollableAreaBottomAligned',l);this._bottomEdgeBias=l;if(this._bottomEdgeBias){this.scrollToBottom(false);}else this.scrollToTop(false);setTimeout(this.poke.bind(this),0);return this;};j.prototype.setInfiniteScrollHandler=function(k,l){'use strict';if(l){this._infiniteUpwardScrollHandler=k;}else this._infiniteDownScrollHandler=k;return this;};j.prototype.addScrollCallback=function(k){'use strict';this._scrollCallbacks.push(k);return this;};j.prototype.setTabbable=function(k){'use strict';this._scroll._wrap.setAttribute('tabindex',k?'0':'-1');};j.prototype.poke=function(k,l){'use strict';var m=this._scrollHeight,n=this._scroll.getScrollTop();this._scrollHeight=this._getScrollHeight();if(typeof m=='undefined'||l&&!l.old_height){this._bottomEdgeBias&&this._setShadowHeight();return;}var o=this._scrollHeight-m;if(this._bottomEdgeBias){var p=l?l.height-l.old_height:0;clearTimeout(this._pollTimer);this._pollTimer=setTimeout(this.poke.bind(this),200);var q,r=o-p;if(this._scrollHeight>this._getFlexHeight()){q=n+r;q=q<0?0:q;}else q=0;r>0&&this._setShadowHeight();if(q!==n)this._scroll.setScrollTop(q,false);r<0&&this._setShadowHeight();}else if(o)this._scroll.setScrollTop(n,false);};j.prototype.setScrollTop=function(k,l){'use strict';this._scroll.setScrollTop(k,l);};j.prototype.getScrollableArea=function(){'use strict';return this._scroll;};j.prototype.isScrolledToBottom=function(){'use strict';return this._scroll.isScrolledToBottom();};j.prototype.scrollToBottom=function(k){'use strict';this._scroll.scrollToBottom(k);if(this._bottomEdgeBias)this._scrollBottom=0;};j.prototype.isScrolledToTop=function(){'use strict';return this._scroll.getScrollTop()===0;};j.prototype.scrollToTop=function(k){'use strict';this._scroll.scrollToTop(k);};j.prototype.scrollIntoView=function(k,l){'use strict';this._scroll.scrollIntoView(k,l);};j.prototype.destroy=function(){'use strict';this._scrollSub&&this._scrollSub.unsubscribe();this.unsubscribe(this._drawSubscription);clearTimeout(this._pollTimer);i.destroy.call(this);this._scroll.destroy();};j.prototype._getScrollHeight=function(){'use strict';if(this._bottomEdgeBias){return this._scrollContent.offsetHeight;}else return this._scroll.getScrollHeight();};j.prototype._setShadowHeight=function(){'use strict';var k=this._shadowHeight;this._shadowHeight=this._scrollHeight-this._getFlexHeight();if(this._shadowHeight<0)this._shadowHeight=0;if(this._shadowHeight!==k)c('Style').set(this._shadow,'height',this._shadowHeight+'px');};j.prototype._onScroll=function(){'use strict';var k=this._scroll.getScrollTop(),l=this._getScrollHeight(),m=this._getFlexHeight(),n=l>this._lastScrollHeight;this._lastScrollHeight=l;if(k<m){if(!this._nearTop||n&&2*m>l){this._nearTop=true;this._infiniteUpwardScrollHandler&&this._infiniteUpwardScrollHandler();}}else this._nearTop=false;if(k+2*m>l){if(!this._nearBottom||n&&2*m>l){this._nearBottom=true;this._infiniteDownScrollHandler&&this._infiniteDownScrollHandler();}}else this._nearBottom=false;this._scrollCallbacks.forEach(function(o){return o(this._scroll);}.bind(this));};f.exports=j;}),null);
__d('WebMessengerDetailViewControlManager',['Event','ArbiterMixin','CSS','WebMessengerDetailViewHeaderControl','DOM','WebMessengerFlexibleScrollArea','WebMessengerDetailViewActionsMenuControl','WebMessengerDetailViewAllPeopleResultsControl','WebMessengerDetailViewComposeTypeaheadControl','WebMessengerDetailViewRecentMessagesControl','WebMessengerDetailViewSearchContextControl','WebMessengerDetailViewSearchSnippetsControl','WebMessengerDetailViewBottomShelfControl','WebMessengerDetailViewSharedPhotosControl','MercuryConfig','MercuryIDs','WebMessengerMessagesSelection','Parent','WebMessengerDetailViewSheetControl','WebMessengerStateManager','WebMessengerStateConstants','Style','UserAgent_DEPRECATED','WebMessengerEvents','WebMessengerSubscriptionsHandler','WebMessengerTemplates','mixin','getElementPosition'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);this._rootElement=k;c('DOM').empty(this._rootElement);var l=c('WebMessengerTemplates')[':fb:web-messenger:read-view'].build();c('DOM').setContent(this._rootElement,l.getRoot());this._readContainer=l.getNode('readContainer');this._headerControl=new (c('WebMessengerDetailViewHeaderControl'))(l.getNode('detailViewHeader'));this._actionsMenuControl=new (c('WebMessengerDetailViewActionsMenuControl'))(l.getNode('detailViewActionsMenu'),this._headerControl);this._allPeopleResultsControl=new (c('WebMessengerDetailViewAllPeopleResultsControl'))(l.getNode('detailViewAllPeopleResults'));this._composeTypeaheadControl=new (c('WebMessengerDetailViewComposeTypeaheadControl'))(l.getNode('detailViewComposeTypeahead'),l.getNode('detailViewComposeTypeaheadResults'));this._searchContextControl=new (c('WebMessengerDetailViewSearchContextControl'))(this,l.getNode('detailViewSearchContext'),l.getNode('snippetPaginationControlBox'));this._searchSnippetsControl=new (c('WebMessengerDetailViewSearchSnippetsControl'))(this,l.getNode('detailViewSearchSnippets'));this._sharedPhotosControl=new (c('WebMessengerDetailViewSharedPhotosControl'))(this,l.getNode('detailViewSharedPhotos'));this._sheetControl=new (c('WebMessengerDetailViewSheetControl'))(l.getNode('detailViewSheetTab'));var m=l.getNode('detailViewBottomShelf');this._bottomShelfControl=new (c('WebMessengerDetailViewBottomShelfControl'))(this,m);this._detailViewScroller=l.getNode('readMessagesScroller');c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._detailViewScroller,'click',function(o){if(c('Parent').byTag(o.getTarget(),'a')||c('DOM').getSelection())return;this._bottomShelfControl.focusComposer();}.bind(this)));var n={fade:!!c('UserAgent_DEPRECATED').osx(),persistent:true};this._flexArea=new (c('WebMessengerFlexibleScrollArea'))(this._detailViewScroller,n).setBottomAligned(false).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearTop'),true).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(200).draw();c('WebMessengerSubscriptionsHandler').addSubscriptions(c('WebMessengerEvents').subscribe(c('WebMessengerEvents').DETAIL_DOM_CHANGED,this._flexArea.draw.bind(this._flexArea)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').SUBMIT_REPLY,this._bottomShelfControl.submitReply.bind(this._bottomShelfControl)),c('WebMessengerStateManager').subscribe(c('WebMessengerStateConstants').STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));c('WebMessengerSubscriptionsHandler').addSubscriptions(this._sheetControl.subscribe('resize',this._flexArea.draw.bind(this._flexArea)));this._recentMessagesControl=new (c('WebMessengerDetailViewRecentMessagesControl'))(this,l.getNode('detailViewRecentMessages'),l.getNode('loadingSpinner'),l.getNode('noSelectedConversation'),l.getNode('newMessageLink'),l.getNode('showUnreadLink'),l.getNode('contextBanner'),m);this._stateData={};this._resizeNodes=[this._rootElement,this._detailViewScroller,c('DOM').find(this._detailViewScroller,'div.uiScrollableAreaBody')];}j.prototype.updateOnStateChange=function(){'use strict';var k=c('WebMessengerStateManager').getCurrentDetailState(),l=this._stateData;this._stateData=c('WebMessengerStateManager').getCurrentStateData();this._flexArea.setTabbable(k!==c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN);this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();c('CSS').removeClass(this._readContainer,'blankComposeState');c('CSS').conditionClass(this._readContainer,'blankComposeState',k===c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN);this._bottomShelfControl.updateView();this._actionsMenuControl.updateView();this._headerControl.updateView();switch(k){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:this._recentMessagesControl.updateView();this._sheetControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:this._allPeopleResultsControl.updateView();this._composeTypeaheadControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:this._composeTypeaheadControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this._composeTypeaheadControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS:this._sharedPhotosControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET:case c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET:this._searchSnippetsControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:this._searchContextControl.updateView();break;}switch(k){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:if(l.thread_id!=this._stateData.thread_id)this._bottomShelfControl.focusComposer();break;}};j.prototype.hideAll=function(){'use strict';this._headerControl.hideView();this._actionsMenuControl.hideView();this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();this._bottomShelfControl.hideView();};j.prototype.getSelectedMessageIDs=function(){'use strict';var k=c('WebMessengerStateManager').getCurrentDetailState();switch(k){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:return c('WebMessengerMessagesSelection').getSelectedMessageIDs();}return [];};j.prototype.scrollIntoView=function(k){'use strict';this._flexArea&&this._flexArea.scrollIntoView(k);};j.prototype.setScrollTop=function(k,l){'use strict';this._flexArea&&this._flexArea.setScrollTop(k,l);};j.prototype.isScrolledToBottom=function(){'use strict';return this._flexArea&&this._flexArea.isScrolledToBottom();};j.prototype.scrollToBottom=function(k){'use strict';this._flexArea&&this._flexArea.scrollToBottom(k);};j.prototype.draw=function(){'use strict';this._flexArea&&this._flexArea.draw();};j.prototype.poke=function(){'use strict';this._flexArea&&this._flexArea.poke();};j.prototype.addScrollCallback=function(k){'use strict';this._flexArea&&this._flexArea.addScrollCallback(k);};j.prototype.getFlexAreaBoundingClientRect=function(){'use strict';return c('getElementPosition')(this._flexArea.flexArea);};j.prototype.resizeTo=function(k){'use strict';if(k!==null){k=k.toString();if(!k.endsWith('%')||k.endsWith('px'))k=k+'px';}this._resizeNodes.forEach(function(l){c('Style').set(l,'width',k);});c('WebMessengerEvents').detailDOMChanged();};j.prototype.destroy=function(){'use strict';this._headerControl.destroy();this._actionsMenuControl.destroy();this._allPeopleResultsControl.destroy();this._composeTypeaheadControl.destroy();this._recentMessagesControl.destroy();this._searchContextControl.destroy();this._searchSnippetsControl.destroy();this._bottomShelfControl.destroy();this._sharedPhotosControl.destroy();this._flexArea.destroy();this._sheetControl.destroy();};f.exports=j;}),null);
__d('MercuryPageServerRequests',['CurrentUser','MercuryAPIArgsSource','MercuryAssert','MercuryServerRequests','MercurySingletonProvider','MessagingTag','PageMessageEnumTag','PagesEventType','PagesMessagingPerfTypedLogger','PagesMessengerThreadUtils','MercuryServerDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('MercuryAPIArgsSource').MERCURY;h=babelHelpers.inherits(k,c('MercuryServerRequests'));i=h&&h.prototype;k.getForFBID=function(m){return l.getForFBID(m);};k.get=function(){return l.get();};function k(m){i.constructor.call(this,m);var n={'/pages/messaging/thread_tag/add/':{request_user_id:m,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests1,handler:function(o,p){return this.__handleUpdate(o,p);}.bind(this)},'/pages/messaging/thread_tag/remove/':{request_user_id:m,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests1,handler:function(o,p){return this.__handleUpdate(o,p);}.bind(this)},'/pages/messaging/thread_tag/list/':{request_user_id:m,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(o,p){return this.__handleUpdate(o,p);}.bind(this)},'/pages/messaging/thread_custom_tags/list/':{request_user_id:m,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(o,p){return this.__handleUpdate(o,p);}.bind(this)},'/pages/messaging/create_note/':{request_user_id:m,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(o,p){return this.__handleUpdate(o,p);}.bind(this)}};c('MercuryServerDispatcher').registerEndpoints(n);}k.prototype.$MercuryPageServerRequests1=function(m,n){var o=m?m.tag_name:n.tag_name,p=m?m.thread_ids:[],q=n?n.thread_ids:[],r=p.concat(q),s={tag_name:o,thread_ids:r};return s;};k.prototype.addThreadFlag=function(m,n){c('MercuryAssert').isThreadID(m);this.__threadIDMap.getServerIDFromClientID(m,function(o){var p={thread_ids:[o],tag_name:c('PageMessageEnumTag').FLAG};this.__sendRequest('/pages/messaging/thread_tag/add/',p);}.bind(this));};k.prototype.createNote=function(m,n,o){c('MercuryAssert').isThreadID(o);this.__threadIDMap.getServerIDFromClientID(o,function(p){var q={body:m,message_id:n,other_user_fbid:p};this.__sendRequest('/pages/messaging/create_note/',q);}.bind(this));};k.prototype.fetchThreadlistInfo=function(m,n){var o=arguments.length<=2||arguments[2]===undefined?c('MessagingTag').INBOX:arguments[2],p=arguments[3],q=arguments.length<=4||arguments[4]===undefined?j:arguments[4],r={folder:o,offset:m,limit:n,tag_name:null,custom_tags_filter:null,custom_tags:[],enum_tag:''};if(c('PagesMessengerThreadUtils').isPageSpecficEnumFilter(p)){r.tag_name=p;this.__sendRequest('/pages/messaging/thread_tag/list/',r);return;}if(p&&c('PagesMessengerThreadUtils').isCustomTagsFilter(p)){r.custom_tags_filter=p;r.custom_tags=c('PagesMessengerThreadUtils').parseCustomTagsFilter(p);if(c('PagesMessengerThreadUtils').isCustomTagsWithFlagFilter(p))r.enum_tag=c('PageMessageEnumTag').FLAG;this.__sendRequest('/pages/messaging/thread_custom_tags/list/',r);return;}i.fetchThreadlistInfo.call(this,m,n,o,p,q);};k.prototype.removeThreadFlag=function(m,n){c('MercuryAssert').isThreadID(m);this.__threadIDMap.getServerIDFromClientID(m,function(o){var p={thread_ids:[o],tag_name:c('PageMessageEnumTag').FLAG};this.__sendRequest('/pages/messaging/thread_tag/remove/',p);}.bind(this));};k.prototype.toString=function(){return 'MercuryPageServerRequests';};k.prototype.__logMercurySendError=function(m){new (c('PagesMessagingPerfTypedLogger'))().setPageID(this.__getFBID()).setEventName(c('PagesEventType').MESSAGES_SEND_MESSAGE_JS_HANDLE_ERROR).setExceptionMessage(m.error_data.description).setExceptionCode(m.error_data.code).log();i.__logMercurySendError.call(this,m);};k.prototype.__getForAsyncRequest=function(m){var n=m.getData(),o=n.request_user_id?n.request_user_id:c('CurrentUser').getID();return k.getForFBID(o);};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercuryOrderedThreadlist',['invariant','FBID','LogHistory','MercuryActionType','MercuryDispatcher','MercuryFilters','MercuryFolders','MercuryPayloadSource','MercurySingletonProvider','MercuryThreadIDMap','MessagingTag','PagesManagerMessagingPriorityStore','PageMessageEnumTag','RangedCallbackManager','MercuryServerRequests','MercuryPageServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('LogHistory').getInstance('ordered_threadlist_model'),j=c('MercuryFilters').getSupportedFilters().concat([c('MercuryFilters').ALL,c('MessagingTag').GROUPS]),k=c('MercuryFolders').getSupportedFolders().concat([c('MessagingTag').SPAM]);l.getForFBID=function(o){return n.getForFBID(o);};l.get=function(){return n.get();};function l(o){this.$MercuryOrderedThreadlist1=o;if(c('FBID').isUser(this.$MercuryOrderedThreadlist1)){this.$MercuryOrderedThreadlist2=c('MercuryServerRequests').getForFBID(this.$MercuryOrderedThreadlist1);}else this.$MercuryOrderedThreadlist2=c('MercuryPageServerRequests').getForFBID(this.$MercuryOrderedThreadlist1);this.$MercuryOrderedThreadlist3=c('MercuryThreadIDMap').getForFBID(this.$MercuryOrderedThreadlist1);this.$MercuryOrderedThreadlist4=c('MercuryThreadInformer').getForFBID(this.$MercuryOrderedThreadlist1);this.$MercuryOrderedThreadlist5=c('MercuryThreads').getForFBID(this.$MercuryOrderedThreadlist1);this.$MercuryOrderedThreadlist6=c('MercuryDispatcher').getForFBID(this.$MercuryOrderedThreadlist1);this.$MercuryOrderedThreadlist7={};this.$MercuryOrderedThreadlist8();this.$MercuryOrderedThreadlist6.subscribe('update-threadlist',function(p,q){if(!m(q))return;var r=q.ordered_threadlists;if(r&&r.length){this.$MercuryOrderedThreadlist9(r);}else{var s=(q.actions||[]).filter(function(t){return t.thread_id;});this.$MercuryOrderedThreadlist10(q.threads||[]);this.$MercuryOrderedThreadlist11(s);}this.$MercuryOrderedThreadlist4.updatedThreadlist();}.bind(this));this.$MercuryOrderedThreadlist6.subscribe('invalidate-global-state',function(){return this.$MercuryOrderedThreadlist12();}.bind(this));}l.prototype.getThreadlistOrderMap=function(o,p){if(!this.$MercuryOrderedThreadlist7[o][p]){j=j.concat([p]);k.forEach(function(q){this.$MercuryOrderedThreadlist7[q][p]=new (c('RangedCallbackManager'))(function(r){var s=this.$MercuryOrderedThreadlist5.getThreadMetaNow(r);return s&&s.timestamp;}.bind(this),function(r,s){return s-r;},this.$MercuryOrderedThreadlist3.canLinkExternally.bind(this.$MercuryOrderedThreadlist3));}.bind(this));}return this.$MercuryOrderedThreadlist7[o][p];};l.prototype.getThreadlist=function(o,p,q,r,s,t){return this.getFilteredThreadlist(o,p,q,c('MercuryFilters').ALL,r,s,t);};l.prototype.getFilteredThreadlist=function(o,p,q,r,s,t,u){var v=this.getThreadlistOrderMap(q,r),w=v.executeOrEnqueue(o,p,s,t),x=v.getUnavailableResources(w),y=v.getError(o,p,t);if(x.length||y){if(v.getCurrentArraySize()<o){var z={start:o,limit:p,filter:r,resources_size:v.getCurrentArraySize()};i.warn('range_with_gap',JSON.stringify(z));}v.setError(false);this.$MercuryOrderedThreadlist2.fetchThreadlistInfo(v.getCurrentArraySize(),x.length,q,r==c('MercuryFilters').ALL?null:r,u);}return w;};l.prototype.getThreadlistUntilTimestamp=function(o,p,q){q=q||c('MercuryFilters').ALL;return this.getThreadlistOrderMap(p,q).getElementsUntil(o);};l.prototype.getAvailableThreadlistNow=function(o,p){p=p||c('MercuryFilters').ALL;return this.getThreadlistOrderMap(o,p).getAllResources();};l.prototype.getThreadCount=function(o,p){p=p||c('MercuryFilters').ALL;return this.getThreadlistOrderMap(o,p).getCurrentArraySize();};l.prototype.hasLoadedThreadlist=function(o,p){p=p||c('MercuryFilters').ALL;return this.getThreadlistOrderMap(o,p).hasReachedEndOfArray();};l.prototype.unsubscribe=function(o,p,q){q=q||c('MercuryFilters').ALL;this.getThreadlistOrderMap(p,q).unsubscribe(o);};l.prototype.$MercuryOrderedThreadlist12=function(){this.$MercuryOrderedThreadlist7={};this.$MercuryOrderedThreadlist8();};l.prototype.$MercuryOrderedThreadlist8=function(){k.forEach(function(o){this.$MercuryOrderedThreadlist7[o]={};j.forEach(function(p){this.$MercuryOrderedThreadlist7[o][p]=new (c('RangedCallbackManager'))(function(q){var r=this.$MercuryOrderedThreadlist5.getThreadMetaNow(q);return r&&r.timestamp;}.bind(this),function(q,r){return r-q;},this.$MercuryOrderedThreadlist3.canLinkExternally.bind(this.$MercuryOrderedThreadlist3));}.bind(this));}.bind(this));};l.prototype.$MercuryOrderedThreadlist13=function(o,p,q){var r=this.$MercuryOrderedThreadlist5.getThreadMetaNow(o);return !!(r&&r.timestamp&&q&&p&&this.$MercuryOrderedThreadlist14(o)==p&&c('arrayContains')(this.$MercuryOrderedThreadlist15(o),q));};l.prototype.$MercuryOrderedThreadlist16=function(o,p,q){var r,s=this,t=[],u=false,v=false,w=(o||[]).filter(function(aa){var ba=aa.filter||c('MercuryFilters').ALL;return (aa.folder==p||!aa.folder&&p==c('MessagingTag').INBOX)&&ba==q;}),x=this.$MercuryOrderedThreadlist7[p][q].getAllResources(),y=void 0;w.forEach(function(aa){t=t.concat(aa.thread_ids);if(aa.error){if(aa.end>x.length)v=aa.error;}else{var ba=aa.end-aa.start;if(aa.thread_ids.length<ba)u=true;}if(!y||aa.end>y)y=aa.end;});this.$MercuryOrderedThreadlist17(t,p,q);if(u){this.$MercuryOrderedThreadlist7[p][q].setReachedEndOfArray();}else if(v){this.$MercuryOrderedThreadlist7[p][q].setError(v);}else{var z=this.$MercuryOrderedThreadlist7[p][q].getCurrentArraySize();if(y&&z<y)(function(){var aa={},ba=x.concat(t),ca=ba.filter(function(da){var ea=aa[da];aa[da]=true;return ea;});if(ca.length){i.warn('duplicate_threads',JSON.stringify({folder:p,expected_final_size:y,actual_final_size:z,duplicate_thread_ids:ca}));s.$MercuryOrderedThreadlist2.fetchThreadlistInfo(y,ca.length,p,q==c('MercuryFilters').ALL?null:q);}})();}};l.prototype.$MercuryOrderedThreadlist9=function(o){k.forEach(function(p){j.forEach(function(q){this.$MercuryOrderedThreadlist16(o,p,q);}.bind(this));}.bind(this));};l.prototype.$MercuryOrderedThreadlist11=function(o){var p={},q=this.getThreadlistOrderMap(c('MessagingTag').INBOX,c('MercuryFilters').NONPRIORITY),r=this.$MercuryOrderedThreadlist5;k.forEach(function(s){p[s]={};j.forEach(function(t){p[s][t]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});o.forEach(function(s){if(s.is_forward)return;var t=s.thread_id;this.$MercuryOrderedThreadlist18(t,function(u){this.$MercuryOrderedThreadlist19(t,function(v){var w=function(){v.forEach(function(z){if(!c('arrayContains')(j,z))return;!!!u?h(0):void 0;p[u][z].to_add.push(t);if(!this.$MercuryOrderedThreadlist7[u][z].hasReachedEndOfArray()&&!this.$MercuryOrderedThreadlist7[u][z].hasResource(t))p[u][z].to_remove_if_last_after_add[t]=true;}.bind(this));}.bind(this);function x(z){!!!u?h(0):void 0;if(c('arrayContains')(j,z))if(c('arrayContains')(v,z)){p[u][z].to_add.push(t);}else p[u][z].to_remove.push(t);}function y(){if(c('arrayContains')(j,c('PageMessageEnumTag').IMPORTANT))if(c('arrayContains')(v,c('MercuryFilters').NONPRIORITY)){p[c('MessagingTag').INBOX][c('PageMessageEnumTag').IMPORTANT].to_remove.push(t);if(c('PagesManagerMessagingPriorityStore').hasMorePriorityItem())return;var z=q.getAllResources();if(!z.length||!c('PagesManagerMessagingPriorityStore').hasMoreNonPriorityItem()){p[c('MessagingTag').INBOX][c('MercuryFilters').NONPRIORITY].to_add.push(t);return;}var aa=r.getThreadMetaNow(z[z.length-1]),ba=r.getThreadMetaNow(t);if(!aa||!ba)return;var ca=aa.timestamp,da=ba.timestamp;if(ca<=da)p[c('MessagingTag').INBOX][c('MercuryFilters').NONPRIORITY].to_add.push(t);}else{p[c('MessagingTag').INBOX][c('MercuryFilters').NONPRIORITY].to_remove.push(t);p[c('MessagingTag').INBOX][c('PageMessageEnumTag').IMPORTANT].to_add.push(t);}}if(!u){if(s.action_type===c('MercuryActionType').CHANGE_FOLDER||s.action_type===c('MercuryActionType').CHANGE_ARCHIVED_STATUS)k.forEach(function(z){if(z!==u)j.forEach(function(aa){this.$MercuryOrderedThreadlist7[z][aa].removeResources([t]);}.bind(this));}.bind(this));return;}!!!u?h(0):void 0;switch(s.action_type){case c('MercuryActionType').DELETE_THREAD:v.forEach(function(z){if(!c('arrayContains')(j,z))return;p[u][z].to_remove.push(t);});break;case c('MercuryActionType').CHANGE_ARCHIVED_STATUS:case c('MercuryActionType').CHANGE_FOLDER:w();break;case c('MercuryActionType').CHANGE_READ_STATUS:x(c('MessagingTag').UNREAD);break;case c('MercuryActionType').USER_GENERATED_MESSAGE:case c('MercuryActionType').LOG_MESSAGE:v.forEach(function(z){if(!c('arrayContains')(j,z))return;if(this.$MercuryOrderedThreadlist13(t,u,z))p[u][z].to_add.push(t);}.bind(this));break;case c('MercuryActionType').CHANGE_FLAG:x(c('PageMessageEnumTag').FLAG);break;case c('MercuryActionType').UPDATE_PRIORITY:if(c('arrayContains')(j,c('PageMessageEnumTag').IMPORTANT))y();break;}}.bind(this));}.bind(this));}.bind(this));k.forEach(function(s){j.forEach(function(t){var u=this.$MercuryOrderedThreadlist7[s][t];this.$MercuryOrderedThreadlist17(p[s][t].to_add,s,t);for(var v=u.getCurrentArraySize()-1;v>=0;v--){var w=u.getResourceAtIndex(v);if(!p[s][t].to_remove_if_last_after_add[w])break;p[s][t].to_remove.push(w);}u.removeResources(p[s][t].to_remove);}.bind(this));}.bind(this));};l.prototype.$MercuryOrderedThreadlist10=function(o){var p={};k.forEach(function(q){p[q]={};j.forEach(function(r){p[q][r]=[];});});o.forEach(function(q){this.$MercuryOrderedThreadlist18(q.thread_id,function(r){this.$MercuryOrderedThreadlist19(q.thread_id,function(s){if(r)s.forEach(function(t){if(this.$MercuryOrderedThreadlist13(q.thread_id,r,t))p[r][t].push(q.thread_id);}.bind(this));}.bind(this));}.bind(this));}.bind(this));k.forEach(function(q){j.forEach(function(r){if(p[q][r].length>0)this.$MercuryOrderedThreadlist17(p[q][r],q,r);}.bind(this));}.bind(this));};l.prototype.$MercuryOrderedThreadlist17=function(o,p,q){q=q||c('MercuryFilters').ALL;this.$MercuryOrderedThreadlist7[p][q].addResources(o);k.forEach(function(r){if(r!=p)this.$MercuryOrderedThreadlist7[r][q].removeResources(o);}.bind(this));};l.prototype.$MercuryOrderedThreadlist18=function(o,p){this.$MercuryOrderedThreadlist5.getThreadMeta(o,function(q){p(this.$MercuryOrderedThreadlist14(o,q));}.bind(this));};l.prototype.$MercuryOrderedThreadlist14=function(o,p){p=p||this.$MercuryOrderedThreadlist5.getThreadMetaNow(o);var q=null;if(!p){q='No thread metadata';}else if(!p.folder)q='No thread folder';if(q){var r={error:q,tid:o};i.warn('no_thread_folder',JSON.stringify(r));return null;}!!!p?h(0):void 0;var s=p.folder;if(p.is_archived)s=c('MessagingTag').ACTION_ARCHIVED;if(this.$MercuryOrderedThreadlist7[s]){return s;}else return null;};l.prototype.$MercuryOrderedThreadlist19=function(o,p){this.$MercuryOrderedThreadlist5.getThreadMeta(o,function(q){p(this.$MercuryOrderedThreadlist15(o,q));}.bind(this));};l.prototype.$MercuryOrderedThreadlist15=function(o,p){p=p||this.$MercuryOrderedThreadlist5.getThreadMetaNow(o);var q=[c('MercuryFilters').ALL];if(!p){var r={error:'no_thread_metadata',tid:o};i.warn('no_thread_metadata',JSON.stringify(r));return [];}if(p.unread_count)q.push(c('MessagingTag').UNREAD);if(!p.is_canonical)q.push(c('MessagingTag').GROUPS);var s=p.page_thread_info;if(s&&s.flagged)q.push(c('PageMessageEnumTag').FLAG);if(s)if(s.is_priority===true){q.push(c('PageMessageEnumTag').IMPORTANT);}else if(s.is_priority===false)q.push(c('MercuryFilters').NONPRIORITY);return q;};function m(o){switch(o.payload_source){case c('MercuryPayloadSource').CLIENT_CHANGE_ARCHIVED_STATUS:case c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS:case c('MercuryPayloadSource').CLIENT_CHANGE_FOLDER:case c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE:case c('MercuryPayloadSource').CLIENT_DELETE_MESSAGES:case c('MercuryPayloadSource').CLIENT_DELETE_THREAD:case c('MercuryPayloadSource').CLIENT_SEND_MESSAGE:case c('MercuryPayloadSource').SERVER_SEND_MESSAGE:case c('MercuryPayloadSource').SERVER_FETCH_THREADLIST_INFO:case c('MercuryPayloadSource').SERVER_THREAD_SYNC:case c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE:return true;case c('MercuryPayloadSource').SERVER_INITIAL_DATA:return !!o.ordered_threadlists;default:return false;}}var n=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MercuryPageOrderedThreadlist',['MercuryOrderedThreadlist','MercurySingletonProvider','MessagingTag','MercuryFilters'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MercuryOrderedThreadlist'));i=h&&h.prototype;j.getForFBID=function(l){return k.getForFBID(l);};j.get=function(){return k.get();};function j(l){i.constructor.call(this,l);}j.prototype.addNonPriorityThreadsWithoutSort=function(l){var m=this.getThreadlistOrderMap(c('MessagingTag').INBOX,c('MercuryFilters').NONPRIORITY);m.addResourcesWithoutSorting(l,m.getCurrentArraySize());};var k=new (c('MercurySingletonProvider'))(j);f.exports=j;}),null);
__d('PagesManagerActionType',['ImmutableObject','keyMirrorRecursive'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=new (c('ImmutableObject'))(c('keyMirrorRecursive')({LIST:{FETCH:'',FETCHED:'',UPDATED:'',LOAD_MORE:'',LOADING:'',PREVENT_SCROLL:'',SELECT:'',DESELECT_ALL:'',VIEW:'',INITIAL_VIEW:'',CLEAR_INITIAL_VIEW:'',SWITCH_PRIORITY:'',SET_PRIORITY_GK:''},NAVIGATION_UNIT:{CHANGE:'',NOTIFICATION_COUNT_CHANGE:''},FILTER_PANEL:{TOGGLE_PANEL:''},LAYOUT:{HEIGHT_CHANGE:''},SEARCH:{TOGGLE_SEARCH:'',CHANGE_SEARCH_TERM:'',IS_SEARCHING_CHANGED:'',ADD_SEARCH_CUSTOM_TAG:'',REMOVE_SEARCH_CUSTOM_TAG:'',FETCH_CUSTOM_TAG_THREAD_COUNTS:'',UPDATE_CUSTOM_TAG_THREAD_COUNTS:''}}));f.exports=h;}),null);
__d('PagesManagerDispatcher',['ReactDispatcher_DEPRECATED'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new (c('ReactDispatcher_DEPRECATED'))();}),null);
__d('PagesManagerMessagingNavigationUnitKey',['MercuryFilters','MessagingTag','PageMessageEnumTag'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={FILTERS:{ALL:c('MercuryFilters').ALL,UNREAD:c('MercuryFilters').UNREAD,FLAGGED:c('PageMessageEnumTag').FLAG,PRIORITY:c('PageMessageEnumTag').IMPORTANT},FOLDERS:{INBOX:c('MessagingTag').INBOX,ARCHIVED:c('MessagingTag').ACTION_ARCHIVED,SPAM:c('MessagingTag').SPAM}};f.exports=h;}),null);
__d('PagesManagerNavigationUnit',['invariant'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j){this.$PagesManagerNavigationUnit1=j;}i.prototype.getDisplayTitle=function(){h(0);};i.prototype.getKey=function(){return this.$PagesManagerNavigationUnit1;};i.prototype.getNotificationCount=function(j,k){return 0;};f.exports=i;}),null);
__d('PagesManagerMessagingAllNavigationUnit',['fbt','PagesManagerMessagingNavigationUnitKey','PagesManagerNavigationUnit'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('PagesManagerNavigationUnit'));j=i&&i.prototype;function k(){j.constructor.call(this,c('PagesManagerMessagingNavigationUnitKey').FILTERS.ALL);}k.prototype.getDisplayTitle=function(){return h._("\u5168\u90e8");};f.exports=k;}),null);
__d('PagesManagerMessagingFolderNavigationUnit',['invariant','immutable','PagesManagerMessagingNavigationUnitKey','PagesManagerNavigationUnit'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('immutable').List;i=babelHelpers.inherits(l,c('PagesManagerNavigationUnit'));j=i&&i.prototype;l.prototype.getSupportedFilterKeys=function(){return k([c('PagesManagerMessagingNavigationUnitKey').FILTERS.ALL]);};l.prototype.assertSupportsFilter=function(m){!(this.getSupportedFilterKeys().indexOf(m.getKey())>=0)?h(0):void 0;};function l(){i.apply(this,arguments);}f.exports=l;}),null);
__d('PagesManagerMessagingUnreadCountHelper',['MercuryThreadlistConstants','MercuryUnreadState'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={getUnreadCount:function i(j,k){var l=c('MercuryUnreadState').getForFBID(j),m=l.exceedsMaxCount(k);return m?c('MercuryThreadlistConstants').MAX_UNREAD_COUNT:l.getUnreadCount(k);}};f.exports=h;}),null);
__d('PagesManagerMessagingInboxNavigationUnit',['fbt','immutable','PagesManagerMessagingFolderNavigationUnit','PagesManagerMessagingNavigationUnitKey','PagesManagerMessagingUnreadCountHelper'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('immutable').List;i=babelHelpers.inherits(l,c('PagesManagerMessagingFolderNavigationUnit'));j=i&&i.prototype;function l(){j.constructor.call(this,c('PagesManagerMessagingNavigationUnitKey').FOLDERS.INBOX);}l.prototype.getDisplayTitle=function(){return h._("\u6536\u4ef6\u5323");};l.prototype.getSupportedFilterKeys=function(){return k([c('PagesManagerMessagingNavigationUnitKey').FILTERS.ALL,c('PagesManagerMessagingNavigationUnitKey').FILTERS.UNREAD,c('PagesManagerMessagingNavigationUnitKey').FILTERS.FLAGGED]);};l.prototype.getNotificationCount=function(m,n){return c('PagesManagerMessagingUnreadCountHelper').getUnreadCount(m,this.getKey());};f.exports=l;}),null);
__d('PagesManagerMessagingPriorityNavigationUnit',['fbt','PagesManagerNavigationUnit','PagesManagerMessagingNavigationUnitKey'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('PagesManagerNavigationUnit'));j=i&&i.prototype;function k(){j.constructor.call(this,c('PagesManagerMessagingNavigationUnitKey').FILTERS.PRIORITY);}k.prototype.getDisplayTitle=function(){return h._("\u512a\u5148\u9806\u5e8f\u6aa2\u8996");};f.exports=k;}),null);
__d('PagesManagerMessagingPriorityStore',['FluxStore','MercuryFilters','MercuryPageOrderedThreadlist','PagesManagerActionType','PagesManagerDispatcher','PagesManagerMessagingPriorityNavigationUnit','PagesManagerMessagingInboxNavigationUnit','PagesManagerMessagingAllNavigationUnit'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=new (c('PagesManagerMessagingInboxNavigationUnit'))(),k=new (c('PagesManagerMessagingPriorityNavigationUnit'))(),l=new (c('PagesManagerMessagingAllNavigationUnit'))();h=babelHelpers.inherits(m,c('FluxStore'));i=h&&h.prototype;function m(){i.constructor.call(this,c('PagesManagerDispatcher'));this.$PagesManagerMessagingPriorityStore1=true;this.$PagesManagerMessagingPriorityStore2=true;this.$PagesManagerMessagingPriorityStore3=false;this.$PagesManagerMessagingPriorityStore4=false;this.$PagesManagerMessagingPriorityStore5=0;}m.prototype.__onDispatch=function(n){switch(n.type){case c('PagesManagerActionType').LIST.FETCH:if(this.$PagesManagerMessagingPriorityStore4)this.$PagesManagerMessagingPriorityStore6(n);break;case c('PagesManagerActionType').LIST.LOADING:if(this.$PagesManagerMessagingPriorityStore4){this.$PagesManagerMessagingPriorityStore3=true;this.__emitChange();}break;case c('PagesManagerActionType').LIST.SWITCH_PRIORITY:this.$PagesManagerMessagingPriorityStore4=n.isPriorityOn;break;default:return;}};m.prototype.$PagesManagerMessagingPriorityStore7=function(n,o,p){var q=c('MercuryPageOrderedThreadlist').getForFBID(n);q.getFilteredThreadlist(o,p+1,j.getKey(),k.getKey(),function(r){var s=r.length>p;this.$PagesManagerMessagingPriorityStore8(s,s);if(!s)this.$PagesManagerMessagingPriorityStore9(n,o,p);}.bind(this));};m.prototype.$PagesManagerMessagingPriorityStore9=function(n,o,p){var q=c('MercuryPageOrderedThreadlist').getForFBID(n),r=q.getAvailableThreadlistNow(j.getKey(),k.getKey());q.getFilteredThreadlist(this.$PagesManagerMessagingPriorityStore5,p+1,j.getKey(),l.getKey(),function(s){var t=s.length>p;s=t?s.slice(0,-1):s;s=this.$PagesManagerMessagingPriorityStore10(s,r);q.addNonPriorityThreadsWithoutSort(s);this.$PagesManagerMessagingPriorityStore5+=p;this.$PagesManagerMessagingPriorityStore11(t);}.bind(this));return;};m.prototype.$PagesManagerMessagingPriorityStore12=function(n){var o=c('MercuryPageOrderedThreadlist').getForFBID(n);return o.getAvailableThreadlistNow(j.getKey(),k.getKey());};m.prototype.$PagesManagerMessagingPriorityStore13=function(n){if(this.$PagesManagerMessagingPriorityStore2)return [];var o=c('MercuryPageOrderedThreadlist').getForFBID(n);return o.getAvailableThreadlistNow(j.getKey(),c('MercuryFilters').NONPRIORITY);};m.prototype.$PagesManagerMessagingPriorityStore6=function(n){var o=n.pageID,p=n.offset,q=n.limit;this.$PagesManagerMessagingPriorityStore3=true;if(this.$PagesManagerMessagingPriorityStore2){var r=this.$PagesManagerMessagingPriorityStore14(o,p+q);if(r){this.$PagesManagerMessagingPriorityStore8(this.$PagesManagerMessagingPriorityStore2,true);}else this.$PagesManagerMessagingPriorityStore7(o,p,q);}else{var s=this.$PagesManagerMessagingPriorityStore15(o,this.$PagesManagerMessagingPriorityStore5+q);if(s){this.$PagesManagerMessagingPriorityStore11(this.$PagesManagerMessagingPriorityStore1);}else this.$PagesManagerMessagingPriorityStore9(o,p,q);}};m.prototype.$PagesManagerMessagingPriorityStore14=function(n,o){var p=c('MercuryPageOrderedThreadlist').getForFBID(n);return p.getThreadCount(j.getKey(),k.getKey())>=o;};m.prototype.$PagesManagerMessagingPriorityStore15=function(n,o){var p=c('MercuryPageOrderedThreadlist').getForFBID(n);return p.hasLoadedThreadlist(j.getKey(),l.getKey())||p.getThreadCount(j.getKey(),l.getKey())>=o;};m.prototype.$PagesManagerMessagingPriorityStore8=function(n,o){this.$PagesManagerMessagingPriorityStore3=!o;this.$PagesManagerMessagingPriorityStore2=n;if(!this.__dispatcher.isDispatching()&&o)this.__dispatcher.dispatch({type:c('PagesManagerActionType').LIST.FETCHED});};m.prototype.$PagesManagerMessagingPriorityStore11=function(n){this.$PagesManagerMessagingPriorityStore3=false;this.$PagesManagerMessagingPriorityStore1=n;if(!this.__dispatcher.isDispatching())this.__dispatcher.dispatch({type:c('PagesManagerActionType').LIST.FETCHED});};m.prototype.$PagesManagerMessagingPriorityStore10=function(n,o){return n.filter(function(p){return !o.includes(p);});};m.prototype.getIsPriorityMode=function(){return this.$PagesManagerMessagingPriorityStore4;};m.prototype.getPriorityItemList=function(n){var o=this.$PagesManagerMessagingPriorityStore12(n);return this.$PagesManagerMessagingPriorityStore2&&o.length>0?o.slice(0,o.length-1):o;};m.prototype.getNonPriorityItemList=function(n){var o=this.$PagesManagerMessagingPriorityStore13(n);return this.$PagesManagerMessagingPriorityStore1&&o.length>0?o.slice(0,o.length-1):o;};m.prototype.hasMorePriorityItem=function(){return this.$PagesManagerMessagingPriorityStore2;};m.prototype.hasMoreNonPriorityItem=function(){return this.$PagesManagerMessagingPriorityStore1;};m.prototype.isLoading=function(){return this.$PagesManagerMessagingPriorityStore3;};f.exports=new m();}),null);
__d('WebMessengerMercury',['MercuryMessages','MercuryOrderedThreadlist','MercuryServerRequests','WebMessengerStateManager','MercuryThreadInformer','MercuryThreadActions','MercuryThreads','MercuryUnreadState','MercuryUnseenState'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={getMessages:function j(){return c('MercuryMessages').getForFBID(i());},getOrderedThreadlist:function j(){return c('MercuryOrderedThreadlist').getForFBID(i());},getServerRequests:function j(){return c('MercuryServerRequests').getForFBID(i());},getThreadInformer:function j(){return c('MercuryThreadInformer').getForFBID(i());},getThreadActions:function j(){return c('MercuryThreadActions').getForFBID(i());},getThreads:function j(){return c('MercuryThreads').getForFBID(i());},getUnreadState:function j(){return c('MercuryUnreadState').getForFBID(i());},getUnseenState:function j(){return c('MercuryUnseenState').getForFBID(i());}};function i(){return c('WebMessengerStateManager').getCurrentUserID();}f.exports=h;}),null);
__d('WebMessengerMasterViewUnseenMessagesNotice',['MercuryThreadlistConstants','MessagingTag','WebMessengerStateManager','UserActivity','WebMessengerSubscriptionsHandler','WebMessengerMessagesNotice','WebMessengerConstants','WebMessengerMercury','throttle'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('WebMessengerConstants').THREADLIST_SCROLLTOP_OFFSET,k=c('MercuryThreadlistConstants').MESSAGE_NOTICE_INACTIVITY_THRESHOLD;h=babelHelpers.inherits(l,c('WebMessengerMessagesNotice'));i=h&&h.prototype;function l(q){'use strict';i.constructor.call(this);this._manager=q;this._threadInformer=c('WebMessengerMercury').getThreadInformer();this._unseenState=c('WebMessengerMercury').getUnseenState();c('WebMessengerSubscriptionsHandler').addSubscriptions(this._threadInformer.subscribe('messages-received',function(r,s){var t=!c('UserActivity').isActive(k),u=!this.isScrolledWithinTopThreshold();if(!i.getActive.call(this)||o(s)||!n(s))return;if(i.onlyReceivedFromSelf.call(this,s))return;if(t){this.removeMessageNotice();this._manager.scrollToTop();}else if(u)this.showMessageNotice();}.bind(this)),this._threadInformer.subscribe('unseen-updated',m.bind(null,this)));this._manager.addScrollCallback(c('throttle').withBlocking(function(r){if(i.getActive.call(this)&&r.getScrollTop()<=c('WebMessengerConstants').THREADLIST_TOP_OFFSET&&c('UserActivity').isActive(k)&&p()){this.removeMessageNotice();this._unseenState.markAsSeen();}}.bind(this),100,null));}l.prototype.isScrolledWithinTopThreshold=function(){'use strict';return this._manager.getScrollTop()<=j;};l.prototype.showMessageNotice=function(){'use strict';if(!p())return;var q=function(){this._manager.scrollToTop();}.bind(this);i.showMessageNotice.call(this,q,'below');};function m(q){if(q._unseenState.getUnseenCount()===0)q.removeMessageNotice();}function n(q){for(var r in q)for(var s=0;s<q[r].length;s++)if(q[r][s].folder==c('MessagingTag').INBOX)return true;return false;}function o(q){var r=c('WebMessengerStateManager').getCurrentStateData().thread_id,s=true;for(var t in q)if(q.hasOwnProperty(t))if(t!==r){s=false;break;}return p()&&s;}function p(){var q=c('WebMessengerStateManager').getCurrentStateData().folder;return q===c('MessagingTag').INBOX;}f.exports=l;}),null);
__d('WebMessengerThreadlistRenderer',['csx','cx','fbt','CSS','WebMessengerDeleteThreadDialog','DOM','Event','Focus','MercuryListUpdateRenderer','MercuryAPIArgsSource','MessagingTag','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','MercuryThreadMetadataRawRenderer','MercuryThreadMetadataRenderer','Tooltip','WebMessengerMercury','WebMessengerPermalinks'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={renderThreadsFromIDs:function m(n,o,p,q,r,s){q=q||function(t){return t;};r=r||{};c('MercuryListUpdateRenderer').updateList(n,o.map(q),function(t){return !r[o[t]]&&o[t]!=p;},function(t){var u=o[t],v=c('WebMessengerTemplates')[':fb:web-messenger:threadlist-row'].build();v.getRoot().setAttribute('id',q(u));var w=v.getNode('threadLink');c('Focus').listen(w,function(x){c('CSS').conditionClass(v.getRoot(),"_5fes",x);});c('Event').listen(w,'click',function(x){if(x.getModifiers().any)return true;var y=c('WebMessengerStateManager').getCurrentMasterState(),z={thread_id:u};if(y===c('WebMessengerStateConstants').MASTER.SEARCH)z.query=c('WebMessengerStateManager').getCurrentStateData().query;c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,z);return false;});if(u==p)c('CSS').addClass(v.getRoot(),"_kv");u&&c('WebMessengerMercury').getThreads().getThreadMeta(u,function(x){var y=c('MercuryThreadMetadataRenderer').getForFBID(c('WebMessengerStateManager').getCurrentUserID());y.renderCoreThreadlist(x,v,l.bind(null,s),{names_renderer:c('MercuryThreadMetadataRawRenderer').renderShortNames,show_unread_count:false},true);},c('MercuryAPIArgsSource').WEBMESSENGER);return v.getRoot();});}};function l(m,n,o){var p=n.getNode('readToggler'),q=n.getNode('archiveButton'),r=n.getNode('deleteButton');n.getNode('threadLink').setAttribute('href',c('WebMessengerPermalinks').getURI(m,c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:o.thread_id}).toString());if(o.unread_count>0){c('CSS').addClass(n.getRoot(),"_kx");c('DOM').setContent(n.getNode('newCount'),j._("{num}\u5247\u65b0\u8a0a\u606f",[j.param('num',o.unread_count)]));c('CSS').addClass(p,"_ky");c('Tooltip').set(p,j._("\u6a19\u793a\u70ba\u5df2\u8b80\u8a0a\u606f"),'above','right');}else{c('CSS').addClass(p,"_kz");c('Tooltip').set(p,j._("\u6a19\u793a\u70ba\u672a\u8b80\u8a0a\u606f"),'above','right');}c('Event').listen(p,'click',function(event){var u=c('WebMessengerMercury').getThreadActions();c('CSS').matchesSelector(p,"._ky")?u.markRead(o.thread_id):u.markUnread(o.thread_id);return false;});var s=c('WebMessengerStateManager').getCurrentStateData().folder;if(s==c('MessagingTag').SPAM){c('Tooltip').set(r,j._("\u522a\u9664\u5c0d\u8a71"),'above','right');c('CSS').addClass(r,"_4_3q");c('Event').listen(r,'click',function(event){c('WebMessengerDeleteThreadDialog').show(o.thread_id);});c('CSS').hide(q);}else{c('CSS').hide(r);var t=true;if(s==c('MessagingTag').ACTION_ARCHIVED){t=false;c('Tooltip').set(q,j._("\u53d6\u6d88\u5b58\u6a94"),'above','right');c('CSS').addClass(q,"_2s2");}else{c('Tooltip').set(q,j._("\u5c01\u5b58"),'above','right');c('CSS').addClass(q,"_l9");}c('Event').listen(q,'click',function(event){var u=c('WebMessengerMercury').getThreadActions();t?u.archive(o.thread_id):u.unarchive(o.thread_id);var v=c('WebMessengerStateManager').getCurrentStateData();if(v.thread_id==o.thread_id)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{folder:v.folder});return false;});}}f.exports=k;}),null);
__d('WebMessengerMasterViewRecentThreadsControl',['cx','fbt','UserActivity','CSS','DOM','Event','MercuryAPIArgsSource','MercuryFilters','MercuryFolders','MercuryThreadlistConstants','MessagingTag','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerThreadlistRenderer','WebMessengerConstants','WebMessengerEvents','WebMessengerInfoBoxRenderer','WebMessengerSubscriptionsHandler','WebMessengerMasterViewUnseenMessagesNotice','WebMessengerMercury','createObjectFrom','ge'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();c('UserActivity');var j='recent:';function k(ca,da,ea,fa){'use strict';this._manager=ca;this._rootElement=da;this._infoBox=ea;this._orderedThreadlist=c('WebMessengerMercury').getOrderedThreadlist();this._serverRequests=c('WebMessengerMercury').getServerRequests();this._threadInformer=c('WebMessengerMercury').getThreadInformer();this._threads=c('WebMessengerMercury').getThreads();this._unseenState=c('WebMessengerMercury').getUnseenState();c('DOM').empty(this._rootElement);this._pagerExponent=-1;var ga=c('WebMessengerTemplates')[':fb:web-messenger:threadlist'].build();c('DOM').setContent(this._rootElement,ga.getRoot());this._loadingSpinner=ga.getNode('loadingSpinner');this._threadlistRows=ga.getNode('threadlistRows');this._loadMoreButton=ga.getNode('loadMoreButton');this._loadMoreLink=ga.getNode('loadMoreLink');this._active=false;this._state=null;this._folder=null;this._filter=null;this._selection=null;this._threadIDs=[];this._unreadThreadIDs=[];this._folders=c('MercuryFolders').getSupportedFolders();this._filters=c('MercuryFilters').getSupportedFilters();this._olderTimestamp={};this._currentCountMap={};this._folders.forEach(function(ha){this._currentCountMap[ha]={};this._filters.concat([c('MercuryFilters').ALL]).forEach(function(ia){this._currentCountMap[ha][ia]=c('MercuryThreadlistConstants').WEBMESSENGER_THREAD_COUNT+1;}.bind(this));}.bind(this));this._unseenMessagesNotice=new (c('WebMessengerMasterViewUnseenMessagesNotice'))(this._manager);this._unseenMessagesNotice.setNoticeContextNode(fa);c('WebMessengerSubscriptionsHandler').addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(ha,ia){x(this,c('createObjectFrom')(ia));}.bind(this)),c('Event').listen(this._loadMoreLink,'click',function(){w(this);}.bind(this)),this._manager.subscribe('scrolledNearBottom',function(){this._active&&w(this);}.bind(this)));}k.prototype.updateView=function(){'use strict';this._active=true;this._unseenMessagesNotice.updateView();c('CSS').show(this._rootElement);var ca=m(this),da=n(this),ea=this._folder,fa=this._selection;o(this);if(da)p(this,fa);if(ca){v(this);}else q(this);};k.prototype.hideView=function(){'use strict';this._active=false;this._unseenMessagesNotice.hideView();c('CSS').hide(this._rootElement);};k.prototype.destroy=function(){'use strict';l(this);this._unseenMessagesNotice.destroy();};function l(ca){ca._threadlistSubscription&&ca._orderedThreadlist.unsubscribe(ca._threadlistSubscription.subscriber_id,ca._threadlistSubscription.folder,ca._threadlistSubscription.filter);ca._threadlistSubscription=null;}function m(ca){var da=c('WebMessengerStateManager').getCurrentStateData();if(ca._folder!=da.folder||ca._filter!=da.filter)return true;return false;}function n(ca){var da=c('WebMessengerStateManager').getCurrentStateData();if(ca._selection!=da.thread_id)return true;return false;}function o(ca){var da=c('WebMessengerStateManager').getCurrentStateData();ca._state=c('WebMessengerStateManager').getCurrentMasterState();if(ca._folder!=da.folder||ca._filter!=da.filter)ca._pageExponent=-1;ca._folder=da.folder;ca._filter=da.filter;ca._selection=da.thread_id;}function p(ca,da){var ea=c('ge')(ba(da));if(ea){c('CSS').removeClass(ea,"_kv");ea.removeAttribute('aria-selected');}var fa=c('ge')(ba(ca._selection));if(fa){c('CSS').addClass(fa,"_kv");fa.setAttribute('aria-selected','true');}c('WebMessengerEvents').updateSelection(fa&&fa.id);}function q(ca){if(ca._active)c('WebMessengerShortcuts').updateThreadlistIndex(ca,ca._threadIDs.map(ba),ba(ca._selection));}function r(ca){c('CSS').addClass(ca._manager.getFlexAreaElement(),"_3j6");c('CSS').addClass(ca._manager.getFlexAreaElement(),"_3j7");}function s(ca){c('CSS').removeClass(ca._manager.getFlexAreaElement(),"_3j6");c('CSS').removeClass(ca._manager.getFlexAreaElement(),"_3j7");}function t(ca){c('CSS').hide(ca._threadlistRows);s(ca);}function u(ca){if(ca._threadIDs.length){c('CSS').show(ca._threadlistRows);s(ca);}else{c('CSS').hide(ca._threadlistRows);r(ca);}}function v(ca){c('CSS').show(ca._loadingSpinner);c('CSS').hide(ca._infoBox);t(ca);c('CSS').hide(ca._loadMoreButton);l(ca);var da=ca._orderedThreadlist.getFilteredThreadlist(c('MercuryThreadlistConstants').RECENT_THREAD_OFFSET,ca._currentCountMap[ca._folder][ca._filter],ca._folder,ca._filter,function(ea,fa){c('CSS').hide(ca._loadingSpinner);y(ca,ea,fa);u(ca);q(ca);ca._manager.poke();ca._manager.forceFireScrollCallbacks();},null,c('MercuryAPIArgsSource').WEBMESSENGER);if(da)ca._threadlistSubscription={subscriber_id:da,folder:ca._folder,filter:ca._filter};}function w(ca){if(ca._requestInFlight||c('CSS').hasClass(ca._loadMoreButton,'hidden_elem'))return;ca._requestInFlight=true;c('CSS').addClass(ca._loadMoreButton,'async_saving');ca._pagerExponent=Math.min(ca._pagerExponent+1,c('WebMessengerConstants').EXPONENTIAL_PAGER_MAX_CYCLES);var da=Math.pow(2,ca._pagerExponent),ea=ca._currentCountMap[ca._folder][ca._filter]+da*c('MercuryThreadlistConstants').WEBMESSENGER_MORE_COUNT;l(ca);var fa=ca._orderedThreadlist.getFilteredThreadlist(c('MercuryThreadlistConstants').RECENT_THREAD_OFFSET,ea,ca._folder,ca._filter,function(ga,ha){c('CSS').removeClass(ca._loadMoreButton,'async_saving');ca._currentCountMap[ca._folder][ca._filter]=ea;y(ca,ga,ha);q(ca);ca._manager.poke();ca._requestInFlight=false;},null,c('MercuryAPIArgsSource').WEBMESSENGER);if(fa)ca._threadlistSubscription={subscriber_id:fa,folder:ca._folder,filter:ca._filter};}function x(ca,da){if(!ca._folder||!ca._olderTimestamp[ca._folder])return;var ea=ca._orderedThreadlist.getThreadlistUntilTimestamp(ca._olderTimestamp[ca._folder],ca._folder,ca._filter);if(ca._filter==c('MessagingTag').UNREAD){ea=aa(ca,ea);}else ca._unreadThreadIDs=[];if(ea.length>ca._currentCountMap[ca._folder][ca._filter])ca._currentCountMap[ca._folder][ca._filter]=ea.length;ca._threadIDs=ea;u(ca);c('WebMessengerThreadlistRenderer').renderThreadsFromIDs(ca._threadlistRows,ea,ca._selection,ba,da,c('WebMessengerStateConstants').MASTER.RECENT_THREADS);q(ca);ca._manager.poke();}function y(ca,da,ea){var fa=da.length==ca._currentCountMap[ca._folder][ca._filter];if(fa)da.pop();if(da.length){var ga=da[da.length-1];ca._threads.getThreadMeta(ga,function(ha){ca._olderTimestamp[ca._folder]=ha.timestamp;},c('MercuryAPIArgsSource').WEBMESSENGER);}if(ca._filter==c('MessagingTag').UNREAD){ca._unreadThreadIDs=da;}else ca.unreadThreadIDs=[];c('CSS').conditionShow(ca._loadMoreButton,fa);ca._threadIDs=da;c('WebMessengerThreadlistRenderer').renderThreadsFromIDs(ca._threadlistRows,da,ca._selection,ba,null,c('WebMessengerStateConstants').MASTER.RECENT_THREADS);ea=ea&&da.length===0;ea&&z(ca);c('CSS').conditionShow(ca._infoBox,ea);}function z(ca){if(ca._builtErrorMessage)return;c('DOM').setContent(ca._infoBox,c('WebMessengerInfoBoxRenderer').render(i._("\u7121\u6cd5\u8f09\u5165\u5c0d\u8a71"),[{text:i._("\u518d\u8a66\u4e00\u6b21"),handler:v.bind(null,ca)}]));ca._builtErrorMessage=true;}function aa(ca,da){da.forEach(function(ea){if(ca._unreadThreadIDs.indexOf(ea)<0)ca._unreadThreadIDs.push(ea);});ca._unreadThreadIDs.sort(function(ea,fa){var ga=ca._threads.getThreadMetaNow(ea).timestamp,ha=ca._threads.getThreadMetaNow(fa).timestamp;return ha-ga;});ca._unreadThreadIDs=ca._unreadThreadIDs.filter(function(ea){var fa=ca._threads.getThreadMetaNow(ea);return c('MercuryFolders').getFromMeta(fa)==ca._folder;});return ca._unreadThreadIDs;}function ba(ca){if(ca)return j+ca;return null;}f.exports=k;}),null);
__d('MercuryThreadSearchUtils',['escapeRegex','TokenizeUtil'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={wordsInString:function i(j){return (j||'').split(/\s+/).filter(function(k){return k.trim().length>0;});},anyMatchPredicate:function i(j,k){for(var l=0;l<j.length;l++)if(k(j[l]))return true;return false;},allMatchPredicate:function i(j,k){for(var l=0;l<j.length;l++)if(!k(j[l]))return false;return true;},queryWordMatchesAnyNameWord:function i(j,k){var l=new RegExp('^'+c('escapeRegex')(j),'i');return this.anyMatchPredicate(k,function(m){var n=c('TokenizeUtil').parse(m).flatValue;return l.test(n);});},queryMatchesName:function i(j,k){var l=this.wordsInString(j),m=this.wordsInString(k);return this.allMatchPredicate(l,function(n){return this.queryWordMatchesAnyNameWord(n,m);}.bind(this));}};f.exports=h;}),null);
__d('MercuryLocalThreadResults',['MercuryFolders','MercuryIDs','MercurySingletonMixin','MercuryOrderedThreadlist','MercuryParticipants','MercuryThreadSearchUtils','MercuryThreads'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this.$MercuryLocalThreadResults1=i;this.$MercuryLocalThreadResults2=c('MercuryOrderedThreadlist').getForFBID(this.$MercuryLocalThreadResults1);this.$MercuryLocalThreadResults3=c('MercuryThreads').getForFBID(this.$MercuryLocalThreadResults1);}h.prototype.findMatchingThreadsFromIds=function(i,j){'use strict';return j.filter(function(k){var l=this.$MercuryLocalThreadResults3.getThreadMetaNow(k);return this.$MercuryLocalThreadResults4(l,i);}.bind(this));};h.prototype.findMatchingThreads=function(i){'use strict';var j=[];c('MercuryFolders').getSupportedFolders().forEach(function(k){j=j.concat(this.$MercuryLocalThreadResults2.getThreadlistUntilTimestamp(0,k));}.bind(this));return this.findMatchingThreadsFromIds(i,j);};h.prototype.$MercuryLocalThreadResults4=function(i,j){'use strict';var k=this.$MercuryLocalThreadResults5(i.participants),l=c('MercuryThreadSearchUtils').wordsInString(j),m=null;c('MercuryParticipants').getMulti(k,function(n){m=k.map(function(o){return n[o];});});if(!m)return false;return c('MercuryThreadSearchUtils').allMatchPredicate(l,function(n){var o=c('MercuryThreadSearchUtils').anyMatchPredicate(m,function(q){return q&&q.name&&c('MercuryThreadSearchUtils').queryWordMatchesAnyNameWord(n,c('MercuryThreadSearchUtils').wordsInString(q.name));}),p=i.name&&c('MercuryThreadSearchUtils').queryWordMatchesAnyNameWord(n,c('MercuryThreadSearchUtils').wordsInString(i.name));return o||p;});};h.prototype.$MercuryLocalThreadResults5=function(i){'use strict';if(i.length===1&&c('MercuryIDs').tokenize(i[0]).value===this.$MercuryLocalThreadResults1)return i;return i.filter(function(j){var k=c('MercuryIDs').tokenize(j).value;return k!==this.$MercuryLocalThreadResults1;}.bind(this));};Object.assign(h,c('MercurySingletonMixin'));f.exports=h;}),null);
__d('MercurySearchThreadResults',['KeyedCallbackManager','MercuryAPIArgsSource','MercurySingletonMixin','MercuryThreadlistConstants','MercuryThreadIDMap','RangedCallbackManager','MercuryServerDispatcher','MercuryServerPayloadPreprocessor'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=new (c('KeyedCallbackManager'))(),i=c('MercuryThreadlistConstants').WEBMESSENGER_THREAD_COUNT,j=c('MercuryThreadlistConstants').WEBMESSENGER_MORE_COUNT;function k(l){'use strict';this.$MercurySearchThreadResults1=l;this.$MercurySearchThreadResults2=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySearchThreadResults1);this.$MercurySearchThreadResults3=c('MercuryThreadIDMap').getForFBID(this.$MercurySearchThreadResults1);c('MercuryServerDispatcher').registerEndpoints({'/ajax/mercury/search_threads.php':{request_user_id:l,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(m){this.handleUpdate(m);}.bind(this)}});}k.prototype.getThreadlist=function(l,m){'use strict';if(l){var n=h.executeOrEnqueue(l,function(q){var r=q.getAllResources(),s=q.hasReachedEndOfArray();m(r,s);}),o=h.getUnavailableResources(n),p=c('MercuryAPIArgsSource').WEBMESSENGER;if(o.length)this.$MercurySearchThreadResults4({client:p,query:l,offset:0,limit:i+1});return n;}};k.prototype.isExhausted=function(l){'use strict';var m=h.getResource(l);return m?m.hasReachedEndOfArray():false;};k.prototype.getCachedThreadlist=function(l){'use strict';var m=h.getResource(l);return m?m.getAllResources():null;};k.prototype.cacheThreadlist=function(l,m){'use strict';h.getResource(l);var n=new (c('RangedCallbackManager'))();n.addResourcesWithoutSorting(m,0);n.setReachedEndOfArray();h.setResource(l,n);};k.prototype.getMoreThreadlist=function(l,m){'use strict';if(l){var n=h.getResource(l);if(n){var o=n.getCurrentArraySize(),p=j,q=n.executeOrEnqueue(0,o+p,function(){var s=n.getAllResources(),t=n.hasReachedEndOfArray();m(s,t);}),r=n.getUnavailableResources(q);if(r.length)this.$MercurySearchThreadResults4({query:l,offset:o,limit:p+1});return q;}}};k.prototype.handleUpdate=function(l){'use strict';if(l.mercury_payload)this.$MercurySearchThreadResults2.handleUpdate(l.mercury_payload);var m=l.search_threads||{};for(var n in m){var o=m[n]||[],p=o.map(function(r){return this.$MercurySearchThreadResults3.getClientIDFromServerIDNow(r);}.bind(this)),q=h.getResource(n);if(q){this.$MercurySearchThreadResults5(q,p,j+1);}else{q=new (c('RangedCallbackManager'))();this.$MercurySearchThreadResults5(q,p,i+1);h.setResource(n,q);}}};k.prototype.unsubscribe=function(l,m){'use strict';if(m){var n=h.getResource(m);if(n){n.unsubscribe(l);}else h.unsubscribe(l);}};k.prototype.setInitialCount=function(l){'use strict';i=l;};k.prototype.$MercurySearchThreadResults5=function(l,m,n){'use strict';var o=l.getCurrentArraySize(),p=m.length<n;if(!p)m.pop();l.addResourcesWithoutSorting(m,o);if(p)l.setReachedEndOfArray();};k.prototype.$MercurySearchThreadResults4=function(l){'use strict';l.client=c('MercuryAPIArgsSource').WEBMESSENGER;l.index='fbid';c('MercuryServerDispatcher').trySend('/ajax/mercury/search_threads.php',l,null,this.$MercurySearchThreadResults1);};Object.assign(k,c('MercurySingletonMixin'));f.exports=k;}),null);
__d('MercurySearchThreadsStrategy',['WebMessengerConstants','MercuryLocalThreadResults','MercurySingletonMixin','MercurySearchThreadResults','createObjectFrom'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=null,i=null,j=c('WebMessengerConstants').SEARCH_THREAD_DELAY;function k(l){'use strict';this.$MercurySearchThreadsStrategy1=l;this.$MercurySearchThreadsStrategy2=c('MercuryLocalThreadResults').getForFBID(this.$MercurySearchThreadsStrategy1);this.$MercurySearchThreadsStrategy3=c('MercurySearchThreadResults').getForFBID(this.$MercurySearchThreadsStrategy1);}k.prototype.clearTimer=function(){'use strict';h=null;clearTimeout(i);i=null;};k.prototype.search=function(l,m,n,o){'use strict';if(l!=h){h=l;clearTimeout(i);i=null;}var p=this.$MercurySearchThreadsStrategy2.findMatchingThreads(l),q=this.$MercurySearchThreadsStrategy3.getCachedThreadlist(l);if(q){var r=this.$MercurySearchThreadsStrategy4(p,q);m(r);n([],this.$MercurySearchThreadsStrategy3.isExhausted(l));o(null,l);return;}var s=this.$MercurySearchThreadsStrategy5(l),t=this.$MercurySearchThreadsStrategy4(p,s.thread_ids);if(s.from_exhausted_remote_results){this.$MercurySearchThreadsStrategy3.cacheThreadlist(l,t);m(t);n([],true);o(null,l);return;}m(t);i=setTimeout(function(){var u=this.$MercurySearchThreadsStrategy3.getThreadlist(l,n);o(u,l);}.bind(this),j);};k.prototype.$MercurySearchThreadsStrategy5=function(l){'use strict';var m='',n=[];for(var o=l.length-1;o>0;o--){var p=l.slice(0,o),q=this.$MercurySearchThreadsStrategy3.getCachedThreadlist(p);if(!q)continue;if(this.$MercurySearchThreadsStrategy3.isExhausted(p)){return {from_exhausted_remote_results:true,thread_ids:this.$MercurySearchThreadsStrategy2.findMatchingThreadsFromIds(l,q)};}else if(m.length===0){m=p;n=this.$MercurySearchThreadsStrategy2.findMatchingThreadsFromIds(l,q);}}return {from_exhausted_remote_results:false,thread_ids:n};};k.prototype.$MercurySearchThreadsStrategy4=function(l,m){'use strict';return Object.keys(babelHelpers['extends']({},c('createObjectFrom')(l),c('createObjectFrom')(m)));};Object.assign(k,c('MercurySingletonMixin'));f.exports=k;}),null);
__d('WebMessengerMasterViewSearchInputControl',['cx','Event','CSS','DOM','Input','Keys','MercurySearchThreadsStrategy','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerSubscriptionsHandler','WebMessengerEvents','containsNode','ge'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercurySearchThreadsStrategy').get();function j(r,s){'use strict';this._manager=r;this._rootElement=s;c('DOM').empty(this._rootElement);var t=c('WebMessengerTemplates')[':fb:web-messenger:master-view:search-input'].build();c('DOM').replace(this._rootElement,t.getRoot());this._searchBox=t.getRoot();this._searchInput=t.getNode('searchInput');this._searchClear=t.getNode('searchClear');this._searchButton=c('DOM').find(this._searchBox,'button');this._state=null;this._query=null;this._folder=null;this._threadID=null;this._ariaOwns=this._searchInput.getAttribute('aria-owns');c('WebMessengerSubscriptionsHandler').addSubscriptions(c('WebMessengerEvents').subscribe(c('WebMessengerEvents').UPDATE_SELECTION,q.bind(null,this)),c('Event').listen(this._searchButton,'click',function(){var u=c('Input').getValue(this._searchInput);if(u)o(this,u);}.bind(this)),c('Event').listen(this._searchClear,'click',n.bind(null,this)),c('Event').listen(this._searchInput,'keyup',function(event){var u=c('Input').getValue(this._searchInput);if(event.keyCode==c('Keys').ESC){n(this);}else if(event.keyCode==c('Keys').RETURN&&u){c('WebMessengerShortcuts').openSearchThread();}else if(u){p(this,u);}else if(u!==c('WebMessengerStateManager').getCurrentStateData().query){n(this);this.focus();}return false;}.bind(this)),c('Event').listen(this._searchInput,'focus',function(u){this._focused=true;}.bind(this)),c('Event').listen(this._searchInput,'blur',function(u){this._focused=false;}.bind(this)));}j.prototype.updateView=function(){'use strict';var r=l(this);k(this);if(r)m(this);};j.prototype.focusAndSelectSearch=function(){'use strict';o(this,c('Input').getValue(this._searchInput));this._manager.scrollToTop(false);this.focus();this._searchInput.select();};j.prototype.focus=function(){'use strict';setTimeout(function(){if(!this._focused){this._searchInput.focus();this._searchInput.value=this._searchInput.value;}}.bind(this),0);};j.prototype.destroy=function(){'use strict';};function k(r){var s=c('WebMessengerStateManager').getCurrentStateData();r._state=c('WebMessengerStateManager').getCurrentMasterState();r._folder=s.folder;if(r._state!=c('WebMessengerStateConstants').MASTER.SEARCH){r._query=null;}else r._query=s.query;}function l(r){if(!r._state||!r._folder)return true;var s=c('WebMessengerStateManager').getCurrentMasterState(),t=c('WebMessengerStateManager').getCurrentStateData();if(r._folder!=t.folder)return true;if(s!=r._state)return true;if(s==c('WebMessengerStateConstants').MASTER.SEARCH&&r._query!=t.query)return true;return false;}function m(r){if(r._state==c('WebMessengerStateConstants').MASTER.SEARCH){var s=r._query||'';if(c('Input').getValue(r._searchInput)!=s)c('Input').setValue(r._searchInput,s);r.focus();}else{c('Input').reset(r._searchInput);r._searchInput.blur();}c('CSS').conditionClass(r._searchBox,"_47",!c('Input').isEmpty(r._searchInput));}function n(r){i.clearTimer();var s=c('WebMessengerStateManager').getCurrentStateData();s.no_uri=true;delete s.query;c('WebMessengerStateManager').updateMasterState(c('WebMessengerStateConstants').MASTER.RECENT_THREADS,s);}function o(r,s){var t=c('WebMessengerStateManager').getCurrentMasterState();if(t!=c('WebMessengerStateConstants').MASTER.SEARCH)r._threadID=c('WebMessengerStateManager').getCurrentStateData().thread_id;if(s)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET,{query:s,message_query:s});}function p(r,s){var t=c('WebMessengerStateManager').getCurrentStateData();if(s!==t.query){var u=c('WebMessengerStateManager').getCurrentMasterState();if(u!=c('WebMessengerStateConstants').MASTER.SEARCH)r._threadID=t.thread_id;if(s)c('WebMessengerStateManager').updateMasterState(c('WebMessengerStateConstants').MASTER.SEARCH,{all_people_query:t.all_people_query,message_query:t.message_query,message_id:t.message_id,query:s,thread_id:t.thread_id});}}function q(r,s,t){if(c('containsNode')(c('ge')(r._ariaOwns),c('ge')(t)))r._searchInput.setAttribute('aria-activedescendant',t);}f.exports=j;}),null);
__d('MercurySearchThreadResultOrderer',['MercurySingletonMixin','MessagingTag','MercuryThreads','createObjectFrom'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(l){'use strict';this.$MercurySearchThreadResultOrderer1=l;this.$MercurySearchThreadResultOrderer2=c('MercuryThreads').getForFBID(l);}h.prototype.separateCanonicalThreadsInFolder=function(l,m){'use strict';var n=[],o=[];l.forEach(function(p){var q=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(p);if(q.folder===m&&q.is_canonical){n.push(p);}else o.push(p);}.bind(this));return {canonical_in_folder:n.sort(function(p,q){return this.$MercurySearchThreadResultOrderer3(p,q);}.bind(this)),remaining:o};};h.prototype.filterThreadsInFolder=function(l,m){'use strict';var n=[];l.forEach(function(o){var p=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(o);if(p.folder===m&&p.is_archived===false){n.push(o);}else if(m===c('MessagingTag').ACTION_ARCHIVED&&p.is_archived===true)n.push(o);}.bind(this));return n;};h.prototype.orderResults=function(l,m,n,o){'use strict';var p=k(m,n),q=p.sort(this.$MercurySearchThreadResultOrderer4.bind(this,o));return k(l,q);};h.prototype.$MercurySearchThreadResultOrderer4=function(l,m,n){'use strict';var o=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(m),p=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(n),q=i(o),r=i(p);if(q!==r)return j(q,l)>j(r,l)?-1:1;if(o.is_canonical!==p.is_canonical)return o.is_canonical?-1:1;return this.$MercurySearchThreadResultOrderer3(m,n);};h.prototype.$MercurySearchThreadResultOrderer3=function(l,m){'use strict';var n=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(l),o=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(m);return n.timestamp>o.timestamp?-1:1;};function i(l){return l.is_archived?c('MessagingTag').ACTION_ARCHIVED:l.folder;}function j(l,m){if(l===m)return 5;var n={};n[c('MessagingTag').INBOX]=4;n[c('MessagingTag').ACTION_ARCHIVED]=3;n[c('MessagingTag').OTHER]=2;n[c('MessagingTag').SPAM]=1;return n[l];}function k(l,m){var n=c('createObjectFrom')(l),o=m.filter(function(p){return !(p in n);});return l.concat(o);}Object.assign(h,c('MercurySingletonMixin'));f.exports=h;}),null);
__d('WebMessengerMasterViewSearchThreadsControl',['csx','cx','fbt','Event','CSS','DOM','MercuryFolders','MercurySearchThreadResultOrderer','MercurySearchThreadResults','MercurySearchThreadsStrategy','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerThreadlistRenderer','WebMessengerEvents','WebMessengerMercury','WebMessengerSubscriptionsHandler','createObjectFrom','ge','getElementText'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercurySearchThreadResultOrderer').get(),l=c('MercurySearchThreadResults').get(),m=c('MercurySearchThreadsStrategy').get(),n='search:',o='search-indicator';function p(la,ma,na,oa){'use strict';this._manager=la;this._rootElement=ma;this._noMessagesIndicator=oa;this._orderedThreadlist=c('WebMessengerMercury').getOrderedThreadlist();this._threadInformer=c('WebMessengerMercury').getThreadInformer();this._threads=c('WebMessengerMercury').getThreads();c('DOM').empty(this._rootElement);var pa=c('WebMessengerTemplates')[':fb:web-messenger:thread-search'].build();c('DOM').setContent(this._rootElement,pa.getRoot());this._loadingSpinner=pa.getNode('loadingSpinner');this._threadlistRows=pa.getNode('threadlistRows');this._loadMoreButton=pa.getNode('loadMoreButton');this._loadMoreLink=pa.getNode('loadMoreLink');var qa=c('WebMessengerTemplates')[':fb:web-messenger:master-view-snippets-link'].build();this._threadSearchResultDescription=qa.getNode('threadSearchResultDescription');this._searchMessagesIndicator=qa.getRoot();this._searchMessagesIndicator.setAttribute('id',n+o);c('DOM').replace(na,this._searchMessagesIndicator);this._snippetSearchLink=qa.getNode('snippetSearchLink');this._snippetSearchLinkText=qa.getNode('snippetSearchLinkText');this._active=false;this._detailState=null;this._query=null;this._folder=null;this._selection=null;this._keyboardSelection=null;this._threadIDs=[];this._oldestTimestamps=r(this);this._namesChangedSinceLastRedraw=false;this._remoteResultsCompleted=true;c('WebMessengerSubscriptionsHandler').addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(ra,sa){da(this,c('createObjectFrom')(sa));}.bind(this)),this._threadInformer.subscribe('messages-received',function(){this._namesChangedSinceLastRedraw=true;}.bind(this)),c('Event').listen(this._loadMoreLink,'click',function(){ca(this);}.bind(this)),c('Event').listen(this._snippetSearchLink,'click',function(){this.updateKeyboardSelection(o);ka(this);}.bind(this)));}p.prototype.updateView=function(){'use strict';this._active=true;c('CSS').show(this._rootElement);c('CSS').hide(this._loadingSpinner);var la=s(this),ma=t(this),na=this._folder,oa=this._query,pa=this._selection;u(this);if(ma||la){var qa=this._keyboardSelection;switch(this._detailState){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:this._keyboardSelection=this._selection;break;case c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:this._keyboardSelection=o;}v(this,qa);}if(la){aa(this);}else{w(this,false);ba(this);}};p.prototype.hideView=function(){'use strict';this._active=false;c('CSS').hide(this._rootElement);ea(this,false);ba(this);};p.prototype.openSearchThread=function(la){'use strict';if(la==o){ka(this);}else c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{query:this._query,thread_id:la});};p.prototype.updateKeyboardSelection=function(la){'use strict';var ma=this._keyboardSelection;this._keyboardSelection=la;v(this,ma);};p.prototype.destroy=function(){'use strict';q(this);};function q(la){la._searchThreadsSubscription&&l.unsubscribe(la._searchThreadsSubscription.subscriber_id,la._searchThreadsSubscription.query);la._searchThreadsSubscription=null;}function r(la){var ma={};c('MercuryFolders').getSupportedFolders().forEach(function(na){var oa=la._orderedThreadlist.getThreadlistUntilTimestamp(0,na);ma[na]=oa.length>0?la._threads.getThreadMetaNow(oa[oa.length-1]).timestamp:Infinity;}.bind(this));return ma;}function s(la){var ma=la._namesChangedSinceLastRedraw;la._namesChangedSinceLastRedraw=false;if(ma)return true;if(!la._remoteResultsCompleted)return true;var na=r(la),oa=la._oldestTimestamps;la._oldestTimestamps=na;var pa=c('WebMessengerStateManager').getCurrentStateData();if(la._query!==pa.query||la._folder!==pa.folder)return true;for(var qa in oa)if(oa[qa]>na[qa])return true;return false;}function t(la){var ma=c('WebMessengerStateManager').getCurrentStateData();if(la._selection!=ma.thread_id)return true;return false;}function u(la){var ma=c('WebMessengerStateManager').getCurrentStateData();la._detailState=c('WebMessengerStateManager').getCurrentDetailState();la._query=ma.query;la._folder=ma.folder;la._selection=ma.thread_id;}function v(la,ma){var na=c('ge')(ia(ma));if(na){c('CSS').removeClass(na,"_kv");na.removeAttribute('aria-selected');}var oa=c('ge')(ia(la._keyboardSelection));if(oa){c('CSS').addClass(oa,"_kv");oa.setAttribute('aria-selected',true);}c('WebMessengerEvents').updateSelection(oa&&oa.id);}function w(la,ma){if(la._keyboardSelection&&la._keyboardSelection!=o&&la._threadIDs.indexOf(la._keyboardSelection)<0)la._keyboardSelection=null;if(!la._keyboardSelection)if(la._threadIDs.length){la._keyboardSelection=la._threadIDs[0];}else if(!ma){la._keyboardSelection=o;v(la);}var na=la._threadIDs.slice(0);na.push(o);if(la._active)c('WebMessengerShortcuts').updateThreadlistIndex(la,na.map(ia),ia(la._keyboardSelection));}function x(la){var ma=c('DOM').scry(la._threadlistRows,"._l5");ma.filter(function(na){return c('getElementText')(na)!==c('WebMessengerStateManager').getCurrentStateData().folder;}).forEach(c('CSS').show.bind(c('CSS')));}function y(la){var ma=c('DOM').scry(la._threadlistRows,"._l5");ma.forEach(c('CSS').hide.bind(c('CSS')));}function z(la){x(la);la._manager.draw();}function aa(la){c('CSS').show(la._loadingSpinner);ea(la,false);c('CSS').hide(la._threadlistRows);c('CSS').hide(la._loadMoreButton);y(la);q(la);if(la._query){var ma=[],na=[];la._remoteResultsCompleted=false;m.search(la._query,function(oa){var pa=k.separateCanonicalThreadsInFolder(oa,c('WebMessengerStateManager').getCurrentStateData().folder);ma=pa.canonical_in_folder;na=pa.remaining;ja(la);c('CSS').show(la._threadlistRows);ga(la,ma);z(la);},function(oa,pa){la._remoteResultsCompleted=true;var qa=k.orderResults(ma,na,oa,c('WebMessengerStateManager').getCurrentStateData().folder);if(qa.length>0){c('CSS').conditionShow(la._loadMoreButton,!pa);ha(la,qa);}else fa(la);c('CSS').hide(la._loadingSpinner);z(la);},function(oa,pa){if(oa)la._searchThreadsSubscription={subscriber_id:oa,query:pa};});}else{m.clearTimer();c('CSS').hide(la._loadingSpinner);c('DOM').empty(la._threadlistRows);c('CSS').show(la._threadlistRows);la._threadIDs=[];}ba(la);}function ba(la){var ma=!!la._query&&la._active,na=ma^c('CSS').shown(la._searchMessagesIndicator);c('CSS').conditionShow(la._searchMessagesIndicator,ma);la._manager.sizeToFit(ma);na&&la._manager.draw();}function ca(la){q(la);c('CSS').addClass(la._loadMoreButton,'async_saving');var ma=l.getMoreThreadlist(la._query,function(na,oa){c('CSS').removeClass(la._loadMoreButton,'async_saving');c('CSS').conditionShow(la._loadMoreButton,!oa);ha(la,na);la._manager.poke();});if(ma)la._searchThreadsSubscription={subscriber_id:ma,query:la._query};}function da(la,ma){if(la._threadIDs.length){c('WebMessengerThreadlistRenderer').renderThreadsFromIDs(la._threadlistRows,la._threadIDs,la._keyboardSelection,ia,ma,c('WebMessengerStateConstants').MASTER.SEARCH);la._manager.poke();}}function ea(la,ma){ma=ma&&la._active;c('CSS').conditionClass(la._searchMessagesIndicator,"_33x",ma!==false);c('CSS').conditionShow(la._noMessagesIndicator,ma!==false);}function fa(la){la._threadIDs=[];w(la,false);var ma=j._("\u6c92\u6709\u4eba\u6216\u5c0d\u8a71\u540d\u7a31\u70ba{query}",[j.param('query',la._query)]),na=c('DOM').create('div',{},ma);c('DOM').setContent(la._noMessagesIndicator,na);ea(la,true);}function ga(la,ma){ha(la,ma,true);}function ha(la,ma,na){la._threadIDs=ma;w(la,na);c('WebMessengerThreadlistRenderer').renderThreadsFromIDs(la._threadlistRows,ma,la._keyboardSelection,ia,null,c('WebMessengerStateConstants').MASTER.SEARCH);c('WebMessengerEvents').updateSelection(la._keyboardSelection);if(la._keyboardSelection==o)v(la);}function ia(la){if(la)return n+la;return null;}function ja(la){var ma=j._("\u986f\u793a\u540d\u7a31\u7684\u641c\u5c0b\u7d50\u679c\uff1a{query}",[j.param('query',la._query)]);c('DOM').setContent(la._threadSearchResultDescription,ma);}function ka(la){if(la._query){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET,{query:la._query,message_query:la._query});c('WebMessengerEvents').focusSearch();}}f.exports=p;}),null);
__d('MessagingFilteringNux',['Arbiter','AsyncRequest','LayerDestroyOnHide','LayerHideOnTransition','isWebMessengerURI'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=null,i,j={ACCEPTED_EVENT:'filtering/accepted',DIALOG_REGISTERED_EVENT:'filtering/dialog-registered',tryShow:function k(l){c('Arbiter').subscribe(j.DIALOG_REGISTERED_EVENT,function(){if(!h)return;h.setContext(l);h.show();h=null;},c('Arbiter').SUBSCRIBE_ALL);},registerDialog:function k(l){h=l.disableBehavior(c('LayerDestroyOnHide')).disableBehavior(c('LayerHideOnTransition'));i=c('Arbiter').subscribe('page_transition',function(m,n){if(!c('isWebMessengerURI')(n.uri)){l&&l.destroy();i.unsubscribe();}},c('Arbiter').SUBSCRIBE_NEW);if(l)l.subscribe('confirm',function(){new (c('AsyncRequest'))('/ajax/web_messenger/dismiss_filtering_nux.php').send();l.hide();c('Arbiter').inform(j.ACCEPTED_EVENT,{});});c('Arbiter').inform(j.DIALOG_REGISTERED_EVENT,{},c('Arbiter').BEHAVIOR_PERSISTENT);}};f.exports=j;}),null);
__d('WebMessengerAuxMenu',['SelectableMenu','MenuSelectableItem','MenuTheme','PopoverMenuOverlappingBorder','Popover','PopoverMenu'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){'use strict';this._menu=new (c('SelectableMenu'))([],{className:j,theme:c('MenuTheme')});var k=new (c('Popover'))(i.parentNode,i,null,{alignh:'right'});new (c('PopoverMenu'))(k,i,this._menu,[c('PopoverMenuOverlappingBorder')]);}h.prototype.addOption=function(i,j){'use strict';var k=new (c('MenuSelectableItem'))({markup:i,title:''});k.setOnClickHandler(j);this._menu.addItem(k);return k;};h.prototype.destroy=function(){'use strict';};f.exports=h;}),null);
__d('WebMessengerMenuFolderControl',['csx','cx','WebMessengerAuxMenu','CSS','Parent','WebMessengerTemplates','Toggler','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k;function l(n){return c('Parent').bySelector(n,"._282");}function m(n,o,p){'use strict';var q=!j||j!=o;j=o;this._template=c('WebMessengerTemplates')[':fb:web-messenger:master-view:tab-bar:menu-option'].build();this._template.setNodeContent('folderLabel',n);if(!k||q){k=new (c('WebMessengerAuxMenu'))(j,"_1j");c('CSS').show(l(j));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Toggler').subscribe(['show','hide'],function(r,s){var t=s.getActive(),u=t&&c('Parent').bySelector(t,"._282");if(u)c('CSS').conditionClass(u,"_50p_",r==='show');}));}this._menuItem=k.addOption(this._template.getRoot(),p);this._menuItem.getRoot();}m.prototype.getCountBadge=function(){'use strict';return this._template.getNode('count');};m.prototype.setSelected=function(n){'use strict';c('CSS').conditionClass(l(j),'selectedFolder',n);if(n){this._menuItem.select();}else this._menuItem.deselect();};m.prototype.destroy=function(){'use strict';k&&k.destroy();};f.exports=m;}),null);
__d('WebMessengerTabbedFolderControl',['Event','CSS','WebMessengerTemplates'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l){'use strict';this._template=c('WebMessengerTemplates')[':fb:web-messenger:master-view:tab-bar:folder'].build();this._template.setNodeContent('folderLabel',i);this._listener=c('Event').listen(this._template.getNode('link'),'click',k);if(l)this._countListener=c('Event').listen(this._template.getNode('count'),'click',l);j.push(this._template.getRoot());}h.prototype.getCountBadge=function(){'use strict';return this._template.getNode('count');};h.prototype.setSelected=function(i){'use strict';c('CSS').conditionClass(this._template.getRoot(),'selectedFolder',i);};h.prototype.getElement=function(){'use strict';this._template.getRoot();};h.prototype.destroy=function(){'use strict';this._listener.remove();this._countListener&&this._countListener.remove();};f.exports=h;}),null);
__d('WebMessengerMasterViewTabBarControl',['csx','fbt','JSXDOM','Arbiter','CSS','DOM','Event','Ellipsizer','WebMessengerMenuFolderControl','MercuryFilters','MercuryFolders','MercuryThreadlistConstants','MessagingFilteringNux','MessagingTag','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTabbedFolderControl','WebMessengerTemplates','WebMessengerEvents','WebMessengerSubscriptionsHandler','WebMessengerMercury'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(q,r,s){'use strict';this._manager=q;this._rootElement=r;this._rootTopContentElement=s;this._threadInformer=c('WebMessengerMercury').getThreadInformer();this._unreadState=c('WebMessengerMercury').getUnreadState();c('DOM').empty(this._rootElement);var t=c('WebMessengerTemplates')[':fb:web-messenger:master-view:tab-bar'].build(),u=c('WebMessengerTemplates')[':fb:web-messenger:master-view:top-content'].build();c('DOM').setContent(this._rootElement,t.getRoot());c('DOM').setContent(this._rootTopContentElement,u.getRoot());this._tabList=t.getRoot();this._moreMenu=t.getNode('moreMenu');this._topContentCont=u.getRoot();this._topContent=u.getNode('masterViewTopContentHolder');this._closeButton=u.getNode('masterViewTopContentCloseButton');this._closeButtonCont=u.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=c('MercuryFolders').getSupportedFolders();this._foldersToHeader={};this._filters=c('MercuryFilters').getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=c('JSXDOM').a({href:"#"},i._("\u5168\u90e8\u6a19\u793a\u70ba\u5df2\u8b80\u53d6"));this._unreadMarkAllRead=c('JSXDOM').a({href:"#"},i._("\u5168\u90e8\u6a19\u793a\u70ba\u5df2\u8b80\u53d6"));var v=[];this._filters.forEach(function(y){var z=o.bind(null,this,c('MessagingTag').INBOX,y);switch(y){case c('MessagingTag').UNREAD:this._filtersToHeader[y]=this._filtersToHeader[y]||new (c('WebMessengerMenuFolderControl'))(i._("\u672a\u8b80\u53d6"),this._moreMenu,z);break;}}.bind(this));this._folders.forEach(function(y){var z=o.bind(null,this,y,c('MercuryFilters').ALL),aa=o.bind(null,this,y,c('MessagingTag').UNREAD);switch(y){case c('MessagingTag').INBOX:var ba=i._("\u6700\u65b0\u8a0a\u606f");this._foldersToHeader[y]=this._foldersToHeader[y]||new (c('WebMessengerTabbedFolderControl'))(ba,v,z,aa);break;case c('MessagingTag').OTHER:this._foldersToHeader[y]=this._foldersToHeader[y]||new (c('WebMessengerMenuFolderControl'))(i._("\u5df2\u904e\u6ffe"),this._moreMenu,z);break;case c('MessagingTag').ACTION_ARCHIVED:this._foldersToHeader[y]=this._foldersToHeader[y]||new (c('WebMessengerMenuFolderControl'))(i._("\u5b58\u6a94\u8a0a\u606f"),this._moreMenu,z);break;case c('MessagingTag').SPAM:break;case c('MessagingTag').PENDING:this._foldersToHeader[y]=this._foldersToHeader[y]||new (c('WebMessengerTabbedFolderControl'))(i._("\u8a0a\u606f\u8981\u6c42"),v,z);break;}}.bind(this));c('DOM').prependContent(this._tabList,v);var w=c('DOM').scry(this._tabList,"._6xt");w.push(t.getNode('moreMenuLabel'));this._ellipsizer=new (c('Ellipsizer'))(w);k(this);var x=o.bind(null,this,c('MessagingTag').INBOX,c('MercuryFilters').ALL);c('Arbiter').subscribe(c('MessagingFilteringNux').ACCEPTED_EVENT,n.bind(null,this));c('WebMessengerSubscriptionsHandler').addSubscriptions(this._threadInformer.subscribe('unread-updated',p.bind(null,this)),c('Event').listen(this._otherMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(c('MessagingTag').OTHER);}.bind(this)),c('Event').listen(this._unreadMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(c('MessagingTag').INBOX);}.bind(this)),c('Event').listen(this._closeButton,'click',x));}j.prototype.updateView=function(){'use strict';var q=m(this);l(this);if(q)n(this);k(this);};j.prototype.getOtherFolderLabel=function(){'use strict';var q=c('MessagingTag').OTHER,r=this._foldersToHeader[q];if(!r||!r._template)return null;return r._template.getNode('folderLabel');};j.prototype.destroy=function(){'use strict';for(var q in this._foldersToHeader)this._foldersToHeader[q]&&this._foldersToHeader[q].destroy();for(var r in this._filtersToHeader)this._filtersToHeader[r]&&this._filtersToHeader[r].destroy();};function k(q){var r=85;c('DOM').scry(q._tabList,"._1r").forEach(function(s){r+=s.offsetWidth;});q._ellipsizer.confineWithin(q._rootElement.offsetWidth-r,1.3);}function l(q){var r=c('WebMessengerStateManager').getCurrentStateData();q._state=c('WebMessengerStateManager').getCurrentMasterState();q._folder=r.folder;q._filter=r.filter;q._query=r.query;}function m(q){if(!q._state||!q._folder)return true;var r=c('WebMessengerStateManager').getCurrentStateData();if(q._folder!=r.folder)return true;if(q._filter!=r.filter)return true;return false;}function n(q){var r=false,s;q._folders.forEach(function(t){var u=q._filter==c('MessagingTag').UNREAD,v=t==q._folder&&(q._filter==c('MercuryFilters').ALL||u),w,x;switch(t){case c('MessagingTag').INBOX:if(u){var y=c('JSXDOM').strong(null,i._("\u672a\u8b80\u53d6")),z=c('JSXDOM').strong(null,i._("\u6536\u4ef6\u5323")),aa=i._("\u5728{inbox}\u6709{unread}\u8a0a\u606f",[i.param('unread',y),i.param('inbox',z)]);w=c('JSXDOM').div(null,aa,' \u00b7 ',q._unreadMarkAllRead);x=true;}break;case c('MessagingTag').OTHER:break;}if(v){s=t;c('CSS').conditionShow(q._closeButtonCont,x);}else q._foldersToHeader[t].setSelected(false);if(v&&w){r=true;c('DOM').setContent(q._topContent,w);}});q._filters.forEach(function(t){var u=q._folder==c('MessagingTag').INBOX&&t==q._filter;q._filtersToHeader[t].setSelected(u);});s&&q._foldersToHeader[s].setSelected(true);c('CSS').conditionShow(q._topContentCont,r);p(q);q._manager.draw();}function o(q,r,s){var t=q._state==c('WebMessengerStateConstants').MASTER.SEARCH;if(t||q._folder!=r||q._filter!=s){var u=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData()),v=c('WebMessengerStateManager').getCurrentDetailState();if(v!==c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET&&v!==c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT)delete u.query;c('WebMessengerStateManager').updateMasterState(c('WebMessengerStateConstants').MASTER.RECENT_THREADS,Object.assign(u,{folder:r,filter:s}));}c('WebMessengerEvents').focusComposer();return false;}function p(q){for(var r in q._foldersToHeader){if(r==c('MessagingTag').ACTION_ARCHIVED)continue;var s=q._unreadState.exceedsMaxCount(r)?c('MercuryThreadlistConstants').MAX_UNREAD_COUNT+'+':q._unreadState.getUnreadCount(r),t=[q._foldersToHeader[r].getCountBadge()];if(r==c('MessagingTag').INBOX)q._filters.forEach(function(u){t.push(q._filtersToHeader[u].getCountBadge());});t.forEach(function(u){if(s)c('DOM').setContent(u,i._("\uff08{unread_count}\uff09",[i.param('unread_count',s)]));c('CSS').conditionShow(u,s);});}k(q);}f.exports=j;}),null);
__d('WebMessengerMasterViewControlManager',['ArbiterMixin','DOM','WebMessengerFlexibleScrollArea','WebMessengerMasterViewTabBarControl','WebMessengerMasterViewSearchInputControl','WebMessengerMasterViewRecentThreadsControl','WebMessengerMasterViewSearchThreadsControl','WebMessengerStateManager','WebMessengerStateConstants','Style','WebMessengerTemplates','WebMessengerEvents','WebMessengerSubscriptionsHandler','mixin'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);this._rootElement=k;c('DOM').empty(this._rootElement);var l=c('WebMessengerTemplates')[':fb:web-messenger:master-view'].build();c('DOM').setContent(this._rootElement,l.getRoot());this._tabBarControl=new (c('WebMessengerMasterViewTabBarControl'))(this,l.getNode('masterViewTabBar'),l.getNode('masterViewTopContent'));this._searchInputControl=new (c('WebMessengerMasterViewSearchInputControl'))(this,l.getNode('masterViewSearchInput'));this._searchThreadsControl=new (c('WebMessengerMasterViewSearchThreadsControl'))(this,l.getNode('masterViewSearchThreads'),l.getNode('searchMessagesIndicator'),l.getNode('noMessages'));this._threadlistRowsWrapper=l.getNode('threadlistRowsWrapper');this._flexArea&&this._flexArea.destroy();var m={fade:true,persistent:true};this._flexArea=new (c('WebMessengerFlexibleScrollArea'))(this._threadlistRowsWrapper,m).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(40).draw();this._recentThreadsControl=new (c('WebMessengerMasterViewRecentThreadsControl'))(this,l.getNode('masterViewRecentThreads'),l.getNode('masterInfoBox'),l.getNode('masterViewTabBar'));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('WebMessengerEvents').subscribe(c('WebMessengerEvents').FOCUS_AND_SELECT_SEARCH,this._searchInputControl.focusAndSelectSearch.bind(this._searchInputControl)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').FOCUS_SEARCH,this._searchInputControl.focus.bind(this._searchInputControl)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').MASTER_DOM_CHANGED,function(){this._tabBarControl.updateView();this._flexArea&&this._flexArea.draw();}.bind(this)),c('WebMessengerStateManager').subscribe(c('WebMessengerStateConstants').STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._resizeNodes=[this._rootElement,this._threadlistRowsWrapper,c('DOM').find(this._threadlistRowsWrapper,'div.uiScrollableAreaBody')];}j.prototype.updateOnStateChange=function(){'use strict';var k=c('WebMessengerStateManager').getCurrentMasterState();this._tabBarControl.updateView();this._searchInputControl.updateView();switch(k){case c('WebMessengerStateConstants').MASTER.RECENT_THREADS:this._searchThreadsControl.hideView();this._recentThreadsControl.updateView();break;case c('WebMessengerStateConstants').MASTER.SEARCH:this._recentThreadsControl.hideView();this._searchThreadsControl.updateView();break;}};j.prototype.scrollIntoView=function(k,l){'use strict';this._flexArea&&this._flexArea.scrollIntoView(k,l);};j.prototype.scrollToBottom=function(k){'use strict';this._flexArea&&this._flexArea.scrollToBottom(k);};j.prototype.scrollToTop=function(k){'use strict';this._flexArea&&this._flexArea.scrollToTop(k);};j.prototype.isScrolledToTop=function(){'use strict';return this._flexArea&&this._flexArea.isScrolledToTop();};j.prototype.getScrollTop=function(){'use strict';return this._flexArea.getScrollableArea().getScrollTop();};j.prototype.draw=function(){'use strict';this._flexArea&&this._flexArea.draw();};j.prototype.poke=function(){'use strict';this._flexArea&&this._flexArea.poke();};j.prototype.sizeToFit=function(k){'use strict';this._flexArea&&this._flexArea.setSizeToFit(k);};j.prototype.addScrollCallback=function(k){'use strict';this._flexArea&&this._flexArea.addScrollCallback(k);};j.prototype.forceFireScrollCallbacks=function(){'use strict';this._flexArea&&this._flexArea._onScroll();};j.prototype.getFlexAreaElement=function(){'use strict';return this._flexArea.flexArea;};j.prototype.resizeTo=function(k){'use strict';if(k!==null){k=k.toString();if(!(k.endsWith('%')||k.endsWith('px')))k=k+'px';}this._resizeNodes.forEach(function(l){c('Style').set(l,'width',k);});c('WebMessengerEvents').masterDOMChanged();};j.prototype.destroy=function(){'use strict';this._tabBarControl.destroy();this._recentThreadsControl.destroy();this._searchThreadsControl.destroy();this._flexArea.destroy();};f.exports=j;}),null);
__d('WebMessengerPageTitleRenderer',['fbt','DocumentTitle','MercuryAPIArgsSource','MercuryViewer','MercuryParticipants','WebMessengerStateConstants','WebMessengerStateManager','MercuryThreadMetadataRenderer','MercuryThreads'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreadMetadataRenderer').get(),j=c('MercuryThreads').get(),k={updateTitleForState:function n(o,p,q){this.withTitleForState(o,p,q||function(r){var s=c('WebMessengerStateManager').getCurrentDetailState(),t=c('WebMessengerStateManager').getCurrentStateData();if(o===s&&p===t)c('DocumentTitle').set(r);});},withTitleForState:function n(o,p,q){switch(o){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:l(p.thread_id,q);break;default:m(q);break;}}};function l(n,o){if(!n){m(o);return;}j.getThreadMeta(n,function(p){if(p.name){o(h._("{conversation_name} \u2500 \u8a0a\u606f",[h.param('conversation_name',p.name)]));return;}c('MercuryParticipants').getMulti(p.participants,function(q){var r=[];for(var s in q)if(q.hasOwnProperty(s))r.push(q[s]);var t=i.renderParticipantList(n,r,q[c('MercuryViewer').getID()]?p.participants.length-1:p.participants.length,{abbr_mode:true,last_separator_uses_and:true,names_renderer:function u(v){var w=[];if(v.length===1&&v[0].id===c('MercuryViewer').getID()){w.push(v[0].name);}else for(var x=0;x<v.length;x++)if(v[x].id!==c('MercuryViewer').getID())w.push(v[x].name);return w;}});o(h._("{conversation_name} \u2500 \u8a0a\u606f",[h.param('conversation_name',t)]));});},c('MercuryAPIArgsSource').WEBMESSENGER);}function m(n){n(h._("\u8a0a\u606f"));}f.exports=k;}),null);
__d('WebMessengerPageTitleControl',['WebMessengerPageTitleRenderer','WebMessengerStateManager','WebMessengerStateConstants','WebMessengerSubscriptionsHandler','WebMessengerEvents'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function i(){var j=function k(){c('WebMessengerPageTitleRenderer').updateTitleForState(c('WebMessengerStateManager').getCurrentDetailState(),c('WebMessengerStateManager').getCurrentStateData());};c('WebMessengerSubscriptionsHandler').addSubscriptions(c('WebMessengerStateManager').subscribe(c('WebMessengerStateConstants').STATE_CHANGE_EVENT,j),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').DETAIL_DOM_CHANGED,j));};f.exports=h;}),null);
__d('WebMessengerThreadMessagesAgent',['MercuryAPIArgsSource','MercuryMessages','MessagingTag','MercuryOrderedThreadlist','MercuryThreadInformer','MercuryThreads','WebMessengerConstants'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryMessages').get(),i=c('MercuryOrderedThreadlist').get(),j=c('MercuryThreadInformer').get(),k=c('MercuryThreads').get(),l=21,m=false,n='n_inbox_n_unreads',o=c('WebMessengerConstants').THREADLIST_MAX_READ_PRELOAD_NUM,p=c('WebMessengerConstants').THREADLIST_MAX_UNREAD_PRELOAD_NUM;function q(){'use strict';this._active=true;this._iterative=m;this._strategy=n;this._requestInFlight=false;this._requestIsQueued=false;this._pendingThreadIds={};this._processedThreadIds={};this._threadInformerSubscriptions=[];this._threadInformerSubscriptions.push(j.subscribe('threadlist-updated',r.bind(null,this)));}q.prototype.turnOn=function(){'use strict';this._active=true;};q.prototype.turnOff=function(){'use strict';this._active=false;};q.prototype.destroy=function(){'use strict';this._threadInformerSubscriptions.forEach(j.unsubscribe);this._threadInformerSubscriptions=[];};function r(u){if(u._active&&!u._requestIsQueued){if(u._requestInFlight){u._requestIsQueued=true;return;}var v=s(u);if(v.length){u._requestInFlight=true;if(v.length>l){v=v.slice(0,l);u._requestIsQueued=true;}}v.forEach(function(w){u._processedThreadIds[w]=true;u._pendingThreadIds[w]=true;h.getThreadMessagesRange(w,0,c('WebMessengerConstants').INITIAL_MESSAGES_LIMIT,function(){t(u,w);},null,c('MercuryAPIArgsSource').WEBMESSENGER);});}}function s(u){var v=i.getThreadlistUntilTimestamp(0,c('MessagingTag').INBOX),w=v.filter(function(ba){return !u._processedThreadIds[ba]&&!h.hasLoadedNMessages(ba,c('WebMessengerConstants').INITIAL_MESSAGES_LIMIT);});if(u._strategy===n){var x=[],y=[];for(var z=0;z<w.length;z++){var aa=k.getThreadMetaNow(w[z]);if(aa){if(aa.unread_count&&y.length<p)y.push(w[z]);if(!aa.unread_count&&x.length<o)x.push(w[z]);if(y.length>=p&&x.length>=o)break;}}w=x.concat(y);}return w;}function t(u,v){if(u._pendingThreadIds[v])delete u._pendingThreadIds[v];if(Object.keys(u._pendingThreadIds).length===0){if(!u._iterative)u._active=false;u._requestInFlight=false;if(u._requestIsQueued){u._requestIsQueued=false;r(u);}}}f.exports=q;}),null);
__d('WebMessengerApp',['cx','Arbiter','CSS','WebMessengerDetailViewControlManager','DOM','WebMessengerMasterViewControlManager','WebMessengerPageTitleControl','PageTransitions','WebMessengerPermalinks','MercuryServerPayloadPreprocessor','WebMessengerShortcuts','SnowflakePermalinkUtils','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerStateStore','MercuryThreadInformer','WebMessengerThreadMessagesAgent','URI','WebMessengerAdsControl','WebMessengerSubscriptionsHandler','WebMessengerWidthControl','WebMessengerTemplates','clickRefAction','goURI','isWebMessengerURI','MercuryDeliveryState','MercuryParticipants'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryServerPayloadPreprocessor').get(),j=c('MercuryThreadInformer').get();c('MercuryDeliveryState').get();c('MercuryParticipants');e(['FBRTCMessageHandler'],function(s){s.init();});var k,l;function m(s,t){var u=t&&t.getQueryData().hasOwnProperty('theater'),v=t&&c('SnowflakePermalinkUtils').isPermalinkURI(t);if(u){k=c('Arbiter').subscribe('PhotoSnowlift.CLOSE',n.bind(null,s),c('Arbiter').SUBSCRIBE_NEW);return false;}else if(v){l=c('Arbiter').subscribe('PhotoSnowflake.CLOSE',n.bind(null,s),c('Arbiter').SUBSCRIBE_NEW);return false;}if(!t||!c('isWebMessengerURI')(t)){r(s);return false;}c('WebMessengerPermalinks').processURI(t,function(w){if(w){var x=c('WebMessengerStateManager').getCurrentStateData();if(w.redirect){c('WebMessengerPermalinks').goNextURI(w.master_state,w.detail_state,w.data,w.replace);}else c('WebMessengerStateManager').updateStateOnURI(w.master_state,w.detail_state,w.data);c('PageTransitions').transitionComplete();s._adsControl.stateChanged(x,c('WebMessengerStateManager').getCurrentStateData());return;}r(s);c('goURI')(t);});return true;}function n(s){c('PageTransitions').registerHandler(m.bind(null,s),6);if(k){k.unsubscribe();k=null;}if(l){l.unsubscribe();l=null;}}function o(){var s=c('WebMessengerStateManager').getCurrentStateData();c('WebMessengerStateStore').setLastSeen(s.folder,s.thread_id);}function p(s,t,u,v,w,x,y,z,aa){c('WebMessengerSubscriptionsHandler').engage();n(this);c('Arbiter').inform('chat/set_does_page_occlude_tabs',true,c('Arbiter').BEHAVIOR_PERSISTENT);c('Arbiter').inform('chat/set_show_tab_unread_ui',false,c('Arbiter').BEHAVIOR_PERSISTENT);c('Arbiter').inform('chat/prefilled_messages_set',y,c('Arbiter').BEHAVIOR_PERSISTENT);var ba=new (c('WebMessengerThreadMessagesAgent'))();ba;c('WebMessengerStateManager').setStandaloneMode(x);i.handleUpdate(t);c('DOM').empty(s);var ca=c('WebMessengerTemplates')[':fb:web-messenger:page-skeleton'].build();c('DOM').setContent(s,ca.getRoot());if(c('WebMessengerStateManager').getStandaloneMode())c('CSS').addClass(document.body,"_k0_");c('WebMessengerShortcuts').registerGeneralShortcuts();this._masterViewManager=new (c('WebMessengerMasterViewControlManager'))(ca.getNode('masterView'));this._detailViewManager=new (c('WebMessengerDetailViewControlManager'))(ca.getNode('detailView'));this._pageTitleControl=new (c('WebMessengerPageTitleControl'))();v&&c('DOM').prependContent(ca.getRoot(),v);if(c('WebMessengerStateManager').getStandaloneMode()){this._widthControl=null;this._masterViewManager.resizeTo(null);this._detailViewManager.resizeTo(null);}else this._widthControl=new (c('WebMessengerWidthControl'))(this._masterViewManager.resizeTo.bind(this._masterViewManager),this._detailViewManager.resizeTo.bind(this._detailViewManager),w);this._adsControl=c('WebMessengerAdsControl').init(z,aa);var da=u?new (c('URI'))(u):c('WebMessengerPermalinks').getDefaultURI();m(this,da);c('clickRefAction')('web_messenger').set_namespace('web_messenger');c('WebMessengerSubscriptionsHandler').addSubscriptions(j.subscribe('threads-deleted',function(ea,fa){var ga=c('WebMessengerStateManager').getCurrentStateData().thread_id,ha=c('WebMessengerStateManager').getCurrentDetailState();if(ha==c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES&&fa[ga]){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:null});}else o();}),c('WebMessengerStateManager').subscribe(c('WebMessengerStateConstants').STATE_CHANGE_EVENT,o));e(['MercuryBrowserAlerts'],function(ea){c('WebMessengerSubscriptionsHandler').addSubscriptions(j.subscribe('messages-received',function(fa,ga){for(var ha in ga){var ia=ga[ha];for(var ja=0;ja<ia.length;ja++)ea.messageReceived(ia[ja]);}}));ea.subscribe('before-alert',function(fa,event){if(event.threadID==q())event.cancelAlert();});});}function q(){var s=c('WebMessengerStateManager').getCurrentDetailState(),t=c('WebMessengerStateManager').getCurrentStateData();if(s==c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES||s==c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT)return t.thread_id;return null;}function r(s){var t=true;e(['ChatTabActions'],function(u){t&&u.persistLocalState();});c('WebMessengerSubscriptionsHandler').release();c('Arbiter').inform('chat/set_does_page_occlude_tabs',false,c('Arbiter').BEHAVIOR_PERSISTENT);c('Arbiter').inform('chat/set_show_tab_unread_ui',true,c('Arbiter').BEHAVIOR_PERSISTENT);s._masterViewManager.destroy();s._detailViewManager.destroy();t=false;}f.exports=p;}),null);
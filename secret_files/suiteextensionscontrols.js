try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['suiteextensionscontrols.js'] = (new Date()).getTime();
var SuiteExtensionsControls;(function(n){function t(){for(var r=document.querySelectorAll(".registerFileIcon"),e=SuiteExtensions.SuiteExtensionsDataStore.GetInstance(),n=0;n<r.length;n++){var f=r[n].title;var i=f.split(".");var t=i.length>=2?i[i.length-1]:"";t=t.toLowerCase();if(t!=""){var u=SuiteExtensions.ControlFactory.CreateControl(t,SuiteExtensions.ControlType.Icon);u!=null&&u.Render(r[n])}}}n.InitializeIconControls=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var SuiteExtensionsControls;(function(n){var t=function(){function n(n,t,i,r){this.overlayId=n;this.cancelHandler=r;this.overlay=this.newOverlay();this.dialog=this.newDialog(t,i);this.overlay.appendChild(this.dialog)}n.prototype.open=function(){if(document.getElementById(this.overlayId)==null){document.body.appendChild(this.overlay);this.overlay.style.visibility="visible"}else{var n=SuiteExtensions.SuiteExtensionsDataStore.GetInstance();n.hostConfig!=null&&n.hostConfig.logging.WriteDebugLog("OpenDialogControl",!1,"Dialog control with the same id is already opened.")}};n.prototype.close=function(){if(document.getElementById(this.overlayId)==this.overlay){this.overlay.style.visibility="hidden";document.body.removeChild(this.overlay)}};n.prototype.get_id=function(){return this.overlayId};n.prototype.cancelled=function(){this.close();this.cancelHandler!=null&&this.cancelHandler()};n.prototype.newOverlay=function(){var n=document.createElement("div");n.style.position="absolute";n.style.left="0px";n.style.top="0px";n.style.width="100%";n.style.height="100%";n.style.textAlign="center";n.style.zIndex="1000";n.style.visibility="hidden";n.style.backgroundColor="rgba(0,0,0,0)";n.id=this.overlayId;n.onclick=this.cancelled.bind(this);return n};n.prototype.newDialog=function(n,t){var r=document.createElement("div");r.style.padding="15px 0px 15px";r.appendChild(n);var u=document.createElement("div");u.style.textAlign="left";u.appendChild(t);var i=document.createElement("div");i.style.width="300px";i.style.margin="100px auto";i.style.backgroundColor="#fff";i.style.border="2px solid #000";i.style.padding="0px 0px 15px";i.style.textAlign="left";i.onclick=this.cancelClickProgate.bind(this);i.appendChild(r);i.appendChild(u);return i};n.prototype.cancelClickProgate=function(n){n=n||window.event;n.stopPropagation?n.stopPropagation():n.cancelBubble=!0};n.formId="AddInPicker";n.optionId="AddInChoice";return n}();n.DialogControl=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var SuiteExtensionsControls;(function(n){var t=function(){function n(n){this.defaultAddInKey=null;this.dataStore=SuiteExtensions.SuiteExtensionsDataStore.GetInstance();this.addIns=n}n.prototype.get_appId=function(){var n=this.get_defaultAddIn();return n.appId};n.prototype.get_addIns=function(){return this.addIns};n.prototype.get_addInCount=function(){return this.addIns.length};n.prototype.set_defaultAddInKey=function(n){var t=this.get_addIn(n);if(t!=null){this.defaultAddInKey=t.id;return!0}else{this.defaultAddInKey=null;return!1}var i="[Default AddIn = "+this.defaultAddInKey+"]";this.dataStore.hostConfig.logging.WriteDebugLog("SetDefaultHandler",!1,i)};n.prototype.get_defaultAddInKey=function(){return this.defaultAddInKey};n.prototype.get_defaultAddIn=function(){return this.get_addIn(this.get_defaultAddInKey())};n.prototype.get_addIn=function(n){typeof n=="undefined"&&(n=null);if(this.addIns.length<1)return null;if(n==undefined||n=="")return this.addIns[0];for(var i in this.addIns){var t=this.addIns[i];if(t.id==n)return t}return null};return n}();n.SuiteExtensionsControl=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var SuiteExtensionsControls;(function(n){var t=function(){function t(t,i,r,u,f,e){this.constAddInStoreLabel="Look for another app in the Office Store";this.constCheckBoxLabel="Always apply this choice for this file type";this.dataStore=SuiteExtensions.SuiteExtensionsDataStore.GetInstance();this.canStoreChoice=u;this.selectHandler=f;this.cancelHandler=e;this.dataStore.hostConfig!=null&&this.dataStore.hostConfig.logging.WriteStart("StartBuildingPickerUI");var c=document.createElement("div");c.style.padding="0px 15px 0px";c.appendChild(document.createTextNode(r));var h=document.createElement("div");if(this.canStoreChoice){var o=document.createElement("input");o.type="checkbox";o.style.marginRight="4px";var s=document.createElement("div");s.style.padding="0px 15px 0px";s.appendChild(o);s.appendChild(document.createTextNode(this.constCheckBoxLabel));h.appendChild(s);this.checkbox=o}else this.checkbox=null;h.appendChild(this.get_choiceList(i));this.pickerDialog=new n.DialogControl(t,c,h,this.dialogCancelled.bind(this));if(this.dataStore.hostConfig!=null){this.dataStore.hostConfig.logging.WriteSuccess("SuccessBuildingPickerUI");this.dataStore.hostConfig.logging.WriteDebugLog("SuccessBuildingPickerUI",!1,"Picker UI has been created and a link is avaialbe to call it")}}t.prototype.open=function(){this.pickerDialog.open()};t.prototype.close=function(){this.pickerDialog.close()};t.prototype.get_id=function(){return this.pickerDialog.get_id()};t.prototype.choiceSelected=function(n){var t=this.canStoreChoice&&this.checkbox!=null&&this.checkbox.checked?!0:!1;this.pickerDialog.close();this.selectHandler!=null&&this.selectHandler(n,t)};t.prototype.dialogCancelled=function(){this.cancelHandler!=null&&this.cancelHandler()};t.prototype.get_choiceList=function(n){this.dataStore.hostConfig!=null&&this.dataStore.hostConfig.logging.WriteStart("StartGeneratingChoiceList");var t=document.createElement("table");t.style.textAlign="left";t.style.width="100%";t.style.borderCollapse="collapse";t.style.padding="0px";var u=document.createElement("col");u.width="52px";t.appendChild(u);var e=document.createElement("col");t.appendChild(e);for(var i=0;i<n.length;i++){var r=n[i];var f=r.id;t.appendChild(this.newAddInChoice(r.fileIcon,r.displayName,f,this.choiceSelected.bind(this,f)))}this.dataStore.hostConfig!=null&&this.dataStore.hostConfig.logging.WriteSuccess("SuccessGeneratingChoiceList");return t};t.prototype.newAddInChoice=function(n,t,i,r){var e=document.createElement("img");e.src=n;e.style.width="32px";e.style.height="32px";e.style.display="block";var f=document.createElement("td");f.style.paddingTop="5px";f.style.paddingLeft="15px";f.style.paddingRight="5px";f.style.paddingBottom="5px";f.appendChild(e);var o=document.createElement("td");o.appendChild(document.createTextNode(t));var u=document.createElement("tr");u.id=i;u.appendChild(f);u.appendChild(o);u.onclick=r;u.onmouseover=function(){u.style.backgroundColor="#CDE6F7"};u.onmouseleave=function(){u.style.backgroundColor=""};return u};t.choiceListId="AddInPicker";return t}();n.FileHandlerPickerControl=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var __extends=this.__extends||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);function r(){this.constructor=n}r.prototype=t.prototype;n.prototype=new r};var SuiteExtensionsControls;(function(n){var t=function(t){__extends(i,t);function i(n,i,r,u){t.call(this,n);this.fileExtension=i;r==null&&(r="How do you want to handle this file ("+i+")?");this.titleForPicker=r;this.canRememberAddIn=u;this.canRememberAddIn&&this.loadStoredHandlerChoice()}i.prototype.pickFileHandler=function(t){var i=this.get_addIns();if(i.length>1&&this.get_defaultAddInKey()==null)if(this.dataStore.hostConfig.isFlightEnabled(SuiteExtensions.AddInsFlights.FileHandlerAddInPicker)){var f="overlay_"+this.fileExtension;var u=this.pickHandlerCallback.bind(this,t);var r=new n.FileHandlerPickerControl(f,i,this.titleForPicker,this.canRememberAddIn,u,null);r.open();return}else{t();return}else{t();return}};i.prototype.get_fileExtension=function(){return this.fileExtension};i.prototype.loadStoredHandlerChoice=function(){var i=SuiteExtensions.AddInType.FileHandler+"."+this.fileExtension;var t="[StorageKey = "+i+"]";this.dataStore.hostConfig.logging.WriteDebugLog("RetrievingHandlerChoice",!1,t);try{var n=sessionStorage.getItem(i)}catch(r){this.dataStore.hostConfig.logging.WriteDebugLog("RetrievedHandlerChoiceFailed",!0,"SessionStorage is disabled");return}if(n!=null){t="[Stored Choice = "+n+"]";this.dataStore.hostConfig.logging.WriteDebugLog("RetrievedHandlerChoice",!1,t);this.set_defaultAddInKey(n)}};i.prototype.storeHandlerChoice=function(n){var t=SuiteExtensions.AddInType.FileHandler+"."+this.fileExtension;this.dataStore.hostConfig.logging.WriteStart("StartStoreHandlerChoice");var i="[StorageKey = "+t+"][AddInKey = "+n+"]";this.dataStore.hostConfig.logging.WriteDebugLog("StoringHandlerChoice",!1,i);try{sessionStorage.setItem(t,n)}catch(r){this.dataStore.hostConfig.logging.WriteFailure("FailureStoreHandlerChoice");return}this.dataStore.hostConfig.logging.WriteSuccess("SuccessStoreHandlerChoice")};i.prototype.pickHandlerCallback=function(n,t,i){this.set_defaultAddInKey(t);i&&this.storeHandlerChoice(t);n()};return i}(n.SuiteExtensionsControl);n.FileHandlerControl=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var SuiteExtensionsControls;(function(n){var t=function(n){__extends(t,n);function t(t,i,r,u,f){n.call(this,t,i,r,u);this.appUrlProperty=f;this.resourceIdOverride=null}t.prototype.get_appUrl=function(){var n=this.get_defaultAddIn();return n[this.appUrlProperty]};t.prototype.set_httpRoot=function(n){this.httpRoot=n};t.prototype.set_itemUrl=function(n){this.itemUrl=n};t.prototype.getRedirectUrl=function(){var n=this.get_defaultAddIn();return this.getRedirectUrlForAddIn(n)};t.prototype.overrideResourceId=function(n){this.resourceIdOverride=n};t.prototype.render=function(n,t,i,r,u){var h=this.get_defaultAddIn();var s=h[this.appUrlProperty];if(n!=null&&s!=null&&s!=""){var e=this.getNewForm(s,t,i,r);if(u){this.dataStore.hostConfig!=null&&this.dataStore.hostConfig.logging.WriteStart("UsingFullWindow");n.appendChild(e)}else{this.dataStore.hostConfig!=null&&this.dataStore.hostConfig.logging.WriteStart("UsingChildIFrame");var f=document.createElement("iframe");f.style.width="100%";f.style.height="100%";f.style.borderWidth="0px";n.appendChild(f);var o=f.contentDocument;o.body==null&&o.write("<body></body>");o.body.appendChild(e);e=f.contentDocument.getElementsByTagName("form")[0]}e.submit();if(this.dataStore.hostConfig!=null){this.dataStore.hostConfig.logging.WriteSuccess("SuccessCallingDocumentControlFormPost");this.dataStore.hostConfig.logging.WriteDebugLog("UsingUrlToGetDocument",!1,"Clicked link to interact with the file using app with file extension definition")}}};t.prototype.getNewForm=function(n,t,i,r){this.dataStore.hostConfig!=null&&this.dataStore.hostConfig.logging.WriteStart("GeneratingContentRetrievalForm");var u=document.createElement("form");u.action=n;u.method="POST";u.style.visibility="Hidden";u.appendChild(this.newFormInput("fileget",i));u.appendChild(this.newFormInput("fileput",t));u.appendChild(this.newFormInput("fileid",r));this.resourceIdOverride==null?u.appendChild(this.newFormInput("resourceid",this.dataStore.hostConfig.resourceId)):u.appendChild(this.newFormInput("resourceid",this.resourceIdOverride));u.appendChild(this.newFormInput("culturename",this.dataStore.hostConfig.cultureName));u.appendChild(this.newFormInput("client",this.dataStore.hostConfig.host));var f=document.createElement("input");f.type="submit";u.appendChild(f);if(this.dataStore.hostConfig!=null){this.dataStore.hostConfig.logging.WriteSuccess("SuccessCallingPreviewIframePost");this.dataStore.hostConfig.logging.WriteDebugLog("UsingPreviewUrl",!1,"Clicked preview to preview the file from app using file extension definition")}return u};t.prototype.newFormInput=function(n,t){var i=document.createElement("input");i.type="hidden";i.id=n;i.name=n;i.value=t;return i};t.prototype.getRedirectUrlForAddIn=function(n){var t="";if(this.dataStore.hostConfig!=null&&(this.dataStore.hostConfig.host=="SharePoint"||this.dataStore.hostConfig.host=="OneDrive")){var i="/_layouts/15/online/cloudappsredirect.aspx?addintype=FileHandler&usemds=false";t=this.httpRoot+i+"&appurl="+encodeURIComponent(n[this.appUrlProperty])+"&appid="+encodeURIComponent(n.appId)+"&itemurl="+encodeURIComponent(this.itemUrl)}return t};return t}(n.FileHandlerControl);n.DocumentControl=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var SuiteExtensionsControls;(function(n){var t=function(n){__extends(t,n);function t(i,r){n.call(this,i,r,null,!0,t.constUrlPropertyName)}t.prototype.updateElement=function(n){this.pickFileHandler(this.doUpdateElement.bind(this,n))};t.prototype.doUpdateElement=function(n){var i=this.get_defaultAddIn();var t=i.openUrl;if(t!=null&&t!=""){this.dataStore.hostConfig!=null&&this.dataStore.hostConfig.logging.WriteStart("StartUpdateOpenUrl");n.setAttribute("href",this.getRedirectUrlForAddIn(i));if(this.dataStore.hostConfig!=null){this.dataStore.hostConfig.logging.WriteSuccess("SuccessUpdateOpenUrl");this.dataStore.hostConfig.logging.WriteDebugLog("UsingOpenUrl",!1,"FileHandler app is installed as custom open url is not empty. Clicked open to open the file from app using file extension definition.")}}};t.constUrlPropertyName="openUrl";return t}(n.DocumentControl);n.EditControl=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var SuiteExtensionsControls;(function(n){var i=function(){function n(){}return n}();n.FileCreationEntry=i;var t=function(t){__extends(i,t);function i(n){t.call(this,n);this.initializeInternalEntryInfo()}i.prototype.get_fileCreationEntries=function(){for(var i=[],t=0;t<this.internalEntryInfo.length;t++){var n=this.internalEntryInfo[t];i.push({imageUrl:n.addInCandidates[0].fileIcon,imageAlternateText:n.fileExtension,displayName:n.fileExtension.toUpperCase()+" File"})}return i};i.prototype.createNewFileControl=function(t){var i=this.internalEntryInfo[t];return new n.NewFileControl(i.addInCandidates,i.fileExtension)};i.prototype.initializeInternalEntryInfo=function(){for(var i=this.get_addIns(),u=[],n=0;n<i.length;n++)for(var f=i[n].extension,t=0;t<f.length;t++)u.push({fileExtension:f[t],addIn:i[n]});var r=this.GroupItemsBy(u,function(n){return n.fileExtension});this.internalEntryInfo=[];for(var n=0;n<r.length;n++){var o=r[n].key;var e=r[n].items.map(function(n){return n.addIn});this.internalEntryInfo.push({fileExtension:o,addInCandidates:e})}};i.prototype.GroupItemsBy=function(n,t){for(var e=[],f={},o=Object.prototype.hasOwnProperty,u=0;u<n.length;u++){var r=t(n[u]);var i;if(o.call(f,r))i=f[r];else{i={key:r,items:[]};e.push(i);f[r]=i}i.items.push(n[u])}return e};return i}(n.SuiteExtensionsControl);n.FileCreationMenu=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var SuiteExtensionsControls;(function(n){n.__namespace=!0})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var SuiteExtensionsControls;(function(n){var t=function(n){__extends(t,n);function t(t,i){n.call(this,t,i,null,!0)}t.prototype.getFileIcon=function(){var n=this.get_defaultAddIn();return n.fileIcon};t.prototype.Render=function(n){var i=this.get_defaultAddIn();if(i.fileIcon!=null&&i.fileIcon!=""){var t=n;if(t!=null){this.dataStore.hostConfig!=null&&this.dataStore.hostConfig.logging.WriteStart("StartUsingDocIconFromApp");t.setAttribute("src",i.fileIcon);t.setAttribute("width","16");t.setAttribute("height","16");if(this.dataStore.hostConfig!=null){this.dataStore.hostConfig.logging.WriteSuccess("SuccessUsingDocIconFromApp");this.dataStore.hostConfig.logging.WriteDebugLog("UsingDocIconFromApp",!1,"App Icon loaded using file extension definition")}}}};return t}(n.FileHandlerControl);n.IconControl=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var SuiteExtensionsControls;(function(n){var t=function(n){__extends(t,n);function t(i,r){var u="How do you want to create this file ("+r+")?";n.call(this,i,r,u,!1,t.constUrlPropertyName)}t.constUrlPropertyName="newFileUrl";return t}(n.DocumentControl);n.NewFileControl=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));var SuiteExtensionsControls;(function(n){var t=function(n){__extends(t,n);function t(i,r){n.call(this,i,r,null,!0,t.constUrlPropertyName)}t.prototype.appendCustomIframe=function(n){if(this.dataStore.hostConfig.isFlightEnabled(SuiteExtensions.AddInsFlights.FileHandlerAddInPicker)&&this.get_addInCount()>1){var t=document.createElement("a");t.href="#";t.innerText=Strings.CloudApps.L_AppToPreviewFile;t.onclick=this.pickFileHandler.bind(this,this.doAppendCustomIframe.bind(this,n));n.appendChild(t);return}else this.doAppendCustomIframe(n)};t.prototype.doAppendCustomIframe=function(n){var i=this.get_defaultAddIn();var r=i.previewUrl;if(n!=null&&r!=null&&r!=""){this.dataStore.hostConfig!=null&&this.dataStore.hostConfig.logging.WriteStart("StartCallingCustomPreviewIframe");var t=document.createElement("iframe");t.setAttribute("width","350");t.setAttribute("height","250");t.setAttribute("src",this.getRedirectUrlForAddIn(i));if(this.dataStore.hostConfig!=null){this.dataStore.hostConfig.logging.WriteSuccess("SuccessCallingCustomPreviewIframe");this.dataStore.hostConfig.logging.WriteDebugLog("UsingCustomPreviewUrl",!1,"FileHandler app is installed as custom preview url is not empty. Clicked preview to preview the file from app using file extension definition")}n.appendChild(t)}};t.constUrlPropertyName="previewUrl";return t}(n.DocumentControl);n.PreviewControl=t})(SuiteExtensionsControls||(SuiteExtensionsControls={}));
window.scriptsLoaded['suiteextensionscontrols.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['suiteextensionscontrols.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }

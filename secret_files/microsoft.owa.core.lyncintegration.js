try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.owa.core.lyncintegration.js'] = (new Date()).getTime();
Type.registerNamespace("_lwx");_lwx.j=function(n){this.a=n;this.b=_a.a.dD};_lwx.j.prototype={a:null,b:null,queueTimerCallback:function(n,t){return this.a.a(this.b,"SkypeQTC",n,t)},queuePeriodicCallback:function(n,t){return this.a.e(this.b,"SkypeQPC",n,t)},cancelTask:function(n){return this.a.b(n)},queueTask:function(n){this.a.c(this.b,"SkypeQTask",n)},queueIdleTask:function(n){this.a.d(this.b,"SkypeQITask",n)}};_lwx.k=function(n){this.b=Function.createDelegate(this,this.d);_lwx.k.initializeBase(this);this.a=n;this.a.apcl(_a.bn.b,this.b)};_lwx.k.prototype={a:null,c:null,lastUserActivityTime:function(){return this.c},ex:function(){this.a.rpcl(_a.bn.b,this.b);_a.jb.prototype.ex.call(this)},d:function(n,t){this.c=this.a.a}};_lwx.i=function(n){this.fW=Function.createDelegate(this,this.gU);this.fU=Function.createDelegate(this,this.gR);this.fT=Function.createDelegate(this,this.gQ);this.fV=Function.createDelegate(this,this.gS);_lwx.i.initializeBase(this,[null,!0,null]);this.dt=n};_lwx.i.prototype={dt:null,fj:!1,ga:function(){return this.dt?this.dt.a.b.c():null},gd:function(){return this.dt?this.dt.a.c.c():null},fx:function(n,t){return this.dt?this.dt.a.a.c():null},gV:function(){if(!this.fj&&this.dt){this.dt.b.a(this.fV);this.dt.a.a.a(this.fT);this.dt.a.b.a(this.fU);this.dt.a.c.a(this.fW);this.fj=!0}},gW:function(){if(this.fj&&this.dt){this.dt.b.d(this.fV);this.dt.a.a.d(this.fT);this.dt.a.b.d(this.fU);this.dt.a.c.d(this.fW);this.fj=!1}},gR:function(n){this.eu("DisplayName")},gQ:function(n){this.eu("PhotoUrl")},gU:function(n){this.eu("ImAddress")},gS:function(n){this.x(_lwx.c.a(n))}};_lwx.a=function(n,t,i,r){_lwx.a.initializeBase(this,[n,i.N.a().o().SkypeScriptsUrl,_lwx.a.c(t,i,r)])};_lwx.a.c=function(n,t,i){var r=new _sk.m(n,t.bh);r.g=i.a().WorkloadId||"OwaWorkloadId";r.f=i.a().UID||_j.i.e(i.a().UPN).toString();r.c=i.a().SHSID||_lwx.a.b();r.d=i.b().CorrelationID||_a.c.get_utcNow().h().toString();r.a=n===1?t.N.a().o().SkypeConsumerApiKey:t.N.a().o().SkypeEnterpriseApiKey;r.e=i.a().UPN;return r};_lwx.a.a=function(){return Math.floor((1+Math.random())*65536).toString(16).substr(1)};_lwx.a.b=function(){return _lwx.a.a()+_lwx.a.a()+"-"+_lwx.a.a()+"-"+_lwx.a.a()+"-"+_lwx.a.a()+"-"+_lwx.a.a()+_lwx.a.a()+_lwx.a.a()};_lwx.e=function(n){this.j=n};_lwx.e.prototype={j:null,a:function(n,t){return new _lwx.d(this.j,n,t,null,1)},b:function(n,t){return this.k(n,t,1)},g:function(n,t){return this.k(n,t,2)},h:function(n,t){return this.k(n,t,3)},i:function(n,t){return null},f:function(n){return null},k:function(n,t,i){var r=new _j.l;r.a(n);return new _lwx.d(this.j,r,null,t,i)}};_lwx.d=function(n,t,i,r,u){_lwx.d.initializeBase(this);_a.b.a(t,"participants");_a.b.g(t.x.length,0,"participants.Count");if(r){if(t.x.length!==1)throw Error.invalidOperation("imAddress can only be used in conjunction with a single participant.");if(i)throw Error.invalidOperation("imAddress and itemOrConversation are mutually exclusive.");}this.j=n;this.a=_lwx.d.a(n,t);_a.b.g(this.a.x.length,0,"No valid participants.");this.k=i;this.c=r;this.f=u;var f=this;_sk.a.a(function(n){f.i=n})};_lwx.d.a=function(n,t){for(var f=new _j.l,e={},r=0;r<t.x.length;r++){var i=t.x[r];if(i&&n.a(i.g())){var u=i.g();if(!(u in e)){f.a(i);e[u]=i}}}return f};_lwx.d.prototype={j:null,a:null,k:null,c:null,i:null,f:0,R:function(){_a.cU.prototype.R.call(this);if(this.a.x.length>0){_j.e.a(_ff.c.j,"Starting chat with "+this.a.x.length+" and first is "+this.c);for(var t=new Array(this.a.x.length),n=0;n<this.a.x.length;n++)t[n]=this.c||this.a.x[n].g();this.i.t(t,[this.f])}},bb:function(){return 0}};_lwx.b=function(n,t,i,r,u){this.S=Function.createDelegate(this,this.bg);this.P=Function.createDelegate(this,this.ba);this.U=Function.createDelegate(this,this.bi);this.V=Function.createDelegate(this,this.bj);this.Q=Function.createDelegate(this,this.be);this.R=Function.createDelegate(this,this.bf);this.T=Function.createDelegate(this,this.bh);this.W=Function.createDelegate(this,this.bk);this.F=new _j.l;this.Y=new _j.l;this.E={};this.I={};this.bm={};_lwx.b.initializeBase(this);_j.e.a(_a.a.ct,"LyncIntegrationChatManager started");if(!n){this.n("Initialization","Disabled");return}this.n("Initialization","unknown");this.J=u;this.G=!1;if(i){this.K=i;this.N=!0;r?this.bb(r):this.C="Disabled";this.K.b(_db.bL,this.W)}_sk.a.a(this.T)};_lwx.b.prototype={N:!1,Z:null,M:null,L:!1,C:"unknown",G:!1,D:null,J:null,K:null,d:function(){return this.C},b:function(){return this.C==="SignedIn"},e:function(){this.X("IsEnabled");return this.C!=="Disabled"},s:function(){return this.F},r:function(){return this.Y},t:function(){return!this.J.d()},c:function(){this.X("CurrentUserSipUri");return this.M},k:function(n){this.G=n;if(n){var i=this,t=this;_o365sg2p.e.b(!0,function(){},function(n){_j.e.c(_a.a.l,"ChatManager: Failed to set Skype auto-signin preference: {0}",n.message)})}this.n("SignIn","AttemptingSignIn");this.bd()},l:function(n){_j.e.a(_a.a.l,"Signing out.");this.n("SignOut:Manual="+n,"AttemptingSignOut");this.D.h(this.R,this.Q);this.D=null;if(n){var i=this,t=this;_o365sg2p.e.b(!1,function(){},function(n){_j.e.c(_a.a.l,"ChatManager: Failed to set Skype auto-signin preference to false: {0}",n.message)})}},h:function(n,t,i){},m:function(n,t){if(this.D){var i=t!=="Offline"?t:"Hidden";this.D.a().a.b(_sk.d.b(i))}},n:function(n,t){t==="Error";_j.e.a(_a.a.l,"SignInState: {0} Requesting change from {1} to {2}",n,this.C,t);var i=this.b();if(this.C!==t){this.C=t;this.bs(_lwx.b.a);this.b()!==i&&this.bs(_lwx.b.b)}},A:function(n,t){_j.e.a(_a.a.l,"Setting current user SIP URI to {0}",t);this.M=t},x:function(){},u:function(n){return _lwx.c.b(n)},g:function(n){return _lwx.c.c(n)},bt:function(){_j.Q.prototype.bt.call(this)},bf:function(){this.n("SignOutSucceeded","SignedOut")},bc:function(n,t,i){if(this.C!=="Disabled"){var r=n?"SignedOut":"Disabled";if(_j.i.a(i)){_j.e.a(_a.a.l,"The currentUserSipUri is null/empty -> Marking SignInState as disabled.");this.J.d()||(r="Disabled")}this.n("Configuration Updated",r)}this.Z=t;this.A("InternalSetConfiguration",i);this.L=!0},bd:function(){this.G&&_sk.e.a&&_sk.e.a.n();_sk.c.a.f(this.V)},bj:function(){this.n("SignInFailed","SignedOut")},bg:function(){this.K.a(_db.bK,new _db.bK)},bk:function(n){_sk.c.a.a(6)},ba:function(){this.n("SignInSucceeded","SignedIn");this.G=!1},be:function(n){this.n("SignOutFailed","SignedOut")},X:function(n){this.N&&(this.C==="unknown"||!this.L)&&_j.e.c(_a.a.l,"ChatManager: Do not access {0} until configuration has loaded.",n)},bb:function(n){var r=n.e().bk.InstantMessage;var i=n.c().bk.UserDisplayName;var t=n.c().bk.UserSipUri;this.bc(r,i,t)},z:function(n,t,i){return null},q:function(){return null},a:function(n){return this.b()&&!_j.i.b(n)&&(_j.i.b(this.c())||n.toLowerCase()!==this.c().toLowerCase())},f:function(n){for(var t=0;t<n.b();t++)if(this.a(n.a(t).SipUri))return!0;return!1},y:function(){this.D.a().d()},j:function(n){this.bw(_lwx.b.c,n)},bh:function(n){this.D=n;this.D.g(this.U);_sk.g.b?this.ba():_sk.g.c(this.P);_sk.c.a.d(this.S)},bi:function(n){if(n.b==="UnreadMessage"&&n.a){n.a.play();return}_sk.c.a.a(4);if(n.i()){var f=n.e.a.c.c();var t="IM:"+Math.random().toString();_j.e.a(_a.a.l,"OnSkypeNotification");if(!(t in this.E)){this.E[t]=n;var i=this;var r=function(r){_j.e.a(_a.a.l,"OnSkypeNotification handler");if(!r){for(var u=0;u<i.F.x.length;u++){var f=i.F.x[u];if(f.c().Id===t){i.F.o(f,!0);n.c.d(i.I[t]);delete i.I[t]}}t in i.E&&delete i.E[t]}};this.I[t]=r}this.bl(n.e,n.b,n.f.c(),t,n.a);var u=this.I[t];n.c.a(u)}},bl:function(n,t,i,r,u){var s=new _lwx.i(n);s.gV();var h=new _j.l;h.a(n);var f=new _h.g(!0);f.a().z(h);f.N(new _g.g(r));f.j=s;f.r=i;f.C=t;if(u){var e=u;f.w=e.$$d_play||(e.$$d_play=Function.createDelegate(e,e.play));var o=u;f.z=o.$$d_stop||(o.$$d_stop=Function.createDelegate(o,o.stop))}this.F.a(f)},O:function(n,t){this.F.o(n,!0);if(n.c().Id in this.E){var i=this.E[n.c().Id];if(t===3){i.d(1);_sk.c.a.a(2)}else if(t)t===1&&i.h();else{i.d();_sk.c.a.a(2)}n.j.gW();delete this.E[n.c().Id]}},w:function(n){},o:function(n){this.O(n,0)},p:function(n){this.O(n,3)},v:function(n){this.O(n,1)}};_lwx.b.d=function(){};_lwx.b.d.prototype={accept:0,decline:1,open:2,acceptWithIm:3};_lwx.b.d.registerEnum("_lwx.b.d",!1);_lwx.f=function(n,t,i,r){this.j=Function.createDelegate(this,this.o);this.l=new Sys.EventHandlerList;this.f=n;this.k=t;this.h=i;this.g=r;this.h.e(this.j);this.g.e(this.j)};_lwx.f.prototype={k:null,h:null,g:null,f:!1,m:!1,n:0,b:function(n){n&&this.f&&(this.i()?n():this.l.addHandler("chatInitialized",n))},a:function(){return this.i()&&this.f?this.k:null},e:function(){return this.i()&&this.f?this.h.b():null},d:function(){return this.i()&&this.f?this.g.b():null},c:function(){return this.f},i:function(){if(!this.f||this.m)return!0;this.h.a(null);this.g.a(null);return!1},o:function(){this.n++;if(this.n===2){this.m=!0;var n=this.l.getHandler("chatInitialized");n&&n()}}};_lwx.g=function(n,t,i,r,u){this.e=n;this.d=t;this.g=i;this.c=r;this.f=u};_lwx.g.prototype={e:!1,d:null,g:null,c:null,f:0,b:null,a:function(){_a.b.f(this.f,"Mouse","ChatProviderFactory.Create - Layout");this.b||(this.b=new _lwx.f(this.e,this.d,this.g,this.c));return this.b}};_lwx.h=function(n){this.i=Function.createDelegate(this,this.m);this.k=Function.createDelegate(this,this.o);this.j=Function.createDelegate(this,this.n);this.e={};this.g={};_lwx.h.initializeBase(this);_j.e.a(_a.a.ct,"LyncIntegration PresenceManager started");this.f=n;this.f.apcl(_lwx.b.a,this.j);this.h=this.f.d();_sk.a.a(this.k)};_lwx.h.prototype={f:null,d:null,h:"unknown",n:function(n,t){var u=n;var i=this.h;var f=i==="SignedIn";this.h=u.C;var r=this.f.d()==="SignedIn";if(f!==r&&!r){_j.e.a(_a.a.bm,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Resetting presence to Unknown everywhere.",i,this.h);this.D()}},o:function(n){this.d=n;this.p()},p:function(){var t=this.e;for(var n in t){var i={key:n,value:t[n]};this.l(i.key)}},c:function(n){if(!this.f.e())return!1;_j.e.a(_a.a.ct,"LyncIntegration PresenceManager TryRegisterForPresenceUpdates: {0}",n.g());n.apcl("ImAddress",this.i);if(_j.i.b(n.g()))return!0;var i=n.g().toLowerCase();i in this.e||(this.e[i]=new _j.q);var t=this.e[i];t.g(n)||t.c(n);t.d.length>1?n.x(t.d[0].X()):this.f.b()||n.x(0);this.l(i);return!0},l:function(n){if(this.d&&!(n in this.g)){var i=this;var t=function(t){for(var u=i.e[n],r=0;r<u.d.length;r++)u.d[r].x(_lwx.c.a(t))};this.g[n]=t;n!==this.f.c()?this.d.f(n).b.a(this.g[n]):this.d.a().a.a(this.g[n])}},a:function(n){_j.e.a(_a.a.ct,"LyncIntegration PresenceManager TryUnregisterForPresenceUpdates: {0}",n.g());if(!this.f.e())return!1;n.rpcl("ImAddress",this.i);if(_j.i.b(n.g()))return!1;var t=n.g().toLowerCase();if(!(t in this.e))return!1;var i=this.e[t];i.n(n);if(!i.d.length){delete this.e[t];if(this.d){this.d.f(t).b.d(this.g[t]);delete this.g[t]}}return!0},b:function(n,t){t.val=0;return!1},D:function(){this.q();this.d=null},q:function(){if(this.d){var i=this.e;for(var u in i){var n={key:u,value:i[u]};this.d.f(n.key).b.d(this.g[n.key]);delete this.g[n.key];for(var r=n.value,t=0;t<r.d.length;t++)r.d[t].x(0)}}},m:function(n,t){var i=n;_j.e.a(_a.a.ct,"LyncIntegration PresenceManager OnImAddressChangedForAPersona: {0}",i.g());i.rpcl("ImAddress",this.i);this.c(i)}};_lwx.c=function(){};_lwx.c.b=function(n){switch(n){case"Away":return 3;case"BeRightBack":return 3;case"Busy":return 4;case"DoNotDisturb":return 6;case"IdleBusy":return 4;case"IdleOnline":return 2;case"Offline":return 1;case"Online":return 2}return 0};_lwx.c.a=function(n){switch(n){case 5:case 4:return 3;case 2:return 4;case 3:return 6;case 6:return 1;case 1:return 2}return 0};_lwx.c.c=function(n){switch(n){case 2:return"Online";case 3:return"Away";case 5:return"IdleBusy";case 4:return"Busy";case 6:return"DoNotDisturb";case 1:return"Offline"}return"None"};_lwx.k.registerClass("_lwx.k",_a.jb,_sk.o);_lwx.i.registerClass("_lwx.i",_pc.a);_lwx.a.registerClass("_lwx.a",_sk.e);_lwx.d.registerClass("_lwx.d",_a.cU);_lwx.b.registerClass("_lwx.b",_j.Q,IChatManager,_j.bp,Sys.IDisposable);_lwx.h.registerClass("_lwx.h",_j.bZ,IPresenceManager);_lwx.b.a="SignInState";_lwx.b.b="IsSignedIn";_lwx.b.c="Presence";
window.scriptsLoaded['microsoft.owa.core.lyncintegration.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.owa.core.lyncintegration.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }
